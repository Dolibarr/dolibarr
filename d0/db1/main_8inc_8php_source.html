<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dolibarr: htdocs/main.inc.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dolibarr
   &#160;<span id="projectnumber">x.y.z</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_eaa9681d2effa5cf690be6ac05e74743.html">htdocs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">main.inc.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/db1/main_8inc_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* Copyright (C) 2002-2007  Rodolphe Quiedeville    &lt;rodolphe@quiedeville.org&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2003       Xavier Dutoit           &lt;doli@sydesy.com&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2004-2021  Laurent Destailleur     &lt;eldy@users.sourceforge.net&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 2004       Sebastien Di Cintio     &lt;sdicintio@ressource-toi.org&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Copyright (C) 2004       Benoit Mortier          &lt;benoit.mortier@opensides.be&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Copyright (C) 2005-2021  Regis Houssin           &lt;regis.houssin@inodbox.com&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 2011-2014  Philippe Grand          &lt;philippe.grand@atoo-net.com&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Copyright (C) 2008       Matteli</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Copyright (C) 2011-2016  Juanjo Menent           &lt;jmenent@2byte.es&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * Copyright (C) 2012       Christophe Battarel     &lt;christophe.battarel@altairis.fr&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Copyright (C) 2014-2015  Marcos García           &lt;marcosgdf@gmail.com&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Copyright (C) 2015       Raphaël Doursenaud      &lt;rdoursenaud@gpcsolutions.fr&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Copyright (C) 2020       Demarest Maxime         &lt;maxime@indelog.fr&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * Copyright (C) 2020       Charlene Benke          &lt;charlie@patas-monkey.com&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Copyright (C) 2021       Frédéric France         &lt;frederic.france@netlogic.fr&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * Copyright (C) 2021       Alexandre Spangaro      &lt;aspangaro@open-dsi.fr&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//@ini_set(&#39;memory_limit&#39;, &#39;128M&#39;); // This may be useless if memory is hard limited by your PHP</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// For optional tuning. Enabled if environment variable MAIN_SHOW_TUNING_INFO is defined.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;$micro_start_time = 0;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">&#39;MAIN_SHOW_TUNING_INFO&#39;</span>])) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  list($usec, $sec) = explode(<span class="stringliteral">&quot; &quot;</span>, microtime());</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  $micro_start_time = ((<a class="code" href="../../dd/dd1/md_2style_8css_8php.html#a30684cee0104698ef539bf2b69be6de8">float</a>) $usec + (<span class="keywordtype">float</span>) $sec);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">// Add Xdebug code coverage</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">//define(&#39;XDEBUGCOVERAGE&#39;,1);</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;XDEBUGCOVERAGE&#39;</span>)) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    xdebug_start_code_coverage();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a5eaeb45db72451a231c73bfe51fa6f38">   61</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a5eaeb45db72451a231c73bfe51fa6f38">realCharForNumericEntities</a>($matches)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  $newstringnumentity = preg_replace(<span class="stringliteral">&#39;/;$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $matches[1]);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">//print  &#39; $newstringnumentity=&#39;.$newstringnumentity;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^x/i&#39;</span>, $newstringnumentity)) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    $newstringnumentity = hexdec(preg_replace(<span class="stringliteral">&#39;/^x/i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $newstringnumentity));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// The numeric value we don&#39;t want as entities because they encode ascii char, and why using html entities on ascii except for haking ?</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (($newstringnumentity &gt;= 65 &amp;&amp; $newstringnumentity &lt;= 90) || ($newstringnumentity &gt;= 97 &amp;&amp; $newstringnumentity &lt;= 122)) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> chr((<span class="keywordtype">int</span>) $newstringnumentity);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&#39;&amp;#&#39;</span>.$matches[1]; <span class="comment">// Value will be unchanged because regex was /&amp;#(  )/</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a5e2e3d643df949095491e8438c80850e">   87</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a5e2e3d643df949095491e8438c80850e">testSqlAndScriptInject</a>($val, $type)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// Decode string first because a lot of things are obfuscated by encoding or multiple encoding.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// So &lt;svg o&amp;#110;load=&#39;console.log(&amp;quot;123&amp;quot;)&#39; become &lt;svg onload=&#39;console.log(&amp;quot;123&amp;quot;)&#39;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// So &quot;&amp;colon;&amp;apos;&quot; become &quot;:&#39;&quot; (due to ENT_HTML5)</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// So &quot;&amp;Tab;&amp;NewLine;&quot; become &quot;&quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// So &quot;&amp;lpar;&amp;rpar;&quot; become &quot;()&quot;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// Loop to decode until no more things to decode.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//print &quot;before decoding $val\n&quot;;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    $oldval = $val;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    $val = html_entity_decode($val, ENT_QUOTES | ENT_HTML5);  <span class="comment">// Decode &#39;&amp;colon;&#39;, &#39;&amp;apos;&#39;, &#39;&amp;Tab;&#39;, &#39;&amp;NewLine&#39;, ...</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Sometimes we have entities without the ; at end so html_entity_decode does not work but entities is still interpreted by browser.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    $val = preg_replace_callback(<span class="stringliteral">&#39;/&amp;#(x?[0-9][0-9a-f]+;?)/i&#39;</span>, <span class="keyword">function</span> ($m) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="comment">// Decode &#39;&amp;#110;&#39;, ...</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a5eaeb45db72451a231c73bfe51fa6f38">realCharForNumericEntities</a>($m); }, $val);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// We clean html comments because some hacks try to obfuscate evil strings by inserting HTML comments. Example: on&lt;!-- --&gt;error=alert(1)</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    $val = preg_replace(<span class="stringliteral">&#39;/&lt;!--[^&gt;]*--&gt;/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $val);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    $val = preg_replace(<span class="stringliteral">&#39;/[\r\n\t]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $val);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  } <span class="keywordflow">while</span> ($oldval != $val);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">//print &quot;type = &quot;.$type.&quot; after decoding: &quot;.$val.&quot;\n&quot;;</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  $inj = 0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// We check string because some hacks try to obfuscate evil strings by inserting non printable chars. Example: &#39;java(ascci09)scr(ascii00)ipt&#39; is processed like &#39;javascript&#39; (whatever is place of evil ascii char)</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">// We should use dol_string_nounprintableascii but function is not yet loaded/available</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// Example of valid UTF8 chars:</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// utf8=utf8mb3:    &#39;\x09&#39;, &#39;\x0A&#39;, &#39;\x0D&#39;, &#39;\x7E&#39;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// utf8=utf8mb3:  &#39;\xE0\xA0\x80&#39;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// utf8mb4:     &#39;\xF0\x9D\x84\x9E&#39;   (but this may be refused by the database insert if pagecode is utf8=utf8mb3)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  $newval = preg_replace(<span class="stringliteral">&#39;/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/u&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $val); <span class="comment">// /u operator makes UTF8 valid characters being ignored so are not included into the replace</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// Note that $newval may also be completely empty &#39;&#39; when non valid UTF8 are found.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span> ($newval != $val) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// If $val has changed after removing non valid UTF8 chars, it means we have an evil string.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    $inj += 1;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">//print &#39;type=&#39;.$type.&#39;-val=&#39;.$val.&#39;-newval=&#39;.$newval.&quot;-inj=&quot;.$inj.&quot;\n&quot;;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// For SQL Injection (only GET are used to scan for such injection strings)</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">if</span> ($type == 1 || $type == 3) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// Note the \s+ is replaced into \s* because some spaces may have been modified in previous loop</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/delete\s*from/i&#39;</span>, $val);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/create\s*table/i&#39;</span>, $val);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/insert\s*into/i&#39;</span>, $val);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/select\s*from/i&#39;</span>, $val);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/into\s*(outfile|dumpfile)/i&#39;</span>, $val);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/user\s*\&zwj;(/i&#39;</span>, $val); <span class="comment">// avoid to use function user() or mysql_user() that return current database login</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/information_schema/i&#39;</span>, $val); <span class="comment">// avoid to use request that read information_schema database</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/&lt;svg/i&#39;</span>, $val); <span class="comment">// &lt;svg can be allowed in POST</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/update[^&amp;].*set.+=/i&#39;</span>, $val);  <span class="comment">// the [^&amp;] test is to avoir error when request is like action=update&amp;...set...</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/union.+select/i&#39;</span>, $val);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> ($type == 3) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// Note the \s+ is replaced into \s* because some spaces may have been modified in previous loop</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/select|update|delete|truncate|replace|group\s*by|concat|count|from|union/i&#39;</span>, $val);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">if</span> ($type != 2) { <span class="comment">// Not common key strings, so we can check them both on GET and POST</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/updatexml\&zwj;(/i&#39;</span>, $val);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/(\.\.%2f)+/i&#39;</span>, $val);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/\s@@/&#39;</span>, $val);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// For XSS Injection done by closing textarea to execute content into a textarea field</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;\/textarea/i&#39;</span>, $val);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// For XSS Injection done by adding javascript with script</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// This is all cases a browser consider text is javascript:</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// When it found &#39;&lt;script&#39;, &#39;javascript:&#39;, &#39;&lt;style&#39;, &#39;onload\s=&#39; on body tag, &#39;=&quot;&amp;&#39; on a tag size with old browsers</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// All examples on page: http://ha.ckers.org/xss.html#XSScalc</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// More on https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;audio/i&#39;</span>, $val);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;embed/i&#39;</span>, $val);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;iframe/i&#39;</span>, $val);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;object/i&#39;</span>, $val);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&lt;script/i&#39;</span>, $val);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/Set\.constructor/i&#39;</span>, $val); <span class="comment">// ECMA script 6</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOSTYLECHECK&#39;</span>)) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/&lt;style/i&#39;</span>, $val);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/base\s+href/si&#39;</span>, $val);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/=data:/si&#39;</span>, $val);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// List of dom events is on https://www.w3schools.com/jsref/dom_obj_event.asp and https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(mouse|drag|key|load|touch|pointer|select|transition)([a-z]*)\s*=/i&#39;</span>, $val); <span class="comment">// onmousexxx can be set on img or any html tag like &lt;img title=&#39;...&#39; onmouseover=alert(1)&gt;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(abort|afterprint|animation|auxclick|beforecopy|beforecut|beforeprint|beforeunload|blur|cancel|canplay|canplaythrough|change|click|close|contextmenu|cuechange|copy|cut)\s*=/i&#39;</span>, $val);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(dblclick|drop|durationchange|emptied|end|ended|error|focus|focusin|focusout|formdata|gotpointercapture|hashchange|input|invalid)\s*=/i&#39;</span>, $val);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(lostpointercapture|offline|online|pagehide|pageshow)\s*=/i&#39;</span>, $val);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(paste|pause|play|playing|progress|ratechange|reset|resize|scroll|search|seeked|seeking|show|stalled|start|submit|suspend)\s*=/i&#39;</span>, $val);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(timeupdate|toggle|unload|volumechange|waiting|wheel)\s*=/i&#39;</span>, $val);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// We refuse html into html because some hacks try to obfuscate evil strings by inserting HTML into HTML. Example: &lt;img on&lt;a&gt;error=alert(1) to bypass test on onerror</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  $tmpval = preg_replace(<span class="stringliteral">&#39;/&lt;[^&lt;]+&gt;/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $val);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// List of dom events is on https://www.w3schools.com/jsref/dom_obj_event.asp and https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(mouse|drag|key|load|touch|pointer|select|transition)([a-z]*)\s*=/i&#39;</span>, $val); <span class="comment">// onmousexxx can be set on img or any html tag like &lt;img title=&#39;...&#39; onmouseover=alert(1)&gt;</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(abort|afterprint|animation|auxclick|beforecopy|beforecut|beforeprint|beforeunload|blur|cancel|canplay|canplaythrough|change|click|close|contextmenu|cuechange|copy|cut)\s*=/i&#39;</span>, $tmpval);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(dblclick|drop|durationchange|emptied|end|ended|error|focus|focusin|focusout|formdata|gotpointercapture|hashchange|input|invalid)\s*=/i&#39;</span>, $tmpval);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(lostpointercapture|offline|online|pagehide|pageshow)\s*=/i&#39;</span>, $tmpval);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(paste|pause|play|playing|progress|ratechange|reset|resize|scroll|search|seeked|seeking|show|stalled|start|submit|suspend)\s*=/i&#39;</span>, $tmpval);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/on(timeupdate|toggle|unload|volumechange|waiting|wheel)\s*=/i&#39;</span>, $tmpval);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">//$inj += preg_match(&#39;/on[A-Z][a-z]+\*=/&#39;, $val);   // To lock event handlers onAbort(), ...</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/&amp;#58;|&amp;#0000058|&amp;#x3A/i&#39;</span>, $val); <span class="comment">// refused string &#39;:&#39; encoded (no reason to have it encoded) to lock &#39;javascript:...&#39;</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/j\s*a\s*v\s*a\s*s\s*c\s*r\s*i\s*p\s*t\s*:/i&#39;</span>, $val);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  $inj += preg_match(<span class="stringliteral">&#39;/vbscript\s*:/i&#39;</span>, $val);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">// For XSS Injection done by adding javascript closing html tags like with onmousemove, etc... (closing a src or href tag with not cleaned param)</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">if</span> ($type == 1 || $type == 3) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    $val = str_replace(<span class="stringliteral">&#39;enclosure=&quot;&#39;</span>, <span class="stringliteral">&#39;enclosure=X&#39;</span>, $val); <span class="comment">// We accept enclosure=&quot; for the export/import module</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/&quot;/i&#39;</span>, $val); <span class="comment">// We refused &quot; in GET parameters value.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">if</span> ($type == 2) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    $inj += preg_match(<span class="stringliteral">&#39;/[:;&quot;\&#39;&lt;&gt;\?\&zwj;(\&zwj;){}\$%]/&#39;</span>, $val); <span class="comment">// PHP_SELF is a file system (or url path without parameters). It can contains spaces.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">return</span> $inj;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">  210</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>(&amp;$var, $type)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (is_array($var)) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">foreach</span> ($var as $key =&gt; $value) {  <span class="comment">// Warning, $key may also be used for attacks</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>($key, $type) &amp;&amp; <a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>($value, $type)) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">//$var[$key] = $value;  // This is useless</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">// Get remote IP: PS: We do not use getRemoteIP(), function is not yet loaded and we need a value that can&#39;t be spoofed</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        $ip = (empty($_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]) ? <span class="stringliteral">&#39;unknown&#39;</span> : $_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        $errormessage = <span class="stringliteral">&#39;Access refused to &#39;</span>.htmlentities($ip, ENT_COMPAT, <span class="stringliteral">&#39;UTF-8&#39;</span>).<span class="stringliteral">&#39; by SQL or Script injection protection in main.inc.php - GETPOST type=&#39;</span>.htmlentities($type, ENT_COMPAT, <span class="stringliteral">&#39;UTF-8&#39;</span>).<span class="stringliteral">&#39; paramkey=&#39;</span>.htmlentities($key, ENT_COMPAT, <span class="stringliteral">&#39;UTF-8&#39;</span>).<span class="stringliteral">&#39; paramvalue=&#39;</span>.htmlentities($value, ENT_COMPAT, <span class="stringliteral">&#39;UTF-8&#39;</span>).<span class="stringliteral">&#39; page=&#39;</span>.htmlentities($_SERVER[<span class="stringliteral">&quot;REQUEST_URI&quot;</span>], ENT_COMPAT, <span class="stringliteral">&#39;UTF-8&#39;</span>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        print $errormessage;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// Add entry into error log</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;error_log&#39;</span>)) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;          error_log($errormessage);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">// TODO Add entry into security audit table</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        exit;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="../../d0/db1/main_8inc_8php.html#a5e2e3d643df949095491e8438c80850e">testSqlAndScriptInject</a>($var, $type) &lt;= 0);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">// To disable the WAF for GET and POST and PHP_SELF, uncomment this</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">//define(&#39;NOSCANPHPSELFFORINJECTION&#39;, 1);</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">//define(&#39;NOSCANGETFORINJECTION&#39;, 1);</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">//define(&#39;NOSCANPOSTFORINJECTION&#39;, 1);</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">// Check consistency of NOREQUIREXXX DEFINES</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keywordflow">if</span> ((defined(<span class="stringliteral">&#39;NOREQUIREDB&#39;</span>) || defined(<span class="stringliteral">&#39;NOREQUIRETRAN&#39;</span>)) &amp;&amp; !defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>)) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  print <span class="stringliteral">&#39;If define NOREQUIREDB or NOREQUIRETRAN are set, you must also set NOREQUIREMENU or not set them.&#39;</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  exit;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;NOREQUIREUSER&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>)) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  print <span class="stringliteral">&#39;If define NOREQUIREUSER is set, you must also set NOREQUIREMENU or not set it.&#39;</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  exit;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">// Sanity check on URL</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOSCANPHPSELFFORINJECTION&#39;</span>) &amp;&amp; !empty($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>])) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  $morevaltochecklikepost = array($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>]);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>($morevaltochecklikepost, 2);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">// Sanity check on GET parameters</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOSCANGETFORINJECTION&#39;</span>) &amp;&amp; !empty($_SERVER[<span class="stringliteral">&quot;QUERY_STRING&quot;</span>])) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// Note: QUERY_STRING is url encoded, but $_GET and $_POST are already decoded</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// Because the analyseVarsForSqlAndScriptsInjection is designed for already url decoded value, we must decode QUERY_STRING</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// Another solution is to provide $_GET as parameter</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  $morevaltochecklikeget = array(urldecode($_SERVER[<span class="stringliteral">&quot;QUERY_STRING&quot;</span>]));</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>($morevaltochecklikeget, 1);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">// Sanity check on POST</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOSCANPOSTFORINJECTION&#39;</span>)) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a>($_POST, 0);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">// This is to make Dolibarr working with Plesk</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>]) &amp;&amp; substr($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>], -6) !== <span class="stringliteral">&#39;htdocs&#39;</span>) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  set_include_path($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>].<span class="stringliteral">&#39;/htdocs&#39;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">// Include the conf.php and functions.lib.php and security.lib.php. This defined the constants like DOL_DOCUMENT_ROOT, DOL_DATA_ROOT, DOL_URL_ROOT...</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;require_once <span class="stringliteral">&#39;filefunc.inc.php&#39;</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">// If there is a POST parameter to tell to save automatically some POST parameters into cookies, we do it.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">// This is used for example by form of boxes to save personalization of some options.</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">// DOL_AUTOSET_COOKIE=cookiename:val1,val2 and  cookiename_val1=aaa cookiename_val2=bbb will set cookie_name with value json_encode(array(&#39;val1&#39;=&gt; , ))</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keywordflow">if</span> (!empty($_POST[<span class="stringliteral">&quot;DOL_AUTOSET_COOKIE&quot;</span>])) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  $tmpautoset = explode(<span class="charliteral">&#39;:&#39;</span>, $_POST[<span class="stringliteral">&quot;DOL_AUTOSET_COOKIE&quot;</span>], 2);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  $tmplist = explode(<span class="charliteral">&#39;,&#39;</span>, $tmpautoset[1]);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  $cookiearrayvalue = array();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">foreach</span> ($tmplist as $tmpkey) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    $postkey = $tmpautoset[0].<span class="charliteral">&#39;_&#39;</span>.$tmpkey;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">//var_dump(&#39;tmpkey=&#39;.$tmpkey.&#39; postkey=&#39;.$postkey.&#39; value=&#39;.$_POST[$postkey]);</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (!empty($_POST[$postkey])) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      $cookiearrayvalue[$tmpkey] = $_POST[$postkey];</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  $cookiename = $tmpautoset[0];</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  $cookievalue = json_encode($cookiearrayvalue);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">//var_dump(&#39;setcookie cookiename=&#39;.$cookiename.&#39; cookievalue=&#39;.$cookievalue);</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">if</span> (PHP_VERSION_ID &lt; 70300) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    setcookie($cookiename, empty($cookievalue) ? <span class="stringliteral">&#39;&#39;</span> : $cookievalue, empty($cookievalue) ? 0 : (time() + (86400 * 354)), <span class="charliteral">&#39;/&#39;</span>, <span class="keyword">null</span>, ((empty($dolibarr_main_force_https) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4236d55151f75d548565509df223da18">isHTTPS</a>() === <span class="keyword">false</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>), <span class="keyword">true</span>); <span class="comment">// keep cookie 1 year and add tag httponly</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// Only available for php &gt;= 7.3</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    $cookieparams = array(</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="stringliteral">&#39;expires&#39;</span> =&gt; empty($cookievalue) ? 0 : (time() + (86400 * 354)),</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="stringliteral">&#39;path&#39;</span> =&gt; <span class="charliteral">&#39;/&#39;</span>,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="comment">//&#39;domain&#39; =&gt; &#39;.mywebsite.com&#39;, // the dot at the beginning allows compatibility with subdomains</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="stringliteral">&#39;secure&#39;</span> =&gt; ((empty($dolibarr_main_force_https) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4236d55151f75d548565509df223da18">isHTTPS</a>() === <span class="keyword">false</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="stringliteral">&#39;httponly&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="stringliteral">&#39;samesite&#39;</span> =&gt; <span class="stringliteral">&#39;Lax&#39;</span> <span class="comment">// None || Lax  || Strict</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    );</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    setcookie($cookiename, empty($cookievalue) ? <span class="stringliteral">&#39;&#39;</span> : $cookievalue, $cookieparams);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (empty($cookievalue)) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    unset($_COOKIE[$cookiename]);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">// Set the handler of session</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">// if (ini_get(&#39;session.save_handler&#39;) == &#39;user&#39;)</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordflow">if</span> (!empty($php_session_save_handler) &amp;&amp; $php_session_save_handler == <span class="stringliteral">&#39;db&#39;</span>) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  require_once <span class="stringliteral">&#39;core/lib/phpsessionin&#39;</span>.$php_session_save_handler.<span class="stringliteral">&#39;.lib.php&#39;</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">// Init session. Name of session is specific to Dolibarr instance.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">// Must be done after the include of filefunc.inc.php so global variables of conf file are defined (like $dolibarr_main_instance_unique_id or $dolibarr_main_force_https).</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">// Note: the function dol_getprefix() is defined into functions.lib.php but may have been defined to return a different key to manage another area to protect.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;$prefix = dol_getprefix(<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;$sessionname = <span class="stringliteral">&#39;DOLSESSID_&#39;</span>.$prefix;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;$sessiontimeout = <span class="stringliteral">&#39;DOLSESSTIMEOUT_&#39;</span>.$prefix;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="keywordflow">if</span> (!empty($_COOKIE[$sessiontimeout])) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  ini_set(<span class="stringliteral">&#39;session.gc_maxlifetime&#39;</span>, $_COOKIE[$sessiontimeout]);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">// This create lock, released by session_write_close() or end of page.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">// We need this lock as long as we read/write $_SESSION [&#39;vars&#39;]. We can remove lock when finished.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOSESSION&#39;</span>)) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">if</span> (PHP_VERSION_ID &lt; 70300) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    session_set_cookie_params(0, <span class="charliteral">&#39;/&#39;</span>, <span class="keyword">null</span>, ((empty($dolibarr_main_force_https) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4236d55151f75d548565509df223da18">isHTTPS</a>() === <span class="keyword">false</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>), <span class="keyword">true</span>); <span class="comment">// Add tag secure and httponly on session cookie (same as setting session.cookie_httponly into php.ini). Must be called before the session_start.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Only available for php &gt;= 7.3</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    $sessioncookieparams = array(</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="stringliteral">&#39;lifetime&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="stringliteral">&#39;path&#39;</span> =&gt; <span class="charliteral">&#39;/&#39;</span>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="comment">//&#39;domain&#39; =&gt; &#39;.mywebsite.com&#39;, // the dot at the beginning allows compatibility with subdomains</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="stringliteral">&#39;secure&#39;</span> =&gt; ((empty($dolibarr_main_force_https) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4236d55151f75d548565509df223da18">isHTTPS</a>() === <span class="keyword">false</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>),</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="stringliteral">&#39;httponly&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="stringliteral">&#39;samesite&#39;</span> =&gt; <span class="stringliteral">&#39;Lax&#39;</span> <span class="comment">// None || Lax  || Strict</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    session_set_cookie_params($sessioncookieparams);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  session_name($sessionname);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  session_start();  <span class="comment">// This call the open and read of session handler</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">//exit; // this exist generates a call to write and close</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">// Init the 5 global objects, this include will make the &#39;new Xxx()&#39; and set properties for: $conf, $db, $langs, $user, $mysoc</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;require_once <span class="stringliteral">&#39;master.inc.php&#39;</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">// If software has been locked. Only login $conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED is allowed.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED)) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  $ok = 0;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">if</span> ((!session_id() || !isset($_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>])) &amp;&amp; !isset($_POST[<span class="stringliteral">&quot;username&quot;</span>]) &amp;&amp; !empty($_SERVER[<span class="stringliteral">&quot;GATEWAY_INTERFACE&quot;</span>])) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    $ok = 1; <span class="comment">// We let working pages if not logged and inside a web browser (login form, to allow login by admin)</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  } elseif (isset($_POST[<span class="stringliteral">&quot;username&quot;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&quot;username&quot;</span>] == $conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    $ok = 1; <span class="comment">// We let working pages that is a login submission (login submit, to allow login by admin)</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  } elseif (defined(<span class="stringliteral">&#39;NOREQUIREDB&#39;</span>)) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    $ok = 1; <span class="comment">// We let working pages that don&#39;t need database access (xxx.css.php)</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  } elseif (defined(<span class="stringliteral">&#39;EVEN_IF_ONLY_LOGIN_ALLOWED&#39;</span>)) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    $ok = 1; <span class="comment">// We let working pages that ask to work even if only login enabled (logout.php)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  } elseif (session_id() &amp;&amp; isset($_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>]) &amp;&amp; $_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>] == $conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    $ok = 1; <span class="comment">// We let working if user is allowed admin</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (!$ok) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (session_id() &amp;&amp; isset($_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>]) &amp;&amp; $_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>] != $conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      print <span class="stringliteral">&#39;Sorry, your application is offline.&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      print <span class="stringliteral">&#39;You are logged with user &quot;&#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>].<span class="stringliteral">&#39;&quot; and only administrator user &quot;&#39;</span>.$conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED.<span class="stringliteral">&#39;&quot; is allowed to connect for the moment.&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      $nexturl = DOL_URL_ROOT.<span class="stringliteral">&#39;/user/logout.php?token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      print <span class="stringliteral">&#39;Please try later or &lt;a href=&quot;&#39;</span>.$nexturl.<span class="stringliteral">&#39;&quot;&gt;click here to disconnect and change login user&lt;/a&gt;...&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      print <span class="stringliteral">&#39;Sorry, your application is offline. Only administrator user &quot;&#39;</span>.$conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED.<span class="stringliteral">&#39;&quot; is allowed to connect for the moment.&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      $nexturl = DOL_URL_ROOT.<span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      print <span class="stringliteral">&#39;Please try later or &lt;a href=&quot;&#39;</span>.$nexturl.<span class="stringliteral">&#39;&quot;&gt;click here to change login user&lt;/a&gt;...&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    exit;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">// Activate end of page function</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;register_shutdown_function(<span class="stringliteral">&#39;dol_shutdown&#39;</span>);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">// Load debugbar</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;debugbar&#39;</span>) &amp;&amp; !<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>) &amp;&amp; empty($_SESSION[<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>])) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  global $debugbar;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/debugbar/class/DebugBar.php&#39;</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  $debugbar = <span class="keyword">new</span> <a class="code" href="../../dd/dda/class_dolibarr_debug_bar.html">DolibarrDebugBar</a>();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  $renderer = $debugbar-&gt;getRenderer();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_HTML_HEADER)) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    $conf-&gt;global-&gt;MAIN_HTML_HEADER = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  $conf-&gt;global-&gt;MAIN_HTML_HEADER .= $renderer-&gt;renderHead();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  $debugbar[<span class="stringliteral">&#39;time&#39;</span>]-&gt;startMeasure(<span class="stringliteral">&#39;pageaftermaster&#39;</span>, <span class="stringliteral">&#39;Page generation (after environment init)&#39;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">// Detection browser</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&quot;HTTP_USER_AGENT&quot;</span>])) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  $tmp = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a79ced81be2caf5eae76a9b550addd641">getBrowserInfo</a>($_SERVER[<span class="stringliteral">&quot;HTTP_USER_AGENT&quot;</span>]);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  $conf-&gt;browser-&gt;name = $tmp[<span class="stringliteral">&#39;browsername&#39;</span>];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  $conf-&gt;browser-&gt;os = $tmp[<span class="stringliteral">&#39;browseros&#39;</span>];</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  $conf-&gt;browser-&gt;version = $tmp[<span class="stringliteral">&#39;browserversion&#39;</span>];</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  $conf-&gt;browser-&gt;layout = $tmp[<span class="stringliteral">&#39;layout&#39;</span>]; <span class="comment">// &#39;classic&#39;, &#39;phone&#39;, &#39;tablet&#39;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">//var_dump($conf-&gt;browser);</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">if</span> ($conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span>) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    $conf-&gt;dol_no_mouse_hover = 1;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">// If theme is forced</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  $conf-&gt;theme = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  $conf-&gt;css = <span class="stringliteral">&quot;/theme/&quot;</span>.$conf-&gt;theme.<span class="stringliteral">&quot;/style.css.php&quot;</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">// Set global MAIN_OPTIMIZEFORTEXTBROWSER (must be before login part)</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;textbrowser&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || (!empty($conf-&gt;browser-&gt;name) &amp;&amp; $conf-&gt;browser-&gt;name == <span class="stringliteral">&#39;lynxlinks&#39;</span>)) {   <span class="comment">// If we must enable text browser</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  $conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER = 1;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">// Force HTTPS if required ($conf-&gt;file-&gt;main_force_https is 0/1 or &#39;https dolibarr root url&#39;)</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">// $_SERVER[&quot;HTTPS&quot;] is &#39;on&#39; when link is https, otherwise $_SERVER[&quot;HTTPS&quot;] is empty or &#39;off&#39;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;file-&gt;main_force_https) &amp;&amp; (empty($_SERVER[<span class="stringliteral">&quot;HTTPS&quot;</span>]) || $_SERVER[<span class="stringliteral">&quot;HTTPS&quot;</span>] != <span class="stringliteral">&#39;on&#39;</span>)) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  $newurl = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">if</span> (is_numeric($conf-&gt;file-&gt;main_force_https)) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> ($conf-&gt;file-&gt;main_force_https == <span class="charliteral">&#39;1&#39;</span> &amp;&amp; !empty($_SERVER[<span class="stringliteral">&quot;SCRIPT_URI&quot;</span>])) { <span class="comment">// If SCRIPT_URI supported by server</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^http:/i&#39;</span>, $_SERVER[<span class="stringliteral">&quot;SCRIPT_URI&quot;</span>]) &amp;&amp; !preg_match(<span class="stringliteral">&#39;/^https:/i&#39;</span>, $_SERVER[<span class="stringliteral">&quot;SCRIPT_URI&quot;</span>])) { <span class="comment">// If link is http</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        $newurl = preg_replace(<span class="stringliteral">&#39;/^http:/i&#39;</span>, <span class="stringliteral">&#39;https:&#39;</span>, $_SERVER[<span class="stringliteral">&quot;SCRIPT_URI&quot;</span>]);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">// Check HTTPS environment variable (Apache/mod_ssl only)</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      $newurl = preg_replace(<span class="stringliteral">&#39;/^http:/i&#39;</span>, <span class="stringliteral">&#39;https:&#39;</span>, DOL_MAIN_URL_ROOT).$_SERVER[<span class="stringliteral">&quot;REQUEST_URI&quot;</span>];</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// Check HTTPS environment variable (Apache/mod_ssl only)</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    $newurl = $conf-&gt;file-&gt;main_force_https.$_SERVER[<span class="stringliteral">&quot;REQUEST_URI&quot;</span>];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">// Start redirect</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">if</span> ($newurl) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    header_remove(); <span class="comment">// Clean header already set to be sure to remove any header like &quot;Set-Cookie: DOLSESSID_...&quot; from non HTTPS answers</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;main.inc: dolibarr_main_force_https is on, we make a redirect to &quot;</span>.$newurl);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    header(<span class="stringliteral">&quot;Location: &quot;</span>.$newurl);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    exit;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;main.inc: dolibarr_main_force_https is on but we failed to forge new https url so no redirect is done&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOLOGIN&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;NOIPCHECK&#39;</span>) &amp;&amp; !empty($dolibarr_main_restrict_ip)) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  $listofip = explode(<span class="charliteral">&#39;,&#39;</span>, $dolibarr_main_restrict_ip);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  $found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">foreach</span> ($listofip as $ip) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    $ip = trim($ip);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">if</span> ($ip == $_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      $found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (!$found) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    print <span class="stringliteral">&#39;Access refused by IP protection. Your detected IP is &#39;</span>.$_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>];</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    exit;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">// Loading of additional presentation includes</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOREQUIREHTML&#39;</span>)) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.form.class.php&#39;</span>; <span class="comment">// Need 660ko memory (800ko in 2.2)</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOREQUIREAJAX&#39;</span>)) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/ajax.lib.php&#39;</span>; <span class="comment">// Need 22ko memory</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">// If install or upgrade process not done or not completely finished, we call the install page.</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_NOT_INSTALLED) || !empty($conf-&gt;global-&gt;MAIN_NOT_UPGRADED)) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;main.inc: A previous install or upgrade was not complete. Redirect to install page.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  header(<span class="stringliteral">&quot;Location: &quot;</span>.DOL_URL_ROOT.<span class="stringliteral">&quot;/install/index.php&quot;</span>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  exit;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">// If an upgrade process is required, we call the install page.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordflow">if</span> ((!empty($conf-&gt;global-&gt;MAIN_VERSION_LAST_UPGRADE) &amp;&amp; ($conf-&gt;global-&gt;MAIN_VERSION_LAST_UPGRADE != DOL_VERSION))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;|| (empty($conf-&gt;global-&gt;MAIN_VERSION_LAST_UPGRADE) &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_VERSION_LAST_INSTALL) &amp;&amp; ($conf-&gt;global-&gt;MAIN_VERSION_LAST_INSTALL != DOL_VERSION))) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  $versiontocompare = empty($conf-&gt;global-&gt;MAIN_VERSION_LAST_UPGRADE) ? $conf-&gt;global-&gt;MAIN_VERSION_LAST_INSTALL : $conf-&gt;global-&gt;MAIN_VERSION_LAST_UPGRADE;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/admin.lib.php&#39;</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  $dolibarrversionlastupgrade = preg_split(<span class="stringliteral">&#39;/[.-]/&#39;</span>, $versiontocompare);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  $dolibarrversionprogram = preg_split(<span class="stringliteral">&#39;/[.-]/&#39;</span>, DOL_VERSION);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  $rescomp = <a class="code" href="../../da/d0f/admin_8lib_8php.html#a8040bdcb4bd2bd4da08017934341dad7">versioncompare</a>($dolibarrversionprogram, $dolibarrversionlastupgrade);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">if</span> ($rescomp &gt; 0) {   <span class="comment">// Programs have a version higher than database.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_NO_UPGRADE_REDIRECT_ON_LEVEL_3_CHANGE) || $rescomp &lt; 3) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">// We did not add &quot;&amp;&amp; $rescomp &lt; 3&quot; because we want upgrade process for build upgrades</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;main.inc: database version &quot;</span>.$versiontocompare.<span class="stringliteral">&quot; is lower than programs version &quot;</span>.DOL_VERSION.<span class="stringliteral">&quot;. Redirect to install/upgrade page.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      header(<span class="stringliteral">&quot;Location: &quot;</span>.DOL_URL_ROOT.<span class="stringliteral">&quot;/install/index.php&quot;</span>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      exit;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">// Creation of a token against CSRF vulnerabilities</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOTOKENRENEWAL&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;NOSESSION&#39;</span>)) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">// No token renewal on .css.php, .js.php and .json.php</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/\.(css|js|json)\.php$/&#39;</span>, $_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>])) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">// Rolling token at each call ($_SESSION[&#39;token&#39;] contains token of previous page)</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (isset($_SESSION[<span class="stringliteral">&#39;newtoken&#39;</span>])) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      $_SESSION[<span class="stringliteral">&#39;token&#39;</span>] = $_SESSION[<span class="stringliteral">&#39;newtoken&#39;</span>];</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (!isset($_SESSION[<span class="stringliteral">&#39;newtoken&#39;</span>]) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_SECURITY_CSRF_TOKEN_RENEWAL_ON_EACH_CALL&#39;</span>)) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="comment">// Note: Using MAIN_SECURITY_CSRF_TOKEN_RENEWAL_ON_EACH_CALL is not recommended: if a user succeed in entering a data from</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="comment">// a public page with a link that make a token regeneration, it can make use of the backoffice no more possible !</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="comment">// Save in $_SESSION[&#39;newtoken&#39;] what will be next token. Into forms, we will add param token = $_SESSION[&#39;newtoken&#39;]</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      $token = <a class="code" href="../../dd/df3/security_8lib_8php.html#ac12a777e000fbc4272e9460e11e33385">dol_hash</a>(uniqid(mt_rand(), <span class="keyword">false</span>), <span class="stringliteral">&#39;md5&#39;</span>); <span class="comment">// Generates a hash of a random number. We don&#39;t need a secured hash, just a changing random value.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      $_SESSION[<span class="stringliteral">&#39;newtoken&#39;</span>] = $token;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;NEW TOKEN generated by : &quot;</span>.$_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>], LOG_DEBUG);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">//dol_syslog(&quot;aaaa - &quot;.defined(&#39;NOCSRFCHECK&#39;).&quot; - &quot;.$dolibarr_nocsrfcheck.&quot; - &quot;.$conf-&gt;global-&gt;MAIN_SECURITY_CSRF_WITH_TOKEN.&quot; - &quot;.$_SERVER[&#39;REQUEST_METHOD&#39;].&quot; - &quot;.GETPOST(&#39;token&#39;, &#39;alpha&#39;));</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">// Check validity of token, only if option MAIN_SECURITY_CSRF_WITH_TOKEN enabled or if constant CSRFCHECK_WITH_TOKEN is set into page</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="keywordflow">if</span> ((!defined(<span class="stringliteral">&#39;NOCSRFCHECK&#39;</span>) &amp;&amp; empty($dolibarr_nocsrfcheck) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_SECURITY_CSRF_WITH_TOKEN&#39;</span>)) || defined(<span class="stringliteral">&#39;CSRFCHECK_WITH_TOKEN&#39;</span>)) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// Array of action code where CSRFCHECK with token will be forced (so token must be provided on url request)</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  $sensitiveget = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;massaction&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_SECURITY_CSRF_WITH_TOKEN&#39;</span>) &gt;= 3) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// All GET actions and mass actions are processed as sensitive.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;massaction&#39;</span>) || !in_array(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>), array(<span class="stringliteral">&#39;create&#39;</span>, <span class="stringliteral">&#39;createsite&#39;</span>, <span class="stringliteral">&#39;createcard&#39;</span>, <span class="stringliteral">&#39;edit&#39;</span>, <span class="stringliteral">&#39;editvalidator&#39;</span>, <span class="stringliteral">&#39;file_manager&#39;</span>, <span class="stringliteral">&#39;presend&#39;</span>, <span class="stringliteral">&#39;presend_addmessage&#39;</span>, <span class="stringliteral">&#39;preview&#39;</span>, <span class="stringliteral">&#39;specimen&#39;</span>))) { <span class="comment">// We exclude the case action=&#39;create&#39; and action=&#39;file_manager&#39; that are legitimate</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      $sensitiveget = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  } elseif (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_SECURITY_CSRF_WITH_TOKEN&#39;</span>) &gt;= 2) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// Few GET actions coded with a &amp;token into url are processed as sensitive.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    $arrayofactiontoforcetokencheck = array(</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="stringliteral">&#39;activate&#39;</span>,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="stringliteral">&#39;doprev&#39;</span>, <span class="stringliteral">&#39;donext&#39;</span>, <span class="stringliteral">&#39;dvprev&#39;</span>, <span class="stringliteral">&#39;dvnext&#39;</span>,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="stringliteral">&#39;freezone&#39;</span>, <span class="stringliteral">&#39;install&#39;</span>,</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="stringliteral">&#39;reopen&#39;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    );</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> (in_array(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>), $arrayofactiontoforcetokencheck)) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      $sensitiveget = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// We also match for value with just a simple string that must match</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(add|classify|close|confirm|copy|del|disable|enable|remove|set|unset|update|save)/&#39;</span>, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>))) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      $sensitiveget = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">// Check a token is provided for all cases that need a mandatory token</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">// (all POST actions + all sensitive GET actions + all mass actions + all login/actions/logout on pages with CSRFCHECK_WITH_TOKEN set)</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    $_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;POST&#39;</span> ||</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    $sensitiveget ||</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;massaction&#39;</span>) ||</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    ((<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;actionlogin&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;action&#39;</span>)) &amp;&amp; defined(<span class="stringliteral">&#39;CSRFCHECK_WITH_TOKEN&#39;</span>))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  ) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// If token is not provided or empty, error (we are in case it is mandatory)</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;token&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;token&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) == <span class="stringliteral">&#39;notrequired&#39;</span>) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../d0/db1/main_8inc_8php.html#a1bed423acec10147bfe221cd6fe286aa">top_httphead</a>();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;uploadform&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&quot; refused. File size too large or not provided.&quot;</span>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        $langs-&gt;loadLangs(array(<span class="stringliteral">&quot;errors&quot;</span>, <span class="stringliteral">&quot;install&quot;</span>));</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        print $langs-&gt;trans(<span class="stringliteral">&quot;ErrorFileSizeTooLarge&quot;</span>).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        print $langs-&gt;trans(<span class="stringliteral">&quot;ErrorGoBackAndCorrectParameters&quot;</span>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        http_response_code(403);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CSRFCHECK_WITH_TOKEN&#39;</span>)) {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&quot; refused by CSRF protection (CSRFCHECK_WITH_TOKEN protection) in main.inc.php. Token not provided.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          print <span class="stringliteral">&quot;Access to a page that needs a token (constant CSRFCHECK_WITH_TOKEN is defined) is refused by CSRF protection in main.inc.php. Token not provided.\n&quot;</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&quot; refused by CSRF protection (POST method or GET with a sensible value for &#39;action&#39; parameter) in main.inc.php. Token not provided.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          print <span class="stringliteral">&quot;Access to this page this way (POST method or GET with a sensible value for &#39;action&#39; parameter) is refused by CSRF protection in main.inc.php. Token not provided.\n&quot;</span>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          print <span class="stringliteral">&quot;If you access your server behind a proxy using url rewriting and the parameter is provided by caller, you might check that all HTTP header are propagated (or add the line \$dolibarr_nocsrfcheck=1 into your conf.php file or MAIN_SECURITY_CSRF_WITH_TOKEN to 0&quot;</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_SECURITY_CSRF_WITH_TOKEN)) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            print <span class="stringliteral">&quot; instead of &quot;</span>.$conf-&gt;global-&gt;MAIN_SECURITY_CSRF_WITH_TOKEN;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          print <span class="stringliteral">&quot; into setup).\n&quot;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      die;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  $sessiontokenforthisurl = (empty($_SESSION[<span class="stringliteral">&#39;token&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SESSION[<span class="stringliteral">&#39;token&#39;</span>]);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">// TODO Get the sessiontokenforthisurl into an array of session token (one array per base URL so we can use the CSRF per page and we keep ability for several tabs per url in a browser)</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;token&#39;</span>) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;token&#39;</span>) != <span class="stringliteral">&#39;notrequired&#39;</span> &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;token&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) != $sessiontokenforthisurl) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&quot; refused by CSRF protection (invalid token), so we disable POST and some GET parameters - referer=&quot;</span>.(empty($_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>])?<span class="stringliteral">&#39;&#39;</span>:$_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>]).<span class="stringliteral">&quot;, action=&quot;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>).<span class="stringliteral">&quot;, _GET|POST[&#39;token&#39;]=&quot;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;token&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>), LOG_WARNING);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">//dol_syslog(&quot;_SESSION[&#39;token&#39;]=&quot;.$sessiontokenforthisurl, LOG_DEBUG);</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// Do not output anything on standard output because this create problems when using the BACK button on browsers. So we just set a message into session.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>(<span class="stringliteral">&#39;SecurityTokenHasExpiredSoActionHasBeenCanceledPleaseRetry&#39;</span>, <span class="keyword">null</span>, <span class="stringliteral">&#39;warnings&#39;</span>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    $savid = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;id&#39;</span>])) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      $savid = ((int) $_POST[<span class="stringliteral">&#39;id&#39;</span>]);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    unset($_POST);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">//unset($_POST[&#39;action&#39;]); unset($_POST[&#39;massaction&#39;]);</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">//unset($_POST[&#39;confirm&#39;]); unset($_POST[&#39;confirmmassaction&#39;]);</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    unset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    unset($_GET[<span class="stringliteral">&#39;action&#39;</span>]);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    unset($_GET[<span class="stringliteral">&#39;confirmmassaction&#39;</span>]);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    unset($_GET[<span class="stringliteral">&#39;massaction&#39;</span>]);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    unset($_GET[<span class="stringliteral">&#39;token&#39;</span>]);      <span class="comment">// TODO Make a redirect if we have a token in url to remove it ?</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (isset($savid)) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      $_POST[<span class="stringliteral">&#39;id&#39;</span>] = ((int) $savid);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="comment">// Note: There is another CSRF protection into the filefunc.inc.php</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;}</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">// Disable modules (this must be after session_start and after conf has been loaded)</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;disablemodules&#39;</span>)) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  $_SESSION[<span class="stringliteral">&quot;disablemodules&quot;</span>] = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;disablemodules&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&quot;disablemodules&quot;</span>])) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  $modulepartkeys = array(<span class="stringliteral">&#39;css&#39;</span>, <span class="stringliteral">&#39;js&#39;</span>, <span class="stringliteral">&#39;tabs&#39;</span>, <span class="stringliteral">&#39;triggers&#39;</span>, <span class="stringliteral">&#39;login&#39;</span>, <span class="stringliteral">&#39;substitutions&#39;</span>, <span class="stringliteral">&#39;menus&#39;</span>, <span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;sms&#39;</span>, <span class="stringliteral">&#39;tpl&#39;</span>, <span class="stringliteral">&#39;barcode&#39;</span>, <span class="stringliteral">&#39;models&#39;</span>, <span class="stringliteral">&#39;societe&#39;</span>, <span class="stringliteral">&#39;hooks&#39;</span>, <span class="stringliteral">&#39;dir&#39;</span>, <span class="stringliteral">&#39;syslog&#39;</span>, <span class="stringliteral">&#39;tpllinkable&#39;</span>, <span class="stringliteral">&#39;contactelement&#39;</span>, <span class="stringliteral">&#39;moduleforexternal&#39;</span>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  $disabled_modules = explode(<span class="charliteral">&#39;,&#39;</span>, $_SESSION[<span class="stringliteral">&quot;disablemodules&quot;</span>]);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">foreach</span> ($disabled_modules as $module) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">if</span> ($module) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">if</span> (empty($conf-&gt;$module)) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        $conf-&gt;$module = <span class="keyword">new</span> stdClass(); <span class="comment">// To avoid warnings</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      $conf-&gt;$module-&gt;enabled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">foreach</span> ($modulepartkeys as $modulepartkey) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        unset($conf-&gt;modules_parts[$modulepartkey][$module]);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="keywordflow">if</span> ($module == <span class="stringliteral">&#39;fournisseur&#39;</span>) {   <span class="comment">// Special case</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        $conf-&gt;supplier_order-&gt;enabled = 0;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        $conf-&gt;supplier_invoice-&gt;enabled = 0;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">// Set current modulepart</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;$modulepart = explode(<span class="stringliteral">&quot;/&quot;</span>, $_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>]);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordflow">if</span> (is_array($modulepart) &amp;&amp; count($modulepart) &gt; 0) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">foreach</span> ($conf-&gt;modules as $module) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (in_array($module, $modulepart)) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      $modulepart = $module;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keywordflow">if</span> (is_array($modulepart)) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  $modulepart = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"> * Phase authentication / login</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;$login = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOLOGIN&#39;</span>)) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// $authmode lists the different method of identification to be tested in order of preference.</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">// Example: &#39;http&#39;, &#39;dolibarr&#39;, &#39;ldap&#39;, &#39;http,forceuser&#39;, &#39;...&#39;</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;MAIN_AUTHENTICATION_MODE&#39;</span>)) {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    $dolibarr_main_authentication = constant(<span class="stringliteral">&#39;MAIN_AUTHENTICATION_MODE&#39;</span>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">// Authentication mode</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">if</span> (empty($dolibarr_main_authentication)) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      $dolibarr_main_authentication = <span class="stringliteral">&#39;http,dolibarr&#39;</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="comment">// Authentication mode: forceuser</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> ($dolibarr_main_authentication == <span class="stringliteral">&#39;forceuser&#39;</span> &amp;&amp; empty($dolibarr_auto_user)) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      $dolibarr_auto_user = <span class="stringliteral">&#39;auto&#39;</span>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="comment">// Set authmode</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  $authmode = explode(<span class="charliteral">&#39;,&#39;</span>, $dolibarr_main_authentication);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">// No authentication mode</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">if</span> (!count($authmode)) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    $langs-&gt;load(<span class="stringliteral">&#39;main&#39;</span>);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a>(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;ErrorConfigParameterNotDefined&quot;</span>, <span class="stringliteral">&#39;dolibarr_main_authentication&#39;</span>));</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    exit;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">// If login request was already post, we retrieve login from the session</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// Call module if not realized that his request.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// At the end of this phase, the variable $login is defined.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  $resultFetchUser = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  $test = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordflow">if</span> (!isset($_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>])) {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// It is not already authenticated and it requests the login / password</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/security2.lib.php&#39;</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    $dol_dst_observed = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;dst_observed&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    $dol_dst_first = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;dst_first&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    $dol_dst_second = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;dst_second&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    $dol_screenwidth = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;screenwidth&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    $dol_screenheight = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;screenheight&quot;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    $dol_hide_topmenu = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    $dol_hide_leftmenu = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    $dol_optimize_smallscreen = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    $dol_no_mouse_hover = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    $dol_use_jmobile = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>, 3); <span class="comment">// 0=default, 1=to say we use app from a webview app, 2=to say we use app from a webview app and keep ajax</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">//dol_syslog(&quot;POST key=&quot;.join(array_keys($_POST),&#39;,&#39;).&#39; value=&#39;.join($_POST,&#39;,&#39;));</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">// If in demo mode, we check we go to home page through the public/demo/index.php page</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span> (!empty($dolibarr_main_demo) &amp;&amp; $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>] == DOL_URL_ROOT.<span class="stringliteral">&#39;/index.php&#39;</span>) {  <span class="comment">// We ask index page</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">if</span> (empty($_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>]) || !preg_match(<span class="stringliteral">&#39;/public/&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>])) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Call index page from another url than demo page (call is done from page &quot;</span>.$_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>].<span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        $url = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        $url .= ($url ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).($dol_hide_topmenu ? <span class="stringliteral">&#39;dol_hide_topmenu=&#39;</span>.$dol_hide_topmenu : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        $url .= ($url ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).($dol_hide_leftmenu ? <span class="stringliteral">&#39;dol_hide_leftmenu=&#39;</span>.$dol_hide_leftmenu : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        $url .= ($url ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).($dol_optimize_smallscreen ? <span class="stringliteral">&#39;dol_optimize_smallscreen=&#39;</span>.$dol_optimize_smallscreen : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        $url .= ($url ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).($dol_no_mouse_hover ? <span class="stringliteral">&#39;dol_no_mouse_hover=&#39;</span>.$dol_no_mouse_hover : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        $url .= ($url ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).($dol_use_jmobile ? <span class="stringliteral">&#39;dol_use_jmobile=&#39;</span>.$dol_use_jmobile : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        $url = DOL_URL_ROOT.<span class="stringliteral">&#39;/public/demo/index.php&#39;</span>.($url ? <span class="charliteral">&#39;?&#39;</span>.$url : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        header(<span class="stringliteral">&quot;Location: &quot;</span>.$url);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        exit;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// Hooks for security access</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;beforeLoginAuthentication&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      $test = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      $error++;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// Verification security graphic code</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> ($test &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>, 2) &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_SECURITY_ENABLECAPTCHA) &amp;&amp; !isset($_SESSION[<span class="stringliteral">&#39;dol_bypass_antispam&#39;</span>])) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      $sessionkey = <span class="stringliteral">&#39;dol_antispam_value&#39;</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      $ok = (array_key_exists($sessionkey, $_SESSION) === <span class="keyword">true</span> &amp;&amp; (strtolower($_SESSION[$sessionkey]) === strtolower(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;code&#39;</span>, <span class="stringliteral">&#39;restricthtml&#39;</span>))));</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="comment">// Check code</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">if</span> (!$ok) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&#39;Bad value for code, connexion refused&#39;</span>);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="comment">// Load translation files required by page</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        $langs-&gt;loadLangs(array(<span class="stringliteral">&#39;main&#39;</span>, <span class="stringliteral">&#39;errors&#39;</span>));</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorBadValueForCode&quot;</span>);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        $test = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="comment">// Call trigger for the &quot;security events&quot; log</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        $user-&gt;trigger_mesg = <span class="stringliteral">&#39;ErrorBadValueForCode - login=&#39;</span>.GETPOST(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>, 2);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="comment">// Call trigger</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        $result = $user-&gt;call_trigger(<span class="stringliteral">&#39;USER_LOGIN_FAILED&#39;</span>, $user);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          $error++;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment">// End call triggers</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="comment">// Hooks on failed login</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        $parameters = array(<span class="stringliteral">&#39;dol_authmode&#39;</span>=&gt;$authmode, <span class="stringliteral">&#39;dol_loginmesg&#39;</span>=&gt;$_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>]);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;afterLoginFailed&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          $error++;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="comment">// Note: exit is done later</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    $allowedmethodtopostusername = 2;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;MAIN_AUTHENTICATION_POST_METHOD&#39;</span>)) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      $allowedmethodtopostusername = constant(<span class="stringliteral">&#39;MAIN_AUTHENTICATION_POST_METHOD&#39;</span>);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    $usertotest = (!empty($_COOKIE[<span class="stringliteral">&#39;login_dolibarr&#39;</span>]) ? preg_replace(<span class="stringliteral">&#39;/[^a-zA-Z0-9_\-]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $_COOKIE[<span class="stringliteral">&#39;login_dolibarr&#39;</span>]) : <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>, $allowedmethodtopostusername));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    $passwordtotest = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;password&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>, $allowedmethodtopostusername);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    $entitytotest = (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;entity&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) ? <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;entity&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) : (!empty($conf-&gt;entity) ? $conf-&gt;entity : 1));</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// Define if we received data to test the login.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    $goontestloop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&quot;REMOTE_USER&quot;</span>]) &amp;&amp; in_array(<span class="stringliteral">&#39;http&#39;</span>, $authmode)) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      $goontestloop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span> ($dolibarr_main_authentication == <span class="stringliteral">&#39;forceuser&#39;</span> &amp;&amp; !empty($dolibarr_auto_user)) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      $goontestloop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>, $allowedmethodtopostusername) || !empty($_COOKIE[<span class="stringliteral">&#39;login_dolibarr&#39;</span>]) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;openid_mode&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>, 1)) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      $goontestloop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (!is_object($langs)) { <span class="comment">// This can occurs when calling page with NOREQUIRETRAN defined, however we need langs for error messages.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/translate.class.php&#39;</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      $langs = <span class="keyword">new</span> <a class="code" href="../../de/d47/class_translate.html">Translate</a>(<span class="stringliteral">&quot;&quot;</span>, $conf);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      $langcode = (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>, 1) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>, 1) : (empty($conf-&gt;global-&gt;MAIN_LANG_DEFAULT) ? <span class="stringliteral">&#39;auto&#39;</span> : $conf-&gt;global-&gt;MAIN_LANG_DEFAULT));</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;MAIN_LANG_DEFAULT&#39;</span>)) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        $langcode = constant(<span class="stringliteral">&#39;MAIN_LANG_DEFAULT&#39;</span>);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      $langs-&gt;setDefaultLang($langcode);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">// Validation of login/pass/entity</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// If ok, the variable login will be returned</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">// If error, we will put error message in session under the name dol_loginmesg</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">// Note authmode is an array for example: array(&#39;0&#39;=&gt;&#39;dolibarr&#39;, &#39;1&#39;=&gt;&#39;google&#39;);</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">if</span> ($test &amp;&amp; $goontestloop &amp;&amp; (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;actionlogin&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>) == <span class="stringliteral">&#39;login&#39;</span> || $dolibarr_main_authentication != <span class="stringliteral">&#39;dolibarr&#39;</span>)) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      $login = <a class="code" href="../../dc/d5b/security2_8lib_8php.html#a972e4b7c324a4112b55df0cb2f9f0713">checkLoginPassEntity</a>($usertotest, $passwordtotest, $entitytotest, $authmode);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="keywordflow">if</span> ($login === <span class="stringliteral">&#39;--bad-login-validity--&#39;</span>) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        $login = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      $dol_authmode = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">if</span> ($login) {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        $dol_authmode = $conf-&gt;authmode; <span class="comment">// This properties is defined only when logged, to say what mode was successfully used</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        $dol_tz = $_POST[<span class="stringliteral">&quot;tz&quot;</span>];</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        $dol_tz_string = $_POST[<span class="stringliteral">&quot;tz_string&quot;</span>];</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        $dol_tz_string = preg_replace(<span class="stringliteral">&#39;/\s*\&zwj;(.+\&zwj;)$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $dol_tz_string);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        $dol_tz_string = preg_replace(<span class="stringliteral">&#39;/,/&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, $dol_tz_string);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        $dol_tz_string = preg_replace(<span class="stringliteral">&#39;/\s/&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $dol_tz_string);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        $dol_dst = 0;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// Keep $_POST here. Do not use GETPOSTISSET</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&quot;dst_first&quot;</span>]) &amp;&amp; isset($_POST[<span class="stringliteral">&quot;dst_second&quot;</span>])) {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/date.lib.php&#39;</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          $datenow = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a>();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          $datefirst = <a class="code" href="../../db/df7/date_8lib_8php.html#ae0a2e540521a44e6a091e8f39c8cf4f5">dol_stringtotime</a>($_POST[<span class="stringliteral">&quot;dst_first&quot;</span>]);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          $datesecond = <a class="code" href="../../db/df7/date_8lib_8php.html#ae0a2e540521a44e6a091e8f39c8cf4f5">dol_stringtotime</a>($_POST[<span class="stringliteral">&quot;dst_second&quot;</span>]);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          <span class="keywordflow">if</span> ($datenow &gt;= $datefirst &amp;&amp; $datenow &lt; $datesecond) {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            $dol_dst = 1;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;          }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">//print $datefirst.&#39;-&#39;.$datesecond.&#39;-&#39;.$datenow.&#39;-&#39;.$dol_tz.&#39;-&#39;.$dol_tzstring.&#39;-&#39;.$dol_dst; exit;</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="keywordflow">if</span> (!$login) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&#39;Bad password, connexion refused&#39;</span>, LOG_DEBUG);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">// Load translation files required by page</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        $langs-&gt;loadLangs(array(<span class="stringliteral">&#39;main&#39;</span>, <span class="stringliteral">&#39;errors&#39;</span>));</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="comment">// Bad password. No authmode has found a good password.</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="comment">// We set a generic message if not defined inside function checkLoginPassEntity or subfunctions</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">if</span> (empty($_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>])) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorBadLoginPassword&quot;</span>);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">// Call trigger for the &quot;security events&quot; log</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        $user-&gt;trigger_mesg = $langs-&gt;trans(<span class="stringliteral">&quot;ErrorBadLoginPassword&quot;</span>).<span class="stringliteral">&#39; - login=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>, 2);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">// Call trigger</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        $result = $user-&gt;call_trigger(<span class="stringliteral">&#39;USER_LOGIN_FAILED&#39;</span>, $user);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          $error++;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="comment">// End call triggers</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment">// Hooks on failed login</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        $parameters = array(<span class="stringliteral">&#39;dol_authmode&#39;</span>=&gt;$dol_authmode, <span class="stringliteral">&#39;dol_loginmesg&#39;</span>=&gt;$_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>]);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;afterLoginFailed&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          $error++;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">// Note: exit is done in next chapter</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// End test login / passwords</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (!$login || (in_array(<span class="stringliteral">&#39;ldap&#39;</span>, $authmode) &amp;&amp; empty($passwordtotest))) { <span class="comment">// With LDAP we refused empty password because some LDAP are &quot;opened&quot; for anonymous access so connexion is a success.</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="comment">// No data to test login, so we show the login page.</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&quot; - action=&quot;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>).<span class="stringliteral">&quot; - actionlogin=&quot;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;actionlogin&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>).<span class="stringliteral">&quot; - showing the login form and exit&quot;</span>, LOG_NOTICE);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;NOREDIRECTBYMAINTOLOGIN&#39;</span>)) {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="comment">// When used with NOREDIRECTBYMAINTOLOGIN set, the http header must already be set when including the main.</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">// See example with selectsearchbox.php. This case is reserverd for the selectesearchbox.php so we can</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="comment">// report a message to ask to login when search ajax component is used after a timeout.</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="comment">//top_httphead();</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;ERROR_NOT_LOGGED&#39;</span>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">if</span> ($_SERVER[<span class="stringliteral">&quot;HTTP_USER_AGENT&quot;</span>] == <span class="stringliteral">&#39;securitytest&#39;</span>) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          http_response_code(401); <span class="comment">// It makes easier to understand if session was broken during security tests</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        dol_loginfunction($langs, $conf, (!empty($mysoc) ? $mysoc : <span class="stringliteral">&#39;&#39;</span>)); <span class="comment">// This include http headers</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      exit;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    $resultFetchUser = $user-&gt;fetch(<span class="stringliteral">&#39;&#39;</span>, $login, <span class="stringliteral">&#39;&#39;</span>, 1, ($entitytotest &gt; 0 ? $entitytotest : -1)); <span class="comment">// login was retrieved previously when checking password.</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> ($resultFetchUser &lt;= 0) {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&#39;User not found, connexion refused&#39;</span>);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      session_destroy();</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      session_set_cookie_params(0, <span class="charliteral">&#39;/&#39;</span>, <span class="keyword">null</span>, (empty($dolibarr_main_force_https) ? <span class="keyword">false</span> : <span class="keyword">true</span>), <span class="keyword">true</span>); <span class="comment">// Add tag secure and httponly on session cookie</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      session_name($sessionname);</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      session_start();</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">if</span> ($resultFetchUser == 0) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">// Load translation files required by page</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        $langs-&gt;loadLangs(array(<span class="stringliteral">&#39;main&#39;</span>, <span class="stringliteral">&#39;errors&#39;</span>));</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorCantLoadUserFromDolibarrDatabase&quot;</span>, $login);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        $user-&gt;trigger_mesg = <span class="stringliteral">&#39;ErrorCantLoadUserFromDolibarrDatabase - login=&#39;</span>.$login;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">if</span> ($resultFetchUser &lt; 0) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $user-&gt;error;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        $user-&gt;trigger_mesg = $user-&gt;error;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="comment">// Call trigger</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      $result = $user-&gt;call_trigger(<span class="stringliteral">&#39;USER_LOGIN_FAILED&#39;</span>, $user);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        $error++;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="comment">// End call triggers</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="comment">// Hooks on failed login</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      $parameters = array(<span class="stringliteral">&#39;dol_authmode&#39;</span>=&gt;$dol_authmode, <span class="stringliteral">&#39;dol_loginmesg&#39;</span>=&gt;$_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>]);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;afterLoginFailed&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        $error++;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      $paramsurl = array();</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;textbrowser&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;textbrowser=&#39;</span>.GETPOST(<span class="stringliteral">&#39;textbrowser&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;nojs&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;nojs=&#39;</span>.GETPOST(<span class="stringliteral">&#39;nojs&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;lang=&#39;</span>.GETPOST(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      header(<span class="stringliteral">&#39;Location: &#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/index.php&#39;</span>.(count($paramsurl) ? <span class="charliteral">&#39;?&#39;</span>.implode(<span class="charliteral">&#39;&amp;&#39;</span>, $paramsurl) : <span class="stringliteral">&#39;&#39;</span>));</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      exit;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="comment">// User is loaded, we may need to change language for him according to its choice</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordflow">if</span> (!empty($user-&gt;conf-&gt;MAIN_LANG_DEFAULT)) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        $langs-&gt;setDefaultLang($user-&gt;conf-&gt;MAIN_LANG_DEFAULT);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">// We are already into an authenticated session</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    $login = $_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>];</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    $entity = isset($_SESSION[<span class="stringliteral">&quot;dol_entity&quot;</span>]) ? $_SESSION[<span class="stringliteral">&quot;dol_entity&quot;</span>] : 0;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;- This is an already logged session. _SESSION[&#39;dol_login&#39;]=&quot;</span>.$login.<span class="stringliteral">&quot; _SESSION[&#39;dol_entity&#39;]=&quot;</span>.$entity, LOG_DEBUG);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    $resultFetchUser = $user-&gt;fetch(<span class="stringliteral">&#39;&#39;</span>, $login, <span class="stringliteral">&#39;&#39;</span>, 1, ($entity &gt; 0 ? $entity : -1));</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> ($resultFetchUser &lt;= 0) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="comment">// Account has been removed after login</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Can&#39;t load user even if session logged. _SESSION[&#39;dol_login&#39;]=&quot;</span>.$login, LOG_WARNING);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      session_destroy();</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      session_set_cookie_params(0, <span class="charliteral">&#39;/&#39;</span>, <span class="keyword">null</span>, (empty($dolibarr_main_force_https) ? <span class="keyword">false</span> : <span class="keyword">true</span>), <span class="keyword">true</span>); <span class="comment">// Add tag secure and httponly on session cookie</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      session_name($sessionname);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      session_start();</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      <span class="keywordflow">if</span> ($resultFetchUser == 0) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">// Load translation files required by page</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        $langs-&gt;loadLangs(array(<span class="stringliteral">&#39;main&#39;</span>, <span class="stringliteral">&#39;errors&#39;</span>));</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorCantLoadUserFromDolibarrDatabase&quot;</span>, $login);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        $user-&gt;trigger_mesg = <span class="stringliteral">&#39;ErrorCantLoadUserFromDolibarrDatabase - login=&#39;</span>.$login;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordflow">if</span> ($resultFetchUser &lt; 0) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        $_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>] = $user-&gt;error;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        $user-&gt;trigger_mesg = $user-&gt;error;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="comment">// Call trigger</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      $result = $user-&gt;call_trigger(<span class="stringliteral">&#39;USER_LOGIN_FAILED&#39;</span>, $user);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        $error++;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">// End call triggers</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">// Hooks on failed login</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      $parameters = array(<span class="stringliteral">&#39;dol_authmode&#39;</span>=&gt;$dol_authmode, <span class="stringliteral">&#39;dol_loginmesg&#39;</span>=&gt;$_SESSION[<span class="stringliteral">&quot;dol_loginmesg&quot;</span>]);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;afterLoginFailed&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        $error++;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      $paramsurl = array();</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;textbrowser&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;textbrowser=&#39;</span>.GETPOST(<span class="stringliteral">&#39;textbrowser&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;nojs&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;nojs=&#39;</span>.GETPOST(<span class="stringliteral">&#39;nojs&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      }</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        $paramsurl[] = <span class="stringliteral">&#39;lang=&#39;</span>.GETPOST(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      header(<span class="stringliteral">&#39;Location: &#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/index.php&#39;</span>.(count($paramsurl) ? <span class="charliteral">&#39;?&#39;</span>.implode(<span class="charliteral">&#39;&amp;&#39;</span>, $paramsurl) : <span class="stringliteral">&#39;&#39;</span>));</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      exit;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="comment">// Initialize technical object to manage hooks of page. Note that conf-&gt;hooks_modules contains array of hook context</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;main&#39;</span>));</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="comment">// Code for search criteria persistence.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">if</span> (!empty($_GET[<span class="stringliteral">&#39;save_lastsearch_values&#39;</span>]) &amp;&amp; !empty($_SERVER[<span class="stringliteral">&quot;HTTP_REFERER&quot;</span>])) {    <span class="comment">// We must use $_GET here</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        $relativepathstring = preg_replace(<span class="stringliteral">&#39;/\?.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $_SERVER[<span class="stringliteral">&quot;HTTP_REFERER&quot;</span>]);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^https?:\/\/[^\/]*/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring); <span class="comment">// Get full path except host server</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">// Clean $relativepathstring</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">if</span> (constant(<span class="stringliteral">&#39;DOL_URL_ROOT&#39;</span>)) {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^&#39;</span>.preg_quote(constant(<span class="stringliteral">&#39;DOL_URL_ROOT&#39;</span>), <span class="charliteral">&#39;/&#39;</span>).<span class="charliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^\//&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^custom\//&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="comment">//var_dump($relativepathstring);</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">// We click on a link that leave a page we have to save search criteria, contextpage, limit and page and mode. We save them from tmp to no tmp</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&#39;lastsearch_values_tmp_&#39;</span>.$relativepathstring])) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_values_&#39;</span>.$relativepathstring] = $_SESSION[<span class="stringliteral">&#39;lastsearch_values_tmp_&#39;</span>.$relativepathstring];</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_values_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_tmp_&#39;</span>.$relativepathstring])) {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_&#39;</span>.$relativepathstring] = $_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_tmp_&#39;</span>.$relativepathstring];</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring]) &amp;&amp; $_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring] != $conf-&gt;liste_limit) {</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_limit_&#39;</span>.$relativepathstring] = $_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring];</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring]) &amp;&amp; $_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring] &gt; 0) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_page_&#39;</span>.$relativepathstring] = $_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring];</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&#39;lastsearch_mode_tmp_&#39;</span>.$relativepathstring])) {</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_mode_&#39;</span>.$relativepathstring] = $_SESSION[<span class="stringliteral">&#39;lastsearch_mode_tmp_&#39;</span>.$relativepathstring];</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_mode_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;updateSession&#39;</span>, array(), $user, $action);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($hookmanager-&gt;error, $hookmanager-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// Is it a new session that has started ?</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">// If we are here, this means authentication was successfull.</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordflow">if</span> (!isset($_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>])) {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="comment">// New session for this login has started.</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    $error = 0;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="comment">// Store value into session (values always stored)</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>] = $user-&gt;login;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_authmode&quot;</span>] = isset($dol_authmode) ? $dol_authmode : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_tz&quot;</span>] = isset($dol_tz) ? $dol_tz : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_tz_string&quot;</span>] = isset($dol_tz_string) ? $dol_tz_string : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_dst&quot;</span>] = isset($dol_dst) ? $dol_dst : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_dst_observed&quot;</span>] = isset($dol_dst_observed) ? $dol_dst_observed : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_dst_first&quot;</span>] = isset($dol_dst_first) ? $dol_dst_first : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_dst_second&quot;</span>] = isset($dol_dst_second) ? $dol_dst_second : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_screenwidth&quot;</span>] = isset($dol_screenwidth) ? $dol_screenwidth : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_screenheight&quot;</span>] = isset($dol_screenheight) ? $dol_screenheight : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_company&quot;</span>] = <a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_SOCIETE_NOM&quot;</span>);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    $_SESSION[<span class="stringliteral">&quot;dol_entity&quot;</span>] = $conf-&gt;entity;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// Store value into session (values stored only if defined)</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">if</span> (!empty($dol_hide_topmenu)) {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      $_SESSION[<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>] = $dol_hide_topmenu;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    }</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span> (!empty($dol_hide_leftmenu)) {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      $_SESSION[<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>] = $dol_hide_leftmenu;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (!empty($dol_optimize_smallscreen)) {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      $_SESSION[<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>] = $dol_optimize_smallscreen;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">if</span> (!empty($dol_no_mouse_hover)) {</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      $_SESSION[<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>] = $dol_no_mouse_hover;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">if</span> (!empty($dol_use_jmobile)) {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      $_SESSION[<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>] = $dol_use_jmobile;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;This is a new started user session. _SESSION[&#39;dol_login&#39;]=&quot;</span>.$_SESSION[<span class="stringliteral">&quot;dol_login&quot;</span>].<span class="stringliteral">&quot; Session id=&quot;</span>.session_id());</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    $db-&gt;begin();</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    $user-&gt;update_last_login_date();</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    $loginfo = <span class="stringliteral">&#39;TZ=&#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_tz&quot;</span>].<span class="stringliteral">&#39;;TZString=&#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_tz_string&quot;</span>].<span class="stringliteral">&#39;;Screen=&#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_screenwidth&quot;</span>].<span class="charliteral">&#39;x&#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_screenheight&quot;</span>];</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="comment">// Call triggers for the &quot;security events&quot; log</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    $user-&gt;trigger_mesg = $loginfo;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">// Call trigger</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    $result = $user-&gt;call_trigger(<span class="stringliteral">&#39;USER_LOGIN&#39;</span>, $user);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      $error++;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// End call triggers</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// Hooks on successfull login</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;login&#39;</span>));</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    $parameters = array(<span class="stringliteral">&#39;dol_authmode&#39;</span>=&gt;$dol_authmode, <span class="stringliteral">&#39;dol_loginfo&#39;</span>=&gt;$loginfo);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;afterLogin&#39;</span>, $parameters, $user, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      $error++;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span> ($error) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      $db-&gt;rollback();</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      session_destroy();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a>($db, <span class="stringliteral">&#39;Error in some triggers USER_LOGIN or in some hooks afterLogin&#39;</span>);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      exit;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      $db-&gt;commit();</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">// Change landing page if defined.</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    $landingpage = (empty($user-&gt;conf-&gt;MAIN_LANDING_PAGE) ? (empty($conf-&gt;global-&gt;MAIN_LANDING_PAGE) ? <span class="stringliteral">&#39;&#39;</span> : $conf-&gt;global-&gt;MAIN_LANDING_PAGE) : $user-&gt;conf-&gt;MAIN_LANDING_PAGE);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span> (!empty($landingpage)) {    <span class="comment">// Example: /index.php</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      $newpath = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($landingpage, 1);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="keywordflow">if</span> ($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>] != $newpath) {   <span class="comment">// not already on landing page (avoid infinite loop)</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        header(<span class="stringliteral">&#39;Location: &#39;</span>.$newpath);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        exit;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  }</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="comment">// If user admin, we force the rights-based modules</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordflow">if</span> ($user-&gt;admin) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    $user-&gt;rights-&gt;user-&gt;user-&gt;lire = 1;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    $user-&gt;rights-&gt;user-&gt;user-&gt;creer = 1;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    $user-&gt;rights-&gt;user-&gt;user-&gt;password = 1;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    $user-&gt;rights-&gt;user-&gt;user-&gt;supprimer = 1;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    $user-&gt;rights-&gt;user-&gt;self-&gt;creer = 1;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    $user-&gt;rights-&gt;user-&gt;self-&gt;password = 1;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">//Required if advanced permissions are used with MAIN_USE_ADVANCED_PERMS</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_ADVANCED_PERMS)) {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;user-&gt;user_advance)) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        $user-&gt;rights-&gt;user-&gt;user_advance = <span class="keyword">new</span> stdClass(); <span class="comment">// To avoid warnings</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      }</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;user-&gt;self_advance)) {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        $user-&gt;rights-&gt;user-&gt;self_advance = <span class="keyword">new</span> stdClass(); <span class="comment">// To avoid warnings</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      }</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;user-&gt;group_advance)) {</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        $user-&gt;rights-&gt;user-&gt;group_advance = <span class="keyword">new</span> stdClass(); <span class="comment">// To avoid warnings</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      $user-&gt;rights-&gt;user-&gt;user_advance-&gt;readperms = 1;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      $user-&gt;rights-&gt;user-&gt;user_advance-&gt;write = 1;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      $user-&gt;rights-&gt;user-&gt;self_advance-&gt;readperms = 1;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      $user-&gt;rights-&gt;user-&gt;self_advance-&gt;writeperms = 1;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      $user-&gt;rights-&gt;user-&gt;group_advance-&gt;read = 1;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      $user-&gt;rights-&gt;user-&gt;group_advance-&gt;readperms = 1;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      $user-&gt;rights-&gt;user-&gt;group_advance-&gt;write = 1;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      $user-&gt;rights-&gt;user-&gt;group_advance-&gt;delete = 1;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">   * Overwrite some configs globals (try to avoid this and have code to use instead $user-&gt;conf-&gt;xxx)</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">// Set liste_limit</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">if</span> (isset($user-&gt;conf-&gt;MAIN_SIZE_LISTE_LIMIT)) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    $conf-&gt;liste_limit = $user-&gt;conf-&gt;MAIN_SIZE_LISTE_LIMIT; <span class="comment">// Can be 0</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">if</span> (isset($user-&gt;conf-&gt;PRODUIT_LIMIT_SIZE)) {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    $conf-&gt;product-&gt;limit_size = $user-&gt;conf-&gt;PRODUIT_LIMIT_SIZE; <span class="comment">// Can be 0</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">// Replace conf-&gt;css by personalized value if theme not forced</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_FORCETHEME) &amp;&amp; !empty($user-&gt;conf-&gt;MAIN_THEME)) {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    $conf-&gt;theme = $user-&gt;conf-&gt;MAIN_THEME;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    $conf-&gt;css = <span class="stringliteral">&quot;/theme/&quot;</span>.$conf-&gt;theme.<span class="stringliteral">&quot;/style.css.php&quot;</span>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">// We may have NOLOGIN set, but NOREQUIREUSER not</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span> (!empty($user) &amp;&amp; method_exists($user, <span class="stringliteral">&#39;loadDefaultValues&#39;</span>)) {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    $user-&gt;loadDefaultValues();   <span class="comment">// Load default values for everybody (works even if $user-&gt;id = 0</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;}</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">// Case forcing style from url</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  $conf-&gt;theme = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>, 1);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  $conf-&gt;css = <span class="stringliteral">&quot;/theme/&quot;</span>.$conf-&gt;theme.<span class="stringliteral">&quot;/style.css.php&quot;</span>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;}</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">// Set javascript option</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;nojs&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {  <span class="comment">// If javascript was not disabled on URL</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  $conf-&gt;use_javascript_ajax = 0;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordflow">if</span> (!empty($user-&gt;conf-&gt;MAIN_DISABLE_JAVASCRIPT)) {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    $conf-&gt;use_javascript_ajax = !$user-&gt;conf-&gt;MAIN_DISABLE_JAVASCRIPT;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">// Set MAIN_OPTIMIZEFORTEXTBROWSER for user (must be after login part)</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER) &amp;&amp; !empty($user-&gt;conf-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  $conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER = $user-&gt;conf-&gt;MAIN_OPTIMIZEFORTEXTBROWSER;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;}</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">// set MAIN_OPTIMIZEFORCOLORBLIND for user</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;$conf-&gt;global-&gt;MAIN_OPTIMIZEFORCOLORBLIND = empty($user-&gt;conf-&gt;MAIN_OPTIMIZEFORCOLORBLIND) ? <span class="stringliteral">&#39;&#39;</span> : $user-&gt;conf-&gt;MAIN_OPTIMIZEFORCOLORBLIND;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">// Set terminal output option according to conf-&gt;browser.</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || !empty($_SESSION[<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>])) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  $conf-&gt;dol_hide_leftmenu = 1;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;}</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || !empty($_SESSION[<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>])) {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  $conf-&gt;dol_hide_topmenu = 1;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || !empty($_SESSION[<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>])) {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  $conf-&gt;dol_optimize_smallscreen = 1;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || !empty($_SESSION[<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>])) {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  $conf-&gt;dol_no_mouse_hover = 1;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;}</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) || !empty($_SESSION[<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>])) {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  $conf-&gt;dol_use_jmobile = 1;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;}</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">// If not on Desktop</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;browser-&gt;layout) &amp;&amp; $conf-&gt;browser-&gt;layout != <span class="stringliteral">&#39;classic&#39;</span>) {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  $conf-&gt;dol_no_mouse_hover = 1;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;}</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">// If on smartphone or optmized for small screen</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keywordflow">if</span> ((!empty($conf-&gt;browser-&gt;layout) &amp;&amp; $conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span>)</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  || (!empty($_SESSION[<span class="stringliteral">&#39;dol_screenwidth&#39;</span>]) &amp;&amp; $_SESSION[<span class="stringliteral">&#39;dol_screenwidth&#39;</span>] &lt; 400)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  || (!empty($_SESSION[<span class="stringliteral">&#39;dol_screenheight&#39;</span>]) &amp;&amp; $_SESSION[<span class="stringliteral">&#39;dol_screenheight&#39;</span>] &lt; 400</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  || !empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER))</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;) {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  $conf-&gt;dol_optimize_smallscreen = 1;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordflow">if</span> (isset($conf-&gt;global-&gt;PRODUIT_DESC_IN_FORM) &amp;&amp; $conf-&gt;global-&gt;PRODUIT_DESC_IN_FORM == 1) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    $conf-&gt;global-&gt;PRODUIT_DESC_IN_FORM_ACCORDING_TO_DEVICE = 0;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;}</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">// Replace themes bugged with jmobile with eldy</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;dol_use_jmobile) &amp;&amp; in_array($conf-&gt;theme, array(<span class="stringliteral">&#39;bureau2crea&#39;</span>, <span class="stringliteral">&#39;cameleo&#39;</span>, <span class="stringliteral">&#39;amarok&#39;</span>))) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  $conf-&gt;theme = <span class="stringliteral">&#39;eldy&#39;</span>;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  $conf-&gt;css = <span class="stringliteral">&quot;/theme/&quot;</span>.$conf-&gt;theme.<span class="stringliteral">&quot;/style.css.php&quot;</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;}</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOREQUIRETRAN&#39;</span>)) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;lang&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) { <span class="comment">// If language was not forced on URL</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">// If user has chosen its own language</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">if</span> (!empty($user-&gt;conf-&gt;MAIN_LANG_DEFAULT)) {</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="comment">// If different than current language</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="comment">//print &quot;&gt;&gt;&gt;&quot;.$langs-&gt;getDefaultLang().&quot;-&quot;.$user-&gt;conf-&gt;MAIN_LANG_DEFAULT;</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="keywordflow">if</span> ($langs-&gt;getDefaultLang() != $user-&gt;conf-&gt;MAIN_LANG_DEFAULT) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        $langs-&gt;setDefaultLang($user-&gt;conf-&gt;MAIN_LANG_DEFAULT);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  }</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOLOGIN&#39;</span>)) {</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// If the login is not recovered, it is identified with an account that does not exist.</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">// Hacking attempt?</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keywordflow">if</span> (!$user-&gt;login) {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <a class="code" href="../../dd/df3/security_8lib_8php.html#ade2525beed17cc74b84932ff7483231d">accessforbidden</a>();</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  }</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160; </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="comment">// Check if user is active</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">if</span> ($user-&gt;statut &lt; 1) {</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="comment">// If not active, we refuse the user</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    $langs-&gt;loadLangs(array(<span class="stringliteral">&quot;errors&quot;</span>, <span class="stringliteral">&quot;other&quot;</span>));</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Authentication KO as login is disabled&quot;</span>, LOG_NOTICE);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <a class="code" href="../../dd/df3/security_8lib_8php.html#ade2525beed17cc74b84932ff7483231d">accessforbidden</a>(<span class="stringliteral">&quot;ErrorLoginDisabled&quot;</span>);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">// Load permissions</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  $user-&gt;getrights();</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;}</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;--- Access to &quot;</span>.(empty($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>].<span class="charliteral">&#39; &#39;</span>).$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39; - action=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>).<span class="stringliteral">&#39;, massaction=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;massaction&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>).(defined(<span class="stringliteral">&#39;NOTOKENRENEWAL&#39;</span>) ? <span class="stringliteral">&#39; NOTOKENRENEWAL=&#39;</span>.constant(<span class="stringliteral">&#39;NOTOKENRENEWAL&#39;</span>) : <span class="stringliteral">&#39;&#39;</span>), LOG_NOTICE);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">//Another call for easy debugg</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">//dol_syslog(&quot;Access to &quot;.$_SERVER[&quot;PHP_SELF&quot;].&#39; &#39;.$_SERVER[&quot;HTTP_REFERER&quot;].&#39; GET=&#39;.join(&#39;,&#39;,array_keys($_GET)).&#39;-&gt;&#39;.join(&#39;,&#39;,$_GET).&#39; POST:&#39;.join(&#39;,&#39;,array_keys($_POST)).&#39;-&gt;&#39;.join(&#39;,&#39;,$_POST));</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">// Load main languages files</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOREQUIRETRAN&#39;</span>)) {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">// Load translation files required by page</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  $langs-&gt;loadLangs(array(<span class="stringliteral">&#39;main&#39;</span>, <span class="stringliteral">&#39;dict&#39;</span>));</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;}</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">// Define some constants used for style of arrays</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;$bc = array(0=&gt;<span class="stringliteral">&#39;class=&quot;impair&quot;&#39;</span>, 1=&gt;<span class="stringliteral">&#39;class=&quot;pair&quot;&#39;</span>);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;$bcdd = array(0=&gt;<span class="stringliteral">&#39;class=&quot;drag drop oddeven&quot;&#39;</span>, 1=&gt;<span class="stringliteral">&#39;class=&quot;drag drop oddeven&quot;&#39;</span>);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;$bcnd = array(0=&gt;<span class="stringliteral">&#39;class=&quot;nodrag nodrop nohover&quot;&#39;</span>, 1=&gt;<span class="stringliteral">&#39;class=&quot;nodrag nodrop nohoverpair&quot;&#39;</span>); <span class="comment">// Used for tr to add new lines</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;$bctag = array(0=&gt;<span class="stringliteral">&#39;class=&quot;impair tagtr&quot;&#39;</span>, 1=&gt;<span class="stringliteral">&#39;class=&quot;pair tagtr&quot;&#39;</span>);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">// Define messages variables</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;$mesg = <span class="stringliteral">&#39;&#39;</span>; $warning = <span class="stringliteral">&#39;&#39;</span>; $error = 0;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">// deprecated, see setEventMessages() and dol_htmloutput_events()</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;$mesgs = array(); $warnings = array(); $errors = array();</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">// Constants used to defined number of lines in textarea</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="keywordflow">if</span> (empty($conf-&gt;browser-&gt;firefox)) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  define(<span class="stringliteral">&#39;ROWS_1&#39;</span>, 1);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  define(<span class="stringliteral">&#39;ROWS_2&#39;</span>, 2);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  define(<span class="stringliteral">&#39;ROWS_3&#39;</span>, 3);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  define(<span class="stringliteral">&#39;ROWS_4&#39;</span>, 4);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  define(<span class="stringliteral">&#39;ROWS_5&#39;</span>, 5);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  define(<span class="stringliteral">&#39;ROWS_6&#39;</span>, 6);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  define(<span class="stringliteral">&#39;ROWS_7&#39;</span>, 7);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  define(<span class="stringliteral">&#39;ROWS_8&#39;</span>, 8);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  define(<span class="stringliteral">&#39;ROWS_9&#39;</span>, 9);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  define(<span class="stringliteral">&#39;ROWS_1&#39;</span>, 0);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  define(<span class="stringliteral">&#39;ROWS_2&#39;</span>, 1);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  define(<span class="stringliteral">&#39;ROWS_3&#39;</span>, 2);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  define(<span class="stringliteral">&#39;ROWS_4&#39;</span>, 3);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  define(<span class="stringliteral">&#39;ROWS_5&#39;</span>, 4);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  define(<span class="stringliteral">&#39;ROWS_6&#39;</span>, 5);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  define(<span class="stringliteral">&#39;ROWS_7&#39;</span>, 6);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  define(<span class="stringliteral">&#39;ROWS_8&#39;</span>, 7);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  define(<span class="stringliteral">&#39;ROWS_9&#39;</span>, 8);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;}</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;$heightforframes = 50;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">// Init menu manager</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>)) {</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">if</span> (empty($user-&gt;socid)) {    <span class="comment">// If internal user or not defined</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    $conf-&gt;standard_menu = (empty($conf-&gt;global-&gt;MAIN_MENU_STANDARD_FORCED) ? (empty($conf-&gt;global-&gt;MAIN_MENU_STANDARD) ? <span class="stringliteral">&#39;eldy_menu.php&#39;</span> : $conf-&gt;global-&gt;MAIN_MENU_STANDARD) : $conf-&gt;global-&gt;MAIN_MENU_STANDARD_FORCED);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="comment">// If external user</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    $conf-&gt;standard_menu = (empty($conf-&gt;global-&gt;MAIN_MENUFRONT_STANDARD_FORCED) ? (empty($conf-&gt;global-&gt;MAIN_MENUFRONT_STANDARD) ? <span class="stringliteral">&#39;eldy_menu.php&#39;</span> : $conf-&gt;global-&gt;MAIN_MENUFRONT_STANDARD) : $conf-&gt;global-&gt;MAIN_MENUFRONT_STANDARD_FORCED);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  }</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="comment">// Load the menu manager (only if not already done)</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  $file_menu = $conf-&gt;standard_menu;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;menu&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>)) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    $file_menu = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;menu&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>); <span class="comment">// example: menu=eldy_menu.php</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;MenuManager&#39;</span>)) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    $menufound = 0;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    $dirmenus = array_merge(array(<span class="stringliteral">&quot;/core/menus/&quot;</span>), (array) $conf-&gt;modules_parts[<span class="stringliteral">&#39;menus&#39;</span>]);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">foreach</span> ($dirmenus as $dirmenu) {</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      $menufound = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a5b2b52738954b2638dc9aa54bf019bd6">dol_include_once</a>($dirmenu.<span class="stringliteral">&quot;standard/&quot;</span>.$file_menu);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <span class="keywordflow">if</span> (class_exists(<span class="stringliteral">&#39;MenuManager&#39;</span>)) {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    }</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;MenuManager&#39;</span>)) { <span class="comment">// If failed to include, we try with standard eldy_menu.php</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;You define a menu manager &#39;&quot;</span>.$file_menu.<span class="stringliteral">&quot;&#39; that can not be loaded.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      $file_menu = <span class="stringliteral">&#39;eldy_menu.php&#39;</span>;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&quot;/core/menus/standard/&quot;</span>.$file_menu;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  $menumanager = <span class="keyword">new</span> <a class="code" href="../../d9/db2/class_menu_manager.html">MenuManager</a>($db, empty($user-&gt;socid) ? 0 : 1);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  $menumanager-&gt;loadMenu();</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;}</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">// Functions</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&quot;llxHeader&quot;</span>)) {</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keyword">function</span> <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#a3e1c89b902a5beaa3d5476a09cd591ae">llxHeader</a>($head = <span class="stringliteral">&#39;&#39;</span>, $title = <span class="stringliteral">&#39;&#39;</span>, <a class="code" href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a> = <span class="stringliteral">&#39;&#39;</span>, $target = <span class="stringliteral">&#39;&#39;</span>, $disablejs = 0, $disablehead = 0, $arrayofjs = <span class="stringliteral">&#39;&#39;</span>, $arrayofcss = <span class="stringliteral">&#39;&#39;</span>, $morequerystring = <span class="stringliteral">&#39;&#39;</span>, $morecssonbody = <span class="stringliteral">&#39;&#39;</span>, $replacemainareaby = <span class="stringliteral">&#39;&#39;</span>, $disablenofollow = 0, $disablenoindex = 0)</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    global $conf, $hookmanager;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="comment">// html header</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <a class="code" href="../../d0/db1/main_8inc_8php.html#a7ca53bfd6df5afab29b5a6c468bdefde">top_htmlhead</a>($head, $title, $disablejs, $disablehead, $arrayofjs, $arrayofcss, 0, $disablenofollow, $disablenoindex);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160; </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    $tmpcsstouse = <span class="stringliteral">&#39;sidebar-collapse&#39;</span>.($morecssonbody ? <span class="charliteral">&#39; &#39;</span>.$morecssonbody : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="comment">// If theme MD and classic layer, we open the menulayer by default.</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span> ($conf-&gt;theme == <span class="stringliteral">&#39;md&#39;</span> &amp;&amp; !in_array($conf-&gt;browser-&gt;layout, array(<span class="stringliteral">&#39;phone&#39;</span>, <span class="stringliteral">&#39;tablet&#39;</span>)) &amp;&amp; empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      global $mainmenu;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <span class="keywordflow">if</span> ($mainmenu != <span class="stringliteral">&#39;website&#39;</span>) {</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        $tmpcsstouse = $morecssonbody; <span class="comment">// We do not use sidebar-collpase by default to have menuhider open by default.</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORCOLORBLIND)) {</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      $tmpcsstouse .= <span class="stringliteral">&#39; colorblind-&#39;</span>.strip_tags($conf-&gt;global-&gt;MAIN_OPTIMIZEFORCOLORBLIND);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    print <span class="stringliteral">&#39;&lt;body id=&quot;mainbody&quot; class=&quot;&#39;</span>.$tmpcsstouse.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160; </div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    $parameters = array(<span class="stringliteral">&#39;help_url&#39;</span> =&gt; <a class="code" href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a>);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;changeHelpURL&#39;</span>, $parameters);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordflow">if</span> ($reshook &gt; 0) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <a class="code" href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a> = $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="comment">// top menu and left menu area</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">if</span> ((empty($conf-&gt;dol_hide_topmenu) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_invisible_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) &amp;&amp; !<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_openinpopup&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      <a class="code" href="../../d0/db1/main_8inc_8php.html#ac4f1c6ce25e9080a698fac2a61506493">top_menu</a>($head, $title, $target, $disablejs, $disablehead, $arrayofjs, $arrayofcss, $morequerystring, <a class="code" href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a>);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160; </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; !<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_openinpopup&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>)) {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <a class="code" href="../../d0/db1/main_8inc_8php.html#a10fa94a9a5f6491258b175619f29d5b5">left_menu</a>(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 1, $title, 1); <span class="comment">// $menumanager is retrieved with a global $menumanager inside this function</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160; </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// main area</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">if</span> ($replacemainareaby) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      print $replacemainareaby;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <a class="code" href="../../d0/db1/main_8inc_8php.html#a71f645436a1f28ec966676ef50f4eaf0">main_area</a>($title);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;}</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160; </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a1bed423acec10147bfe221cd6fe286aa"> 1436</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a1bed423acec10147bfe221cd6fe286aa">top_httphead</a>($contenttype = <span class="stringliteral">&#39;text/html&#39;</span>, $forcenocache = 0)</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;{</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  global $db, $conf, $hookmanager;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">if</span> ($contenttype == <span class="stringliteral">&#39;text/html&#39;</span>) {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    header(<span class="stringliteral">&quot;Content-Type: text/html; charset=&quot;</span>.$conf-&gt;file-&gt;character_set_client);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    header(<span class="stringliteral">&quot;Content-Type: &quot;</span>.$contenttype);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// Security options</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160; </div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">// X-Content-Type-Options</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  header(<span class="stringliteral">&quot;X-Content-Type-Options: nosniff&quot;</span>); <span class="comment">// With the nosniff option, if the server says the content is text/html, the browser will render it as text/html (note that most browsers now force this option to on)</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160; </div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="comment">// X-Frame-Options</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;XFRAMEOPTIONS_ALLOWALL&#39;</span>)) {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    header(<span class="stringliteral">&quot;X-Frame-Options: SAMEORIGIN&quot;</span>); <span class="comment">// Frames allowed only if on same domain (stop some XSS attacks)</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    header(<span class="stringliteral">&quot;X-Frame-Options: ALLOWALL&quot;</span>);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="comment">// X-XSS-Protection</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="comment">//header(&quot;X-XSS-Protection: 1&quot;);          // XSS filtering protection of some browsers (note: use of Content-Security-Policy is more efficient). Disabled as deprecated.</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160; </div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="comment">// Content-Security-Policy</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;MAIN_SECURITY_FORCECSP&#39;</span>)) {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">// If CSP not forced from the page</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="comment">// A default security policy that keep usage of js external component like ckeditor, stripe, google, working</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="comment">//  $contentsecuritypolicy = &quot;font-src *; img-src *; style-src * &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; default-src &#39;self&#39; *.stripe.com &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; script-src &#39;self&#39; *.stripe.com &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; frame-src &#39;self&#39; *.stripe.com; connect-src &#39;self&#39;;&quot;;</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    $contentsecuritypolicy = <a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&#39;MAIN_SECURITY_FORCECSP&#39;</span>);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160; </div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span> (!is_object($hookmanager)) {</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/hookmanager.class.php&#39;</span>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      $hookmanager = <span class="keyword">new</span> <a class="code" href="../../d7/d8c/class_hook_manager.html">HookManager</a>($db);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    $hookmanager-&gt;initHooks(array(<span class="stringliteral">&quot;main&quot;</span>));</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    $parameters = array(<span class="stringliteral">&#39;contentsecuritypolicy&#39;</span>=&gt;$contentsecuritypolicy);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    $result = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;setContentSecurityPolicy&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span> ($result &gt; 0) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      $contentsecuritypolicy = $hookmanager-&gt;resPrint; <span class="comment">// Replace CSP</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      $contentsecuritypolicy .= $hookmanager-&gt;resPrint; <span class="comment">// Concat CSP</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">if</span> (!empty($contentsecuritypolicy)) {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      <span class="comment">// For example, to restrict &#39;script&#39;, &#39;object&#39;, &#39;frames&#39; or &#39;img&#39; to some domains:</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="comment">// script-src https://api.google.com https://anotherhost.com; object-src https://youtube.com; frame-src https://youtube.com; img-src: https://static.example.com</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="comment">// For example, to restrict everything to one domain, except &#39;object&#39;, ...:</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">// default-src https://cdn.example.net; object-src &#39;none&#39;</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="comment">// For example, to restrict everything to itself except img that can be on other servers:</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="comment">// default-src &#39;self&#39;; img-src *;</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="comment">// Pre-existing site that uses too much js code to fix but wants to ensure resources are loaded only over https and disable plugins:</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      <span class="comment">// default-src https: &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; object-src &#39;none&#39;</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      header(<span class="stringliteral">&quot;Content-Security-Policy: &quot;</span>.$contentsecuritypolicy);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    }</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    header(<span class="stringliteral">&quot;Content-Security-Policy: &quot;</span>.constant(<span class="stringliteral">&#39;MAIN_SECURITY_FORCECSP&#39;</span>));</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="comment">// Referrer-Policy</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="comment">// Say if we must provide the referrer when we jump onto another web page.</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="comment">// Default browser are &#39;strict-origin-when-cross-origin&#39; (only domain is sent on other domain switching), we want more so we use &#39;same-origin&#39; so browser doesn&#39;t send any referrer when going into another web site domain.</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;MAIN_SECURITY_FORCERP&#39;</span>)) {</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    $referrerpolicy = <a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&#39;MAIN_SECURITY_FORCERP&#39;</span>, <span class="stringliteral">&quot;same-origin&quot;</span>);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    header(<span class="stringliteral">&quot;Referrer-Policy: &quot;</span>.$referrerpolicy);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160; </div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordflow">if</span> ($forcenocache) {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    header(<span class="stringliteral">&quot;Cache-Control: no-cache, no-store, must-revalidate, max-age=0&quot;</span>);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">// No need to add this token in header, we use instead the one into the forms.</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="comment">//header(&quot;anti-csrf-token: &quot;.newToken());</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;}</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160; </div>
<div class="line"><a name="l01530"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a7ca53bfd6df5afab29b5a6c468bdefde"> 1530</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a7ca53bfd6df5afab29b5a6c468bdefde">top_htmlhead</a>($head, $title = <span class="stringliteral">&#39;&#39;</span>, $disablejs = 0, $disablehead = 0, $arrayofjs = <span class="stringliteral">&#39;&#39;</span>, $arrayofcss = <span class="stringliteral">&#39;&#39;</span>, $disableforlogin = 0, $disablenofollow = 0, $disablenoindex = 0)</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;{</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  global $db, $conf, $langs, $user, $mysoc, $hookmanager;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <a class="code" href="../../d0/db1/main_8inc_8php.html#a1bed423acec10147bfe221cd6fe286aa">top_httphead</a>();</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;css)) {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    $conf-&gt;css = <span class="stringliteral">&#39;/theme/eldy/style.css.php&#39;</span>; <span class="comment">// If not defined, eldy by default</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  print <span class="stringliteral">&#39;&lt;!doctype html&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  print <span class="stringliteral">&#39;&lt;html lang=&quot;&#39;</span>.substr($langs-&gt;defaultlang, 0, 2).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="comment">//print &#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">if</span> (empty($disablehead)) {</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">if</span> (!is_object($hookmanager)) {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      $hookmanager = <span class="keyword">new</span> <a class="code" href="../../d7/d8c/class_hook_manager.html">HookManager</a>($db);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    $hookmanager-&gt;initHooks(array(<span class="stringliteral">&quot;main&quot;</span>));</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160; </div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    $ext = <span class="stringliteral">&#39;layout=&#39;</span>.$conf-&gt;browser-&gt;layout.<span class="stringliteral">&#39;&amp;amp;version=&#39;</span>.urlencode(DOL_VERSION);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160; </div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    print <span class="stringliteral">&quot;&lt;head&gt;\n&quot;</span>;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160; </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_basehref&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>)) {</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      print <span class="stringliteral">&#39;&lt;base href=&quot;&#39;</span>.dol_escape_htmltag(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_basehref&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>)).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    }</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">// Displays meta</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    print <span class="stringliteral">&#39;&lt;meta charset=&quot;utf-8&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    print <span class="stringliteral">&#39;&lt;meta name=&quot;robots&quot; content=&quot;&#39;</span>.($disablenoindex ? <span class="stringliteral">&#39;index&#39;</span> : <span class="stringliteral">&#39;noindex&#39;</span>).($disablenofollow ? <span class="stringliteral">&#39;,follow&#39;</span> : <span class="stringliteral">&#39;,nofollow&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// Do not index</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    print <span class="stringliteral">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// Scale for mobile device</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    print <span class="stringliteral">&#39;&lt;meta name=&quot;author&quot; content=&quot;Dolibarr Development Team&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    print <span class="stringliteral">&#39;&lt;meta name=&quot;anti-csrf-token&quot; content=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_FEATURES_LEVEL&#39;</span>)) {</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      print <span class="stringliteral">&#39;&lt;meta name=&quot;MAIN_FEATURES_LEVEL&quot; content=&quot;&#39;</span>.getDolGlobalInt(<span class="stringliteral">&#39;MAIN_FEATURES_LEVEL&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="comment">// Favicon</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    $favicon = DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/dolibarr_256x256_color.png&#39;</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordflow">if</span> (!empty($mysoc-&gt;logo_squarred_mini)) {</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      $favicon = DOL_URL_ROOT.<span class="stringliteral">&#39;/viewimage.php?cache=1&amp;modulepart=mycompany&amp;file=&#39;</span>.urlencode(<span class="stringliteral">&#39;logos/thumbs/&#39;</span>.$mysoc-&gt;logo_squarred_mini);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&#39;MAIN_FAVICON_URL&#39;</span>)) {</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      $favicon = <a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&#39;MAIN_FAVICON_URL&#39;</span>);</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;dol_use_jmobile)) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      print <span class="stringliteral">&#39;&lt;link rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; href=&quot;&#39;</span>.$favicon.<span class="stringliteral">&#39;&quot;/&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// Not required into an Android webview</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    }</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">//if (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) print &#39;&lt;link rel=&quot;top&quot; title=&quot;&#39;.$langs-&gt;trans(&quot;Home&quot;).&#39;&quot; href=&quot;&#39;.(DOL_URL_ROOT?DOL_URL_ROOT:&#39;/&#39;).&#39;&quot;&gt;&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">//if (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) print &#39;&lt;link rel=&quot;copyright&quot; title=&quot;GNU General Public License&quot; href=&quot;https://www.gnu.org/copyleft/gpl.html#SEC1&quot;&gt;&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="comment">//if (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) print &#39;&lt;link rel=&quot;author&quot; title=&quot;Dolibarr Development Team&quot; href=&quot;https://www.dolibarr.org&quot;&gt;&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="comment">// Mobile appli like icon</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    $manifest = DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/&#39;</span>.$conf-&gt;theme.<span class="stringliteral">&#39;/manifest.json.php&#39;</span>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">if</span> (!empty($manifest)) {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      print <span class="stringliteral">&#39;&lt;link rel=&quot;manifest&quot; href=&quot;&#39;</span>.$manifest.<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;THEME_ELDY_TOPMENU_BACK1)) {</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="comment">// TODO: use auto theme color switch</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      print <span class="stringliteral">&#39;&lt;meta name=&quot;theme-color&quot; content=&quot;rgb(&#39;</span>.$conf-&gt;global-&gt;THEME_ELDY_TOPMENU_BACK1.<span class="stringliteral">&#39;)&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160; </div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="comment">// Auto refresh page</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;autorefresh&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) &gt; 0) {</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      print <span class="stringliteral">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;&#39;</span>.GETPOST(<span class="stringliteral">&#39;autorefresh&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    }</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="comment">// Displays title</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    $appli = constant(<span class="stringliteral">&#39;DOL_APPLICATION_TITLE&#39;</span>);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_APPLICATION_TITLE)) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      $appli = $conf-&gt;global-&gt;MAIN_APPLICATION_TITLE;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    }</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    print <span class="stringliteral">&#39;&lt;title&gt;&#39;</span>;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    $titletoshow = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span> ($title &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_HTML_TITLE) &amp;&amp; preg_match(<span class="stringliteral">&#39;/noapp/&#39;</span>, $conf-&gt;global-&gt;MAIN_HTML_TITLE)) {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      $titletoshow = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a7830e86f4eac6490caf8b5d04602412c">dol_htmlentities</a>($title);</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    } elseif ($title) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      $titletoshow = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a7830e86f4eac6490caf8b5d04602412c">dol_htmlentities</a>($appli.<span class="stringliteral">&#39; - &#39;</span>.$title);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      $titletoshow = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a7830e86f4eac6490caf8b5d04602412c">dol_htmlentities</a>($appli);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160; </div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    $parameters = array(<span class="stringliteral">&#39;title&#39;</span>=&gt;$titletoshow);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    $result = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;setHtmlTitle&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordflow">if</span> ($result &gt; 0) {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      $titletoshow = $hookmanager-&gt;resPrint; <span class="comment">// Replace Title to show</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      $titletoshow .= $hookmanager-&gt;resPrint; <span class="comment">// Concat to Title to show</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    print $titletoshow;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    print <span class="stringliteral">&#39;&lt;/title&gt;&#39;</span>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160; </div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;version&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      $ext = <span class="stringliteral">&#39;version=&#39;</span>.GETPOST(<span class="stringliteral">&#39;version&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>); <span class="comment">// usefull to force no cache on css/js</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="comment">// Refresh value of MAIN_IHM_PARAMS_REV before forging the parameter line.</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_resetcache&#39;</span>)) {</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <a class="code" href="../../da/d0f/admin_8lib_8php.html#a2672fdb5a58c6d4ebe00ba25c9ca9ce9">dolibarr_set_const</a>($db, <span class="stringliteral">&quot;MAIN_IHM_PARAMS_REV&quot;</span>, ((<span class="keywordtype">int</span>) $conf-&gt;global-&gt;MAIN_IHM_PARAMS_REV) + 1, <span class="stringliteral">&#39;chaine&#39;</span>, 0, <span class="stringliteral">&#39;&#39;</span>, $conf-&gt;entity);</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160; </div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    $themeparam = <span class="stringliteral">&#39;?lang=&#39;</span>.$langs-&gt;defaultlang.<span class="stringliteral">&#39;&amp;amp;theme=&#39;</span>.$conf-&gt;theme.(GETPOST(<span class="stringliteral">&#39;optioncss&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>) ? <span class="stringliteral">&#39;&amp;amp;optioncss=&#39;</span>.GETPOST(<span class="stringliteral">&#39;optioncss&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>, 1) : <span class="stringliteral">&#39;&#39;</span>).(empty($user-&gt;id) ? <span class="stringliteral">&#39;&#39;</span> : (<span class="stringliteral">&#39;&amp;amp;userid=&#39;</span>.$user-&gt;id)).<span class="stringliteral">&#39;&amp;amp;entity=&#39;</span>.$conf-&gt;entity;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    $themeparam .= ($ext ? <span class="stringliteral">&#39;&amp;amp;&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&amp;amp;revision=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&quot;MAIN_IHM_PARAMS_REV&quot;</span>);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>)) {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;dol_hide_topmenu=&#39;</span>.GETPOST(<span class="stringliteral">&#39;dol_hide_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>)) {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;dol_hide_leftmenu=&#39;</span>.GETPOST(<span class="stringliteral">&#39;dol_hide_leftmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    }</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>)) {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;dol_optimize_smallscreen=&#39;</span>.GETPOST(<span class="stringliteral">&#39;dol_optimize_smallscreen&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>)) {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;dol_no_mouse_hover=&#39;</span>.GETPOST(<span class="stringliteral">&#39;dol_no_mouse_hover&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    }</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>)) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;dol_use_jmobile=&#39;</span>.GETPOST(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>); $conf-&gt;dol_use_jmobile = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_use_jmobile&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;THEME_DARKMODEENABLED&#39;</span>)) {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;THEME_DARKMODEENABLED=&#39;</span>.GETPOST(<span class="stringliteral">&#39;THEME_DARKMODEENABLED&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    }</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&#39;THEME_SATURATE_RATIO&#39;</span>)) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      $themeparam .= <span class="stringliteral">&#39;&amp;amp;THEME_SATURATE_RATIO=&#39;</span>.GETPOST(<span class="stringliteral">&#39;THEME_SATURATE_RATIO&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    }</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160; </div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_ENABLE_FONT_ROBOTO)) {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      print <span class="stringliteral">&#39;&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      print <span class="stringliteral">&#39;&lt;link href=&quot;https://fonts.googleapis.com/css2?family=Roboto:wght@200;300;400;500;600&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_JQUERY&#39;</span>) &amp;&amp; !$disablejs &amp;&amp; $conf-&gt;use_javascript_ajax) {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Includes CSS for JQuery (Ajax library) --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      $jquerytheme = <span class="stringliteral">&#39;base&#39;</span>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_THEME)) {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        $jquerytheme = $conf-&gt;global-&gt;MAIN_USE_JQUERY_THEME;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      }</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordflow">if</span> (constant(<span class="stringliteral">&#39;JS_JQUERY_UI&#39;</span>)) {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.JS_JQUERY_UI.<span class="stringliteral">&#39;css/&#39;</span>.$jquerytheme.<span class="stringliteral">&#39;/jquery-ui.min.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// Forced JQuery</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/css/&#39;</span>.$jquerytheme.<span class="stringliteral">&#39;/jquery-ui.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// JQuery</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      }</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_JQUERY_JNOTIFY&#39;</span>)) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jnotify/jquery.jnotify-alt.min.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// JNotify</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      }</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_SELECT2&#39;</span>) &amp;&amp; (!empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT) || defined(<span class="stringliteral">&#39;REQUIRE_JQUERY_MULTISELECT&#39;</span>))) {     <span class="comment">// jQuery plugin &quot;mutiselect&quot;, &quot;multiple-select&quot;, &quot;select2&quot;...</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        $tmpplugin = empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT) ?constant(<span class="stringliteral">&#39;REQUIRE_JQUERY_MULTISELECT&#39;</span>) : $conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/&#39;</span>.$tmpplugin.<span class="stringliteral">&#39;/dist/css/&#39;</span>.$tmpplugin.<span class="stringliteral">&#39;.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_FONT_AWSOME&#39;</span>)) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Includes CSS for font awesome --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/common/fontawesome-5/css/all.min.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/common/fontawesome-5/css/v4-shims.min.css&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    }</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160; </div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    print <span class="stringliteral">&#39;&lt;!-- Includes CSS for Dolibarr theme --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="comment">// Output style sheets (optioncss=&#39;print&#39; or &#39;&#39;). Note: $conf-&gt;css looks like &#39;/theme/eldy/style.css.php&#39;</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    $themepath = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($conf-&gt;css, 1);</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    $themesubdir = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;modules_parts[<span class="stringliteral">&#39;theme&#39;</span>])) {  <span class="comment">// This slow down</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="keywordflow">foreach</span> ($conf-&gt;modules_parts[<span class="stringliteral">&#39;theme&#39;</span>] as $reldir) {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="keywordflow">if</span> (file_exists(<a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($reldir.$conf-&gt;css, 0))) {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;          $themepath = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($reldir.$conf-&gt;css, 1);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;          $themesubdir = $reldir;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    }</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160; </div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="comment">//print &#39;themepath=&#39;.$themepath.&#39; themeparam=&#39;.$themeparam;exit;</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    print <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.$themepath.$themeparam.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_FIX_FLASH_ON_CHROME)) {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Includes CSS that does not exists as a workaround of flash bug of chrome --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;filethatdoesnotexiststosolvechromeflashbug&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    }</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">// CSS forced by modules (relative url starting with /)</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;modules_parts[<span class="stringliteral">&#39;css&#39;</span>])) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      $arraycss = (array) $conf-&gt;modules_parts[<span class="stringliteral">&#39;css&#39;</span>];</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      foreach ($arraycss as $modcss =&gt; $filescss) {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        $filescss = (array) $filescss; <span class="comment">// To be sure filecss is an array</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="keywordflow">foreach</span> ($filescss as $cssfile) {</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;          <span class="keywordflow">if</span> (empty($cssfile)) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Warning: module &quot;</span>.$modcss.<span class="stringliteral">&quot; declared a css path file into its descriptor that is empty.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;          }</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;          <span class="comment">// cssfile is a relative path</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;          $urlforcss = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($cssfile, 1);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;          <span class="keywordflow">if</span> ($urlforcss &amp;&amp; $urlforcss != <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            print <span class="stringliteral">&#39;&lt;!-- Includes CSS added by module &#39;</span>.$modcss.<span class="stringliteral">&#39; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span>.$urlforcss;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            <span class="comment">// We add params only if page is not static, because some web server setup does not return content type text/css if url has parameters, so browser cache is not used.</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/\.css$/i&#39;</span>, $cssfile)) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;              print $themeparam;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            print <span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Warning: module &quot;</span>.$modcss.<span class="stringliteral">&quot; declared a css path file for a file we can&#39;t find.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      }</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    }</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="comment">// CSS forced by page in top_htmlhead call (relative url starting with /)</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="keywordflow">if</span> (is_array($arrayofcss)) {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="keywordflow">foreach</span> ($arrayofcss as $cssfile) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(http|\/\/)/i&#39;</span>, $cssfile)) {</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;          $urltofile = $cssfile;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;          $urltofile = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($cssfile, 1);</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        }</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        print <span class="stringliteral">&#39;&lt;!-- Includes CSS added by page --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; title=&quot;default&quot; href=&quot;&#39;</span>.$urltofile;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        <span class="comment">// We add params only if page is not static, because some web server setup does not return content type text/css if url has parameters and browser cache is not used.</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/\.css$/i&#39;</span>, $cssfile)) {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;          print $themeparam;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        print <span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      }</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="comment">// Output standard javascript links</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_JQUERY&#39;</span>) &amp;&amp; !$disablejs &amp;&amp; !empty($conf-&gt;use_javascript_ajax)) {</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="comment">// JQuery. Must be before other includes</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Includes JS for JQuery --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;JS_JQUERY&#39;</span>) &amp;&amp; constant(<span class="stringliteral">&#39;JS_JQUERY&#39;</span>)) {</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.JS_JQUERY.<span class="stringliteral">&#39;jquery.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/js/jquery.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;JS_JQUERY_UI&#39;</span>) &amp;&amp; constant(<span class="stringliteral">&#39;JS_JQUERY_UI&#39;</span>)) {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.JS_JQUERY_UI.<span class="stringliteral">&#39;jquery-ui.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/js/jquery-ui.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <span class="comment">// jQuery jnotify</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_DISABLE_JQUERY_JNOTIFY) &amp;&amp; !defined(<span class="stringliteral">&#39;DISABLE_JQUERY_JNOTIFY&#39;</span>)) {</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jnotify/jquery.jnotify.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      <span class="comment">// Table drag and drop lines</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordflow">if</span> (empty($disableforlogin) &amp;&amp; !defined(<span class="stringliteral">&#39;DISABLE_JQUERY_TABLEDND&#39;</span>)) {</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/tablednd/jquery.tablednd.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      }</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      <span class="comment">// Chart</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      <span class="keywordflow">if</span> (empty($disableforlogin) &amp;&amp; (empty($conf-&gt;global-&gt;MAIN_JS_GRAPH) || $conf-&gt;global-&gt;MAIN_JS_GRAPH == <span class="stringliteral">&#39;chart&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;DISABLE_JS_GRAPH&#39;</span>)) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/nnnick/chartjs/dist/chart.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160; </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      <span class="comment">// jQuery jeditable for Edit In Place features</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_JEDITABLE) &amp;&amp; !defined(<span class="stringliteral">&#39;DISABLE_JQUERY_JEDITABLE&#39;</span>)) {</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        print <span class="stringliteral">&#39;&lt;!-- JS to manage editInPlace feature --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jeditable/jquery.jeditable.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jeditable/jquery.jeditable.ui-datepicker.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jeditable/jquery.jeditable.ui-autocomplete.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        print <span class="stringliteral">&#39;&lt;script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        print <span class="stringliteral">&#39;var urlSaveInPlace = \&#39;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/ajax/saveinplace.php\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        print <span class="stringliteral">&#39;var urlLoadInPlace = \&#39;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/ajax/loadinplace.php\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        print <span class="stringliteral">&#39;var tooltipInPlace = \&#39;&#39;</span>.$langs-&gt;transnoentities(<span class="stringliteral">&#39;ClickToEdit&#39;</span>).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;.&quot;\n&quot;; // Added in title attribute of span</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="stringliteral">        print &#39;</span>var placeholderInPlace = \<span class="stringliteral">&#39;&amp;nbsp;\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// If we put another string than $langs-&gt;trans(&quot;ClickToEdit&quot;) here, nothing is shown. If we put empty string, there is error, Why ?</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        print <span class="stringliteral">&#39;var cancelInPlace = \&#39;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Cancel&quot;</span>).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="stringliteral">        print &#39;</span>var submitInPlace = \<span class="stringliteral">&#39;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;Ok&#39;</span>).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="stringliteral">        print &#39;</span>var indicatorInPlace = \<span class="stringliteral">&#39;&lt;img src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&quot;/theme/&quot;</span>.$conf-&gt;theme.<span class="stringliteral">&quot;/img/working.gif&quot;</span>.<span class="stringliteral">&#39;&quot;&gt;\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        print <span class="stringliteral">&#39;var withInPlace = 300;&#39;</span>; <span class="comment">// width in pixel for default string edit</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        print <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/js/editinplace.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/jeditable/jquery.jeditable.ckeditor.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      }</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      <span class="comment">// jQuery Timepicker</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_TIMEPICKER) || defined(<span class="stringliteral">&#39;REQUIRE_JQUERY_TIMEPICKER&#39;</span>)) {</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/timepicker/jquery-ui-timepicker-addon.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/js/timepicker.js.php?lang=&#39;</span>.$langs-&gt;defaultlang.($ext ? <span class="stringliteral">&#39;&amp;amp;&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      }</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_SELECT2&#39;</span>) &amp;&amp; (!empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT) || defined(<span class="stringliteral">&#39;REQUIRE_JQUERY_MULTISELECT&#39;</span>))) {</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment">// jQuery plugin &quot;mutiselect&quot;, &quot;multiple-select&quot;, &quot;select2&quot;, ...</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        $tmpplugin = empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT) ?constant(<span class="stringliteral">&#39;REQUIRE_JQUERY_MULTISELECT&#39;</span>) : $conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/&#39;</span>.$tmpplugin.<span class="stringliteral">&#39;/dist/js/&#39;</span>.$tmpplugin.<span class="stringliteral">&#39;.full.min.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// We include full because we need the support of containerCssClass</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DISABLE_MULTISELECT&#39;</span>)) {     <span class="comment">// jQuery plugin &quot;mutiselect&quot; to select with checkboxes. Can be removed once we have an enhanced search tool</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/jquery/plugins/multiselect/jquery.multi-select.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      }</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="keywordflow">if</span> (!$disablejs &amp;&amp; !empty($conf-&gt;use_javascript_ajax)) {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <span class="comment">// CKEditor</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      <span class="keywordflow">if</span> (empty($disableforlogin) &amp;&amp; (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;fckeditor&#39;</span>) &amp;&amp; (empty($conf-&gt;global-&gt;FCKEDITOR_EDITORNAME) || $conf-&gt;global-&gt;FCKEDITOR_EDITORNAME == <span class="stringliteral">&#39;ckeditor&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;DISABLE_CKEDITOR&#39;</span>)) || defined(<span class="stringliteral">&#39;FORCE_CKEDITOR&#39;</span>)) {</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        print <span class="stringliteral">&#39;&lt;!-- Includes JS for CKEditor --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        $pathckeditor = DOL_URL_ROOT.<span class="stringliteral">&#39;/includes/ckeditor/ckeditor/&#39;</span>;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        $jsckeditor = <span class="stringliteral">&#39;ckeditor.js&#39;</span>;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        <span class="keywordflow">if</span> (constant(<span class="stringliteral">&#39;JS_CKEDITOR&#39;</span>)) {</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;          <span class="comment">// To use external ckeditor 4 js lib</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;          $pathckeditor = constant(<span class="stringliteral">&#39;JS_CKEDITOR&#39;</span>);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        }</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        print <span class="stringliteral">&#39;&lt;script&gt;&#39;</span>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        print <span class="stringliteral">&#39;/* enable ckeditor by main.inc.php */&#39;</span>;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        print <span class="stringliteral">&#39;var CKEDITOR_BASEPATH = \&#39;&#39;</span>.dol_escape_js($pathckeditor).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="stringliteral">        print &#39;</span>var ckeditorConfig = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js(<a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($themesubdir.<span class="stringliteral">&#39;/theme/&#39;</span>.$conf-&gt;theme.<span class="stringliteral">&#39;/ckeditor/config.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>), 1)).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;.&quot;\n&quot;; // $themesubdir=&#39;</span><span class="stringliteral">&#39; in standard usage</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="stringliteral">        print &#39;</span>var ckeditorFilebrowserBrowseUrl = \<span class="stringliteral">&#39;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/filemanagerdol/browser/default/browser.php?Connector=&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/filemanagerdol/connectors/php/connector.php\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        print <span class="stringliteral">&#39;var ckeditorFilebrowserImageBrowseUrl = \&#39;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/filemanagerdol/browser/default/browser.php?Type=Image&amp;Connector=&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/filemanagerdol/connectors/php/connector.php\&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        print <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.$pathckeditor.$jsckeditor.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        print <span class="stringliteral">&#39;&lt;script&gt;&#39;</span>;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;mode&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>) == <span class="stringliteral">&#39;Full_inline&#39;</span>) {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;          print <span class="stringliteral">&#39;CKEDITOR.disableAutoInline = false;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          print <span class="stringliteral">&#39;CKEDITOR.disableAutoInline = true;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        }</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        print <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      }</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160; </div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="comment">// Browser notifications (if NOREQUIREMENU is on, it is mostly a page for popup, so we do not enable notif too. We hide also for public pages).</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;NOBROWSERNOTIF&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>) &amp;&amp; !defined(<span class="stringliteral">&#39;NOLOGIN&#39;</span>)) {</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        $enablebrowsernotif = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;agenda&#39;</span>) &amp;&amp; !empty($conf-&gt;global-&gt;AGENDA_REMINDER_BROWSER)) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;          $enablebrowsernotif = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        }</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        <span class="keywordflow">if</span> ($conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span>) {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;          $enablebrowsernotif = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        }</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordflow">if</span> ($enablebrowsernotif) {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;          print <span class="stringliteral">&#39;&lt;!-- Includes JS of Dolibarr (browser layout = &#39;</span>.$conf-&gt;browser-&gt;layout.<span class="stringliteral">&#39;)--&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;          print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/js/lib_notification.js.php&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        }</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      }</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="comment">// Global js function</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Includes JS of Dolibarr --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/js/lib_head.js.php?lang=&#39;</span>.$langs-&gt;defaultlang.($ext ? <span class="stringliteral">&#39;&amp;amp;&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160; </div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="comment">// JS forced by modules (relative url starting with /)</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;modules_parts[<span class="stringliteral">&#39;js&#39;</span>])) {   <span class="comment">// $conf-&gt;modules_parts[&#39;js&#39;] is array(&#39;module&#39;=&gt;array(&#39;file1&#39;,&#39;file2&#39;))</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        $arrayjs = (array) $conf-&gt;modules_parts[<span class="stringliteral">&#39;js&#39;</span>];</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        foreach ($arrayjs as $modjs =&gt; $filesjs) {</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;          $filesjs = (array) $filesjs; <span class="comment">// To be sure filejs is an array</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;          <span class="keywordflow">foreach</span> ($filesjs as $jsfile) {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <span class="comment">// jsfile is a relative path</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            $urlforjs = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>($jsfile, 1);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            <span class="keywordflow">if</span> ($urlforjs &amp;&amp; $urlforjs != <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;              print <span class="stringliteral">&#39;&lt;!-- Include JS added by module &#39;</span>.$modjs.<span class="stringliteral">&#39;--&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.$urlforjs.((strpos($jsfile, <span class="charliteral">&#39;?&#39;</span>) === <span class="keyword">false</span>) ? <span class="charliteral">&#39;?&#39;</span> : <span class="stringliteral">&#39;&amp;amp;&#39;</span>).<span class="stringliteral">&#39;lang=&#39;</span>.$langs-&gt;defaultlang.<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;              <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Warning: module &quot;</span>.$modjs.<span class="stringliteral">&quot; declared a js path file for a file we can&#39;t find.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;          }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        }</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      }</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="comment">// JS forced by page in top_htmlhead (relative url starting with /)</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">if</span> (is_array($arrayofjs)) {</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        print <span class="stringliteral">&#39;&lt;!-- Includes JS added by page --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">foreach</span> ($arrayofjs as $jsfile) {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(http|\/\/)/i&#39;</span>, $jsfile)) {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.$jsfile.((strpos($jsfile, <span class="charliteral">&#39;?&#39;</span>) === <span class="keyword">false</span>) ? <span class="charliteral">&#39;?&#39;</span> : <span class="stringliteral">&#39;&amp;amp;&#39;</span>).<span class="stringliteral">&#39;lang=&#39;</span>.$langs-&gt;defaultlang.<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.dol_buildpath($jsfile, 1).((strpos($jsfile, <span class="charliteral">&#39;?&#39;</span>) === <span class="keyword">false</span>) ? <span class="charliteral">&#39;?&#39;</span> : <span class="stringliteral">&#39;&amp;amp;&#39;</span>).<span class="stringliteral">&#39;lang=&#39;</span>.$langs-&gt;defaultlang.<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;          }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      }</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    }</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="comment">//If you want to load custom javascript file from your selected theme directory</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;ALLOW_THEME_JS)) {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      $theme_js = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a>(<span class="stringliteral">&#39;/theme/&#39;</span>.$conf-&gt;theme.<span class="charliteral">&#39;/&#39;</span>.$conf-&gt;theme.<span class="stringliteral">&#39;.js&#39;</span>, 0);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      <span class="keywordflow">if</span> (file_exists($theme_js)) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/&#39;</span>.$conf-&gt;theme.<span class="charliteral">&#39;/&#39;</span>.$conf-&gt;theme.<span class="stringliteral">&#39;.js&#39;</span>.($ext ? <span class="charliteral">&#39;?&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    }</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160; </div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <span class="keywordflow">if</span> (!empty($head)) {</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      print $head.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    }</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_HTML_HEADER)) {</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      print $conf-&gt;global-&gt;MAIN_HTML_HEADER.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    }</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160; </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    $result = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;addHtmlHeader&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    print $hookmanager-&gt;resPrint; <span class="comment">// Replace Title to show</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    print <span class="stringliteral">&quot;&lt;/head&gt;\n\n&quot;</span>;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  }</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  $conf-&gt;headerdone = 1; <span class="comment">// To tell header was output</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160; </div>
<div class="line"><a name="l01932"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#ac4f1c6ce25e9080a698fac2a61506493"> 1932</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#ac4f1c6ce25e9080a698fac2a61506493">top_menu</a>($head, $title = <span class="stringliteral">&#39;&#39;</span>, $target = <span class="stringliteral">&#39;&#39;</span>, $disablejs = 0, $disablehead = 0, $arrayofjs = <span class="stringliteral">&#39;&#39;</span>, $arrayofcss = <span class="stringliteral">&#39;&#39;</span>, $morequerystring = <span class="stringliteral">&#39;&#39;</span>, $helppagename = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;{</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  global $user, $conf, $langs, $db;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  global $dolibarr_main_authentication, $dolibarr_main_demo;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  global $hookmanager, $menumanager;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160; </div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  $searchform = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160; </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="comment">// Instantiate hooks for external modules</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;toprightmenu&#39;</span>));</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160; </div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  $toprightmenu = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="comment">// For backward compatibility with old modules</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;headerdone)) {</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    $disablenofollow = 0;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <a class="code" href="../../d0/db1/main_8inc_8php.html#a7ca53bfd6df5afab29b5a6c468bdefde">top_htmlhead</a>($head, $title, $disablejs, $disablehead, $arrayofjs, $arrayofcss, 0, $disablenofollow);</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    print <span class="stringliteral">&#39;&lt;body id=&quot;mainbody&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160; </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment">   * Top menu</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="keywordflow">if</span> ((empty($conf-&gt;dol_hide_topmenu) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_invisible_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) &amp;&amp; (!defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>) || !constant(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>))) {</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">if</span> (!isset(<a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>) || !is_object(<a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>)) {</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.form.class.php&#39;</span>;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a> = <span class="keyword">new</span> <a class="code" href="../../df/d08/class_form.html">Form</a>($db);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    }</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160; </div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;!-- Start top horizontal --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160; </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    print <span class="stringliteral">&#39;&lt;header id=&quot;id-top&quot; class=&quot;side-nav-vert&#39;</span>.(GETPOST(<span class="stringliteral">&#39;dol_invisible_topmenu&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) ? <span class="stringliteral">&#39; hidden&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>; <span class="comment">// dol_invisible_topmenu differs from dol_hide_topmenu: dol_invisible_topmenu means we output menu but we make it invisible.</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160; </div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="comment">// Show menu entries</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    print <span class="stringliteral">&#39;&lt;div id=&quot;tmenu_tooltip&#39;</span>.(empty($conf-&gt;global-&gt;MAIN_MENU_INVERT) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39;invert&#39;</span>).<span class="stringliteral">&#39;&quot; class=&quot;tmenu&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    $menumanager-&gt;atarget = $target;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    $menumanager-&gt;showmenu(<span class="stringliteral">&#39;top&#39;</span>, array(<span class="stringliteral">&#39;searchform&#39;</span>=&gt;$searchform)); <span class="comment">// This contains a \n</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    print <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="comment">// Define link to login card</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    $appli = constant(<span class="stringliteral">&#39;DOL_APPLICATION_TITLE&#39;</span>);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_APPLICATION_TITLE)) {</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      $appli = $conf-&gt;global-&gt;MAIN_APPLICATION_TITLE;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\d\.\d/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="keywordflow">if</span> (!preg_match(<span class="charliteral">&#39;/&#39;</span>.preg_quote(DOL_VERSION).<span class="charliteral">&#39;/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;          $appli .= <span class="stringliteral">&quot; (&quot;</span>.DOL_VERSION.<span class="stringliteral">&quot;)&quot;</span>; <span class="comment">// If new title contains a version that is different than core</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        }</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      }</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    }</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160; </div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_FEATURES_LEVEL&#39;</span>)) {</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      $appli .= <span class="stringliteral">&quot;&lt;br&gt;&quot;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;LevelOfFeature&quot;</span>).<span class="stringliteral">&#39;: &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a>(<span class="stringliteral">&#39;MAIN_FEATURES_LEVEL&#39;</span>);</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    $logouttext = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    $logouthtmltext = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      <span class="comment">//$logouthtmltext=$appli.&#39;&lt;br&gt;&#39;;</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordflow">if</span> ($_SESSION[<span class="stringliteral">&quot;dol_authmode&quot;</span>] != <span class="stringliteral">&#39;forceuser&#39;</span> &amp;&amp; $_SESSION[<span class="stringliteral">&quot;dol_authmode&quot;</span>] != <span class="stringliteral">&#39;http&#39;</span>) {</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        $logouthtmltext .= $langs-&gt;trans(<span class="stringliteral">&quot;Logout&quot;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160; </div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        $logouttext .= <span class="stringliteral">&#39;&lt;a accesskey=&quot;l&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/user/logout.php?token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        $logouttext .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&#39;Logout&#39;</span>), <span class="stringliteral">&#39;sign-out&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="keyword">false</span>, 0, 0, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;atoplogin&#39;</span>);</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        $logouttext .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        $logouthtmltext .= $langs-&gt;trans(<span class="stringliteral">&quot;NoLogoutProcessWithAuthMode&quot;</span>, $_SESSION[<span class="stringliteral">&quot;dol_authmode&quot;</span>]);</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        $logouttext .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&#39;Logout&#39;</span>), <span class="stringliteral">&#39;sign-out&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="keyword">false</span>, 0, 0, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;atoplogin opacitymedium&#39;</span>);</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      }</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    }</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160; </div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;login_block usedropdown&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160; </div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;div class=&quot;login_block_other&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="comment">// Execute hook printTopRightMenu (hooks should output string like &#39;&lt;div class=&quot;login&quot;&gt;&lt;a href=&quot;&quot;&gt;mylink&lt;/a&gt;&lt;/div&gt;&#39;)</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    $result = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printTopRightMenu&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">if</span> (is_numeric($result)) {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordflow">if</span> ($result == 0) {</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        $toprightmenu .= $hookmanager-&gt;resPrint; <span class="comment">// add</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        $toprightmenu = $hookmanager-&gt;resPrint; <span class="comment">// replace</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      }</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      $toprightmenu .= $result; <span class="comment">// For backward compatibility</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160; </div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="comment">// Link to module builder</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;modulebuilder&#39;</span>)) {</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      $text = <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/modulebuilder/index.php?mainmenu=home&amp;leftmenu=admintools&quot; target=&quot;modulebuilder&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      <span class="comment">//$text.= img_picto(&quot;:&quot;.$langs-&gt;trans(&quot;ModuleBuilder&quot;), &#39;printer_top.png&#39;, &#39;class=&quot;printer&quot;&#39;);</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      $text .= <span class="stringliteral">&#39;&lt;span class=&quot;fa fa-bug atoplogin valignmiddle&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      $text .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      $toprightmenu .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;textwithtooltip(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;ModuleBuilder&quot;</span>), 2, 1, $text, <span class="stringliteral">&#39;login_block_elem&#39;</span>, 2);</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    }</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160; </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="comment">// Link to print main content area</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_PRINT_DISABLELINK) &amp;&amp; empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      $qs = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($_SERVER[<span class="stringliteral">&quot;QUERY_STRING&quot;</span>]);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160; </div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="keywordflow">if</span> (isset($_POST) &amp;&amp; is_array($_POST)) {</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <span class="keywordflow">foreach</span> ($_POST as $key =&gt; $value) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;          <span class="keywordflow">if</span> ($key !== <span class="stringliteral">&#39;action&#39;</span> &amp;&amp; $key !== <span class="stringliteral">&#39;password&#39;</span> &amp;&amp; !is_array($value)) {</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            $qs .= <span class="charliteral">&#39;&amp;&#39;</span>.$key.<span class="charliteral">&#39;=&#39;</span>.urlencode($value);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;          }</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      }</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      $qs .= (($qs &amp;&amp; $morequerystring) ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).$morequerystring;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      $text = <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.dol_escape_htmltag($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>]).<span class="charliteral">&#39;?&#39;</span>.$qs.($qs ? <span class="charliteral">&#39;&amp;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;optioncss=print&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="comment">//$text.= img_picto(&quot;:&quot;.$langs-&gt;trans(&quot;PrintContentArea&quot;), &#39;printer_top.png&#39;, &#39;class=&quot;printer&quot;&#39;);</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      $text .= <span class="stringliteral">&#39;&lt;span class=&quot;fa fa-print atoplogin valignmiddle&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      $text .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      $toprightmenu .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;textwithtooltip(<span class="stringliteral">&#39;&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&quot;PrintContentArea&quot;</span>), 2, 1, $text, <span class="stringliteral">&#39;login_block_elem&#39;</span>, 2);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    }</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160; </div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <span class="comment">// Link to Dolibarr wiki pages</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_HELP_DISABLELINK) &amp;&amp; empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      $langs-&gt;load(<span class="stringliteral">&quot;help&quot;</span>);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      $helpbaseurl = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      $helppage = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      $mode = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      $helppresent = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160; </div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keywordflow">if</span> (empty($helppagename)) {</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        $helppagename = <span class="stringliteral">&#39;EN:User_documentation|FR:Documentation_utilisateur|ES:Documentación_usuarios&#39;</span>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        $helppresent = <span class="stringliteral">&#39;helppresent&#39;</span>;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      }</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160; </div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="comment">// Get helpbaseurl, helppage and mode from helppagename and langs</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      $arrayres = <a class="code" href="../../d0/db1/main_8inc_8php.html#ab4ac000e297a48e208e78c2af6ff262b">getHelpParamFor</a>($helppagename, $langs);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      $helpbaseurl = $arrayres[<span class="stringliteral">&#39;helpbaseurl&#39;</span>];</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      $helppage = $arrayres[<span class="stringliteral">&#39;helppage&#39;</span>];</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      $mode = $arrayres[<span class="stringliteral">&#39;mode&#39;</span>];</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160; </div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="comment">// Link to help pages</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      <span class="keywordflow">if</span> ($helpbaseurl &amp;&amp; $helppage) {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        $text = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        $title = $langs-&gt;trans($mode == <span class="stringliteral">&#39;wiki&#39;</span> ? <span class="stringliteral">&#39;GoToWikiHelpPage&#39;</span> : <span class="stringliteral">&#39;GoToHelpPage&#39;</span>).<span class="stringliteral">&#39;, &#39;</span>;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="keywordflow">if</span> ($mode == <span class="stringliteral">&#39;wiki&#39;</span>) {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;          $title .= <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>.img_picto(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;globe&#39;</span>, <span class="stringliteral">&#39;class=&quot;pictofixedwidth&quot;&#39;</span>).$langs-&gt;trans(<span class="stringliteral">&quot;PageWiki&quot;</span>).<span class="charliteral">&#39; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>(<span class="charliteral">&#39;&quot;&#39;</span>.strtr($helppage, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39; &#39;</span>).<span class="charliteral">&#39;&quot;&#39;</span>);</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          <span class="keywordflow">if</span> ($helppresent) {</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            $title .= <span class="stringliteral">&#39; &lt;span class=&quot;opacitymedium&quot;&gt;(&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DedicatedPageAvailable&quot;</span>).<span class="stringliteral">&#39;)&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            $title .= <span class="stringliteral">&#39; &lt;span class=&quot;opacitymedium&quot;&gt;(&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;HomePage&quot;</span>).<span class="stringliteral">&#39;)&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          }</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        }</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        $text .= <span class="stringliteral">&#39;&lt;a class=&quot;help&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;&#39;</span>;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">if</span> ($mode == <span class="stringliteral">&#39;wiki&#39;</span>) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          $text .= sprintf($helpbaseurl, urlencode(html_entity_decode($helppage)));</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;          $text .= sprintf($helpbaseurl, $helppage);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        }</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        $text .= <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        $text .= <span class="stringliteral">&#39;&lt;span class=&quot;fa fa-question-circle atoplogin valignmiddle&#39;</span>.($helppresent ? <span class="charliteral">&#39; &#39;</span>.$helppresent : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        $text .= <span class="stringliteral">&#39;&lt;span class=&quot;fa fa-long-arrow-alt-up helppresentcircle&#39;</span>.($helppresent ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39; unvisible&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        $text .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        $toprightmenu .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;textwithtooltip(<span class="stringliteral">&#39;&#39;</span>, $title, 2, 1, $text, <span class="stringliteral">&#39;login_block_elem&#39;</span>, 2);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      }</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160; </div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      <span class="comment">// Version</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_SHOWDATABASENAMEINHELPPAGESLINK)) {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        $langs-&gt;load(<span class="stringliteral">&#39;admin&#39;</span>);</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        $appli .= <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Database&quot;</span>).<span class="stringliteral">&#39;: &#39;</span>.$db-&gt;database_name;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      }</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    }</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      $text = <span class="stringliteral">&#39;&lt;span class=&quot;aversion&quot;&gt;&lt;span class=&quot;hideonsmartphone small&quot;&gt;&#39;</span>.DOL_VERSION.<span class="stringliteral">&#39;&lt;/span&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      $toprightmenu .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;textwithtooltip(<span class="stringliteral">&#39;&#39;</span>, $appli, 2, 1, $text, <span class="stringliteral">&#39;login_block_elem&#39;</span>, 2);</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    }</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160; </div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="comment">// Logout link</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    $toprightmenu .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;textwithtooltip(<span class="stringliteral">&#39;&#39;</span>, $logouthtmltext, 2, 1, $logouttext, <span class="stringliteral">&#39;login_block_elem logout-btn&#39;</span>, 2);</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160; </div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>; <span class="comment">// end div class=&quot;login_block_other&quot;</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160; </div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160; </div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="comment">// Add login user link</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;div class=&quot;login_block_user&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="comment">// Login name with photo and tooltip</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    $mode = -1;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;div class=&quot;inline-block nowrap&quot;&gt;&lt;div class=&quot;inline-block login_block_elem login_block_elem_name&quot; style=&quot;padding: 0px;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_TOP_MENU_SEARCH_DROPDOWN)) {</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="comment">// Add search dropdown</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      $toprightmenu .= <a class="code" href="../../d0/db1/main_8inc_8php.html#ad46a898e40cc046fa58e96efa1c1f359">top_menu_search</a>();</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    }</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_USE_TOP_MENU_QUICKADD_DROPDOWN)) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="comment">// Add search dropdown</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      $toprightmenu .= <a class="code" href="../../d0/db1/main_8inc_8php.html#a1d3a53ad764311e0ec6e7466ff660ec0">top_menu_quickadd</a>();</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    }</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="comment">// Add bookmark dropdown</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    $toprightmenu .= <a class="code" href="../../d0/db1/main_8inc_8php.html#af6a6ade8f057ae2fc0d0b72f8e173b04">top_menu_bookmark</a>();</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="comment">// Add user dropdown</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    $toprightmenu .= <a class="code" href="../../d0/db1/main_8inc_8php.html#a4b00e754b077a74356ddbab8ca69f190">top_menu_user</a>();</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160; </div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160; </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    $toprightmenu .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160; </div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160; </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    print $toprightmenu;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160; </div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    print <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>; <span class="comment">// end div class=&quot;login_block&quot;</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    print <span class="stringliteral">&#39;&lt;/header&gt;&#39;</span>;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="comment">//print &#39;&lt;header class=&quot;header2&quot;&gt;&amp;nbsp;&lt;/header&gt;&#39;;</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    print <span class="stringliteral">&#39;&lt;div style=&quot;clear: both;&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    print <span class="stringliteral">&quot;&lt;!-- End top horizontal menu --&gt;\n\n&quot;</span>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160; </div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; empty($conf-&gt;dol_use_jmobile)) {</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    print <span class="stringliteral">&#39;&lt;!-- Begin div id-container --&gt;&lt;div id=&quot;id-container&quot; class=&quot;id-container&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;}</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02167"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a4b00e754b077a74356ddbab8ca69f190"> 2167</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a4b00e754b077a74356ddbab8ca69f190">top_menu_user</a>($hideloginname = 0, $urllogout = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;{</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;  global $langs, $conf, $db, $hookmanager, $user, $mysoc;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  global $dolibarr_main_authentication, $dolibarr_main_demo;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  global $menumanager;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  $langs-&gt;load(<span class="stringliteral">&#39;companies&#39;</span>);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160; </div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  $userImage = $userDropDownImage = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="keywordflow">if</span> (!empty($user-&gt;photo)) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    $userImage          = <a class="code" href="../../df/d08/class_form.html#a873221a472d9412f4873fc9f0db3df56">Form::showphoto</a>(<span class="stringliteral">&#39;userphoto&#39;</span>, $user, 0, 0, 0, <span class="stringliteral">&#39;photouserphoto userphoto&#39;</span>, <span class="stringliteral">&#39;small&#39;</span>, 0, 1);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    $userDropDownImage  = <a class="code" href="../../df/d08/class_form.html#a873221a472d9412f4873fc9f0db3df56">Form::showphoto</a>(<span class="stringliteral">&#39;userphoto&#39;</span>, $user, 0, 0, 0, <span class="stringliteral">&#39;dropdown-user-image&#39;</span>, <span class="stringliteral">&#39;small&#39;</span>, 0, 1);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    $nophoto = <span class="stringliteral">&#39;/public/theme/common/user_anonymous.png&#39;</span>;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordflow">if</span> ($user-&gt;gender == <span class="stringliteral">&#39;man&#39;</span>) {</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      $nophoto = <span class="stringliteral">&#39;/public/theme/common/user_man.png&#39;</span>;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    }</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordflow">if</span> ($user-&gt;gender == <span class="stringliteral">&#39;woman&#39;</span>) {</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      $nophoto = <span class="stringliteral">&#39;/public/theme/common/user_woman.png&#39;</span>;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    }</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    $userImage = <span class="stringliteral">&#39;&lt;img class=&quot;photo photouserphoto userphoto&quot; alt=&quot;No photo&quot; src=&quot;&#39;</span>.DOL_URL_ROOT.$nophoto.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    $userDropDownImage = <span class="stringliteral">&#39;&lt;img class=&quot;photo dropdown-user-image&quot; alt=&quot;No photo&quot; src=&quot;&#39;</span>.DOL_URL_ROOT.$nophoto.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  }</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160; </div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  $dropdownBody = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;span id=&quot;topmenulogincompanyinfo-btn&quot;&gt;&lt;i class=&quot;fa fa-caret-right&quot;&gt;&lt;/i&gt; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ShowCompanyInfos&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;div id=&quot;topmenulogincompanyinfo&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId1&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId1&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_SIREN&quot;</span>), 1).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  }</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId2&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId2&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_SIRET&quot;</span>), 2).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  }</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId3&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId3&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_APE&quot;</span>), 3).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;  }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId4&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId4&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_RCS&quot;</span>), 4).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  }</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId5&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId5&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_PROFID5&quot;</span>), 5).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  }</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <span class="keywordflow">if</span> ($langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId6&quot;</span>, $mysoc-&gt;country_code) != <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;transcountry(<span class="stringliteral">&quot;ProfId6&quot;</span>, $mysoc-&gt;country_code).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_PROFID6&quot;</span>), 6).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;VATIntraShort&quot;</span>).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_INFO_TVAINTRA&quot;</span>), <span class="stringliteral">&#39;VAT&#39;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Country&quot;</span>).<span class="stringliteral">&#39;&lt;/b&gt;: &lt;span&gt;&#39;</span>.($mysoc-&gt;country_code ? $langs-&gt;trans(<span class="stringliteral">&quot;Country&quot;</span>.$mysoc-&gt;country_code) : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160; </div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160; </div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;span id=&quot;topmenuloginmoreinfo-btn&quot;&gt;&lt;i class=&quot;fa fa-caret-right&quot;&gt;&lt;/i&gt; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ShowMoreInfos&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;div id=&quot;topmenuloginmoreinfo&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160; </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="comment">// login infos</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="keywordflow">if</span> (!empty($user-&gt;admin)) {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Administrator&quot;</span>).<span class="stringliteral">&#39;&lt;/b&gt;: &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a270210083c4970c0fdc9a83d2f9622c2">yn</a>($user-&gt;admin);</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  }</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <span class="keywordflow">if</span> (!empty($user-&gt;socid)) { <span class="comment">// Add thirdparty for external users</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    $thirdpartystatic = <span class="keyword">new</span> <a class="code" href="../../dc/dbc/class_societe.html">Societe</a>($db);</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    $thirdpartystatic-&gt;fetch($user-&gt;socid);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    $companylink = <span class="charliteral">&#39; &#39;</span>.$thirdpartystatic-&gt;getNomUrl(2); <span class="comment">// picto only of company</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    $company = <span class="stringliteral">&#39; (&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Company&quot;</span>).<span class="stringliteral">&#39;: &#39;</span>.$thirdpartystatic-&gt;name.<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  }</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  $type = ($user-&gt;socid ? $langs-&gt;trans(<span class="stringliteral">&quot;External&quot;</span>).$company : $langs-&gt;trans(<span class="stringliteral">&quot;Internal&quot;</span>));</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Type&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$type;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Status&quot;</span>).<span class="stringliteral">&#39;&lt;/b&gt;: &#39;</span>.$user-&gt;getLibStatut(0);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160; </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;u&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Session&quot;</span>).<span class="stringliteral">&#39;&lt;/u&gt;&#39;</span>;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;IPAddress&quot;</span>).<span class="stringliteral">&#39;&lt;/b&gt;: &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($_SERVER[<span class="stringliteral">&quot;REMOTE_ADDR&quot;</span>]);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_MODULE_MULTICOMPANY)) {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ConnectedOnMultiCompany&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$conf-&gt;entity.<span class="stringliteral">&#39; (user entity &#39;</span>.$user-&gt;entity.<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  }</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;AuthenticationMode&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$_SESSION[<span class="stringliteral">&quot;dol_authmode&quot;</span>].(empty($dolibarr_main_demo) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39; (demo)&#39;</span>);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ConnectedSince&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datelastlogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;PreviousConnexion&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datepreviouslogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;CurrentTheme&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$conf-&gt;theme;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;CurrentMenuManager&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.(isset($menumanager) ? $menumanager-&gt;name : <span class="stringliteral">&#39;unknown&#39;</span>);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  $langFlag = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a15897ead0ed9fdab27a2ff8d595b1302">picto_from_langcode</a>($langs-&gt;getDefaultLang());</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;CurrentUserLanguage&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.($langFlag ? $langFlag.<span class="charliteral">&#39; &#39;</span> : <span class="stringliteral">&#39;&#39;</span>).$langs-&gt;getDefaultLang();</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160; </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  $tz = (int) $_SESSION[<span class="stringliteral">&#39;dol_tz&#39;</span>] + (<span class="keywordtype">int</span>) $_SESSION[<span class="stringliteral">&#39;dol_dst&#39;</span>];</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ClientTZ&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.($tz ? ($tz &gt;= 0 ? <span class="charliteral">&#39;+&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).$tz : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39; (&#39;</span>.$_SESSION[<span class="stringliteral">&#39;dol_tz_string&#39;</span>].<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="comment">//$dropdownBody .= &#39; &amp;nbsp; &amp;nbsp; &amp;nbsp; &#39;.$langs-&gt;trans(&quot;DaylingSavingTime&quot;).&#39;: &#39;;</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="comment">//if ($_SESSION[&#39;dol_dst&#39;] &gt; 0) $dropdownBody .= yn(1);</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="comment">//else $dropdownBody .= yn(0);</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160; </div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Browser&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$conf-&gt;browser-&gt;name.($conf-&gt;browser-&gt;version ? <span class="charliteral">&#39; &#39;</span>.$conf-&gt;browser-&gt;version : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39; (&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Layout&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$conf-&gt;browser-&gt;layout;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Screen&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$_SESSION[<span class="stringliteral">&#39;dol_screenwidth&#39;</span>].<span class="stringliteral">&#39; x &#39;</span>.$_SESSION[<span class="stringliteral">&#39;dol_screenheight&#39;</span>];</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;  <span class="keywordflow">if</span> ($conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span>) {</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Phone&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Yes&quot;</span>);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  }</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="keywordflow">if</span> (!empty($_SESSION[<span class="stringliteral">&quot;disablemodules&quot;</span>])) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    $dropdownBody .= <span class="stringliteral">&#39;&lt;br&gt;&lt;b&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;DisabledModules&quot;</span>).<span class="stringliteral">&#39;:&lt;/b&gt; &lt;br&gt;&#39;</span>.join(<span class="stringliteral">&#39;, &#39;</span>, explode(<span class="charliteral">&#39;,&#39;</span>, $_SESSION[<span class="stringliteral">&quot;disablemodules&quot;</span>]));</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  }</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  $dropdownBody .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160; </div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="comment">// Execute hook</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  $parameters = array(<span class="stringliteral">&#39;user&#39;</span>=&gt;$user, <span class="stringliteral">&#39;langs&#39;</span> =&gt; $langs);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  $result = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printTopRightMenuLoginDropdownBody&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <span class="keywordflow">if</span> (is_numeric($result)) {</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="keywordflow">if</span> ($result == 0) {</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      $dropdownBody .= $hookmanager-&gt;resPrint; <span class="comment">// add</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      $dropdownBody = $hookmanager-&gt;resPrint; <span class="comment">// replace</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    }</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  }</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160; </div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="keywordflow">if</span> (empty($urllogout)) {</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    $urllogout = DOL_URL_ROOT.<span class="stringliteral">&#39;/user/logout.php?token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>();</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  }</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  $logoutLink = <span class="stringliteral">&#39;&lt;a accesskey=&quot;l&quot; href=&quot;&#39;</span>.$urllogout.<span class="stringliteral">&#39;&quot; class=&quot;button-top-menu-dropdown&quot; &gt;&lt;i class=&quot;fa fa-sign-out-alt&quot;&gt;&lt;/i&gt; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Logout&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  $profilLink = <span class="stringliteral">&#39;&lt;a accesskey=&quot;l&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/user/card.php?id=&#39;</span>.$user-&gt;id.<span class="stringliteral">&#39;&quot; class=&quot;button-top-menu-dropdown&quot; &gt;&lt;i class=&quot;fa fa-user&quot;&gt;&lt;/i&gt;  &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Card&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160; </div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160; </div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  $profilName = $user-&gt;getFullName($langs).<span class="stringliteral">&#39; (&#39;</span>.$user-&gt;login.<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160; </div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="keywordflow">if</span> (!empty($user-&gt;admin)) {</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    $profilName = <span class="stringliteral">&#39;&lt;i class=&quot;far fa-star classfortooltip&quot; title=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Administrator&quot;</span>).<span class="stringliteral">&#39;&quot; &gt;&lt;/i&gt; &#39;</span>.$profilName;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160; </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="comment">// Define version to show</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  $appli = constant(<span class="stringliteral">&#39;DOL_APPLICATION_TITLE&#39;</span>);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_APPLICATION_TITLE)) {</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    $appli = $conf-&gt;global-&gt;MAIN_APPLICATION_TITLE;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\d\.\d/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      <span class="keywordflow">if</span> (!preg_match(<span class="charliteral">&#39;/&#39;</span>.preg_quote(DOL_VERSION).<span class="charliteral">&#39;/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        $appli .= <span class="stringliteral">&quot; (&quot;</span>.DOL_VERSION.<span class="stringliteral">&quot;)&quot;</span>; <span class="comment">// If new title contains a version that is different than core</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      }</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    }</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  }</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160; </div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    $btnUser = <span class="stringliteral">&#39;&lt;!-- div for user link --&gt;</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="stringliteral">      &lt;div id=&quot;topmenu-login-dropdown&quot; class=&quot;userimg atoplogin dropdown user user-menu inline-block&quot;&gt;</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="stringliteral">          &lt;a href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/user/card.php?id=&#39;</span>.$user-&gt;id.<span class="stringliteral">&#39;&quot; class=&quot;dropdown-toggle login-dropdown-a&quot; data-toggle=&quot;dropdown&quot;&gt;</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="stringliteral">              &#39;</span>.$userImage.(empty($user-&gt;photo) ? <span class="stringliteral">&#39;&lt;span class=&quot;hidden-xs maxwidth200 atoploginusername hideonsmartphone paddingleft&quot;&gt;&#39;</span>.dol_trunc($user-&gt;firstname ? $user-&gt;firstname : $user-&gt;login, 10).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="stringliteral">          &lt;/a&gt;</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="stringliteral">          &lt;div class=&quot;dropdown-menu&quot;&gt;</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="stringliteral">              &lt;!-- User image --&gt;</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="stringliteral">              &lt;div class=&quot;user-header&quot;&gt;</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="stringliteral">                  &#39;</span>.$userDropDownImage.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="stringliteral">                  &lt;p&gt;</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="stringliteral">                      &#39;</span>.$profilName.<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <a class="code" href="../../d9/dc1/journals__list_8php.html#a90b302d5a7120cd0d34478405407d439">if</a> ($user-&gt;datelastlogin) {</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      $title = $langs-&gt;trans(<span class="stringliteral">&quot;ConnectedSince&quot;</span>).<span class="stringliteral">&#39; : &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datelastlogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="keywordflow">if</span> ($user-&gt;datepreviouslogin) {</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        $title .= <span class="stringliteral">&#39;&lt;br&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;PreviousConnexion&quot;</span>).<span class="stringliteral">&#39; : &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datepreviouslogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      }</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    }</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    $btnUser .= <span class="stringliteral">&#39;&lt;small class=&quot;classfortooltip&quot; title=&quot;&#39;</span>.dol_escape_htmltag($title).<span class="stringliteral">&#39;&quot; &gt;&lt;i class=&quot;fa fa-user-clock&quot;&gt;&lt;/i&gt; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datelastlogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>).<span class="stringliteral">&#39;&lt;/small&gt;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="keywordflow">if</span> ($user-&gt;datepreviouslogin) {</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      $btnUser .= <span class="stringliteral">&#39;&lt;small class=&quot;classfortooltip&quot; title=&quot;&#39;</span>.dol_escape_htmltag($title).<span class="stringliteral">&#39;&quot; &gt;&lt;i class=&quot;fa fa-user-clock opacitymedium&quot;&gt;&lt;/i&gt; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($user-&gt;datepreviouslogin, <span class="stringliteral">&quot;dayhour&quot;</span>, <span class="stringliteral">&#39;tzuser&#39;</span>).<span class="stringliteral">&#39;&lt;/small&gt;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    }</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160; </div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="comment">//$btnUser .= &#39;&lt;small class=&quot;classfortooltip&quot;&gt;&lt;i class=&quot;fa fa-cog&quot;&gt;&lt;/i&gt; &#39;.$langs-&gt;trans(&quot;Version&quot;).&#39; &#39;.$appli.&#39;&lt;/small&gt;&#39;;</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    $btnUser .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="stringliteral">                  &lt;/p&gt;</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="stringliteral">              &lt;/div&gt;</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="stringliteral">              &lt;!-- Menu Body --&gt;</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="stringliteral">              &lt;div class=&quot;user-body&quot;&gt;&#39;</span>.$dropdownBody.<span class="stringliteral">&#39;&lt;/div&gt;</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="stringliteral">              &lt;!-- Menu Footer--&gt;</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="stringliteral">              &lt;div class=&quot;user-footer&quot;&gt;</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="stringliteral">                  &lt;div class=&quot;pull-left&quot;&gt;</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="stringliteral">                      &#39;</span>.$profilLink.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="stringliteral">                  &lt;/div&gt;</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="stringliteral">                  &lt;div class=&quot;pull-right&quot;&gt;</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="stringliteral">                      &#39;</span>.$logoutLink.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="stringliteral">                  &lt;/div&gt;</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="stringliteral">                  &lt;div style=&quot;clear:both;&quot;&gt;&lt;/div&gt;</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="stringliteral">              &lt;/div&gt;</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="stringliteral">          &lt;/div&gt;</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="stringliteral">      &lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    $btnUser = <span class="stringliteral">&#39;&lt;!-- div for user link --&gt;</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="stringliteral">      &lt;div id=&quot;topmenu-login-dropdown&quot; class=&quot;userimg atoplogin dropdown user user-menu inline-block&quot;&gt;</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="stringliteral">        &lt;a href=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/user/card.php?id=&#39;</span>.$user-&gt;id.<span class="stringliteral">&#39;&quot;&gt;</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="stringliteral">        &#39;</span>.$userImage.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="stringliteral">          &lt;span class=&quot;hidden-xs maxwidth200 atoploginusername hideonsmartphone&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ac863120bf29caa349dd610383aae275e">dol_trunc</a>($user-&gt;firstname ? $user-&gt;firstname : $user-&gt;login, 10).<span class="stringliteral">&#39;&lt;/span&gt;</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="stringliteral">          &lt;/a&gt;</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="stringliteral">    &lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  }</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160; </div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;JS_JQUERY_DISABLE_DROPDOWN&#39;</span>) &amp;&amp; !empty($conf-&gt;use_javascript_ajax)) {    <span class="comment">// This may be set by some pages that use different jquery version to avoid errors</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    $btnUser .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="stringliteral">        &lt;!-- Code to show/hide the user drop-down --&gt;</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="stringliteral">        &lt;script&gt;</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="stringliteral">        jQuery(document).ready(function() {</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="stringliteral">            jQuery(document).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="stringliteral">                if (!$(event.target).closest(&quot;#topmenu-login-dropdown&quot;).length) {</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="stringliteral">          //console.log(&quot;close login dropdown&quot;);</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="stringliteral">          // Hide the menus.</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="stringliteral">                    jQuery(&quot;#topmenu-login-dropdown&quot;).removeClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="stringliteral">            });</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="stringliteral">      &#39;</span>;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160; </div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordflow">if</span> ($conf-&gt;theme != <span class="stringliteral">&#39;md&#39;</span>) {</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      $btnUser .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="stringliteral">              jQuery(&quot;#topmenu-login-dropdown .dropdown-toggle&quot;).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="stringliteral">          console.log(&quot;toggle login dropdown&quot;);</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="stringliteral">          event.preventDefault();</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="stringliteral">                  jQuery(&quot;#topmenu-login-dropdown&quot;).toggleClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="stringliteral">              jQuery(&quot;#topmenulogincompanyinfo-btn&quot;).on(&quot;click&quot;, function() {</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="stringliteral">          console.log(&quot;Clik on topmenulogincompanyinfo-btn&quot;);</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="stringliteral">                  jQuery(&quot;#topmenulogincompanyinfo&quot;).slideToggle();</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="stringliteral">              jQuery(&quot;#topmenuloginmoreinfo-btn&quot;).on(&quot;click&quot;, function() {</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="stringliteral">          console.log(&quot;Clik on topmenuloginmoreinfo-btn&quot;);</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="stringliteral">                  jQuery(&quot;#topmenuloginmoreinfo&quot;).slideToggle();</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="stringliteral">              });&#39;</span>;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    }</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160; </div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    $btnUser .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="stringliteral">        &lt;/script&gt;</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="stringliteral">        &#39;</span>;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  }</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160; </div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">return</span> $btnUser;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;}</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160; </div>
<div class="line"><a name="l02409"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a1d3a53ad764311e0ec6e7466ff660ec0"> 2409</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a1d3a53ad764311e0ec6e7466ff660ec0">top_menu_quickadd</a>()</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;{</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  global $langs;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160; </div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  $html = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160; </div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  $html .= <span class="stringliteral">&#39;&lt;!-- div for quick add link --&gt;</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="stringliteral">    &lt;div id=&quot;topmenu-quickadd-dropdown&quot; class=&quot;atoplogin dropdown inline-block&quot;&gt;</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="stringliteral">        &lt;a class=&quot;dropdown-toggle login-dropdown-a&quot; data-toggle=&quot;dropdown&quot; href=&quot;#&quot; title=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;QuickAdd&#39;</span>).<span class="stringliteral">&#39; (&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;QuickAddMenuShortCut&#39;</span>).<span class="stringliteral">&#39;)&quot;&gt;&lt;i class=&quot;fa fa-plus-circle&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="stringliteral">        &lt;div class=&quot;dropdown-menu&quot;&gt;&#39;</span>.<a class="code" href="../../d0/db1/main_8inc_8php.html#adb5c76cae89d9bc43ced3d15a4f1fd58">printDropdownQuickadd</a>().<span class="stringliteral">&#39;&lt;/div&gt;</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="stringliteral">    &lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  $html .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="stringliteral">        &lt;!-- Code to show/hide the user drop-down --&gt;</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="stringliteral">        &lt;script&gt;</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="stringliteral">        jQuery(document).ready(function() {</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="stringliteral">            jQuery(document).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="stringliteral">                if (!$(event.target).closest(&quot;#topmenu-quickadd-dropdown&quot;).length) {</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="stringliteral">                    // Hide the menus.</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="stringliteral">                    $(&quot;#topmenu-quickadd-dropdown&quot;).removeClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="stringliteral">            });</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="stringliteral">            $(&quot;#topmenu-quickadd-dropdown .dropdown-toggle&quot;).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="stringliteral">                openQuickAddDropDown();</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="stringliteral">            });</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="stringliteral">            // Key map shortcut</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="stringliteral">            $(document).keydown(function(e){</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="stringliteral">                  if( e.which === 76 &amp;&amp; e.ctrlKey &amp;&amp; e.shiftKey ){</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="stringliteral">                     console.log(\&#39;control + shift + l : trigger open quick add dropdown\&#39;);</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="stringliteral">                     openQuickAddDropDown();</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="stringliteral">            });</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="stringliteral">            var openQuickAddDropDown = function() {</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="stringliteral">                event.preventDefault();</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="stringliteral">                $(&quot;#topmenu-quickadd-dropdown&quot;).toggleClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="stringliteral">                //$(&quot;#top-quickadd-search-input&quot;).focus();</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="stringliteral">        &lt;/script&gt;</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="stringliteral">        &#39;</span>;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">return</span> $html;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;}</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160; </div>
<div class="line"><a name="l02458"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#adb5c76cae89d9bc43ced3d15a4f1fd58"> 2458</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#adb5c76cae89d9bc43ced3d15a4f1fd58">printDropdownQuickadd</a>()</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;{</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  global $conf, $user, $langs, $hookmanager;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160; </div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  $items = array(</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <span class="stringliteral">&#39;items&#39;</span> =&gt; array(</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      array(</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/adherents/card.php?action=create&amp;amp;mainmenu=members&quot;</span>,</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;MenuNewMember@members&quot;</span>,</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Adherent@members&quot;</span>,</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_member&quot;</span>,</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;adherent&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;adherent&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 5,</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      ),</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      array(</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/societe/card.php?action=create&amp;amp;mainmenu=companies&quot;</span>,</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;MenuNewThirdParty@companies&quot;</span>,</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;ThirdParty@companies&quot;</span>,</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_company&quot;</span>,</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;societe&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;societe&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 10,</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      ),</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      array(</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/contact/card.php?action=create&amp;amp;mainmenu=companies&quot;</span>,</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewContactAddress@companies&quot;</span>,</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Contact@companies&quot;</span>,</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_contact&quot;</span>,</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;societe&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;societe&quot;</span>, <span class="stringliteral">&quot;contact&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 20,</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      ),</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      array(</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/comm/propal/card.php?action=create&amp;amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewPropal@propal&quot;</span>,</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Proposal@propal&quot;</span>,</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_propal&quot;</span>,</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;propal&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;propal&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 30,</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      ),</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160; </div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      array(</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/commande/card.php?action=create&amp;amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewOrder@orders&quot;</span>,</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Order@orders&quot;</span>,</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_order&quot;</span>,</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;commande&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;commande&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 40,</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      ),</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      array(</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/compta/facture/card.php?action=create&amp;amp;mainmenu=billing&quot;</span>,</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewBill@bills&quot;</span>,</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Bill@bills&quot;</span>,</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_bill&quot;</span>,</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;facture&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 50,</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      ),</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      array(</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/contrat/card.php?action=create&amp;amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewContractSubscription@contracts&quot;</span>,</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Contract@contracts&quot;</span>,</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_contract&quot;</span>,</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;contrat&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;contrat&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 60,</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      ),</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      array(</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/supplier_proposal/card.php?action=create&amp;amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;SupplierProposalNew@supplier_proposal&quot;</span>,</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;SupplierProposal@supplier_proposal&quot;</span>,</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;supplier_proposal&quot;</span>,</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;supplier_proposal&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;supplier_invoice&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 70,</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      ),</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;      array(</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/fourn/commande/card.php?action=create&amp;amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewSupplierOrderShort@orders&quot;</span>,</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;SupplierOrder@orders&quot;</span>,</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;supplier_order&quot;</span>,</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;fournisseur&quot;</span>) &amp;&amp; empty($conf-&gt;global-&gt;MAIN_USE_NEW_SUPPLIERMOD) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;fournisseur&quot;</span>, <span class="stringliteral">&quot;commande&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>)) || (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;supplier_order&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;supplier_invoice&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>)), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 80,</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      ),</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      array(</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/fourn/facture/card.php?action=create&amp;amp;mainmenu=billing&quot;</span>,</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewBill@bills&quot;</span>,</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;SupplierBill@bills&quot;</span>,</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;supplier_invoice&quot;</span>,</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;fournisseur&quot;</span>) &amp;&amp; empty($conf-&gt;global-&gt;MAIN_USE_NEW_SUPPLIERMOD) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;fournisseur&quot;</span>, <span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>)) || (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;supplier_invoice&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;supplier_invoice&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>)), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 90,</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      ),</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      array(</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/ticket/card.php?action=create&amp;amp;mainmenu=ticket&quot;</span>,</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewTicket@ticket&quot;</span>,</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Ticket@ticket&quot;</span>,</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;ticket&quot;</span>,</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;ticket&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;ticket&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 100,</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      ),</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      array(</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/fichinter/card.php?action=create&amp;mainmenu=commercial&quot;</span>,</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewIntervention@interventions&quot;</span>,</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Intervention@interventions&quot;</span>,</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;intervention&quot;</span>,</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;ficheinter&#39;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;ficheinter&quot;</span>, <span class="stringliteral">&quot;creer&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 110,</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      ),</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      array(</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/product/card.php?action=create&amp;amp;type=0&amp;amp;mainmenu=products&quot;</span>,</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewProduct@products&quot;</span>,</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Product@products&quot;</span>,</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_product&quot;</span>,</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;product&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;produit&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 400,</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      ),</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      array(</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/product/card.php?action=create&amp;amp;type=1&amp;amp;mainmenu=products&quot;</span>,</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;NewService@products&quot;</span>,</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Service@products&quot;</span>,</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;object_service&quot;</span>,</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; <a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;service&quot;</span>) &amp;&amp; $user-&gt;hasRight(<span class="stringliteral">&quot;service&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 410,</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      ),</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      array(</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;/user/card.php?action=create&amp;amp;type=1&amp;amp;mainmenu=home&quot;</span>,</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        <span class="stringliteral">&quot;title&quot;</span> =&gt; <span class="stringliteral">&quot;AddUser@users&quot;</span>,</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;        <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;User@users&quot;</span>,</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        <span class="stringliteral">&quot;picto&quot;</span> =&gt; <span class="stringliteral">&quot;user&quot;</span>,</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        <span class="stringliteral">&quot;activation&quot;</span> =&gt; $user-&gt;hasRight(<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;write&quot;</span>), <span class="comment">// vs hooking</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;        <span class="stringliteral">&quot;position&quot;</span> =&gt; 500,</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      ),</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    ),</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  );</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160; </div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  $dropDownQuickAddHtml = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160; </div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <span class="comment">// Define $dropDownQuickAddHtml</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  $dropDownQuickAddHtml .= <span class="stringliteral">&#39;&lt;div class=&quot;quickadd-body dropdown-body&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  $dropDownQuickAddHtml .= <span class="stringliteral">&#39;&lt;div class=&quot;dropdown-quickadd-list&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160; </div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="comment">// Allow the $items of the menu to be manipulated by modules</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  $parameters = array();</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  $hook_items = $items;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;menuDropdownQuickaddItems&#39;</span>, $parameters, $hook_items); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;  <span class="keywordflow">if</span> (is_numeric($reshook) &amp;&amp; !empty($hookmanager-&gt;results) &amp;&amp; is_array($hookmanager-&gt;results)) {</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="keywordflow">if</span> ($reshook == 0) {</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      $items[<span class="stringliteral">&#39;items&#39;</span>] = array_merge($items[<span class="stringliteral">&#39;items&#39;</span>], $hookmanager-&gt;results); <span class="comment">// add</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      $items = $hookmanager-&gt;results; <span class="comment">// replace</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160; </div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="comment">// Sort menu items by &#39;position&#39; value</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    $position = array();</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="keywordflow">foreach</span> ($items[<span class="stringliteral">&#39;items&#39;</span>] as $key =&gt; $row) {</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      $position[$key] = $row[<span class="stringliteral">&#39;position&#39;</span>];</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    }</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    $array1_sort_order = SORT_ASC;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    array_multisort($position, $array1_sort_order, $items[<span class="stringliteral">&#39;items&#39;</span>]);</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  }</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160; </div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <span class="keywordflow">foreach</span> ($items[<span class="stringliteral">&#39;items&#39;</span>] as $item) {</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <span class="keywordflow">if</span> (!$item[<span class="stringliteral">&#39;activation&#39;</span>]) {</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    }</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    $langs-&gt;load(explode(<span class="charliteral">&#39;@&#39;</span>, $item[<span class="stringliteral">&#39;title&#39;</span>])[1]);</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    $langs-&gt;load(explode(<span class="charliteral">&#39;@&#39;</span>, $item[<span class="stringliteral">&#39;name&#39;</span>])[1]);</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    $dropDownQuickAddHtml .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="stringliteral">      &lt;a class=&quot;dropdown-item quickadd-item&quot; href=&quot;&#39;</span>.DOL_URL_ROOT.$item[<span class="stringliteral">&#39;url&#39;</span>].<span class="stringliteral">&#39;&quot; title=&quot;&#39;</span>.$langs-&gt;trans(explode(<span class="charliteral">&#39;@&#39;</span>, $item[<span class="stringliteral">&#39;title&#39;</span>])[0]).<span class="stringliteral">&#39;&quot;&gt;</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="stringliteral">      &#39;</span>. <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>(<span class="stringliteral">&#39;&#39;</span>, $item[<span class="stringliteral">&#39;picto&#39;</span>], <span class="stringliteral">&#39;style=&quot;width:18px;&quot;&#39;</span>) . <span class="charliteral">&#39; &#39;</span> . $langs-&gt;trans(explode(<span class="charliteral">&#39;@&#39;</span>, $item[<span class="stringliteral">&#39;name&#39;</span>])[0]) . <span class="stringliteral">&#39;&lt;/a&gt;</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="stringliteral">    &#39;</span>;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  }</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160; </div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  $dropDownQuickAddHtml .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  $dropDownQuickAddHtml .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160; </div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordflow">return</span> $dropDownQuickAddHtml;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;}</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160; </div>
<div class="line"><a name="l02637"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#af6a6ade8f057ae2fc0d0b72f8e173b04"> 2637</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#af6a6ade8f057ae2fc0d0b72f8e173b04">top_menu_bookmark</a>()</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;{</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  global $langs, $conf, $db, $user;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160; </div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  $html = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  <span class="comment">// Define $bookmarks</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;bookmark&#39;</span>) || empty($user-&gt;rights-&gt;bookmark-&gt;lire)) {</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keywordflow">return</span> $html;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  }</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160; </div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;JS_JQUERY_DISABLE_DROPDOWN&#39;</span>) &amp;&amp; !empty($conf-&gt;use_javascript_ajax)) {     <span class="comment">// This may be set by some pages that use different jquery version to avoid errors</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/bookmarks/bookmarks.lib.php&#39;</span>;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    $langs-&gt;load(<span class="stringliteral">&quot;bookmarks&quot;</span>);</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160; </div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      $html .= <span class="stringliteral">&#39;&lt;div id=&quot;topmenu-bookmark-dropdown&quot; class=&quot;dropdown inline-block&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      $html .= <a class="code" href="../../d8/d9e/bookmarks_8lib_8php.html#afd2d8d08c39bb548bb84ba603c6137a9">printDropdownBookmarksList</a>();</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;      $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      $html .= <span class="stringliteral">&#39;&lt;!-- div for bookmark link --&gt;</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;<span class="stringliteral">          &lt;div id=&quot;topmenu-bookmark-dropdown&quot; class=&quot;dropdown inline-block&quot;&gt;</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="stringliteral">              &lt;a class=&quot;dropdown-toggle login-dropdown-a&quot; data-toggle=&quot;dropdown&quot; href=&quot;#&quot; title=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;Bookmarks&#39;</span>).<span class="stringliteral">&#39; (&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;BookmarksMenuShortCut&#39;</span>).<span class="stringliteral">&#39;)&quot;&gt;&lt;i class=&quot;fa fa-star&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="stringliteral">              &lt;div class=&quot;dropdown-menu&quot;&gt;</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="stringliteral">                  &#39;</span>.<a class="code" href="../../d8/d9e/bookmarks_8lib_8php.html#afd2d8d08c39bb548bb84ba603c6137a9">printDropdownBookmarksList</a>().<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="stringliteral">              &lt;/div&gt;</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="stringliteral">          &lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160; </div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      $html .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="stringliteral">          &lt;!-- Code to show/hide the bookmark drop-down --&gt;</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="stringliteral">          &lt;script&gt;</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="stringliteral">          jQuery(document).ready(function() {</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="stringliteral">              jQuery(document).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="stringliteral">                  if (!$(event.target).closest(&quot;#topmenu-bookmark-dropdown&quot;).length) {</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="stringliteral">            //console.log(&quot;close bookmark dropdown - we click outside&quot;);</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;<span class="stringliteral">                      // Hide the menus.</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="stringliteral">                      $(&quot;#topmenu-bookmark-dropdown&quot;).removeClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="stringliteral">              jQuery(&quot;#topmenu-bookmark-dropdown .dropdown-toggle&quot;).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="stringliteral">          console.log(&quot;toggle bookmark dropdown&quot;);</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="stringliteral">          openBookMarkDropDown();</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="stringliteral">              // Key map shortcut</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="stringliteral">              jQuery(document).keydown(function(e){</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="stringliteral">                    if( e.which === 77 &amp;&amp; e.ctrlKey &amp;&amp; e.shiftKey ){</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="stringliteral">                       console.log(\&#39;control + shift + m : trigger open bookmark dropdown\&#39;);</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="stringliteral">                       openBookMarkDropDown();</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="stringliteral">              var openBookMarkDropDown = function() {</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="stringliteral">                  event.preventDefault();</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="stringliteral">                  jQuery(&quot;#topmenu-bookmark-dropdown&quot;).toggleClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="stringliteral">                  jQuery(&quot;#top-bookmark-search-input&quot;).focus();</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="stringliteral">          });</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="stringliteral">          &lt;/script&gt;</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="stringliteral">          &#39;</span>;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    }</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="keywordflow">return</span> $html;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;}</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160; </div>
<div class="line"><a name="l02710"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#ad46a898e40cc046fa58e96efa1c1f359"> 2710</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#ad46a898e40cc046fa58e96efa1c1f359">top_menu_search</a>()</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;{</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  global $langs, $conf, $db, $user, $hookmanager;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160; </div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  $html = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160; </div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  $usedbyinclude = 1;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  $arrayresult = <span class="keyword">null</span>;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/ajax/selectsearchbox.php&#39;</span>; <span class="comment">// This set $arrayresult</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160; </div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  $defaultAction = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  $buttonList = <span class="stringliteral">&#39;&lt;div class=&quot;dropdown-global-search-button-list&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="comment">// Menu with all searchable items</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="keywordflow">foreach</span> ($arrayresult as $keyItem =&gt; $item) {</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">if</span> (empty($defaultAction)) {</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      $defaultAction = $item[<span class="stringliteral">&#39;url&#39;</span>];</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    }</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    $buttonList .= <span class="stringliteral">&#39;&lt;button class=&quot;dropdown-item global-search-item&quot; data-target=&quot;&#39;</span>.dol_escape_htmltag($item[<span class="stringliteral">&#39;url&#39;</span>]).<span class="stringliteral">&#39;&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    $buttonList .= $item[<span class="stringliteral">&#39;text&#39;</span>];</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    $buttonList .= <span class="stringliteral">&#39;&lt;/button&gt;&#39;</span>;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;  }</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  $buttonList .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160; </div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160; </div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  $searchInput = <span class="stringliteral">&#39;&lt;input name=&quot;sall&quot; id=&quot;top-global-search-input&quot; class=&quot;dropdown-search-input&quot; placeholder=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;Search&#39;</span>).<span class="stringliteral">&#39;&quot; autocomplete=&quot;off&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160; </div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  $dropDownHtml = <span class="stringliteral">&#39;&lt;form id=&quot;top-menu-action-search&quot; name=&quot;actionsearch&quot; method=&quot;GET&quot; action=&quot;&#39;</span>.$defaultAction.<span class="stringliteral">&#39;&quot; &gt;&#39;</span>;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160; </div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  $dropDownHtml .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="stringliteral">        &lt;!-- search input --&gt;</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="stringliteral">        &lt;div class=&quot;dropdown-header search-dropdown-header&quot;&gt;</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="stringliteral">            &#39;</span> . $searchInput.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="stringliteral">        &lt;/div&gt;</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="stringliteral">    &#39;</span>;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160; </div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  $dropDownHtml .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="stringliteral">        &lt;!-- Menu Body --&gt;</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="stringliteral">        &lt;div class=&quot;dropdown-body search-dropdown-body&quot;&gt;</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="stringliteral">        &#39;</span>.$buttonList.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="stringliteral">        &lt;/div&gt;</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="stringliteral">        &#39;</span>;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160; </div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  $dropDownHtml .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160; </div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160; </div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  $html .= <span class="stringliteral">&#39;&lt;!-- div for Global Search --&gt;</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;<span class="stringliteral">    &lt;div id=&quot;topmenu-global-search-dropdown&quot; class=&quot;atoplogin dropdown inline-block&quot;&gt;</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="stringliteral">        &lt;a class=&quot;dropdown-toggle login-dropdown-a&quot; data-toggle=&quot;dropdown&quot; href=&quot;#&quot; title=&quot;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;Search&#39;</span>).<span class="stringliteral">&#39; (&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;SearchMenuShortCut&#39;</span>).<span class="stringliteral">&#39;)&quot;&gt;</span></div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="stringliteral">            &lt;i class=&quot;fa fa-search&quot; &gt;&lt;/i&gt;</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="stringliteral">        &lt;/a&gt;</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="stringliteral">        &lt;div class=&quot;dropdown-menu dropdown-search&quot;&gt;</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="stringliteral">            &#39;</span>.$dropDownHtml.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="stringliteral">        &lt;/div&gt;</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="stringliteral">    &lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160; </div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  $html .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="stringliteral">    &lt;!-- Code to show/hide the user drop-down --&gt;</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="stringliteral">    &lt;script&gt;</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="stringliteral">    jQuery(document).ready(function() {</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="stringliteral">        // prevent submiting form on press ENTER</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="stringliteral">        jQuery(&quot;#top-global-search-input&quot;).keydown(function (e) {</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="stringliteral">            if (e.keyCode == 13) {</span></div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="stringliteral">                var inputs = $(this).parents(&quot;form&quot;).eq(0).find(&quot;:button&quot;);</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="stringliteral">                if (inputs[inputs.index(this) + 1] != null) {</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="stringliteral">                    inputs[inputs.index(this) + 1].focus();</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="stringliteral">                e.preventDefault();</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="stringliteral">                return false;</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="stringliteral">        // arrow key nav</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;<span class="stringliteral">        jQuery(document).keydown(function(e) {</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="stringliteral">      // Get the focused element:</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="stringliteral">      var $focused = $(&quot;:focus&quot;);</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="stringliteral">      if($focused.length &amp;&amp; $focused.hasClass(&quot;global-search-item&quot;)){</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="stringliteral">              // UP - move to the previous line</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;<span class="stringliteral">        if (e.keyCode == 38) {</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="stringliteral">            e.preventDefault();</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="stringliteral">          $focused.prev().focus();</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="stringliteral">        // DOWN - move to the next line</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="stringliteral">        if (e.keyCode == 40) {</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="stringliteral">            e.preventDefault();</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="stringliteral">          $focused.next().focus();</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="stringliteral">      }</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="stringliteral">        // submit form action</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="stringliteral">        jQuery(&quot;.dropdown-global-search-button-list .global-search-item&quot;).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="stringliteral">            jQuery(&quot;#top-menu-action-search&quot;).attr(&quot;action&quot;, $(this).data(&quot;target&quot;));</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="stringliteral">            jQuery(&quot;#top-menu-action-search&quot;).submit();</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="stringliteral">        // close drop down</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="stringliteral">        jQuery(document).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="stringliteral">      if (!$(event.target).closest(&quot;#topmenu-global-search-dropdown&quot;).length) {</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="stringliteral">        console.log(&quot;click close search - we click outside&quot;);</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="stringliteral">                // Hide the menus.</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="stringliteral">                jQuery(&quot;#topmenu-global-search-dropdown&quot;).removeClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="stringliteral">        // Open drop down</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="stringliteral">        jQuery(&quot;#topmenu-global-search-dropdown .dropdown-toggle&quot;).on(&quot;click&quot;, function(event) {</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="stringliteral">      console.log(&quot;toggle search dropdown&quot;);</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="stringliteral">            openGlobalSearchDropDown();</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="stringliteral">        // Key map shortcut</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="stringliteral">        jQuery(document).keydown(function(e){</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="stringliteral">              if( e.which === 70 &amp;&amp; e.ctrlKey &amp;&amp; e.shiftKey ){</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="stringliteral">                 console.log(\&#39;control + shift + f : trigger open global-search dropdown\&#39;);</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="stringliteral">                 openGlobalSearchDropDown();</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="stringliteral">        var openGlobalSearchDropDown = function() {</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="stringliteral">            jQuery(&quot;#topmenu-global-search-dropdown&quot;).toggleClass(&quot;open&quot;);</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="stringliteral">            jQuery(&quot;#top-global-search-input&quot;).focus();</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="stringliteral">    });</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="stringliteral">    &lt;/script&gt;</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="stringliteral">    &#39;</span>;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160; </div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">return</span> $html;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;}</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160; </div>
<div class="line"><a name="l02859"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a10fa94a9a5f6491258b175619f29d5b5"> 2859</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a10fa94a9a5f6491258b175619f29d5b5">left_menu</a>($menu_array_before, $helppagename = <span class="stringliteral">&#39;&#39;</span>, $notused = <span class="stringliteral">&#39;&#39;</span>, $menu_array_after = <span class="stringliteral">&#39;&#39;</span>, $leftmenuwithoutmainarea = 0, $title = <span class="stringliteral">&#39;&#39;</span>, $acceptdelayedhtml = 0)</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;{</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;  global $user, $conf, $langs, $db, <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  global $hookmanager, $menumanager;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160; </div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  $searchform = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160; </div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <span class="keywordflow">if</span> (!empty($menu_array_before)) {</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&quot;Deprecated parameter menu_array_before was used when calling main::left_menu function. Menu entries of module should now be defined into module descriptor and not provided when calling left_menu.&quot;</span>, LOG_WARNING);</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  }</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160; </div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; (!defined(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>) || !constant(<span class="stringliteral">&#39;NOREQUIREMENU&#39;</span>))) {</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="comment">// Instantiate hooks for external modules</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;searchform&#39;</span>, <span class="stringliteral">&#39;leftblock&#39;</span>));</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160; </div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;!-- Begin side-nav id-left --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;div class=&quot;side-nav&quot;&gt;&lt;div id=&quot;id-left&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160; </div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="keywordflow">if</span> ($conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span>) {</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;      $conf-&gt;global-&gt;MAIN_USE_OLD_SEARCH_FORM = 1; <span class="comment">// Select into select2 is awfull on smartphone. TODO Is this still true with select2 v4 ?</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    }</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160; </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160; </div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keywordflow">if</span> (!is_object(<a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>)) {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a> = <span class="keyword">new</span> <a class="code" href="../../df/d08/class_form.html">Form</a>($db);</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    }</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    $selected = -1;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_USE_TOP_MENU_SEARCH_DROPDOWN)) {</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;      $usedbyinclude = 1;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      $arrayresult = <span class="keyword">null</span>;</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/ajax/selectsearchbox.php&#39;</span>; <span class="comment">// This set $arrayresult</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160; </div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      <span class="keywordflow">if</span> ($conf-&gt;use_javascript_ajax &amp;&amp; empty($conf-&gt;global-&gt;MAIN_USE_OLD_SEARCH_FORM)) {</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        $searchform .= <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;selectArrayFilter(<span class="stringliteral">&#39;searchselectcombo&#39;</span>, $arrayresult, $selected, <span class="stringliteral">&#39;&#39;</span>, 1, 0, (empty($conf-&gt;global-&gt;MAIN_SEARCHBOX_CONTENT_LOADED_BEFORE_KEY) ? 1 : 0), <span class="stringliteral">&#39;vmenusearchselectcombo&#39;</span>, 1, $langs-&gt;trans(<span class="stringliteral">&quot;Search&quot;</span>), 1);</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;        <span class="keywordflow">if</span> (is_array($arrayresult)) {</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;          <span class="keywordflow">foreach</span> ($arrayresult as $key =&gt; $val) {</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;            $searchform .= <a class="code" href="../../d0/db1/main_8inc_8php.html#ad079f3096679e29ab84867c7babc8af0">printSearchForm</a>($val[<span class="stringliteral">&#39;url&#39;</span>], $val[<span class="stringliteral">&#39;url&#39;</span>], $val[<span class="stringliteral">&#39;label&#39;</span>], <span class="stringliteral">&#39;maxwidth125&#39;</span>, <span class="stringliteral">&#39;sall&#39;</span>, (empty($val[<span class="stringliteral">&#39;shortcut&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $val[<span class="stringliteral">&#39;shortcut&#39;</span>]), <span class="stringliteral">&#39;searchleft&#39;</span>.$key, $val[<span class="stringliteral">&#39;img&#39;</span>]);</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;          }</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        }</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      }</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160; </div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <span class="comment">// Execute hook printSearchForm</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      $parameters = array(<span class="stringliteral">&#39;searchform&#39;</span> =&gt; $searchform);</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printSearchForm&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      <span class="keywordflow">if</span> (empty($reshook)) {</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;        $searchform .= $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        $searchform = $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      }</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160; </div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      <span class="comment">// Force special value for $searchform</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER) || empty($conf-&gt;use_javascript_ajax)) {</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        $urltosearch = DOL_URL_ROOT.<span class="stringliteral">&#39;/core/search_page.php?showtitlebefore=1&#39;</span>;</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        $searchform = <span class="stringliteral">&#39;&lt;div class=&quot;blockvmenuimpair blockvmenusearchphone&quot;&gt;&lt;div id=&quot;divsearchforms1&quot;&gt;&lt;a href=&quot;&#39;</span>.$urltosearch.<span class="stringliteral">&#39;&quot; accesskey=&quot;s&quot; alt=&quot;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($langs-&gt;trans(<span class="stringliteral">&quot;ShowSearchFields&quot;</span>)).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Search&quot;</span>).<span class="stringliteral">&#39;...&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      } elseif ($conf-&gt;use_javascript_ajax &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_USE_OLD_SEARCH_FORM)) {</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        $searchform = <span class="stringliteral">&#39;&lt;div class=&quot;blockvmenuimpair blockvmenusearchphone&quot;&gt;&lt;div id=&quot;divsearchforms1&quot;&gt;&lt;a href=&quot;#&quot; alt=&quot;&#39;</span>.dol_escape_htmltag($langs-&gt;trans(<span class="stringliteral">&quot;ShowSearchFields&quot;</span>)).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Search&quot;</span>).<span class="stringliteral">&#39;...&lt;/a&gt;&lt;/div&gt;&lt;div id=&quot;divsearchforms2&quot; style=&quot;display: none&quot;&gt;&#39;</span>.$searchform.<span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        $searchform .= <span class="stringliteral">&#39;&lt;script&gt;</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="stringliteral">              jQuery(document).ready(function () {</span></div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="stringliteral">                jQuery(&quot;#divsearchforms1&quot;).click(function(){</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="stringliteral">                     jQuery(&quot;#divsearchforms2&quot;).toggle();</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="stringliteral">                 });</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="stringliteral">                &lt;/script&gt;&#39;</span> . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        $searchform .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      }</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    }</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160; </div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="comment">// Left column</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    print <span class="stringliteral">&#39;&lt;!-- Begin left menu --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    print <span class="stringliteral">&#39;&lt;div class=&quot;vmenu&quot;&#39;</span>.(empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER) ? <span class="stringliteral">&#39;&#39;</span> : <span class="stringliteral">&#39; title=&quot;Left menu&quot;&#39;</span>).<span class="charliteral">&#39;&gt;&#39;</span>.<span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160; </div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="comment">// Show left menu with other forms</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    $menumanager-&gt;menu_array = $menu_array_before;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    $menumanager-&gt;menu_array_after = $menu_array_after;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    $menumanager-&gt;showmenu(<span class="stringliteral">&#39;left&#39;</span>, array(<span class="stringliteral">&#39;searchform&#39;</span>=&gt;$searchform)); <span class="comment">// output menu_array and menu found in database</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160; </div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="comment">// Dolibarr version + help + bug report link</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    print <span class="stringliteral">&quot;&lt;!-- Begin Help Block--&gt;\n&quot;</span>;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    print <span class="stringliteral">&#39;&lt;div id=&quot;blockvmenuhelp&quot; class=&quot;blockvmenuhelp&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160; </div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="comment">// Version</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_SHOW_VERSION)) {    <span class="comment">// Version is already on help picto and on login page.</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.org&#39;</span>;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="comment">//local communities</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/fr/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.fr&#39;</span>;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      }</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/es/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.es&#39;</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      }</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/de/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.de&#39;</span>;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      }</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/it/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.it&#39;</span>;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      }</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/gr/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        $doliurl = <span class="stringliteral">&#39;https://www.dolibarr.gr&#39;</span>;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      }</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160; </div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      $appli = constant(<span class="stringliteral">&#39;DOL_APPLICATION_TITLE&#39;</span>);</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_APPLICATION_TITLE)) {</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        $appli = $conf-&gt;global-&gt;MAIN_APPLICATION_TITLE; $doliurl = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\d\.\d/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;          <span class="keywordflow">if</span> (!preg_match(<span class="charliteral">&#39;/&#39;</span>.preg_quote(DOL_VERSION).<span class="charliteral">&#39;/&#39;</span>, $appli)) {</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;            $appli .= <span class="stringliteral">&quot; (&quot;</span>.DOL_VERSION.<span class="stringliteral">&quot;)&quot;</span>; <span class="comment">// If new title contains a version that is different than core</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;          }</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;          $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        }</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        $appli .= <span class="stringliteral">&quot; &quot;</span>.DOL_VERSION;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      }</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      print <span class="stringliteral">&#39;&lt;div id=&quot;blockvmenuhelpapp&quot; class=&quot;blockvmenuhelp&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <span class="keywordflow">if</span> ($doliurl) {</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        print <span class="stringliteral">&#39;&lt;a class=&quot;help&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;&#39;</span>.$doliurl.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        print <span class="stringliteral">&#39;&lt;span class=&quot;help&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      }</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      print $appli;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <span class="keywordflow">if</span> ($doliurl) {</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        print <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        print <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      }</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    }</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160; </div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="comment">// Link to bugtrack</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_BUGTRACK_ENABLELINK)) {</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/functions2.lib.php&#39;</span>;</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160; </div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <span class="keywordflow">if</span> ($conf-&gt;global-&gt;MAIN_BUGTRACK_ENABLELINK == <span class="stringliteral">&#39;github&#39;</span>) {</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        $bugbaseurl = <span class="stringliteral">&#39;https://github.com/Dolibarr/dolibarr/issues/new?labels=Bug&#39;</span>;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        $bugbaseurl .= <span class="stringliteral">&#39;&amp;title=&#39;</span>;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;Bug: &quot;</span>);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;        $bugbaseurl .= <span class="stringliteral">&#39;&amp;body=&#39;</span>;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;# Instructions\n&quot;</span>);</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;*This is a template to help you report good issues. You may use [Github Markdown](https://help.github.com/articles/getting-started-with-writing-and-formatting-on-github/) syntax to format your issue report.*\n&quot;</span>);</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;*Please:*\n&quot;</span>);</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- *replace the bracket enclosed texts with meaningful information*\n&quot;</span>);</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- *remove any unused sub-section*\n&quot;</span>);</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;# Bug\n&quot;</span>);</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;[*Short description*]\n&quot;</span>);</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;## Environment\n&quot;</span>);</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **Version**: &quot;</span>.DOL_VERSION.<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **OS**: &quot;</span>.php_uname(<span class="charliteral">&#39;s&#39;</span>).<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **Web server**: &quot;</span>.$_SERVER[<span class="stringliteral">&quot;SERVER_SOFTWARE&quot;</span>].<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **PHP**: &quot;</span>.php_sapi_name().<span class="charliteral">&#39; &#39;</span>.phpversion().<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **Database**: &quot;</span>.$db::LABEL.<span class="charliteral">&#39; &#39;</span>.$db-&gt;getVersion().<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;- **URL(s)**: &quot;</span>.$_SERVER[<span class="stringliteral">&quot;REQUEST_URI&quot;</span>].<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;## Expected and actual behavior\n&quot;</span>);</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;[*Verbose description*]\n&quot;</span>);</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;## Steps to reproduce the behavior\n&quot;</span>);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;[*Verbose description*]\n&quot;</span>);</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;## [Attached files](https://help.github.com/articles/issue-attachments) (Screenshots, screencasts, dolibarr.log, debugging informations…)\n&quot;</span>);</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;[*Files*]\n&quot;</span>);</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160; </div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        $bugbaseurl .= urlencode(<span class="stringliteral">&quot;## Report\n&quot;</span>);</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      } elseif (!empty($conf-&gt;global-&gt;MAIN_BUGTRACK_ENABLELINK)) {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        $bugbaseurl = $conf-&gt;global-&gt;MAIN_BUGTRACK_ENABLELINK;</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        $bugbaseurl = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      }</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160; </div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="comment">// Execute hook printBugtrackInfo</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      $parameters = array(<span class="stringliteral">&#39;bugbaseurl&#39;</span> =&gt; $bugbaseurl);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printBugtrackInfo&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      <span class="keywordflow">if</span> (empty($reshook)) {</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        $bugbaseurl .= $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        $bugbaseurl = $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;      }</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160; </div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      print <span class="stringliteral">&#39;&lt;div id=&quot;blockvmenuhelpbugreport&quot; class=&quot;blockvmenuhelp&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      print <span class="stringliteral">&#39;&lt;a class=&quot;help&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;&#39;</span>.$bugbaseurl.<span class="stringliteral">&#39;&quot;&gt;&lt;i class=&quot;fas fa-bug&quot;&gt;&lt;/i&gt; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;FindBug&quot;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;      print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    }</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160; </div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    print <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    print <span class="stringliteral">&quot;&lt;!-- End Help Block--&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160; </div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    print <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    print <span class="stringliteral">&quot;&lt;!-- End left menu --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160; </div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="comment">// Execute hook printLeftBlock</span></div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printLeftBlock&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    print $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160; </div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt;&lt;/div&gt; &lt;!-- End side-nav id-left --&gt;&#39;</span>; <span class="comment">// End div id=&quot;side-nav&quot; div id=&quot;id-left&quot;</span></div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;  }</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160; </div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;  print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;  print <span class="stringliteral">&#39;&lt;!-- Begin right area --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160; </div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;  <span class="keywordflow">if</span> (empty($leftmenuwithoutmainarea)) {</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    <a class="code" href="../../d0/db1/main_8inc_8php.html#a71f645436a1f28ec966676ef50f4eaf0">main_area</a>($title);</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  }</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;}</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160; </div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160; </div>
<div class="line"><a name="l03080"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#a71f645436a1f28ec966676ef50f4eaf0"> 3080</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#a71f645436a1f28ec966676ef50f4eaf0">main_area</a>($title = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;{</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;  global $conf, $langs, $hookmanager;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160; </div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; !<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_openinpopup&#39;</span>)) {</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    print <span class="stringliteral">&#39;&lt;div id=&quot;id-right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  }</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160; </div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160; </div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;  print <span class="stringliteral">&#39;&lt;!-- Begin div class=&quot;fiche&quot; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;div class=&quot;fiche&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160; </div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  $hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;main&#39;</span>));</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;  $parameters = array();</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printMainArea&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  print $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160; </div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED)) {</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    print <a class="code" href="../../d9/d69/functions_8lib_8php.html#aa2fc665c6971f95b44699676cf160975">info_admin</a>($langs-&gt;trans(<span class="stringliteral">&quot;WarningYouAreInMaintenanceMode&quot;</span>, $conf-&gt;global-&gt;MAIN_ONLY_LOGIN_ALLOWED), 0, 0, 1, <span class="stringliteral">&#39;warning maintenancemode&#39;</span>);</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;  }</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160; </div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;  <span class="comment">// Permit to add user company information on each printed document by setting SHOW_SOCINFO_ON_PRINT</span></div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;SHOW_SOCINFO_ON_PRINT) &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;optioncss&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>) == <span class="stringliteral">&#39;print&#39;</span> &amp;&amp; empty(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;disable_show_socinfo_on_print&#39;</span>, <span class="stringliteral">&#39;az09&#39;</span>))) {</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;showSocinfoOnPrint&#39;</span>, $parameters);</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="keywordflow">if</span> (empty($reshook)) {</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- Begin show mysoc info header --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      print <span class="stringliteral">&#39;&lt;div id=&quot;mysoc-info-header&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      print <span class="stringliteral">&#39;&lt;table class=&quot;centpercent div-table-responsive&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      print <span class="stringliteral">&#39;&lt;tbody&gt;&#39;</span>;</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td rowspan=&quot;0&quot; class=&quot;width20p&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      <span class="keywordflow">if</span> ($conf-&gt;global-&gt;MAIN_SHOW_LOGO &amp;&amp; empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER) &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_LOGO)) {</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        print <span class="stringliteral">&#39;&lt;img id=&quot;mysoc-info-header-logo&quot; style=&quot;max-width:100%&quot; alt=&quot;&quot; src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/viewimage.php?cache=1&amp;modulepart=mycompany&amp;file=&#39;</span>.urlencode(<span class="stringliteral">&#39;logos/&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_LOGO)).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;      }</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      print <span class="stringliteral">&#39;&lt;/td&gt;&lt;td  rowspan=&quot;0&quot; class=&quot;width50p&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td class=&quot;titre bold&quot;&gt;&#39;</span>.dol_escape_htmltag($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_NOM).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;      print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;&#39;</span>.dol_escape_htmltag($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_ADDRESS).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_ZIP).<span class="charliteral">&#39; &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_TOWN).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_TEL)) {</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td style=&quot;padding-left: 1em&quot; class=&quot;small&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Phone&quot;</span>).<span class="stringliteral">&#39; : &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_TEL).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      }</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_MAIL)) {</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td style=&quot;padding-left: 1em&quot; class=&quot;small&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Email&quot;</span>).<span class="stringliteral">&#39; : &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_MAIL).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      }</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_WEB)) {</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td style=&quot;padding-left: 1em&quot; class=&quot;small&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Web&quot;</span>).<span class="stringliteral">&#39; : &#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($conf-&gt;global-&gt;MAIN_INFO_SOCIETE_WEB).<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      }</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      print <span class="stringliteral">&#39;&lt;/tbody&gt;&#39;</span>;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      print <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- End show mysoc info header --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    }</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;  }</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;}</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160; </div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160; </div>
<div class="line"><a name="l03142"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#ab4ac000e297a48e208e78c2af6ff262b"> 3142</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#ab4ac000e297a48e208e78c2af6ff262b">getHelpParamFor</a>($helppagename, $langs)</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;{</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;  $helpbaseurl = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;  $helppage = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  $mode = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160; </div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^http/i&#39;</span>, $helppagename)) {</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="comment">// If complete URL</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    $helpbaseurl = <span class="stringliteral">&#39;%s&#39;</span>;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    $helppage = $helppagename;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    $mode = <span class="stringliteral">&#39;local&#39;</span>;</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="comment">// If WIKI URL</span></div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    $reg = array();</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^es/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;      $helpbaseurl = <span class="stringliteral">&#39;http://wiki.dolibarr.org/index.php/%s&#39;</span>;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/ES:([^|]+)/i&#39;</span>, $helppagename, $reg)) {</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;        $helppage = $reg[1];</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;      }</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    }</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^fr/i&#39;</span>, $langs-&gt;defaultlang)) {</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      $helpbaseurl = <span class="stringliteral">&#39;http://wiki.dolibarr.org/index.php/%s&#39;</span>;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/FR:([^|]+)/i&#39;</span>, $helppagename, $reg)) {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;        $helppage = $reg[1];</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      }</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    }</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    <span class="keywordflow">if</span> (empty($helppage)) { <span class="comment">// If help page not already found</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;      $helpbaseurl = <span class="stringliteral">&#39;http://wiki.dolibarr.org/index.php/%s&#39;</span>;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/EN:([^|]+)/i&#39;</span>, $helppagename, $reg)) {</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        $helppage = $reg[1];</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      }</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    }</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    $mode = <span class="stringliteral">&#39;wiki&#39;</span>;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  }</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;  <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;helpbaseurl&#39;</span>=&gt;$helpbaseurl, <span class="stringliteral">&#39;helppage&#39;</span>=&gt;$helppage, <span class="stringliteral">&#39;mode&#39;</span>=&gt;$mode);</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;}</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160; </div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160; </div>
<div class="line"><a name="l03196"></a><span class="lineno"><a class="line" href="../../d0/db1/main_8inc_8php.html#ad079f3096679e29ab84867c7babc8af0"> 3196</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d0/db1/main_8inc_8php.html#ad079f3096679e29ab84867c7babc8af0">printSearchForm</a>($urlaction, $urlobject, $title, $htmlmorecss, $htmlinputname, $accesskey = <span class="stringliteral">&#39;&#39;</span>, $prefhtmlinputname = <span class="stringliteral">&#39;&#39;</span>, $img = <span class="stringliteral">&#39;&#39;</span>, $showtitlebefore = 0, $autofocus = 0)</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;{</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;  global $conf, $langs, $user;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160; </div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;  $ret = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;form action=&quot;&#39;</span>.$urlaction.<span class="stringliteral">&#39;&quot; method=&quot;post&quot; class=&quot;searchform nowraponall tagtr&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;mode&quot; value=&quot;search&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;savelogin&quot; value=&quot;&#39;</span>.dol_escape_htmltag($user-&gt;login).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;  <span class="keywordflow">if</span> ($showtitlebefore) {</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;tagtd left&quot;&gt;&#39;</span>.$title.<span class="stringliteral">&#39;&lt;/div&gt; &#39;</span>;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;  }</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;tagtd&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;  $ret .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>(<span class="stringliteral">&#39;&#39;</span>, $img, <span class="stringliteral">&#39;&#39;</span>, <span class="keyword">false</span>, 0, 0, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;paddingright width20&#39;</span>);</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;text&quot; class=&quot;flat &#39;</span>.$htmlmorecss.<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  $ret .= <span class="stringliteral">&#39; style=&quot;background-repeat: no-repeat; background-position: 3px;&quot;&#39;</span>;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;  $ret .= ($accesskey ? <span class="stringliteral">&#39; accesskey=&quot;&#39;</span>.$accesskey.<span class="charliteral">&#39;&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;  $ret .= <span class="stringliteral">&#39; placeholder=&quot;&#39;</span>.strip_tags($title).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;  $ret .= ($autofocus ? <span class="stringliteral">&#39; autofocus&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;  $ret .= <span class="stringliteral">&#39; name=&quot;&#39;</span>.$htmlinputname.<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.$prefhtmlinputname.$htmlinputname.<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;button type=&quot;submit&quot; class=&quot;button bordertransp&quot; style=&quot;padding-top: 4px; padding-bottom: 4px; padding-left: 6px; padding-right: 6px&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;span class=&quot;fa fa-search&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;/button&gt;&#39;</span>;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;  $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;  $ret .= <span class="stringliteral">&quot;&lt;/form&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;  <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;}</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160; </div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160; </div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&quot;llxFooter&quot;</span>)) {</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;  <span class="keyword">function</span> <a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#aebbb85b0adc465834787866f31885fc5">llxFooter</a>($comment = <span class="stringliteral">&#39;&#39;</span>, $zone = <span class="stringliteral">&#39;private&#39;</span>, $disabledoutputofmessages = 0)</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;  {</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    global $conf, $db, $langs, $user, $mysoc, $object, $hookmanager;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    global $delayedhtmlcontent;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    global $contextpage, $page, $limit, $mode;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    global $dolibarr_distrib;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160; </div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    $ext = <span class="stringliteral">&#39;layout=&#39;</span>.urlencode($conf-&gt;browser-&gt;layout).<span class="stringliteral">&#39;&amp;version=&#39;</span>.urlencode(DOL_VERSION);</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160; </div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <span class="comment">// Hook to add more things on all pages within fiche DIV</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    $llxfooter = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    $parameters = array();</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;llxFooter&#39;</span>, $parameters, $object, $action); <span class="comment">// Note that $action and $object may have been modified by hook</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="keywordflow">if</span> (empty($reshook)) {</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      $llxfooter .= $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    } elseif ($reshook &gt; 0) {</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      $llxfooter = $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    }</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    <span class="keywordflow">if</span> ($llxfooter) {</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;      print $llxfooter;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    }</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160; </div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <span class="comment">// Global html output events ($mesgs, $errors, $warnings)</span></div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a8997facea953d4f9343a05b63fe6fe97">dol_htmloutput_events</a>($disabledoutputofmessages);</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160; </div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="comment">// Code for search criteria persistence.</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    <span class="comment">// $user-&gt;lastsearch_values was set by the GETPOST when form field search_xxx exists</span></div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    <span class="keywordflow">if</span> (is_object($user) &amp;&amp; !empty($user-&gt;lastsearch_values_tmp) &amp;&amp; is_array($user-&gt;lastsearch_values_tmp)) {</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      <span class="comment">// Clean and save data</span></div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <span class="keywordflow">foreach</span> ($user-&gt;lastsearch_values_tmp as $key =&gt; $val) {</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        unset($_SESSION[<span class="stringliteral">&#39;lastsearch_values_tmp_&#39;</span>.$key]); <span class="comment">// Clean array to rebuild it just after</span></div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;        <span class="keywordflow">if</span> (count($val) &amp;&amp; empty($_POST[<span class="stringliteral">&#39;button_removefilter&#39;</span>]) &amp;&amp; empty($_POST[<span class="stringliteral">&#39;button_removefilter_x&#39;</span>])) {</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;          <span class="keywordflow">if</span> (empty($val[<span class="stringliteral">&#39;sortfield&#39;</span>])) {</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;            unset($val[<span class="stringliteral">&#39;sortfield&#39;</span>]);</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;          }</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;          <span class="keywordflow">if</span> (empty($val[<span class="stringliteral">&#39;sortorder&#39;</span>])) {</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;            unset($val[<span class="stringliteral">&#39;sortorder&#39;</span>]);</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;          }</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;          <a class="code" href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a>(<span class="stringliteral">&#39;Save lastsearch_values_tmp_&#39;</span>.$key.<span class="charliteral">&#39;=&#39;</span>.json_encode($val, 0).<span class="stringliteral">&quot; (systematic recording of last search criterias)&quot;</span>);</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;          $_SESSION[<span class="stringliteral">&#39;lastsearch_values_tmp_&#39;</span>.$key] = json_encode($val);</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;          unset($_SESSION[<span class="stringliteral">&#39;lastsearch_values_&#39;</span>.$key]);</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;        }</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      }</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    }</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160; </div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160; </div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    $relativepathstring = $_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>];</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="comment">// Clean $relativepathstring</span></div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <span class="keywordflow">if</span> (constant(<span class="stringliteral">&#39;DOL_URL_ROOT&#39;</span>)) {</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^&#39;</span>.preg_quote(constant(<span class="stringliteral">&#39;DOL_URL_ROOT&#39;</span>), <span class="charliteral">&#39;/&#39;</span>).<span class="charliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    }</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^\//&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    $relativepathstring = preg_replace(<span class="stringliteral">&#39;/^custom\//&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $relativepathstring);</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/list\.php$/&#39;</span>, $relativepathstring)) {</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_mode_tmp_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160; </div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;      <span class="keywordflow">if</span> (!empty($contextpage)) {</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;        $_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_tmp_&#39;</span>.$relativepathstring] = $contextpage;</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      }</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;      <span class="keywordflow">if</span> (!empty($page) &amp;&amp; $page &gt; 0) {</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        $_SESSION[<span class="stringliteral">&#39;lastsearch_page_tmp_&#39;</span>.$relativepathstring] = $page;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;      }</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      <span class="keywordflow">if</span> (!empty($limit) &amp;&amp; $limit != $conf-&gt;liste_limit) {</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        $_SESSION[<span class="stringliteral">&#39;lastsearch_limit_tmp_&#39;</span>.$relativepathstring] = $limit;</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;      }</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;      <span class="keywordflow">if</span> (!empty($mode)) {</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        $_SESSION[<span class="stringliteral">&#39;lastsearch_mode_tmp_&#39;</span>.$relativepathstring] = $mode;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;      }</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160; </div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_contextpage_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_page_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_limit_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      unset($_SESSION[<span class="stringliteral">&#39;lastsearch_mode_&#39;</span>.$relativepathstring]);</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    }</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160; </div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    <span class="comment">// Core error message</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_CORE_ERROR)) {</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      <span class="comment">// Ajax version</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      <span class="keywordflow">if</span> ($conf-&gt;use_javascript_ajax) {</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        $title = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a1b743ba3487d5ca14c5f0a86a07edc71">img_warning</a>().<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;CoreErrorTitle&#39;</span>);</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        print <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a502d0500db4087157edfa026606fbadd">ajax_dialog</a>($title, $langs-&gt;trans(<span class="stringliteral">&#39;CoreErrorMessage&#39;</span>));</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;        <span class="comment">// html version</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;        $msg = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a1b743ba3487d5ca14c5f0a86a07edc71">img_warning</a>().<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;CoreErrorMessage&#39;</span>);</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;        print <span class="stringliteral">&#39;&lt;div class=&quot;error&quot;&gt;&#39;</span>.$msg.<span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      }</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160; </div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;      <span class="comment">//define(&quot;MAIN_CORE_ERROR&quot;,0);      // Constant was defined and we can&#39;t change value of a constant</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    }</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160; </div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    print <span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160; </div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    print <span class="stringliteral">&#39;&lt;/div&gt; &lt;!-- End div class=&quot;fiche&quot; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// End div fiche</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160; </div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; !<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;dol_openinpopup&#39;</span>)) {</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;      print <span class="stringliteral">&#39;&lt;/div&gt; &lt;!-- End div id-right --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// End div id-right</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160; </div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;dol_hide_leftmenu) &amp;&amp; empty($conf-&gt;dol_use_jmobile)) {</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      print <span class="stringliteral">&#39;&lt;/div&gt; &lt;!-- End div id-container --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// End div container</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    }</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160; </div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    print <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    <span class="keywordflow">if</span> ($comment) {</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      print <span class="stringliteral">&#39;&lt;!-- &#39;</span>.$comment.<span class="stringliteral">&#39; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    }</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160; </div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4af3860985b5b02078fa3a534d35998d">printCommonFooter</a>($zone);</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160; </div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    <span class="keywordflow">if</span> (!empty($delayedhtmlcontent)) {</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;      print $delayedhtmlcontent;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    }</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160; </div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;use_javascript_ajax)) {</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      print <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;!-- Includes JS Footer of Dolibarr --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      print <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/js/lib_foot.js.php?lang=&#39;</span>.$langs-&gt;defaultlang.($ext ? <span class="charliteral">&#39;&amp;&#39;</span>.$ext : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;    }</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160; </div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    <span class="comment">// Wrapper to add log when clicking on download or preview</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;blockedlog&#39;</span>) &amp;&amp; is_object($object) &amp;&amp; !empty($object-&gt;id) &amp;&amp; $object-&gt;id &gt; 0 &amp;&amp; $object-&gt;statut &gt; 0) {</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;      <span class="keywordflow">if</span> (in_array($object-&gt;element, array(<span class="stringliteral">&#39;facture&#39;</span>))) {       <span class="comment">// Restrict for the moment to element &#39;facture&#39;</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        print <span class="stringliteral">&quot;\n&lt;!-- JS CODE TO ENABLE log when making a download or a preview of a document --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        ?&gt;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        &lt;script&gt;</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        jQuery(document).ready(<span class="keyword">function</span> () {</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;          $(<span class="stringliteral">&#39;a.documentpreview&#39;</span>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            $.post(<span class="stringliteral">&#39;&lt;?php echo DOL_URL_ROOT.&quot;/blockedlog/ajax/block-add.php&quot; ?&gt;&#39;</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                , {</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                  id:&lt;?php echo $object-&gt;id; ?&gt;</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                  , element:<span class="stringliteral">&#39;&lt;?php echo $object-&gt;element ?&gt;&#39;</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                  , action:<span class="stringliteral">&#39;DOC_PREVIEW&#39;</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;                  , token: <span class="stringliteral">&#39;&lt;?php echo currentToken(); ?&gt;&#39;</span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;                }</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;            );</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;          });</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          $(<span class="stringliteral">&#39;a.documentdownload&#39;</span>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            $.post(<span class="stringliteral">&#39;&lt;?php echo DOL_URL_ROOT.&quot;/blockedlog/ajax/block-add.php&quot; ?&gt;&#39;</span></div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                , {</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                  id:&lt;?php echo $object-&gt;id; ?&gt;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                  , element:<span class="stringliteral">&#39;&lt;?php echo $object-&gt;element ?&gt;&#39;</span></div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;                  , action:<span class="stringliteral">&#39;DOC_DOWNLOAD&#39;</span></div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                  , token: <span class="stringliteral">&#39;&lt;?php echo currentToken(); ?&gt;&#39;</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;                }</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            );</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;          });</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        });</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        &lt;/script&gt;</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        &lt;?php</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;      }</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    }</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160; </div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="comment">// A div for the address popup</span></div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    print <span class="stringliteral">&quot;\n&lt;!-- A div to allow dialog popup by jQuery(&#39;#dialogforpopup&#39;).dialog() --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    print <span class="stringliteral">&#39;&lt;div id=&quot;dialogforpopup&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160; </div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    <span class="comment">// Add code for the asynchronous anonymous first ping (for telemetry)</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    <span class="comment">// You can use &amp;forceping=1 in parameters to force the ping if the ping was already sent.</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    $forceping = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;forceping&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <span class="keywordflow">if</span> (($_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>] == DOL_URL_ROOT.<span class="stringliteral">&#39;/index.php&#39;</span>) || $forceping) {</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="comment">//print &#39;&lt;!-- instance_unique_id=&#39;.$conf-&gt;file-&gt;instance_unique_id.&#39; MAIN_FIRST_PING_OK_ID=&#39;.$conf-&gt;global-&gt;MAIN_FIRST_PING_OK_ID.&#39; --&gt;&#39;;</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      $hash_unique_id = md5(<span class="stringliteral">&#39;dolibarr&#39;</span>.$conf-&gt;file-&gt;instance_unique_id);  <span class="comment">// Do not use dol_hash(), must not change if salt changes.</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160; </div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_FIRST_PING_OK_DATE)</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        || (!empty($conf-&gt;file-&gt;instance_unique_id) &amp;&amp; ($hash_unique_id != $conf-&gt;global-&gt;MAIN_FIRST_PING_OK_ID) &amp;&amp; ($conf-&gt;global-&gt;MAIN_FIRST_PING_OK_ID != <span class="stringliteral">&#39;disabled&#39;</span>))</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      || $forceping) {</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        <span class="comment">// No ping done if we are into an alpha version</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">if</span> (strpos(<span class="stringliteral">&#39;alpha&#39;</span>, DOL_VERSION) &gt; 0 &amp;&amp; !$forceping) {</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;          print <span class="stringliteral">&quot;\n&lt;!-- NO JS CODE TO ENABLE the anonymous Ping. It is an alpha version --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;        } elseif (empty($_COOKIE[<span class="stringliteral">&#39;DOLINSTALLNOPING_&#39;</span>.$hash_unique_id]) || $forceping) { <span class="comment">// Cookie is set when we uncheck the checkbox in the installation wizard.</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;          <span class="comment">// MAIN_LAST_PING_KO_DATE</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;          <span class="comment">// Disable ping if MAIN_LAST_PING_KO_DATE is set and is recent (this month)</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;          <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_LAST_PING_KO_DATE) &amp;&amp; substr($conf-&gt;global-&gt;MAIN_LAST_PING_KO_DATE, 0, 6) == <a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a>(), <span class="stringliteral">&#39;%Y%m&#39;</span>) &amp;&amp; !$forceping) {</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;            print <span class="stringliteral">&quot;\n&lt;!-- NO JS CODE TO ENABLE the anonymous Ping. An error already occured this month, we will try later. --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;            include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/functions2.lib.php&#39;</span>;</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160; </div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;            print <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;!-- Includes JS for Ping of Dolibarr forceping=&#39;</span>.$forceping.<span class="stringliteral">&#39; MAIN_FIRST_PING_OK_DATE=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_FIRST_PING_OK_DATE&quot;</span>).<span class="stringliteral">&#39; MAIN_FIRST_PING_OK_ID=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_FIRST_PING_OK_ID&quot;</span>).<span class="stringliteral">&#39; MAIN_LAST_PING_KO_DATE=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a>(<span class="stringliteral">&quot;MAIN_LAST_PING_KO_DATE&quot;</span>).<span class="stringliteral">&#39; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;            print <span class="stringliteral">&quot;\n&lt;!-- JS CODE TO ENABLE the anonymous Ping --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            $url_for_ping = (empty($conf-&gt;global-&gt;MAIN_URL_FOR_PING) ? <span class="stringliteral">&quot;https://ping.dolibarr.org/&quot;</span> : $conf-&gt;global-&gt;MAIN_URL_FOR_PING);</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;            <span class="comment">// Try to guess the distrib used</span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;            $distrib = <span class="stringliteral">&#39;standard&#39;</span>;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;            <span class="keywordflow">if</span> ($_SERVER[<span class="stringliteral">&quot;SERVER_ADMIN&quot;</span>] == <span class="stringliteral">&#39;doliwamp@localhost&#39;</span>) {</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;              $distrib = <span class="stringliteral">&#39;doliwamp&#39;</span>;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;            }</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;            <span class="keywordflow">if</span> (!empty($dolibarr_distrib)) {</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;              $distrib = $dolibarr_distrib;</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;            }</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;            ?&gt;</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;              &lt;script&gt;</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;              jQuery(document).ready(<span class="keyword">function</span> (tmp) {</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                console.log(<span class="stringliteral">&quot;Try Ping with hash_unique_id is md5(&#39;dolibarr&#39;+instance_unique_id)&quot;</span>);</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;                $.ajax({</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;                    method: <span class="stringliteral">&quot;POST&quot;</span>,</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                    url: <span class="stringliteral">&quot;&lt;?php echo $url_for_ping ?&gt;&quot;</span>,</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;                    timeout: 500,     <span class="comment">// timeout milliseconds</span></div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                    cache: <span class="keyword">false</span>,</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                    data: {</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;                      hash_algo: <span class="stringliteral">&#39;md5&#39;</span>,</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                      hash_unique_id: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js($hash_unique_id); ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                      action: <span class="stringliteral">&#39;dolibarrping&#39;</span>,</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;                      version: <span class="stringliteral">&#39;&lt;?php echo (float) DOL_VERSION; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;                      entity: <span class="stringliteral">&#39;&lt;?php echo (int) $conf-&gt;entity; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;                      dbtype: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js($db-&gt;type); ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;                      country_code: <span class="stringliteral">&#39;&lt;?php echo $mysoc-&gt;country_code ? dol_escape_js($mysoc-&gt;country_code) : &#39;</span>unknown<span class="stringliteral">&#39;; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                      php_version: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js(phpversion()); ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                      os_version: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js(version_os(&#39;</span>smr<span class="stringliteral">&#39;)); ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;                      distrib: <span class="stringliteral">&#39;&lt;?php echo $distrib ? dol_escape_js($distrib) : &#39;</span>unknown<span class="stringliteral">&#39;; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                      token: <span class="stringliteral">&#39;notrequired&#39;</span></div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                    },</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;                    success: <span class="keyword">function</span> (data, status, xhr) {   <span class="comment">// success callback function (data contains body of response)</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                      console.log(<span class="stringliteral">&quot;Ping ok&quot;</span>);</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                      $.ajax({</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;                        method: <span class="stringliteral">&#39;GET&#39;</span>,</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                        url: <span class="stringliteral">&#39;&lt;?php echo DOL_URL_ROOT.&#39;</span>/core/ajax/pingresult.php<span class="stringliteral">&#39;; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                        timeout: 500,     <span class="comment">// timeout milliseconds</span></div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;                        cache: <span class="keyword">false</span>,</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                        data: { hash_algo: <span class="stringliteral">&#39;md5&#39;</span>, hash_unique_id: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js($hash_unique_id); ?&gt;&#39;</span>, action: <span class="stringliteral">&#39;firstpingok&#39;</span>, token: <span class="stringliteral">&#39;&lt;?php echo currentToken(); ?&gt;&#39;</span> }, <span class="comment">// for update</span></div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                        });</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                    },</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                    error: <span class="keyword">function</span> (data,status,xhr) {   <span class="comment">// error callback function</span></div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;                      console.log(<span class="stringliteral">&quot;Ping ko: &quot;</span> + data);</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;                      $.ajax({</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;                          method: <span class="stringliteral">&#39;GET&#39;</span>,</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                          url: <span class="stringliteral">&#39;&lt;?php echo DOL_URL_ROOT.&#39;</span>/core/ajax/pingresult.php<span class="stringliteral">&#39;; ?&gt;&#39;</span>,</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                          timeout: 500,     <span class="comment">// timeout milliseconds</span></div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                          cache: <span class="keyword">false</span>,</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                          data: { hash_algo: <span class="stringliteral">&#39;md5&#39;</span>, hash_unique_id: <span class="stringliteral">&#39;&lt;?php echo dol_escape_js($hash_unique_id); ?&gt;&#39;</span>, action: <span class="stringliteral">&#39;firstpingko&#39;</span>, token: <span class="stringliteral">&#39;&lt;?php echo currentToken(); ?&gt;&#39;</span> },</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;                        });</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                    }</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                });</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;              });</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;              &lt;/script&gt;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            &lt;?php</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;          }</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;          $now = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a>();</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;          print <span class="stringliteral">&quot;\n&lt;!-- NO JS CODE TO ENABLE the anonymous Ping. It was disabled --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;          include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/admin.lib.php&#39;</span>;</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;          <a class="code" href="../../da/d0f/admin_8lib_8php.html#a2672fdb5a58c6d4ebe00ba25c9ca9ce9">dolibarr_set_const</a>($db, <span class="stringliteral">&#39;MAIN_FIRST_PING_OK_DATE&#39;</span>, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a>($now, <span class="stringliteral">&#39;dayhourlog&#39;</span>, <span class="stringliteral">&#39;gmt&#39;</span>), <span class="stringliteral">&#39;chaine&#39;</span>, 0, <span class="stringliteral">&#39;&#39;</span>, $conf-&gt;entity);</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;          <a class="code" href="../../da/d0f/admin_8lib_8php.html#a2672fdb5a58c6d4ebe00ba25c9ca9ce9">dolibarr_set_const</a>($db, <span class="stringliteral">&#39;MAIN_FIRST_PING_OK_ID&#39;</span>, <span class="stringliteral">&#39;disabled&#39;</span>, <span class="stringliteral">&#39;chaine&#39;</span>, 0, <span class="stringliteral">&#39;&#39;</span>, $conf-&gt;entity);</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;        }</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      }</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    }</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160; </div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;    $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;beforeBodyClose&#39;</span>); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="keywordflow">if</span> ($reshook &gt; 0) {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      print $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;    }</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160; </div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    print <span class="stringliteral">&quot;&lt;/body&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    print <span class="stringliteral">&quot;&lt;/html&gt;\n&quot;</span>;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;  }</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;}</div>
<div class="ttc" id="aadmin_2agenda_8php_html_a67afbd53799be648b2ae99e2ebf48210"><div class="ttname"><a href="../../dc/d03/admin_2agenda_8php.html#a67afbd53799be648b2ae99e2ebf48210">$help_url</a></div><div class="ttdeci">if(GETPOST('button_removefilter_x', 'alpha')||GETPOST('button_removefilter.x', 'alpha')||GETPOST('button_removefilter', 'alpha')) if(GETPOST('button_search_x', 'alpha')||GETPOST('button_search.x', 'alpha')||GETPOST('button_search', 'alpha')) if($action==&quot;save&quot; &amp;&amp;empty($cancel)) $help_url</div><div class="ttdoc">View.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d03/admin_2agenda_8php_source.html#l00118">agenda.php:118</a></div></div>
<div class="ttc" id="aadmin_8lib_8php_html_a2672fdb5a58c6d4ebe00ba25c9ca9ce9"><div class="ttname"><a href="../../da/d0f/admin_8lib_8php.html#a2672fdb5a58c6d4ebe00ba25c9ca9ce9">dolibarr_set_const</a></div><div class="ttdeci">dolibarr_set_const($db, $name, $value, $type='chaine', $visible=0, $note='', $entity=1)</div><div class="ttdoc">Insert a parameter (key,value) into database (delete old key then insert it again).</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0f/admin_8lib_8php_source.html#l00632">admin.lib.php:632</a></div></div>
<div class="ttc" id="aadmin_8lib_8php_html_a8040bdcb4bd2bd4da08017934341dad7"><div class="ttname"><a href="../../da/d0f/admin_8lib_8php.html#a8040bdcb4bd2bd4da08017934341dad7">versioncompare</a></div><div class="ttdeci">versioncompare($versionarray1, $versionarray2)</div><div class="ttdoc">Compare 2 versions (stored into 2 arrays).</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0f/admin_8lib_8php_source.html#l00066">admin.lib.php:66</a></div></div>
<div class="ttc" id="aajax_8lib_8php_html_a502d0500db4087157edfa026606fbadd"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a502d0500db4087157edfa026606fbadd">ajax_dialog</a></div><div class="ttdeci">ajax_dialog($title, $message, $w=350, $h=150)</div><div class="ttdoc">Show an ajax dialog.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00404">ajax.lib.php:404</a></div></div>
<div class="ttc" id="aasterisk_2wrapper_8php_html_a3e1c89b902a5beaa3d5476a09cd591ae"><div class="ttname"><a href="../../d6/d7c/asterisk_2wrapper_8php.html#a3e1c89b902a5beaa3d5476a09cd591ae">llxHeader</a></div><div class="ttdeci">if(!defined('NOREQUIRESOC')) if(!defined('NOREQUIRETRAN')) if(!defined('NOTOKENRENEWAL')) if(!defined('NOREQUIREMENU')) if(!defined('NOREQUIREHTML')) if(!defined('NOREQUIREAJAX')) llxHeader()</div><div class="ttdoc">Empty header.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/asterisk_2wrapper_8php_source.html#l00056">wrapper.php:56</a></div></div>
<div class="ttc" id="aasterisk_2wrapper_8php_html_aebbb85b0adc465834787866f31885fc5"><div class="ttname"><a href="../../d6/d7c/asterisk_2wrapper_8php.html#aebbb85b0adc465834787866f31885fc5">llxFooter</a></div><div class="ttdeci">llxFooter()</div><div class="ttdoc">Empty footer.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/asterisk_2wrapper_8php_source.html#l00070">wrapper.php:70</a></div></div>
<div class="ttc" id="abookmarks_8lib_8php_html_afd2d8d08c39bb548bb84ba603c6137a9"><div class="ttname"><a href="../../d8/d9e/bookmarks_8lib_8php.html#afd2d8d08c39bb548bb84ba603c6137a9">printDropdownBookmarksList</a></div><div class="ttdeci">printDropdownBookmarksList()</div><div class="ttdoc">Add area with bookmarks in top menu.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d9e/bookmarks_8lib_8php_source.html#l00030">bookmarks.lib.php:30</a></div></div>
<div class="ttc" id="aclass_dolibarr_debug_bar_html"><div class="ttname"><a href="../../dd/dda/class_dolibarr_debug_bar.html">DolibarrDebugBar</a></div><div class="ttdoc">DolibarrDebugBar class.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/debugbar_2class_2debugbar_8php_source.html#l00025">DebugBar.php:26</a></div></div>
<div class="ttc" id="aclass_form_html"><div class="ttname"><a href="../../df/d08/class_form.html">Form</a></div><div class="ttdoc">Class to manage generation of HTML components Only common components must be here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d05/html_8form_8class_8php_source.html#l00052">html.form.class.php:53</a></div></div>
<div class="ttc" id="aclass_form_html_a873221a472d9412f4873fc9f0db3df56"><div class="ttname"><a href="../../df/d08/class_form.html#a873221a472d9412f4873fc9f0db3df56">Form\showphoto</a></div><div class="ttdeci">static showphoto($modulepart, $object, $width=100, $height=0, $caneditfield=0, $cssclass='photowithmargin', $imagesize='', $addlinktofullsize=1, $cache=0, $forcecapture='', $noexternsourceoverwrite=0)</div><div class="ttdoc">Return HTML code to output a photo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d05/html_8form_8class_8php_source.html#l09445">html.form.class.php:9445</a></div></div>
<div class="ttc" id="aclass_hook_manager_html"><div class="ttname"><a href="../../d7/d8c/class_hook_manager.html">HookManager</a></div><div class="ttdoc">Class to manage hooks.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc6/hookmanager_8class_8php_source.html#l00030">hookmanager.class.php:31</a></div></div>
<div class="ttc" id="aclass_menu_manager_html"><div class="ttname"><a href="../../d9/db2/class_menu_manager.html">MenuManager</a></div><div class="ttdoc">Class to manage menu Auguria.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df9/auguria__menu_8php_source.html#l00029">auguria_menu.php:30</a></div></div>
<div class="ttc" id="aclass_societe_html"><div class="ttname"><a href="../../dc/dbc/class_societe.html">Societe</a></div><div class="ttdoc">Class to manage third parties objects (customers, suppliers, prospects...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d91/societe_8class_8php_source.html#l00049">societe.class.php:50</a></div></div>
<div class="ttc" id="aclass_translate_html"><div class="ttname"><a href="../../de/d47/class_translate.html">Translate</a></div><div class="ttdoc">Class to manage translations.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de9/translate_8class_8php_source.html#l00030">translate.class.php:31</a></div></div>
<div class="ttc" id="acompta_2localtax_2card_8php_html_aef74eb31fbb3b41977336246033f2c11"><div class="ttname"><a href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a></div><div class="ttdeci">if($cancel &amp;&amp;! $id) if($action=='add' &amp;&amp;! $cancel) if($action=='delete') if($id) $form</div><div class="ttdoc">Actions.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dda/compta_2localtax_2card_8php_source.html#l00143">card.php:143</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_ae0a2e540521a44e6a091e8f39c8cf4f5"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#ae0a2e540521a44e6a091e8f39c8cf4f5">dol_stringtotime</a></div><div class="ttdeci">dol_stringtotime($string, $gm=1)</div><div class="ttdoc">Convert a string date into a GM Timestamps date Warning: YYYY-MM-DDTHH:MM:SS+02:00 (RFC3339) is not s...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l00407">date.lib.php:407</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a15897ead0ed9fdab27a2ff8d595b1302"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a15897ead0ed9fdab27a2ff8d595b1302">picto_from_langcode</a></div><div class="ttdeci">picto_from_langcode($codelang, $moreatt='', $notitlealt=0)</div><div class="ttdoc">Return img flag of country for a language code or country code.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l09013">functions.lib.php:9013</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a1b743ba3487d5ca14c5f0a86a07edc71"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a1b743ba3487d5ca14c5f0a86a07edc71">img_warning</a></div><div class="ttdeci">img_warning($titlealt='default', $moreatt='', $morecss='pictowarning')</div><div class="ttdoc">Show warning logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04633">functions.lib.php:4633</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a2583c8c1e7ad5e59aad0f205c13ff2a0"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a></div><div class="ttdeci">dol_escape_htmltag($stringtoescape, $keepb=0, $keepn=0, $noescapetags='', $escapeonlyhtmltags=0)</div><div class="ttdoc">Returns text escaped for inclusion in HTML alt or title tags, or into values of HTML input fields.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01476">functions.lib.php:1476</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a270210083c4970c0fdc9a83d2f9622c2"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a270210083c4970c0fdc9a83d2f9622c2">yn</a></div><div class="ttdeci">yn($yesno, $case=1, $color=0)</div><div class="ttdoc">Return yes or no in current language.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l06638">functions.lib.php:6638</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a39a0441491a380f7f9fe07ee296cd2fa"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a></div><div class="ttdeci">dol_print_error($db='', $error='', $errors=null)</div><div class="ttdoc">Displays error message system with all the information to facilitate the diagnosis and the escalation...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04956">functions.lib.php:4956</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4236d55151f75d548565509df223da18"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4236d55151f75d548565509df223da18">isHTTPS</a></div><div class="ttdeci">isHTTPS()</div><div class="ttdoc">Return if we are using a HTTPS connexion Check HTTPS (no way to be modified by user but may be empty ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03623">functions.lib.php:3623</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4a25c44d5cda2ec236161511fadde188"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a></div><div class="ttdeci">setEventMessages($mesg, $mesgs, $style='mesgs', $messagekey='')</div><div class="ttdoc">Set event messages in dol_events session object.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l08411">functions.lib.php:8411</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4af3860985b5b02078fa3a534d35998d"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4af3860985b5b02078fa3a534d35998d">printCommonFooter</a></div><div class="ttdeci">printCommonFooter($zone='private')</div><div class="ttdoc">Print common footer : conf-&gt;global-&gt;MAIN_HTML_FOOTER js for switch of menu hider js for conf-&gt;global-...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l09446">functions.lib.php:9446</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a52dc9c15ed0565a4b8312dc7d7d41fcb"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a52dc9c15ed0565a4b8312dc7d7d41fcb">dol_print_date</a></div><div class="ttdeci">dol_print_date($time, $format='', $tzoutput='auto', $outputlangs='', $encodetooutput=false)</div><div class="ttdoc">Output date in a string format according to outputlangs (or langs if not defined).</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02535">functions.lib.php:2535</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a5b2b52738954b2638dc9aa54bf019bd6"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a5b2b52738954b2638dc9aa54bf019bd6">dol_include_once</a></div><div class="ttdeci">if(!function_exists('dol_getprefix')) dol_include_once($relpath, $classname='')</div><div class="ttdoc">Make an include_once using default root and alternate root if it fails.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01023">functions.lib.php:1023</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a5e66578bb4ca51676bad5d37e19e7e1a"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a></div><div class="ttdeci">dol_now($mode='auto')</div><div class="ttdoc">Return date for now.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02916">functions.lib.php:2916</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a640ecfcf021710aab29f85315721d059"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a640ecfcf021710aab29f85315721d059">getDolGlobalInt</a></div><div class="ttdeci">getDolGlobalInt($key, $default=0)</div><div class="ttdoc">Return dolibarr global constant int value.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00096">functions.lib.php:96</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a64fc44ee4f3329fe0ff256b57bffc128"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a></div><div class="ttdeci">img_picto($titlealt, $picto, $moreatt='', $pictoisfullpath=false, $srconly=0, $notitle=0, $alt='', $morecss='', $marginleftonlyshort=2)</div><div class="ttdoc">Show picto whatever it's its name (generic function)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03989">functions.lib.php:3989</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a6d79bb77d4de9606546ddfccacf358f9"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a></div><div class="ttdeci">newToken()</div><div class="ttdoc">Return the value of token currently saved into session with name 'newtoken'.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l11185">functions.lib.php:11185</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a7830e86f4eac6490caf8b5d04602412c"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a7830e86f4eac6490caf8b5d04602412c">dol_htmlentities</a></div><div class="ttdeci">dol_htmlentities($string, $flags=ENT_QUOTES|ENT_SUBSTITUTE, $encoding='UTF-8', $double_encode=false)</div><div class="ttdoc">Replace htmlentities functions.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l07322">functions.lib.php:7322</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a788d272d132db299258e4896ca5d2305"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a788d272d132db299258e4896ca5d2305">dol_print_profids</a></div><div class="ttdeci">dol_print_profids($profID, $profIDtype, $countrycode='', $addcpButton=1, $separ='&amp;nbsp;')</div><div class="ttdoc">Format profIDs according to country.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03220">functions.lib.php:3220</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a79ced81be2caf5eae76a9b550addd641"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a79ced81be2caf5eae76a9b550addd641">getBrowserInfo</a></div><div class="ttdeci">getBrowserInfo($user_agent)</div><div class="ttdoc">Return information about user browser.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00292">functions.lib.php:292</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a8997facea953d4f9343a05b63fe6fe97"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a8997facea953d4f9343a05b63fe6fe97">dol_htmloutput_events</a></div><div class="ttdeci">dol_htmloutput_events($disabledoutputofmessages=0)</div><div class="ttdoc">Print formated messages to output (Used to show messages on html output).</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l08446">functions.lib.php:8446</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a97dc8c4d4db97a060f48e220a1f9f293"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a></div><div class="ttdeci">GETPOST($paramname, $check='alphanohtml', $method=0, $filter=null, $options=null, $noreplace=0)</div><div class="ttdoc">Return value of a param into GET or POST supervariable.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00517">functions.lib.php:517</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aa2fc665c6971f95b44699676cf160975"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aa2fc665c6971f95b44699676cf160975">info_admin</a></div><div class="ttdeci">info_admin($text, $infoonimgalt=0, $nodiv=0, $admin='1', $morecss='hideonsmartphone', $textfordropdown='')</div><div class="ttdoc">Show information for admin users or standard users.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04912">functions.lib.php:4912</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aafe4c784fd2bce1f3ebf1a4cc5ef72a3"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aafe4c784fd2bce1f3ebf1a4cc5ef72a3">dol_buildpath</a></div><div class="ttdeci">dol_buildpath($path, $type=0, $returnemptyifnotfound=0)</div><div class="ttdoc">Return path of url or filesystem.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01052">functions.lib.php:1052</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ab5b9cf74b4c4f62ebbb5d304326612dc"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ab5b9cf74b4c4f62ebbb5d304326612dc">getDolGlobalString</a></div><div class="ttdeci">if(!function_exists('utf8_encode')) if(!function_exists('utf8_decode')) getDolGlobalString($key, $default='')</div><div class="ttdoc">Return dolibarr global constant string value.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00082">functions.lib.php:82</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ac863120bf29caa349dd610383aae275e"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ac863120bf29caa349dd610383aae275e">dol_trunc</a></div><div class="ttdeci">dol_trunc($string, $size=40, $trunc='right', $stringencoding='UTF-8', $nodot=0, $display=0)</div><div class="ttdoc">Truncate a string to a particular length adding '…' if string larger than length.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03914">functions.lib.php:3914</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aca64a844ce2ad30d4fc49cd4b957cbdf"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a></div><div class="ttdeci">GETPOSTISSET($paramname)</div><div class="ttdoc">Return true if we are in a context of submitting the parameter $paramname from a POST of a form.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00418">functions.lib.php:418</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ae54e3727f7a757bd40513f88c0c7da47"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a></div><div class="ttdeci">isModEnabled($module)</div><div class="ttdoc">Is Dolibarr module enabled.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00137">functions.lib.php:137</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_af601a73af63cca748b9a57e810259372"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#af601a73af63cca748b9a57e810259372">dol_syslog</a></div><div class="ttdeci">dol_syslog($message, $level=LOG_INFO, $ident=0, $suffixinfilename='', $restricttologhandler='', $logcontext=null)</div><div class="ttdoc">Write log message into outputs.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01611">functions.lib.php:1611</a></div></div>
<div class="ttc" id="ajournals__list_8php_html_a90b302d5a7120cd0d34478405407d439"><div class="ttname"><a href="../../d9/dc1/journals__list_8php.html#a90b302d5a7120cd0d34478405407d439">if</a></div><div class="ttdeci">if(!defined( 'CSRFCHECK_WITH_TOKEN'))</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc1/journals__list_8php_source.html#l00025">journals_list.php:25</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a10fa94a9a5f6491258b175619f29d5b5"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a10fa94a9a5f6491258b175619f29d5b5">left_menu</a></div><div class="ttdeci">left_menu($menu_array_before, $helppagename='', $notused='', $menu_array_after='', $leftmenuwithoutmainarea=0, $title='', $acceptdelayedhtml=0)</div><div class="ttdoc">Show left menu bar.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02859">main.inc.php:2859</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a1bed423acec10147bfe221cd6fe286aa"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a1bed423acec10147bfe221cd6fe286aa">top_httphead</a></div><div class="ttdeci">if(!defined('NOREQUIREMENU')) if(!function_exists(&quot;llxHeader&quot;)) top_httphead($contenttype='text/html', $forcenocache=0)</div><div class="ttdoc">Show HTTP header.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l01436">main.inc.php:1436</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a1d3a53ad764311e0ec6e7466ff660ec0"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a1d3a53ad764311e0ec6e7466ff660ec0">top_menu_quickadd</a></div><div class="ttdeci">top_menu_quickadd()</div><div class="ttdoc">Build the tooltip on top menu quick add.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02409">main.inc.php:2409</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a27abc17e8fd7160a3f44ddeaa1312aa4"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a27abc17e8fd7160a3f44ddeaa1312aa4">analyseVarsForSqlAndScriptsInjection</a></div><div class="ttdeci">analyseVarsForSqlAndScriptsInjection(&amp;$var, $type)</div><div class="ttdoc">Return true if security check on parameters are OK, false otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l00210">main.inc.php:210</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a4b00e754b077a74356ddbab8ca69f190"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a4b00e754b077a74356ddbab8ca69f190">top_menu_user</a></div><div class="ttdeci">top_menu_user($hideloginname=0, $urllogout='')</div><div class="ttdoc">Build the tooltip on user login.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02167">main.inc.php:2167</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a5e2e3d643df949095491e8438c80850e"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a5e2e3d643df949095491e8438c80850e">testSqlAndScriptInject</a></div><div class="ttdeci">testSqlAndScriptInject($val, $type)</div><div class="ttdoc">Security: WAF layer for SQL Injection and XSS Injection (scripts) protection (Filters on GET,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l00087">main.inc.php:87</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a5eaeb45db72451a231c73bfe51fa6f38"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a5eaeb45db72451a231c73bfe51fa6f38">realCharForNumericEntities</a></div><div class="ttdeci">if(!empty($_SERVER['MAIN_SHOW_TUNING_INFO'])) realCharForNumericEntities($matches)</div><div class="ttdoc">Return the real char for a numeric entities.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l00061">main.inc.php:61</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a71f645436a1f28ec966676ef50f4eaf0"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a71f645436a1f28ec966676ef50f4eaf0">main_area</a></div><div class="ttdeci">main_area($title='')</div><div class="ttdoc">Begin main area.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l03080">main.inc.php:3080</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_a7ca53bfd6df5afab29b5a6c468bdefde"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#a7ca53bfd6df5afab29b5a6c468bdefde">top_htmlhead</a></div><div class="ttdeci">top_htmlhead($head, $title='', $disablejs=0, $disablehead=0, $arrayofjs='', $arrayofcss='', $disableforlogin=0, $disablenofollow=0, $disablenoindex=0)</div><div class="ttdoc">Ouput html header of a page.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l01530">main.inc.php:1530</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_ab4ac000e297a48e208e78c2af6ff262b"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#ab4ac000e297a48e208e78c2af6ff262b">getHelpParamFor</a></div><div class="ttdeci">getHelpParamFor($helppagename, $langs)</div><div class="ttdoc">Return helpbaseurl, helppage and mode.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l03142">main.inc.php:3142</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_ac4f1c6ce25e9080a698fac2a61506493"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#ac4f1c6ce25e9080a698fac2a61506493">top_menu</a></div><div class="ttdeci">top_menu($head, $title='', $target='', $disablejs=0, $disablehead=0, $arrayofjs='', $arrayofcss='', $morequerystring='', $helppagename='')</div><div class="ttdoc">Show an HTML header + a BODY + The top menu bar.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l01932">main.inc.php:1932</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_ad079f3096679e29ab84867c7babc8af0"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#ad079f3096679e29ab84867c7babc8af0">printSearchForm</a></div><div class="ttdeci">printSearchForm($urlaction, $urlobject, $title, $htmlmorecss, $htmlinputname, $accesskey='', $prefhtmlinputname='', $img='', $showtitlebefore=0, $autofocus=0)</div><div class="ttdoc">Show a search area.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l03196">main.inc.php:3196</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_ad46a898e40cc046fa58e96efa1c1f359"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#ad46a898e40cc046fa58e96efa1c1f359">top_menu_search</a></div><div class="ttdeci">top_menu_search()</div><div class="ttdoc">Build the tooltip on top menu tsearch.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02710">main.inc.php:2710</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_adb5c76cae89d9bc43ced3d15a4f1fd58"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#adb5c76cae89d9bc43ced3d15a4f1fd58">printDropdownQuickadd</a></div><div class="ttdeci">printDropdownQuickadd()</div><div class="ttdoc">Generate list of quickadd items.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02458">main.inc.php:2458</a></div></div>
<div class="ttc" id="amain_8inc_8php_html_af6a6ade8f057ae2fc0d0b72f8e173b04"><div class="ttname"><a href="../../d0/db1/main_8inc_8php.html#af6a6ade8f057ae2fc0d0b72f8e173b04">top_menu_bookmark</a></div><div class="ttdeci">top_menu_bookmark()</div><div class="ttdoc">Build the tooltip on top menu bookmark.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db1/main_8inc_8php_source.html#l02637">main.inc.php:2637</a></div></div>
<div class="ttc" id="amd_2style_8css_8php_html_a30684cee0104698ef539bf2b69be6de8"><div class="ttname"><a href="../../dd/dd1/md_2style_8css_8php.html#a30684cee0104698ef539bf2b69be6de8">float</a></div><div class="ttdeci">div float</div><div class="ttdoc">Buy price without taxes.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd1/md_2style_8css_8php_source.html#l00908">style.css.php:908</a></div></div>
<div class="ttc" id="asecurity2_8lib_8php_html_a972e4b7c324a4112b55df0cb2f9f0713"><div class="ttname"><a href="../../dc/d5b/security2_8lib_8php.html#a972e4b7c324a4112b55df0cb2f9f0713">checkLoginPassEntity</a></div><div class="ttdeci">checkLoginPassEntity($usertotest, $passwordtotest, $entitytotest, $authmode, $context='')</div><div class="ttdoc">Return a login if login/pass was successfull.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5b/security2_8lib_8php_source.html#l00057">security2.lib.php:57</a></div></div>
<div class="ttc" id="asecurity_8lib_8php_html_ac12a777e000fbc4272e9460e11e33385"><div class="ttname"><a href="../../dd/df3/security_8lib_8php.html#ac12a777e000fbc4272e9460e11e33385">dol_hash</a></div><div class="ttdeci">dol_hash($chain, $type='0')</div><div class="ttdoc">Returns a hash (non reversible encryption) of a string.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df3/security_8lib_8php_source.html#l00206">security.lib.php:206</a></div></div>
<div class="ttc" id="asecurity_8lib_8php_html_ade2525beed17cc74b84932ff7483231d"><div class="ttname"><a href="../../dd/df3/security_8lib_8php.html#ade2525beed17cc74b84932ff7483231d">accessforbidden</a></div><div class="ttdeci">accessforbidden($message='', $printheader=1, $printfooter=1, $showonlymessage=0, $params=null)</div><div class="ttdoc">Show a message to say access is forbidden and stop program.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df3/security_8lib_8php_source.html#l01075">security.lib.php:1075</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- 
File added into doxygen generated documentation
-->
<hr class="footer" />
<address class="footer"><small>Generated on Mon Jan 2 2023 15:02:01 for <a href="https://www.dolibarr.org" title="ERP and CRM open source software">dolibarr</a> by Doxygen 1.9.1 </small></address>
<br>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9049390-16"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-9049390-16');
</script>
</body>
</html>