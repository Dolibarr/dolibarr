<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dolibarr: htdocs/projet/activity/permonth.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dolibarr
   &#160;<span id="projectnumber">x.y.z</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_eaa9681d2effa5cf690be6ac05e74743.html">htdocs</a></li><li class="navelem"><a class="el" href="../../dir_5df1e1124c35cf30c3f95a842cf5db3b.html">projet</a></li><li class="navelem"><a class="el" href="../../dir_73a4bba147b3b85f5b4a0b197950144e.html">activity</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">permonth.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/d12/permonth_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* Copyright (C) 2005      Rodolphe Quiedeville &lt;rodolphe@quiedeville.org&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2004-2015 Laurent Destailleur  &lt;eldy@users.sourceforge.net&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2005-2010 Regis Houssin        &lt;regis.houssin@capnetworks.com&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 2010      Fran√ßois Legastelois &lt;flegastelois@teclib.com&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;require <span class="stringliteral">&quot;../../main.inc.php&quot;</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/projet/class/project.class.php&#39;</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/projet/class/task.class.php&#39;</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/project.lib.php&#39;</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/date.lib.php&#39;</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.formother.class.php&#39;</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.formprojet.class.php&#39;</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/class/html.formcompany.class.php&#39;</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/holiday/class/holiday.class.php&#39;</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// Load translation files required by the page</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;$langs-&gt;loadLangs(array(<span class="stringliteral">&#39;projects&#39;</span>, <span class="stringliteral">&#39;users&#39;</span>, <span class="stringliteral">&#39;companies&#39;</span>));</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;$hookmanager-&gt;initHooks(array(<span class="stringliteral">&#39;timesheetpermonthcard&#39;</span>));</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;$action = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;aZ09&#39;</span>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;$mode = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;mode&quot;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;$id = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;$taskid = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;taskid&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;$mine = 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordflow">if</span> ($mode == <span class="stringliteral">&#39;mine&#39;</span>) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  $mine = 1;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;$projectid = <a class="code" href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a>(<span class="stringliteral">&quot;id&quot;</span>) ? <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>, 1) : <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;projectid&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// Security check</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;$socid = 0;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// For external user, no check is done on company because readability is managed by public status of project and assignement.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// if ($user-&gt;societe_id &gt; 0) $socid=$user-&gt;societe_id;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;$result = <a class="code" href="../../dd/df3/security_8lib_8php.html#a66e46f88bd5c0e08d6f2119178ca11b8">restrictedArea</a>($user, <span class="stringliteral">&#39;projet&#39;</span>, $projectid);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;$now = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a>();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;$year = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reyear&#39;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reyear&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) : (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;year&quot;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;year&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) : date(<span class="stringliteral">&quot;Y&quot;</span>));</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;$month = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;remonth&#39;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;remonth&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) : (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;month&quot;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;month&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) : date(<span class="stringliteral">&quot;m&quot;</span>));</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;$day = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reday&#39;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reday&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>) : (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;day&quot;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;day&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) : date(<span class="stringliteral">&quot;d&quot;</span>));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;$day = (int) $day;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;$week = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;week&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;week&quot;</span>, <span class="stringliteral">&quot;int&quot;</span>) : date(<span class="stringliteral">&quot;W&quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//$search_categ = GETPOST(&quot;search_categ&quot;, &#39;alpha&#39;);</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;$search_usertoprocessid = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_usertoprocessid&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;$search_task_ref = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_task_ref&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;$search_task_label = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_task_label&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;$search_project_ref = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_project_ref&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;$search_thirdparty = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_thirdparty&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;$search_declared_progress = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;search_declared_progress&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;$startdayarray = <a class="code" href="../../db/df7/date_8lib_8php.html#a00bc14984f4a3fdf8e888b3d77da7cd4">dol_get_prev_month</a>($month, $year);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;$prev = $startdayarray;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;$prev_year  = $prev[<span class="stringliteral">&#39;year&#39;</span>];</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;$prev_month = $prev[<span class="stringliteral">&#39;month&#39;</span>];</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;$prev_day   = 1;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;$next = <a class="code" href="../../db/df7/date_8lib_8php.html#a9718e5c28e7294b7c91c676285f13ebc">dol_get_next_month</a>($month, $year);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;$next_year  = $next[<span class="stringliteral">&#39;year&#39;</span>];</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;$next_month = $next[<span class="stringliteral">&#39;month&#39;</span>];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;$next_day   = 1;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;$TWeek = <a class="code" href="../../db/df7/date_8lib_8php.html#a4fea7beb2f8758564f685f77bf82de13">getWeekNumbersOfMonth</a>($month, $year);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;$firstdaytoshow = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a>(0, 0, 0, $month, 1, $year);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;$TFirstDays = <a class="code" href="../../db/df7/date_8lib_8php.html#a7c39820fee49acf547acc6c1f6e7dd73">getFirstDayOfEachWeek</a>($TWeek, $year);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;$TFirstDays[reset($TWeek)] = <span class="stringliteral">&#39;01&#39;</span>; <span class="comment">//first day of month</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;$TLastDays = <a class="code" href="../../db/df7/date_8lib_8php.html#a4ae6f9a007d4478581d6ff6290b0438a">getLastDayOfEachWeek</a>($TWeek, $year);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;$TLastDays[end($TWeek)] = date(<span class="stringliteral">&quot;t&quot;</span>, strtotime($year.<span class="charliteral">&#39;-&#39;</span>.$month.<span class="charliteral">&#39;-&#39;</span>.$day)); <span class="comment">//last day of month</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keywordflow">if</span> (empty($search_usertoprocessid) || $search_usertoprocessid == $user-&gt;id) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  $usertoprocess = $user;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  $search_usertoprocessid = $usertoprocess-&gt;id;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;} elseif ($search_usertoprocessid &gt; 0) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  $usertoprocess = <span class="keyword">new</span> <a class="code" href="../../d7/d23/class_user.html">User</a>($db);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  $usertoprocess-&gt;fetch($search_usertoprocessid);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  $search_usertoprocessid = $usertoprocess-&gt;id;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  $usertoprocess = <span class="keyword">new</span> <a class="code" href="../../d7/d23/class_user.html">User</a>($db);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;$object = <span class="keyword">new</span> <a class="code" href="../../d7/d6d/class_task.html">Task</a>($db);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;$error = 0;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * Actions</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;$parameters = array(<span class="stringliteral">&#39;id&#39;</span> =&gt; $id, <span class="stringliteral">&#39;taskid&#39;</span> =&gt; $taskid, <span class="stringliteral">&#39;projectid&#39;</span> =&gt; $projectid, <span class="stringliteral">&#39;TWeek&#39;</span> =&gt; $TWeek, <span class="stringliteral">&#39;TFirstDays&#39;</span> =&gt; $TFirstDays, <span class="stringliteral">&#39;TLastDays&#39;</span> =&gt; $TLastDays);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;$reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;doActions&#39;</span>, $parameters, $object, $action); <span class="comment">// Note that $action and $object may have been modified by some hooks</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordflow">if</span> ($reshook &lt; 0) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($hookmanager-&gt;error, $hookmanager-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">// Purge criteria</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;button_removefilter_x&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;button_removefilter.x&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;button_removefilter&#39;</span>, <span class="stringliteral">&#39;alpha&#39;</span>)) { <span class="comment">// All tests are required to be compatible with all browsers</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">//$search_categ = &#39;&#39;;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  $search_usertoprocessid = $user-&gt;id;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  $search_task_ref = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  $search_task_label = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  $search_project_ref = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  $search_thirdparty = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  $search_declared_progress = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;button_search_x&quot;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;button_search.x&quot;</span>, <span class="stringliteral">&#39;alpha&#39;</span>) || <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;button_search&quot;</span>, <span class="stringliteral">&#39;alpha&#39;</span>)) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;submitdateselect&#39;</span>)) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  $daytoparse = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a>(0, 0, 0, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;remonth&#39;</span>), <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reday&#39;</span>), <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;reyear&#39;</span>));</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;addtime&#39;</span> &amp;&amp; $user-&gt;rights-&gt;projet-&gt;lire &amp;&amp; <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;assigntask&#39;</span>)) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  $action = <span class="stringliteral">&#39;assigntask&#39;</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">if</span> ($taskid &gt; 0) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    $result = $object-&gt;fetch($taskid, $ref);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      $error++;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorFieldRequired&quot;</span>, $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;Task&quot;</span>)), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    $error++;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;type&#39;</span>)) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;ErrorFieldRequired&quot;</span>, $langs-&gt;transnoentitiesnoconv(<span class="stringliteral">&quot;Type&quot;</span>)), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    $error++;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (!$error) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    $idfortaskuser = $usertoprocess-&gt;id;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    $result = $object-&gt;add_contact($idfortaskuser, <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&quot;type&quot;</span>), <span class="stringliteral">&#39;internal&#39;</span>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> ($result &gt;= 0 || $result == -2) {  <span class="comment">// Contact add ok or already contact of task</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// Test if we are already contact of the project (should be rare but sometimes we can add as task contact without being contact of project, like when admin user has been removed from contact of project)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      $sql = <span class="stringliteral">&#39;SELECT ec.rowid FROM &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;element_contact as ec, &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_type_contact as tc WHERE tc.rowid = ec.fk_c_type_contact&#39;</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      $sql .= <span class="stringliteral">&#39; AND ec.fk_socpeople = &#39;</span>.((int) $idfortaskuser).<span class="stringliteral">&quot; AND ec.element_id = &quot;</span>.((int) $object-&gt;fk_project).<span class="stringliteral">&quot; AND tc.element = &#39;project&#39; AND source = &#39;internal&#39;&quot;</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a> = $db-&gt;query($sql);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        $obj = $db-&gt;fetch_object(<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">if</span> (!$obj) {  <span class="comment">// User is not already linked to project, so we will create link to first type</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;          $project = <span class="keyword">new</span> <a class="code" href="../../d9/d6e/class_project.html">Project</a>($db);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          $project-&gt;fetch($object-&gt;fk_project);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          <span class="comment">// Get type</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          $listofprojcontact = $project-&gt;liste_type_contact(<span class="stringliteral">&#39;internal&#39;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          <span class="keywordflow">if</span> (count($listofprojcontact)) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            $tmparray = array_keys($listofprojcontact);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            $typeforprojectcontact = reset($tmparray);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            $result = $project-&gt;add_contact($idfortaskuser, $typeforprojectcontact, <span class="stringliteral">&#39;internal&#39;</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a>($db);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    $error++;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> ($object-&gt;error == <span class="stringliteral">&#39;DB_ERROR_RECORD_ALREADY_EXISTS&#39;</span>) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      $langs-&gt;load(<span class="stringliteral">&quot;errors&quot;</span>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ErrorTaskAlreadyAssigned&quot;</span>), <span class="keyword">null</span>, <span class="stringliteral">&#39;warnings&#39;</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($object-&gt;error, $object-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">if</span> (!$error) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>(<span class="stringliteral">&quot;TaskAssignedToEnterTime&quot;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    $taskid = 0;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  $action = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;addtime&#39;</span> &amp;&amp; $user-&gt;rights-&gt;projet-&gt;lire) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  $timetoadd = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>(<span class="stringliteral">&#39;task&#39;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (empty($timetoadd)) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;ErrorTimeSpentIsEmpty&quot;</span>), <span class="keyword">null</span>, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">foreach</span> ($timetoadd as $tmptaskid =&gt; $tmpvalue) {     <span class="comment">// Loop on each task</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      $updateoftaskdone = 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">foreach</span> ($tmpvalue as $key =&gt; $val) {          <span class="comment">// Loop on each day</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        $amountoadd = $timetoadd[$tmptaskid][$key];</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> (!empty($amountoadd)) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          $tmpduration = explode(<span class="charliteral">&#39;:&#39;</span>, $amountoadd);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          $newduration = 0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          <span class="keywordflow">if</span> (!empty($tmpduration[0])) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            $newduration += ($tmpduration[0] * 3600);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          <span class="keywordflow">if</span> (!empty($tmpduration[1])) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            $newduration += ($tmpduration[1] * 60);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          <span class="keywordflow">if</span> (!empty($tmpduration[2])) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            $newduration += ($tmpduration[2]);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;          <span class="keywordflow">if</span> ($newduration &gt; 0) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            $object-&gt;fetch($tmptaskid);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            $object-&gt;progress = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($tmptaskid.<span class="stringliteral">&#39;progress&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            $object-&gt;timespent_duration = $newduration;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            $object-&gt;timespent_fk_user = $usertoprocess-&gt;id;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            $object-&gt;timespent_date = <a class="code" href="../../db/df7/date_8lib_8php.html#ab10404fd55a936c0ce185c415d40f546">dol_time_plus_duree</a>($firstdaytoshow, $key, <span class="charliteral">&#39;d&#39;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            $object-&gt;timespent_datehour = $object-&gt;timespent_date;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            $result = $object-&gt;addTimeSpent($user);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;              <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($object-&gt;error, $object-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;              $error++;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            $updateoftaskdone++;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">if</span> (!$updateoftaskdone) {  <span class="comment">// Check to update progress if no update were done on task.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        $object-&gt;fetch($tmptaskid);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">//var_dump($object-&gt;progress);</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">//var_dump(GETPOST($tmptaskid . &#39;progress&#39;, &#39;int&#39;)); exit;</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span> ($object-&gt;progress != <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($tmptaskid.<span class="stringliteral">&#39;progress&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>)) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          $object-&gt;progress = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a>($tmptaskid.<span class="stringliteral">&#39;progress&#39;</span>, <span class="stringliteral">&#39;int&#39;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          $result = $object-&gt;update($user);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($object-&gt;error, $object-&gt;errors, <span class="stringliteral">&#39;errors&#39;</span>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            $error++;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span> (!$error) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a>($langs-&gt;trans(<span class="stringliteral">&quot;RecordSaved&quot;</span>), <span class="keyword">null</span>, <span class="stringliteral">&#39;mesgs&#39;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      $param = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      $param .= ($mode ? <span class="stringliteral">&#39;&amp;mode=&#39;</span>.$mode : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      $param .= ($projectid ? <span class="stringliteral">&#39;id=&#39;</span>.$projectid : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      $param .= ($search_usertoprocessid ? <span class="stringliteral">&#39;&amp;search_usertoprocessid=&#39;</span>.$search_usertoprocessid : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      $param .= ($day ? <span class="stringliteral">&#39;&amp;day=&#39;</span>.$day : <span class="stringliteral">&#39;&#39;</span>).($month ? <span class="stringliteral">&#39;&amp;month=&#39;</span>.$month : <span class="stringliteral">&#39;&#39;</span>).($year ? <span class="stringliteral">&#39;&amp;year=&#39;</span>.$year : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      $param .= ($search_project_ref ? <span class="stringliteral">&#39;&amp;search_project_ref=&#39;</span>.$search_project_ref : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      $param .= ($search_usertoprocessid &gt; 0 ? <span class="stringliteral">&#39;&amp;search_usertoprocessid=&#39;</span>.$search_usertoprocessid : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      $param .= ($search_thirdparty ? <span class="stringliteral">&#39;&amp;search_thirdparty=&#39;</span>.$search_thirdparty : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      $param .= ($search_declared_progress ? <span class="stringliteral">&#39;&amp;search_declared_progress=&#39;</span>.$search_declared_progress : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      $param .= ($search_task_ref ? <span class="stringliteral">&#39;&amp;search_task_ref=&#39;</span>.$search_task_ref : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      $param .= ($search_task_label ? <span class="stringliteral">&#39;&amp;search_task_label=&#39;</span>.$search_task_label : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">// Redirect to avoid submit twice on back</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      header(<span class="stringliteral">&#39;Location: &#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="charliteral">&#39;?&#39;</span>.$param);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      exit;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> * View</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a> = <span class="keyword">new</span> <a class="code" href="../../df/d08/class_form.html">Form</a>($db);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;$formother = <span class="keyword">new</span> <a class="code" href="../../d0/dbd/class_form_other.html">FormOther</a>($db);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;$formcompany = <span class="keyword">new</span> <a class="code" href="../../d2/d52/class_form_company.html">FormCompany</a>($db);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;$formproject = <span class="keyword">new</span> <a class="code" href="../../d3/d2f/class_form_projets.html">FormProjets</a>($db);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;$projectstatic = <span class="keyword">new</span> <a class="code" href="../../d9/d6e/class_project.html">Project</a>($db);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;$project = <span class="keyword">new</span> <a class="code" href="../../d9/d6e/class_project.html">Project</a>($db);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;$taskstatic = <span class="keyword">new</span> <a class="code" href="../../d7/d6d/class_task.html">Task</a>($db);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;$thirdpartystatic = <span class="keyword">new</span> <a class="code" href="../../dc/dbc/class_societe.html">Societe</a>($db);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;$holiday = <span class="keyword">new</span> <a class="code" href="../../dd/d46/class_holiday.html">Holiday</a>($db);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;$title = $langs-&gt;trans(<span class="stringliteral">&quot;TimeSpent&quot;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;$projectsListId = $projectstatic-&gt;getProjectsAuthorizedForUser($usertoprocess, (empty($usertoprocess-&gt;id) ? 2 : 0), 1); <span class="comment">// Return all project i have permission on (assigned to me+public). I want my tasks and some of my task may be on a public projet that is not my project</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">//var_dump($projectsListId);</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keywordflow">if</span> ($id) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  $project-&gt;fetch($id);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  $project-&gt;fetch_thirdparty();</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;$onlyopenedproject = 1; <span class="comment">// or -1</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;$morewherefilter = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="keywordflow">if</span> ($search_project_ref) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  $morewherefilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a>(array(<span class="stringliteral">&quot;p.ref&quot;</span>, <span class="stringliteral">&quot;p.title&quot;</span>), $search_project_ref);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keywordflow">if</span> ($search_task_ref) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  $morewherefilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a>(<span class="stringliteral">&quot;t.ref&quot;</span>, $search_task_ref);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordflow">if</span> ($search_task_label) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  $morewherefilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a>(array(<span class="stringliteral">&quot;t.ref&quot;</span>, <span class="stringliteral">&quot;t.label&quot;</span>), $search_task_label);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordflow">if</span> ($search_thirdparty) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  $morewherefilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a>(<span class="stringliteral">&quot;s.nom&quot;</span>, $search_thirdparty);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordflow">if</span> ($search_declared_progress) {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  $morewherefilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a>(<span class="stringliteral">&quot;t.progress&quot;</span>, $search_declared_progress, 1);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;$tasksarray = $taskstatic-&gt;getTasksArray(0, 0, ($project-&gt;id ? $project-&gt;id : 0), $socid, 0, $search_project_ref, $onlyopenedproject, $morewherefilter, ($search_usertoprocessid ? $search_usertoprocessid : 0)); <span class="comment">// We want to see all tasks of open project i am allowed to see and that match filter, not only my tasks. Later only mine will be editable later.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordflow">if</span> ($morewherefilter) { <span class="comment">// Get all task without any filter, so we can show total of time spent for not visible tasks</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  $tasksarraywithoutfilter = $taskstatic-&gt;getTasksArray(0, 0, ($project-&gt;id ? $project-&gt;id : 0), $socid, 0, <span class="stringliteral">&#39;&#39;</span>, $onlyopenedproject, <span class="stringliteral">&#39;&#39;</span>, ($search_usertoprocessid ? $search_usertoprocessid : 0)); <span class="comment">// We want to see all tasks of open project i am allowed to see and that match filter, not only my tasks. Later only mine will be editable later.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;$projectsrole = $taskstatic-&gt;getUserRolesForProjectsOrTasks($usertoprocess, <span class="keyword">null</span>, ($project-&gt;id ? $project-&gt;id : 0), 0, $onlyopenedproject);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;$tasksrole = $taskstatic-&gt;getUserRolesForProjectsOrTasks(<span class="keyword">null</span>, $usertoprocess, ($project-&gt;id ? $project-&gt;id : 0), 0, $onlyopenedproject);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">//var_dump($tasksarray);</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">//var_dump($projectsrole);</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">//var_dump($taskrole);</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<a class="code" href="../../d6/d7c/asterisk_2wrapper_8php.html#a3e1c89b902a5beaa3d5476a09cd591ae">llxHeader</a>(<span class="stringliteral">&quot;&quot;</span>, $title, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, array(<span class="stringliteral">&#39;/core/js/timesheet.js&#39;</span>));</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">//print_barre_liste($title, $page, $_SERVER[&quot;PHP_SELF&quot;], &quot;&quot;, $sortfield, $sortorder, &quot;&quot;, $num, &#39;&#39;, &#39;title_project&#39;);</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;$param = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;$param .= ($mode ? <span class="stringliteral">&#39;&amp;mode=&#39;</span>.urlencode($mode) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;$param .= ($search_project_ref ? <span class="stringliteral">&#39;&amp;search_project_ref=&#39;</span>.urlencode($search_project_ref) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;$param .= ($search_usertoprocessid &gt; 0 ? <span class="stringliteral">&#39;&amp;search_usertoprocessid=&#39;</span>.urlencode($search_usertoprocessid) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;$param .= ($search_thirdparty ? <span class="stringliteral">&#39;&amp;search_thirdparty=&#39;</span>.urlencode($search_thirdparty) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;$param .= ($search_task_ref ? <span class="stringliteral">&#39;&amp;search_task_ref=&#39;</span>.urlencode($search_task_ref) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;$param .= ($search_task_label ? <span class="stringliteral">&#39;&amp;search_task_label=&#39;</span>.urlencode($search_task_label) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">// Show navigation bar</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;$nav = <span class="stringliteral">&#39;&lt;a class=&quot;inline-block valignmiddle&quot; href=&quot;?year=&#39;</span>.$prev_year.<span class="stringliteral">&quot;&amp;month=&quot;</span>.$prev_month.<span class="stringliteral">&quot;&amp;day=&quot;</span>.$prev_day.$param.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a7714b3b2f906a438f3273a07b76135ed">img_previous</a>($langs-&gt;trans(<span class="stringliteral">&quot;Previous&quot;</span>)).<span class="stringliteral">&quot;&lt;/a&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;$nav .= <span class="stringliteral">&quot; &lt;span id=\&quot;month_name\&quot;&gt;&quot;</span>.dol_print_date(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a>(0, 0, 0, $month, 1, $year), <span class="stringliteral">&quot;%Y&quot;</span>).<span class="stringliteral">&quot;, &quot;</span>.$langs-&gt;trans(date(<span class="charliteral">&#39;F&#39;</span>, mktime(0, 0, 0, $month, 10))).<span class="stringliteral">&quot; &lt;/span&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;$nav .= <span class="stringliteral">&#39;&lt;a class=&quot;inline-block valignmiddle&quot; href=&quot;?year=&#39;</span>.$next_year.<span class="stringliteral">&quot;&amp;month=&quot;</span>.$next_month.<span class="stringliteral">&quot;&amp;day=&quot;</span>.$next_day.$param.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ac655dc67c8d9e44c12dbb4ae8508a688">img_next</a>($langs-&gt;trans(<span class="stringliteral">&quot;Next&quot;</span>)).<span class="stringliteral">&quot;&lt;/a&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;$nav .= <span class="charliteral">&#39; &#39;</span>.$form-&gt;selectDate(-1, <span class="stringliteral">&#39;&#39;</span>, 0, 0, 2, <span class="stringliteral">&quot;addtime&quot;</span>, 1, 1).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;$nav .= <span class="stringliteral">&#39; &lt;button type=&quot;submit&quot; name=&quot;button_search_x&quot; value=&quot;x&quot; class=&quot;bordertransp nobordertransp button_search_x&quot;&gt;&lt;span class=&quot;fa fa-search&quot;&gt;&lt;/span&gt;&lt;/button&gt;&#39;</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;$picto = <span class="stringliteral">&#39;clock&#39;</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;print <span class="stringliteral">&#39;&lt;form name=&quot;addtime&quot; method=&quot;POST&quot; action=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>].<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&#39;</span>.newToken().<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;addtime&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;mode&quot; value=&quot;&#39;</span>.$mode.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;day&quot; value=&quot;&#39;</span>.$day.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;month&quot; value=&quot;&#39;</span>.$month.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;year&quot; value=&quot;&#39;</span>.$year.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;$head = <a class="code" href="../../de/d0a/project_8lib_8php.html#a87fe451720c4c52263d6bb3266faac30">project_timesheet_prepare_head</a>($mode, $usertoprocess);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a>($head, <span class="stringliteral">&#39;inputpermonth&#39;</span>, $langs-&gt;trans(<span class="stringliteral">&#39;TimeSpent&#39;</span>), -1, $picto);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">// Show description of content</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;hideonsmartphone opacitymedium&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keywordflow">if</span> ($mine || ($usertoprocess-&gt;id == $user-&gt;id)) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  print $langs-&gt;trans(<span class="stringliteral">&quot;MyTasksDesc&quot;</span>).<span class="charliteral">&#39;.&#39;</span>.($onlyopenedproject ? <span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;OnlyOpenedProject&quot;</span>) : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (empty($usertoprocess-&gt;id) || $usertoprocess-&gt;id &lt; 0) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> ($user-&gt;rights-&gt;projet-&gt;all-&gt;lire &amp;&amp; !$socid) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      print $langs-&gt;trans(<span class="stringliteral">&quot;ProjectsDesc&quot;</span>).<span class="charliteral">&#39;.&#39;</span>.($onlyopenedproject ? <span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;OnlyOpenedProject&quot;</span>) : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      print $langs-&gt;trans(<span class="stringliteral">&quot;ProjectsPublicTaskDesc&quot;</span>).<span class="charliteral">&#39;.&#39;</span>.($onlyopenedproject ? <span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;OnlyOpenedProject&quot;</span>) : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordflow">if</span> ($mine || ($usertoprocess-&gt;id == $user-&gt;id)) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  print $langs-&gt;trans(<span class="stringliteral">&quot;OnlyYourTaskAreVisible&quot;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  print $langs-&gt;trans(<span class="stringliteral">&quot;AllTaskVisibleButEditIfYouAreAssigned&quot;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a43ed6679bd4b390f7b120bf848d5acf9">dol_get_fiche_end</a>();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;floatright right&#39;</span>.($conf-&gt;dol_optimize_smallscreen ? <span class="stringliteral">&#39; centpercent&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$nav.<span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>; <span class="comment">// We move this before the assign to components so, the default submit button is not the assign to.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;colorbacktimesheet float valignmiddle&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;$titleassigntask = $langs-&gt;transnoentities(<span class="stringliteral">&quot;AssignTaskToMe&quot;</span>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordflow">if</span> ($usertoprocess-&gt;id != $user-&gt;id) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  $titleassigntask = $langs-&gt;transnoentities(<span class="stringliteral">&quot;AssignTaskToUser&quot;</span>, $usertoprocess-&gt;getFullName($langs));</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;taskiddiv inline-block&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;print <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;projecttask&#39;</span>, <span class="stringliteral">&#39;class=&quot;pictofixedwidth&quot;&#39;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;$formproject-&gt;selectTasks($socid ? $socid : -1, $taskid, <span class="stringliteral">&#39;taskid&#39;</span>, 32, 0, <span class="stringliteral">&#39;-- &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ChooseANotYetAssignedTask&quot;</span>).<span class="stringliteral">&#39; --&#39;</span>, 1);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;print <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;print $formcompany-&gt;selectTypeContact($object, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;internal&#39;</span>, <span class="stringliteral">&#39;rowid&#39;</span>, 0, <span class="stringliteral">&#39;maxwidth150onsmartphone&#39;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;submit&quot; class=&quot;button valignmiddle smallonsmartphone small&quot; name=&quot;assigntask&quot; value=&quot;&#39;</span>.dol_escape_htmltag($titleassigntask).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;clearboth&quot; style=&quot;padding-bottom: 20px;&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;$moreforfilter = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">// Filter on categories</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">if (!empty($conf-&gt;categorie-&gt;enabled))</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">  require_once DOL_DOCUMENT_ROOT . &#39;/categories/class/categorie.class.php&#39;;</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">  $moreforfilter.=&#39;&lt;div class=&quot;divsearchfield&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">  $moreforfilter.=$langs-&gt;trans(&#39;ProjectCategories&#39;). &#39;: &#39;;</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">  $moreforfilter.=$formother-&gt;select_categories(&#39;project&#39;, $search_categ, &#39;search_categ&#39;, 1, 1, &#39;maxwidth300&#39;);</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">  $moreforfilter.=&#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">}*/</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">// If the user can view user other than himself</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;$moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;divsearchfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;$moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;inline-block hideonsmartphone&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;$includeonly = <span class="stringliteral">&#39;hierarchyme&#39;</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;user-&gt;user-&gt;lire)) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  $includeonly = array($user-&gt;id);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;$moreforfilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&#39;Filter&#39;</span>).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;User&#39;</span>), <span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;class=&quot;paddingright pictofixedwidth&quot;&#39;</span>).$form-&gt;select_dolusers($search_usertoprocessid ? $search_usertoprocessid : $usertoprocess-&gt;id, <span class="stringliteral">&#39;search_usertoprocessid&#39;</span>, $user-&gt;rights-&gt;user-&gt;user-&gt;lire ? 0 : 0, <span class="keyword">null</span>, 0, $includeonly, <span class="keyword">null</span>, 0, 0, 0, <span class="stringliteral">&#39;&#39;</span>, 0, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;maxwidth200&#39;</span>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;$moreforfilter .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;PROJECT_TIMESHEET_DISABLEBREAK_ON_PROJECT)) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;divsearchfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;inline-block&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  $moreforfilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&#39;Filter&#39;</span>).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;Project&#39;</span>), <span class="stringliteral">&#39;project&#39;</span>, <span class="stringliteral">&#39;class=&quot;paddingright pictofixedwidth&quot;&#39;</span>).<span class="stringliteral">&#39;&lt;input type=&quot;text&quot; name=&quot;search_project_ref&quot; class=&quot;maxwidth100&quot; value=&quot;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($search_project_ref).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;divsearchfield&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;div class=&quot;inline-block&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  $moreforfilter .= <a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&#39;Filter&#39;</span>).<span class="charliteral">&#39; &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&#39;ThirdParty&#39;</span>), <span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;class=&quot;paddingright pictofixedwidth&quot;&#39;</span>).<span class="stringliteral">&#39;&lt;input type=&quot;text&quot; name=&quot;search_thirdparty&quot; class=&quot;maxwidth100&quot; value=&quot;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a>($search_thirdparty).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  $moreforfilter .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordflow">if</span> (!empty($moreforfilter)) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  print <span class="stringliteral">&#39;&lt;div class=&quot;liste_titre liste_titre_bydiv centpercent&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  print $moreforfilter;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  $parameters = array();</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  $reshook = $hookmanager-&gt;executeHooks(<span class="stringliteral">&#39;printFieldPreListTitle&#39;</span>, $parameters); <span class="comment">// Note that $action and $object may have been modified by hook</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  print $hookmanager-&gt;resPrint;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;print <span class="stringliteral">&#39;&lt;div class=&quot;div-table-responsive&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;print <span class="stringliteral">&#39;&lt;table class=&quot;tagtable liste&#39;</span>.($moreforfilter ? <span class="stringliteral">&quot; listwithfilterbefore&quot;</span> : <span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&#39;&quot; id=&quot;tablelines3&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre_filter&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;PROJECT_TIMESHEET_DISABLEBREAK_ON_PROJECT)) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;input type=&quot;text&quot; size=&quot;4&quot; name=&quot;search_project_ref&quot; value=&quot;&#39;</span>.dol_escape_htmltag($search_project_ref).<span class="stringliteral">&#39;&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;PROJECT_TIMESHEET_DISABLEBREAK_ON_PROJECT)) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;input type=&quot;text&quot; size=&quot;4&quot; name=&quot;search_thirdparty&quot; value=&quot;&#39;</span>.dol_escape_htmltag($search_thirdparty).<span class="stringliteral">&#39;&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;input type=&quot;text&quot; size=&quot;4&quot; name=&quot;search_task_label&quot; value=&quot;&#39;</span>.dol_escape_htmltag($search_task_label).<span class="stringliteral">&#39;&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre right&quot;&gt;&lt;input type=&quot;text&quot; size=&quot;4&quot; name=&quot;search_declared_progress&quot; value=&quot;&#39;</span>.dol_escape_htmltag($search_declared_progress).<span class="stringliteral">&#39;&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordflow">foreach</span> ($TWeek as $week_number) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">// Action column</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;liste_titre nowrap&quot; align=&quot;right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;$searchpicto = <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;showFilterAndCheckAddButtons(0);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;print $searchpicto;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;print <span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_titre&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;PROJECT_TIMESHEET_DISABLEBREAK_ON_PROJECT)) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Project&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;PROJECT_TIMESHEET_DISABLEBREAK_ON_PROJECT)) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ThirdParty&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;}</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;print <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Task&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;print <span class="stringliteral">&#39;&lt;td align=&quot;right&quot; class=&quot;leftborder plannedworkload maxwidth75&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;PlannedWorkload&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;print <span class="stringliteral">&#39;&lt;td align=&quot;right&quot; class=&quot;maxwidth75&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ProgressDeclared&quot;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/*print &#39;&lt;td align=&quot;right&quot; class=&quot;maxwidth75&quot;&gt;&#39;.$langs-&gt;trans(&quot;TimeSpent&quot;).&#39;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment"> if ($usertoprocess-&gt;id == $user-&gt;id) print &#39;&lt;td align=&quot;right&quot; class=&quot;maxwidth75&quot;&gt;&#39;.$langs-&gt;trans(&quot;TimeSpentByYou&quot;).&#39;&lt;/td&gt;&#39;;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"> else print &#39;&lt;td align=&quot;right&quot; class=&quot;maxwidth75&quot;&gt;&#39;.$langs-&gt;trans(&quot;TimeSpentByUser&quot;).&#39;&lt;/td&gt;&#39;;*/</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;print <span class="stringliteral">&#39;&lt;td class=&quot;right maxwidth100&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;TimeSpent&quot;</span>).<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;print <span class="stringliteral">&#39;&lt;span class=&quot;nowraponall&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium nopadding userimg&quot;&gt;&lt;img alt=&quot;Photo&quot; class=&quot;photouserphoto userphoto&quot; src=&quot;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/theme/common/everybody.png&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium paddingleft&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Everybody&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;print <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;print <span class="stringliteral">&#39;&lt;td align=&quot;right&quot; class=&quot;maxwidth75&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;TimeSpent&quot;</span>).($usertoprocess-&gt;firstname ? <span class="stringliteral">&#39;&lt;br&gt;&lt;span class=&quot;nowraponall&quot;&gt;&#39;</span>.$usertoprocess-&gt;getNomUrl(-2).<span class="stringliteral">&#39;&lt;span class=&quot;opacitymedium paddingleft&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#ac863120bf29caa349dd610383aae275e">dol_trunc</a>($usertoprocess-&gt;firstname, 10).<span class="stringliteral">&#39;&lt;/span&gt;&lt;/span&gt;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keywordflow">foreach</span> ($TWeek as $week_number) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  print <span class="stringliteral">&#39;&lt;td width=&quot;6%&quot; align=&quot;center&quot; class=&quot;bold hide&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;Week&quot;</span>).<span class="charliteral">&#39; &#39;</span>.$week_number.<span class="stringliteral">&#39;&lt;br&gt;(&#39;</span>.$TFirstDays[$week_number].<span class="stringliteral">&#39;...&#39;</span>.$TLastDays[$week_number].<span class="stringliteral">&#39;)&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;print <span class="stringliteral">&#39;&lt;td&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;print <span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;$colspan = 5;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">// By default, we can edit only tasks we are assigned to</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;$restrictviewformytask = (empty($conf-&gt;global-&gt;PROJECT_TIME_SHOW_TASK_NOT_ASSIGNED) ? 1 : 0);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">// Get if user is available or not for each day</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;$isavailable = array();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">// TODO See code into perweek.php to initialize isavailable array</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keywordflow">if</span> (count($tasksarray) &gt; 0) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">//var_dump($tasksarray);        // contains only selected tasks</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">//var_dump($tasksarraywithoutfilter); // contains all tasks (if there is a filter, not defined if no filter)</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="comment">//var_dump($tasksrole);</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  $j = 0;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  $level = 0;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  $totalforvisibletasks = <a class="code" href="../../de/d0a/project_8lib_8php.html#a105603ea6d6663c0a689251f2a3efa2e">projectLinesPerMonth</a>($j, $firstdaytoshow, $usertoprocess, 0, $tasksarray, $level, $projectsrole, $tasksrole, $mine, $restrictviewformytask, $isavailable, 0, $TWeek);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">//var_dump($totalforvisibletasks);</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// Show total for all other tasks</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// Calculate total for all tasks</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  $listofdistinctprojectid = array(); <span class="comment">// List of all distinct projects</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (!empty($tasksarraywithoutfilter) &amp;&amp; is_array($tasksarraywithoutfilter) &amp;&amp; count($tasksarraywithoutfilter)) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">foreach</span> ($tasksarraywithoutfilter as $tmptask) {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      $listofdistinctprojectid[$tmptask-&gt;fk_project] = $tmptask-&gt;fk_project;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="comment">//var_dump($listofdistinctprojectid);</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  $totalforeachweek = array();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordflow">foreach</span> ($listofdistinctprojectid as $tmpprojectid) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    $projectstatic-&gt;id = $tmpprojectid;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    $projectstatic-&gt;loadTimeSpentMonth($firstdaytoshow, 0, $usertoprocess-&gt;id); <span class="comment">// Load time spent from table projet_task_time for the project into this-&gt;weekWorkLoad and this-&gt;weekWorkLoadPerTask for all days of a week</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">foreach</span> ($TWeek as $weekNb) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      $totalforeachweek[$weekNb] += $projectstatic-&gt;monthWorkLoad[$weekNb];</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">//var_dump($totalforeachday);</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">//var_dump($totalforvisibletasks);</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// Is there a diff between selected/filtered tasks and all tasks ?</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  $isdiff = 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">if</span> (count($totalforeachweek)) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">foreach</span> ($TWeek as $weekNb) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      $timeonothertasks = ($totalforeachweek[$weekNb] - $totalforvisibletasks[$weekNb]);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">if</span> ($timeonothertasks) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        $isdiff = 1;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// There is a diff between total shown on screen and total spent by user, so we add a line with all other cumulated time of user</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span> ($isdiff) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;oddeven othertaskwithtime&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    print <span class="stringliteral">&#39;&lt;td colspan=&quot;&#39;</span>.$colspan.<span class="stringliteral">&#39;&quot; class=&quot;opacitymedium&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    print $langs-&gt;trans(<span class="stringliteral">&quot;OtherFilteredTasks&quot;</span>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">foreach</span> ($TWeek as $weekNb) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      print <span class="stringliteral">&#39;&lt;td class=&quot;center hide&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      $timeonothertasks = ($totalforeachweek[$weekNb] - $totalforvisibletasks[$weekNb]);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">if</span> ($timeonothertasks) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        print <span class="stringliteral">&#39;&lt;span class=&quot;timesheetalreadyrecorded&quot; title=&quot;texttoreplace&quot;&gt;&lt;input type=&quot;text&quot; class=&quot;center smallpadd&quot; size=&quot;2&quot; disabled=&quot;&quot; id=&quot;timespent[-1][&#39;</span>.$weekNb.<span class="stringliteral">&#39;]&quot; name=&quot;task[-1][&#39;</span>.$weekNb.<span class="stringliteral">&#39;]&quot; value=&quot;&#39;</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        print <a class="code" href="../../db/df7/date_8lib_8php.html#acd7ef94d80c3107da4efac7e99bf537f">convertSecondToTime</a>($timeonothertasks, <span class="stringliteral">&#39;allhourmin&#39;</span>);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        print <span class="stringliteral">&#39;&quot;&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    print <span class="stringliteral">&#39; &lt;td class=&quot;liste_total&quot;&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    print <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">if</span> ($conf-&gt;use_javascript_ajax) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    print <span class="stringliteral">&#39;&lt;tr class=&quot;liste_total&quot;&gt;</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="stringliteral">                &lt;td class=&quot;liste_total&quot; colspan=&quot;&#39;</span>.$colspan.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    print $langs-&gt;trans(<span class="stringliteral">&quot;Total&quot;</span>);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    print <span class="stringliteral">&#39;&lt;span class=&quot;opacitymediumbycolor&quot;&gt;  - &#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;ExpectedWorkedHours&quot;</span>).<span class="stringliteral">&#39;: &lt;strong&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a4f4158875f7336eb9999442262e48eee">price</a>($usertoprocess-&gt;weeklyhours, 1, $langs, 0, 0).<span class="stringliteral">&#39;&lt;/strong&gt;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    print <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">foreach</span> ($TWeek as $weekNb) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      print <span class="stringliteral">&#39;&lt;td class=&quot;liste_total hide&#39;</span>.$weekNb.<span class="stringliteral">&#39;&quot; align=&quot;center&quot;&gt;&lt;div class=&quot;totalDay&#39;</span>.$weekNb.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../db/df7/date_8lib_8php.html#acd7ef94d80c3107da4efac7e99bf537f">convertSecondToTime</a>($totalforvisibletasks[$weekNb], <span class="stringliteral">&#39;allhourmin&#39;</span>).<span class="stringliteral">&#39;&lt;/div&gt;&lt;/td&gt;&#39;</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    print <span class="stringliteral">&#39;&lt;td class=&quot;liste_total center&quot;&gt;&lt;div class=&quot;totalDayAll&quot;&gt;&amp;nbsp;&lt;/div&gt;&lt;/td&gt;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral">      &lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  print <span class="stringliteral">&#39;&lt;tr&gt;&lt;td colspan=&quot;15&quot;&gt;&lt;span class=&quot;opacitymedium&quot;&gt;&#39;</span>.$langs-&gt;trans(<span class="stringliteral">&quot;NoAssignedTasks&quot;</span>).<span class="stringliteral">&#39;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;print <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;print <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; id=&quot;numberOfLines&quot; name=&quot;numberOfLines&quot; value=&quot;&#39;</span>.count($tasksarray).<span class="stringliteral">&#39;&quot;/&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;print <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; id=&quot;numberOfFirstLine&quot; name=&quot;numberOfFirstLine&quot; value=&quot;&#39;</span>.(reset($TWeek)).<span class="stringliteral">&#39;&quot;/&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;print <a class="code" href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a>-&gt;buttonsSaveCancel(<span class="stringliteral">&quot;Save&quot;</span>, <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;print <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>.<span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;$modeinput = <span class="stringliteral">&#39;hours&#39;</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keywordflow">if</span> ($conf-&gt;use_javascript_ajax) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  print <span class="stringliteral">&quot;\n&lt;!-- JS CODE TO ENABLE Tooltips on all object with class classfortooltip --&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  print <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  print <span class="stringliteral">&quot;jQuery(document).ready(function () {\n&quot;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  print <span class="stringliteral">&#39;   jQuery(&quot;.timesheetalreadyrecorded&quot;).tooltip({</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral">          show: { collision: &quot;flipfit&quot;, effect:\&#39;toggle\&#39;, delay:50 },</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral">          hide: { effect:\&#39;toggle\&#39;, delay: 50 },</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral">          tooltipClass: &quot;mytooltip&quot;,</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">          content: function () {</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">            return \&#39;&#39;</span>.dol_escape_js($langs-&gt;trans(<span class="stringliteral">&quot;TimeAlreadyRecorded&quot;</span>, $usertoprocess-&gt;getFullName($langs))).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        });<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">  foreach ($TWeek as $week_number) {</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral">    print &#39;</span>    updateTotal(<span class="stringliteral">&#39;.$week_number.&#39;</span>,\<span class="stringliteral">&#39;&#39;</span>.$modeinput.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral">  }</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral">  print &quot;\n});\n&quot;;</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">  print &#39;</span>&lt;/script&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral">llxFooter();</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">$db-&gt;close();</span></div>
<div class="ttc" id="aasterisk_2wrapper_8php_html_a3e1c89b902a5beaa3d5476a09cd591ae"><div class="ttname"><a href="../../d6/d7c/asterisk_2wrapper_8php.html#a3e1c89b902a5beaa3d5476a09cd591ae">llxHeader</a></div><div class="ttdeci">if(!defined('NOREQUIRESOC')) if(!defined('NOREQUIRETRAN')) if(!defined('NOTOKENRENEWAL')) if(!defined('NOREQUIREMENU')) if(!defined('NOREQUIREHTML')) if(!defined('NOREQUIREAJAX')) llxHeader()</div><div class="ttdoc">Empty header.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/asterisk_2wrapper_8php_source.html#l00056">wrapper.php:56</a></div></div>
<div class="ttc" id="aclass_form_company_html"><div class="ttname"><a href="../../d2/d52/class_form_company.html">FormCompany</a></div><div class="ttdoc">Class to build HTML component for third parties management Only common components are here.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df4/html_8formcompany_8class_8php_source.html#l00040">html.formcompany.class.php:41</a></div></div>
<div class="ttc" id="aclass_form_html"><div class="ttname"><a href="../../df/d08/class_form.html">Form</a></div><div class="ttdoc">Class to manage generation of HTML components Only common components must be here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d05/html_8form_8class_8php_source.html#l00052">html.form.class.php:53</a></div></div>
<div class="ttc" id="aclass_form_other_html"><div class="ttname"><a href="../../d0/dbd/class_form_other.html">FormOther</a></div><div class="ttdoc">Classe permettant la generation de composants html autre Only common components are here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dda/html_8formother_8class_8php_source.html#l00039">html.formother.class.php:40</a></div></div>
<div class="ttc" id="aclass_form_projets_html"><div class="ttname"><a href="../../d3/d2f/class_form_projets.html">FormProjets</a></div><div class="ttdoc">Class to manage building of HTML components.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d2b/html_8formprojet_8class_8php_source.html#l00030">html.formprojet.class.php:31</a></div></div>
<div class="ttc" id="aclass_holiday_html"><div class="ttname"><a href="../../dd/d46/class_holiday.html">Holiday</a></div><div class="ttdoc">Class of the module paid holiday.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de6/holiday_8class_8php_source.html#l00034">holiday.class.php:35</a></div></div>
<div class="ttc" id="aclass_project_html"><div class="ttname"><a href="../../d9/d6e/class_project.html">Project</a></div><div class="ttdoc">Class to manage projects.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbf/project_8class_8php_source.html#l00035">project.class.php:36</a></div></div>
<div class="ttc" id="aclass_societe_html"><div class="ttname"><a href="../../dc/dbc/class_societe.html">Societe</a></div><div class="ttdoc">Class to manage third parties objects (customers, suppliers, prospects...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d91/societe_8class_8php_source.html#l00049">societe.class.php:50</a></div></div>
<div class="ttc" id="aclass_task_html"><div class="ttname"><a href="../../d7/d6d/class_task.html">Task</a></div><div class="ttdoc">Class to manage tasks.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d91/task_8class_8php_source.html#l00037">task.class.php:38</a></div></div>
<div class="ttc" id="aclass_user_html"><div class="ttname"><a href="../../d7/d23/class_user.html">User</a></div><div class="ttdoc">Class to manage Dolibarr users.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da1/user_8class_8php_source.html#l00044">user.class.php:45</a></div></div>
<div class="ttc" id="acompta_2index_8php_html_a8c1c24673aed10bb73024203be29cb7a"><div class="ttname"><a href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a></div><div class="ttdeci">if(isModEnabled('facture') &amp;&amp;!empty($user-&gt;rights-&gt;facture-&gt;lire)) if((isModEnabled('fournisseur') &amp;&amp;empty($conf-&gt;global-&gt;MAIN_USE_NEW_SUPPLIERMOD) &amp;&amp; $user-&gt;hasRight(&quot;fournisseur&quot;, &quot;facture&quot;, &quot;lire&quot;))||(isModEnabled('supplier_invoice') &amp;&amp; $user-&gt;hasRight(&quot;supplier_invoice&quot;, &quot;lire&quot;))) if(isModEnabled('don') &amp;&amp;!empty($user-&gt;rights-&gt;don-&gt;lire)) if(isModEnabled('tax') &amp;&amp;!empty($user-&gt;rights-&gt;tax-&gt;charges-&gt;lire)) if(isModEnabled('facture') &amp;&amp;isModEnabled('commande') &amp;&amp; $user-&gt;hasRight(&quot;commande&quot;, &quot;lire&quot;) &amp;&amp;empty($conf-&gt;global-&gt;WORKFLOW_DISABLE_CREATE_INVOICE_FROM_ORDER)) $resql</div><div class="ttdoc">Social contributions to pay.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d3c/compta_2index_8php_source.html#l00745">index.php:745</a></div></div>
<div class="ttc" id="acompta_2localtax_2card_8php_html_aef74eb31fbb3b41977336246033f2c11"><div class="ttname"><a href="../../d3/dda/compta_2localtax_2card_8php.html#aef74eb31fbb3b41977336246033f2c11">$form</a></div><div class="ttdeci">if($cancel &amp;&amp;! $id) if($action=='add' &amp;&amp;! $cancel) if($action=='delete') if($id) $form</div><div class="ttdoc">Actions.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dda/compta_2localtax_2card_8php_source.html#l00143">card.php:143</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_a00bc14984f4a3fdf8e888b3d77da7cd4"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#a00bc14984f4a3fdf8e888b3d77da7cd4">dol_get_prev_month</a></div><div class="ttdeci">dol_get_prev_month($month, $year)</div><div class="ttdoc">Return previous month.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l00494">date.lib.php:494</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_a4ae6f9a007d4478581d6ff6290b0438a"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#a4ae6f9a007d4478581d6ff6290b0438a">getLastDayOfEachWeek</a></div><div class="ttdeci">getLastDayOfEachWeek($TWeek, $year)</div><div class="ttdoc">Return array of last day of weeks.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l01150">date.lib.php:1150</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_a4fea7beb2f8758564f685f77bf82de13"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#a4fea7beb2f8758564f685f77bf82de13">getWeekNumbersOfMonth</a></div><div class="ttdeci">getWeekNumbersOfMonth($month, $year)</div><div class="ttdoc">Return array of week numbers.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l01115">date.lib.php:1115</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_a7c39820fee49acf547acc6c1f6e7dd73"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#a7c39820fee49acf547acc6c1f6e7dd73">getFirstDayOfEachWeek</a></div><div class="ttdeci">getFirstDayOfEachWeek($TWeek, $year)</div><div class="ttdoc">Return array of first day of weeks.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l01132">date.lib.php:1132</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_a9718e5c28e7294b7c91c676285f13ebc"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#a9718e5c28e7294b7c91c676285f13ebc">dol_get_next_month</a></div><div class="ttdeci">dol_get_next_month($month, $year)</div><div class="ttdoc">Return next month.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l00513">date.lib.php:513</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_ab10404fd55a936c0ce185c415d40f546"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#ab10404fd55a936c0ce185c415d40f546">dol_time_plus_duree</a></div><div class="ttdeci">dol_time_plus_duree($time, $duration_value, $duration_unit, $ruleforendofmonth=0)</div><div class="ttdoc">Add a delay to a date.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l00121">date.lib.php:121</a></div></div>
<div class="ttc" id="adate_8lib_8php_html_acd7ef94d80c3107da4efac7e99bf537f"><div class="ttname"><a href="../../db/df7/date_8lib_8php.html#acd7ef94d80c3107da4efac7e99bf537f">convertSecondToTime</a></div><div class="ttdeci">convertSecondToTime($iSecond, $format='all', $lengthOfDay=86400, $lengthOfWeek=7)</div><div class="ttdoc">Return, in clear text, value of a number of seconds in days, hours and minutes.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/date_8lib_8php_source.html#l00238">date.lib.php:238</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a09ae0028df30935f6a6f7d5ae05f42bd"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a></div><div class="ttdeci">dol_mktime($hour, $minute, $second, $month, $day, $year, $gm='auto', $check=1)</div><div class="ttdoc">Return a timestamp date built from detailed informations (by default a local PHP server timestamp) Re...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02828">functions.lib.php:2828</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a171b010d7ac532414a9027d005f16f78"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a171b010d7ac532414a9027d005f16f78">dol_get_fiche_head</a></div><div class="ttdeci">dol_get_fiche_head($links=array(), $active='', $title='', $notab=0, $picto='', $pictoisfullpath=0, $morehtmlright='', $morecss='', $limittoshow=0, $moretabssuffix='')</div><div class="ttdoc">Show tabs of a record.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01841">functions.lib.php:1841</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a2583c8c1e7ad5e59aad0f205c13ff2a0"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a2583c8c1e7ad5e59aad0f205c13ff2a0">dol_escape_htmltag</a></div><div class="ttdeci">dol_escape_htmltag($stringtoescape, $keepb=0, $keepn=0, $noescapetags='', $escapeonlyhtmltags=0)</div><div class="ttdoc">Returns text escaped for inclusion in HTML alt or title tags, or into values of HTML input fields.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01476">functions.lib.php:1476</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a39a0441491a380f7f9fe07ee296cd2fa"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a39a0441491a380f7f9fe07ee296cd2fa">dol_print_error</a></div><div class="ttdeci">dol_print_error($db='', $error='', $errors=null)</div><div class="ttdoc">Displays error message system with all the information to facilitate the diagnosis and the escalation...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04956">functions.lib.php:4956</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a43ed6679bd4b390f7b120bf848d5acf9"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a43ed6679bd4b390f7b120bf848d5acf9">dol_get_fiche_end</a></div><div class="ttdeci">dol_get_fiche_end($notab=0)</div><div class="ttdoc">Return tab footer of a card.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02037">functions.lib.php:2037</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a46f24284833ccc2de3a8a0d703293287"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a46f24284833ccc2de3a8a0d703293287">natural_search</a></div><div class="ttdeci">natural_search($fields, $value, $mode=0, $nofirstand=0)</div><div class="ttdoc">Generate natural SQL search string for a criteria (this criteria can be tested on one or several fiel...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l09717">functions.lib.php:9717</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4a25c44d5cda2ec236161511fadde188"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4a25c44d5cda2ec236161511fadde188">setEventMessages</a></div><div class="ttdeci">setEventMessages($mesg, $mesgs, $style='mesgs', $messagekey='')</div><div class="ttdoc">Set event messages in dol_events session object.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l08411">functions.lib.php:8411</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a4f4158875f7336eb9999442262e48eee"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a4f4158875f7336eb9999442262e48eee">price</a></div><div class="ttdeci">price($amount, $form=0, $outlangs='', $trunc=1, $rounding=-1, $forcerounding=-1, $currency_code='')</div><div class="ttdoc">Function to format a value into an amount for visual output Function used into PDF and HTML pages.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l05660">functions.lib.php:5660</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a5e66578bb4ca51676bad5d37e19e7e1a"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a></div><div class="ttdeci">dol_now($mode='auto')</div><div class="ttdoc">Return date for now.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02916">functions.lib.php:2916</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a64fc44ee4f3329fe0ff256b57bffc128"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a></div><div class="ttdeci">img_picto($titlealt, $picto, $moreatt='', $pictoisfullpath=false, $srconly=0, $notitle=0, $alt='', $morecss='', $marginleftonlyshort=2)</div><div class="ttdoc">Show picto whatever it's its name (generic function)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03989">functions.lib.php:3989</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a7714b3b2f906a438f3273a07b76135ed"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a7714b3b2f906a438f3273a07b76135ed">img_previous</a></div><div class="ttdeci">img_previous($titlealt='default', $moreatt='')</div><div class="ttdoc">Show previous logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04688">functions.lib.php:4688</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a97dc8c4d4db97a060f48e220a1f9f293"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a97dc8c4d4db97a060f48e220a1f9f293">GETPOST</a></div><div class="ttdeci">GETPOST($paramname, $check='alphanohtml', $method=0, $filter=null, $options=null, $noreplace=0)</div><div class="ttdoc">Return value of a param into GET or POST supervariable.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00517">functions.lib.php:517</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ac655dc67c8d9e44c12dbb4ae8508a688"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ac655dc67c8d9e44c12dbb4ae8508a688">img_next</a></div><div class="ttdeci">img_next($titlealt='default', $moreatt='')</div><div class="ttdoc">Show next logo.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l04669">functions.lib.php:4669</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ac863120bf29caa349dd610383aae275e"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ac863120bf29caa349dd610383aae275e">dol_trunc</a></div><div class="ttdeci">dol_trunc($string, $size=40, $trunc='right', $stringencoding='UTF-8', $nodot=0, $display=0)</div><div class="ttdoc">Truncate a string to a particular length adding '‚Ä¶' if string larger than length.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03914">functions.lib.php:3914</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_aca64a844ce2ad30d4fc49cd4b957cbdf"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#aca64a844ce2ad30d4fc49cd4b957cbdf">GETPOSTISSET</a></div><div class="ttdeci">GETPOSTISSET($paramname)</div><div class="ttdoc">Return true if we are in a context of submitting the parameter $paramname from a POST of a form.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00418">functions.lib.php:418</a></div></div>
<div class="ttc" id="aproject_8lib_8php_html_a105603ea6d6663c0a689251f2a3efa2e"><div class="ttname"><a href="../../de/d0a/project_8lib_8php.html#a105603ea6d6663c0a689251f2a3efa2e">projectLinesPerMonth</a></div><div class="ttdeci">projectLinesPerMonth(&amp;$inc, $firstdaytoshow, $fuser, $parent, $lines, &amp;$level, &amp;$projectsrole, &amp;$tasksrole, $mine, $restricteditformytask, &amp;$isavailable, $oldprojectforbreak=0, $TWeek=array())</div><div class="ttdoc">Output a task line into a perday intput mode.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d0a/project_8lib_8php_source.html#l02118">project.lib.php:2118</a></div></div>
<div class="ttc" id="aproject_8lib_8php_html_a87fe451720c4c52263d6bb3266faac30"><div class="ttname"><a href="../../de/d0a/project_8lib_8php.html#a87fe451720c4c52263d6bb3266faac30">project_timesheet_prepare_head</a></div><div class="ttdeci">project_timesheet_prepare_head($mode, $fuser=null)</div><div class="ttdoc">Prepare array with list of tabs.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d0a/project_8lib_8php_source.html#l00457">project.lib.php:457</a></div></div>
<div class="ttc" id="asecurity_8lib_8php_html_a66e46f88bd5c0e08d6f2119178ca11b8"><div class="ttname"><a href="../../dd/df3/security_8lib_8php.html#a66e46f88bd5c0e08d6f2119178ca11b8">restrictedArea</a></div><div class="ttdeci">restrictedArea(User $user, $features, $object=0, $tableandshare='', $feature2='', $dbt_keyfield='fk_soc', $dbt_select='rowid', $isdraft=0, $mode=0)</div><div class="ttdoc">Check permissions of a user to show a page and an object.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df3/security_8lib_8php_source.html#l00337">security.lib.php:337</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- 
File added into doxygen generated documentation
-->
<hr class="footer" />
<address class="footer"><small>Generated on Mon Jan 2 2023 14:21:45 for <a href="https://www.dolibarr.org" title="ERP and CRM open source software">dolibarr</a> by Doxygen 1.9.1 </small></address>
<br>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9049390-16"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-9049390-16');
</script>
</body>
</html>