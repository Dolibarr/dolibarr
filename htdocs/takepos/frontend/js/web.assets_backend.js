
/* /base/static/src/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('base.settings',function(require){"use strict";var core=require('web.core');var config=require('web.config');var FormView=require('web.FormView');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var view_registry=require('web.view_registry');var QWeb=core.qweb;var BaseSettingRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .tab':'_onSettingTabClick','keyup .searchInput':'_onKeyUpSearch',}),init:function(){this._super.apply(this,arguments);this.activeView=false;this.activeTab=false;},start:function(){this._super.apply(this,arguments);if(config.device.isMobile){core.bus.on("DOM_updated",this,function(){this._moveToTab(this.currentIndex||this._currentAppIndex());});}},_initModules:function(){var self=this;this.modules=[];_.each(this.$('.app_settings_block'),function(settingView,index){var group=!$(settingView).hasClass('o_invisible_modifier');var isNotApp=$(settingView).hasClass('o_not_app');if(group&&!isNotApp){var data=$(settingView).data();data.string=$(settingView).attr('string')||data.string;self.modules.push({key:data.key,string:data.string,imgurl:self._getAppIconUrl(data.key),});}else{$(settingView).remove();}});},_initSearch:function(){this.searchInput=this.$('.searchInput');if(this.searchText){this.searchInput.val(this.searchText);this._onKeyUpSearch();}else{this.searchText="";}},_activateSettingMobileTab:function(currentTab){var self=this;var moveTo=currentTab;var next=moveTo+1;var previous=moveTo-1;this.$(".settings .app_settings_block").removeClass("previous next current before after");this.$(".settings_tab .tab").removeClass("previous next current before after");_.each(this.modules,function(module,index){var tab=self.$(".tab[data-key='"+module.key+"']");var view=module.settingView;if(index===previous){tab.addClass("previous");tab.css("margin-left","0px");view.addClass("previous");}else if(index===next){tab.addClass("next");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("next");}else if(index<moveTo){tab.addClass("before");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("before");}else if(index===moveTo){var marginLeft=tab.outerWidth()/2;tab.css("margin-left","-"+marginLeft+"px");tab.addClass("current");view.addClass("current");}else if(index>moveTo){tab.addClass("after");tab.css("margin-left","0");view.addClass("after");}});},_currentAppIndex:function(){var self=this;var index=_.findIndex(this.modules,function(module){return module.key===self.activeSettingTab;});return index;},_getAppIconUrl:function(module){return module==="general_settings"?"/base/static/description/settings.png":"/"+module+"/static/description/icon.png";},_getSearchHeader:function(imgurl,string){return $(QWeb.render('BaseSetting.SearchHeader',{imgurl:imgurl,string:string}));},_handleAttributes:function($el,node){this._super.apply(this,arguments);if(node.attrs.placeholder){$el.attr('placeholder',node.attrs.placeholder);}},_moveToTab:function(index){this.currentIndex=!index||index===-1?0:(index===this.modules.length?index-1:index);if(this.currentIndex!==-1){if(this.activeView){this.activeView.addClass("o_hidden");}
if(this.activeTab){this.activeTab.removeClass("selected");}
var view=this.modules[this.currentIndex].settingView;var tab=this.$(".tab[data-key='"+this.modules[this.currentIndex].key+"']");view.removeClass("o_hidden");this.activeView=view;this.activeTab=tab;if(config.device.isMobile){this._activateSettingMobileTab(this.currentIndex);}else{tab.addClass("selected");}}},_onSettingTabClick:function(event){if(this.searchText.length>0){this.searchInput.val('');this.searchText="";this._searchSetting();}
var settingKey=this.$(event.currentTarget).data('key');this._moveToTab(_.findIndex(this.modules,function(m){return m.key===settingKey;}));},_onKeyUpSearch:function(event){this.searchText=this.searchInput.val();this.activeTab.removeClass('selected');if(config.device.isMobile){this.$('.settings_tab').addClass('o_hidden');this.$('.settings').addClass('d-block');}
this._searchSetting();},_resetSearch:function(){this.searchInput.val("");_.each(this.modules,function(module){module.settingView.addClass('o_hidden');module.settingView.find('.o_setting_box').removeClass('o_hidden');module.settingView.find('h2').removeClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').addClass('mt16');});this.activeTab.removeClass('o_hidden').addClass('selected');this.activeView.removeClass('o_hidden');if(config.device.isMobile){this.$('.settings_tab').removeClass('o_hidden');this.$('.settings').removeClass('d-block');}},_render:function(){var res=this._super.apply(this,arguments);if(!this.modules){this._initModules();}
this._renderLeftPanel();this._initSearch();return res;},_renderLeftPanel:function(){var self=this;_.each(this.modules,function(module){module.settingView=self.$('.app_settings_block[data-key="'+module.key+'"]');module.settingView.addClass("o_hidden");module.settingView.prepend(self._getSearchHeader(module.imgurl,module.string));});this._renderTabs();this._moveToTab(this.currentIndex||this._currentAppIndex());},_renderTabs:function(){var tabs=$(QWeb.render('BaseSetting.Tabs',{tabItems:this.modules}));tabs.appendTo(this.$(".settings_tab"));},_searchSetting:function(){var self=this;this.count=0;_.each(this.modules,function(module){self.inVisibleCount=0;module.settingView.find('.o_setting_box').addClass('o_hidden');module.settingView.find('h2').addClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').removeClass('mt16');var resultSetting=module.settingView.find("label:containsTextLike('"+self.searchText+"')");if(resultSetting.length>0){resultSetting.each(function(){var settingBox=$(this).closest('.o_setting_box');if(!settingBox.hasClass('o_invisible_modifier')){settingBox.removeClass('o_hidden');$(this).html(self._wordHighlighter($(this).html(),self.searchText));}else{self.inVisibleCount++;}});if(self.inVisibleCount!==resultSetting.length){module.settingView.find('.settingSearchHeader').removeClass('o_hidden');module.settingView.removeClass('o_hidden');}}else{++self.count;}});this.count===_.size(this.modules)?this.$('.notFound').removeClass('o_hidden'):this.$('.notFound').addClass('o_hidden');if(this.searchText.length===0){this._resetSearch();}},_wordHighlighter:function(text,word){if(text.indexOf('highlighter')!==-1){text=text.replace('<span class="highlighter">',"");text=text.replace("</span>","");}
var match=text.search(new RegExp(word,"i"));word=text.substring(match,match+word.length);var hilitedWord="<span class='highlighter'>"+word+'</span>';return text.replace(word,hilitedWord);},});var BaseSettingController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{}),init:function(){this._super.apply(this,arguments);this.renderer.activeSettingTab=this.initialState.context.module;},});var BaseSettingView=FormView.extend({config:_.extend({},FormView.prototype.config,{Renderer:BaseSettingRenderer,Controller:BaseSettingController,}),getRenderer:function(parent,state){return new BaseSettingRenderer(parent,state,this.rendererParams);}});view_registry.add('base_settings',BaseSettingView);return{Renderer:BaseSettingRenderer,Controller:BaseSettingController,};});;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){if(pattern[patternIdx]===' '){currScore=1-idx/200;}else{currScore+=1+currScore-idx/200;}
ch=pre+ch+post;patternIdx+=1;}else{currScore=0;}
totalScore+=currScore;if(compareString[idx]===' '){currScore=0;}
result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["web","base","bus","web_tour","mail","product","barcodes","web_planner","stock","web_editor","point_of_sale","portal","account","account_bank_statement_import","auth_signup","base_import","iap","l10n_es","payment","payment_transfer","sms","web_diagram","web_kanban_gauge","web_settings_dashboard"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^']*)'",'([uU])?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:(m[3]!==undefined?m[3]:m[5])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/core/domain.js defined in bundle 'web.assets_backend' */
odoo.define("web.Domain",function(require){"use strict";var collections=require("web.collections");var pyeval=require("web.pyeval");var Domain=collections.Tree.extend({init:function(domain,evalContext){this._super.apply(this,arguments);if(_.isArray(domain)||_.isString(domain)){this._parse(this.normalizeArray(_.clone(this.stringToArray(domain,evalContext))));}else{this._data=!!domain;}},compute:function(values){if(this._data===true||this._data===false){return this._data;}else if(_.isArray(this._data)){var isParentField=false;var fieldName=this._data[0];var parentField=this._data[0].split('.');if('parent'in values&&parentField.length===2){fieldName=parentField[1];isParentField=parentField[0]==='parent'&&fieldName in values.parent;}
if(!(this._data[0]in values)&&!(isParentField)){throw new Error(_.str.sprintf("Unknown field %s in domain",this._data[0]));}
var fieldValue;if(!isParentField){fieldValue=values[fieldName];}else{fieldValue=values.parent[fieldName];}
switch(this._data[1]){case"=":case"==":return _.isEqual(fieldValue,this._data[2]);case"!=":case"<>":return!_.isEqual(fieldValue,this._data[2]);case"<":return(fieldValue<this._data[2]);case">":return(fieldValue>this._data[2]);case"<=":return(fieldValue<=this._data[2]);case">=":return(fieldValue>=this._data[2]);case"in":return _.contains(_.isArray(this._data[2])?this._data[2]:[this._data[2]],fieldValue);case"not in":return!_.contains(_.isArray(this._data[2])?this._data[2]:[this._data[2]],fieldValue);case"like":return(fieldValue.toLowerCase().indexOf(this._data[2].toLowerCase())>=0);case"ilike":return(fieldValue.indexOf(this._data[2])>=0);default:throw new Error(_.str.sprintf("Domain %s uses an unsupported operator",this._data));}}else{switch(this._data){case"&":return _.every(this._children,function(child){return child.compute(values);});case"|":return _.some(this._children,function(child){return child.compute(values);});case"!":return!this._children[0].compute(values);}}},toArray:function(){if(this._data===false){throw new Error("'false' domain cannot be converted to array");}else if(this._data===true){return[];}else{var arr=[this._data];return arr.concat.apply(arr,_.map(this._children,function(child){return child.toArray();}));}},toString:function(){return Domain.prototype.arrayToString(this.toArray());},_parse:function(domain){this._data=(domain.length===0?true:domain[0]);if(domain.length<=1)return;var expected=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){expected++;}else if(domain[i]!=="!"){expected--;}
if(!expected){i++;this._addSubdomain(domain.slice(1,i));this._addSubdomain(domain.slice(i));break;}}},_addSubdomain:function(domain){if(!domain.length)return;var subdomain=new Domain(domain);if(!subdomain._children.length||subdomain._data!==this._data){this._children.push(subdomain);}else{var self=this;_.each(subdomain._children,function(childDomain){self._children.push(childDomain);});}},arrayToString:function(domain){if(_.isString(domain))return domain;return JSON.stringify(domain||[]).replace(/null/g,"None").replace(/false/g,"False").replace(/true/g,"True");},stringToArray:function(domain,evalContext){if(!_.isString(domain))return _.clone(domain);return pyeval.eval("domain",domain?domain.replace(/%%/g,'%'):"[]",evalContext);},normalizeArray:function(domain){var expected=1;_.each(domain,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});if(expected<0){domain.unshift.apply(domain,_.times(Math.abs(expected),_.constant("&")));}
return domain;},});return Domain;});;

/* /web/static/src/js/core/pyeval.js defined in bundle 'web.assets_backend' */
odoo.define('web.pyeval',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var _t=core._t;var py=window.py;var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;utils.divmod(n,DI400Y,function(_n400,n){n400=_n400;utils.divmod(n,DI100Y,function(_n100,n){n100=_n100;utils.divmod(n,DI4Y,function(_n4,n){n4=_n4;utils.divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){utils.assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);utils.assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){utils.divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){utils.divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){utils.divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){utils.divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){utils.divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=utils.modf(days,function(dayfrac,days){d=days;if(dayfrac){return utils.modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=utils.modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;utils.divmod(microseconds,1000000,function(seconds,microseconds){utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;utils.divmod(this.seconds,60,function(m,s){utils.divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days,this.hour,this.minute,this.second+other.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
return py.NotImplemented;},fromJSON:function(year,month,day,hour,minute,second){return py.PY_call(datetime.datetime,[year,month,day,hour,minute,second]);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});function context_today(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day '
+'years months weeks days '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':return[arg,zero];case'year':case'month':case'day':case'weekday':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0);},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var self=this;var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;utils.divmod(months*s,12,function(years,months){self.ops.months=py.float.fromJSON(months*s);self.ops.years=py.float.fromJSON(asJS(self.ops.years)+years*s);});}
this._has_time=0;},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days)}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday});}});function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function pycontext(){return{datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),};}
function pyeval(type,object,context){context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context'){object=[object];}
return eval_contexts(object,context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return{context:pyeval('contexts',source.contexts||[],source.eval_context),domain:pyeval('domains',source.domains,source.eval_context),group_by:pyeval('groupbys',source.group_by_seq||[],source.eval_context),};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,py_eval:py_eval,};});;

/* /web/static/src/js/chrome/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var Bus=require('web.Bus');var ControlPanel=require('web.ControlPanel');var Context=require('web.Context');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var dom=require('web.dom');var framework=require('web.framework');var pyeval=require('web.pyeval');var session=require('web.session');var ViewManager=require('web.ViewManager');var Widget=require('web.Widget');var Action=core.Class.extend({init:function(action){this.action_descr=action;this.title=action.display_name||action.name;},restore:function(){if(this.on_reverse_breadcrumb_callback){return this.on_reverse_breadcrumb_callback();}},detach:function(){},destroy:function(){},set_on_reverse_breadcrumb:function(callback){this.on_reverse_breadcrumb_callback=callback;},setScrollTop:function(){},set_fragment:function($fragment){this.$fragment=$fragment;},getScrollTop:function(){return 0;},get_action_descr:function(){return this.action_descr;},get_breadcrumbs:function(){return{title:this.title,action:this};},get_nb_views:function(){return 0;},get_fragment:function(){return this.$fragment;},get_active_view:function(){return'';},});var WidgetAction=Action.extend({init:function(action,widget){this._super(action);this.widget=widget;if(!this.widget.get('title')){this.widget.set('title',this.title);}
this.widget.on('change:title',this,function(widget){this.title=widget.get('title');});},restore:function(){var self=this;return $.when(this._super()).then(function(){return self.widget.do_show();});},detach:function(){$('body > .nvtooltip').remove();return dom.detach([{widget:this.widget}]);},destroy:function(){this.widget.destroy();},});var ViewManagerAction=WidgetAction.extend({restore:function(view_index){var _super=this._super.bind(this);return this.widget.select_view(view_index).then(function(){return _super();});},set_on_reverse_breadcrumb:function(callback,scrollTop){this._super(callback);this.setScrollTop(scrollTop);},setScrollTop:function(scrollTop){var activeView=this.widget.active_view;var viewController=activeView&&activeView.controller;if(viewController){viewController.setScrollTop(scrollTop);}},getScrollTop:function(){var activeView=this.widget.active_view;var viewController=activeView&&activeView.controller;return viewController?viewController.getScrollTop():0;},get_breadcrumbs:function(){var self=this;return this.widget.view_stack.map(function(view,index){return{title:view.controller&&view.controller.get('title')||self.title,index:index,action:self,};});},get_nb_views:function(){return this.widget.view_stack.length;},get_active_view:function(){return this.widget.active_view.type;}});var ActionManager=Widget.extend({template:'ActionManager',on_attach_callback:function(){this.is_in_DOM=true;if(this.inner_widget&&this.inner_widget.on_attach_callback){this.inner_widget.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;if(this.inner_widget&&this.inner_widget.on_detach_callback){this.inner_widget.on_detach_callback();}},init:function(parent,options){this._super(parent);this.action_stack=[];this.inner_action=null;this.inner_widget=null;this.webclient=options&&options.webclient;this.dialog=null;this.dialog_widget=null;this.on('history_back',this,this.proxy('history_back'));},start:function(){this._super();this.main_control_panel=new ControlPanel(this);this.main_control_panel.on("on_breadcrumb_click",this,_.debounce(function(action,index){this.select_action(action,index);},200,true));core.bus.on('DOM_updated',this,function(){if(this.inner_action&&!$('.dialog').length){this.trigger_up('scrollTo',{offset:this.inner_action.getScrollTop()||0});}});return this.main_control_panel.insertBefore(this.$el);},dialog_stop:function(reason){if(this.dialog){this.dialog.destroy(reason);}
this.dialog=null;},push_action:function(widget,action_descr,options){var self=this;var old_action_stack=this.action_stack;var old_action=this.inner_action;var old_widget=this.inner_widget;var actions_to_destroy;options=options||{};if(options.clear_breadcrumbs){actions_to_destroy=this.action_stack;this.action_stack=[];}else if(options.replace_last_action&&this.action_stack.length>0){actions_to_destroy=[this.action_stack.pop()];}
var new_action;if(widget instanceof ViewManager){new_action=new ViewManagerAction(action_descr,widget);}else if(widget instanceof Widget){new_action=new WidgetAction(action_descr,widget);}else{new_action=new Action(action_descr);}
if(this.webclient&&old_action){old_action.set_on_reverse_breadcrumb(options.on_reverse_breadcrumb,this.webclient.getScrollTop());}
this.action_stack.push(new_action);this.inner_action=new_action;this.inner_widget=widget;if(widget.need_control_panel){widget.set_cp_bus(this.main_control_panel.get_bus());}
var new_widget_fragment=document.createDocumentFragment();return $.when(this.inner_widget.appendTo(new_widget_fragment)).done(function(){if(old_action){old_action.set_fragment(old_action.detach());}
if(!widget.need_control_panel){self.main_control_panel.do_hide();}
self.$el.empty();dom.append(self.$el,new_widget_fragment,{in_DOM:self.is_in_DOM,callbacks:[{widget:self.inner_widget}],});if(actions_to_destroy){self.clear_action_stack(actions_to_destroy);}
self.toggle_fullscreen();self.trigger_up('current_action_updated',{action:new_action});}).fail(function(){new_action.destroy();self.action_stack=old_action_stack;self.inner_action=old_action;self.inner_widget=old_widget;});},setScrollTop:function(scrollTop){if(this.inner_action){this.inner_action.setScrollTop(scrollTop);}},get_breadcrumbs:function(){return _.flatten(_.map(this.action_stack,function(action){return action.get_breadcrumbs();}),true);},get_title:function(){if(this.action_stack.length===1){var action=this.action_stack[0];if(action.get_breadcrumbs().length===1){return action.title;}}
var last_breadcrumb=_.last(this.get_breadcrumbs());return last_breadcrumb?last_breadcrumb.title:"";},get_action_stack:function(){return this.action_stack;},get_inner_action:function(){return this.inner_action;},get_inner_widget:function(){return this.inner_widget;},history_back:function(){if(this.dialog){this.dialog.close();return;}
var nbViews=this.inner_action.get_nb_views();if(nbViews>1){return this.select_action(this.inner_action,nbViews-2);}
var nbActions=this.action_stack.length;if(nbActions>1){var action=this.action_stack[nbActions-2];nbViews=action.get_nb_views();return this.select_action(action,nbViews-1);}
else if(nbActions===1&&nbViews===1){return this.select_action(this.action_stack[0],0);}
return $.Deferred().reject();},select_action:function(action,index){var self=this;var def=this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){var old_action=self.inner_action;var action_index=self.action_stack.indexOf(action);var to_destroy=self.action_stack.splice(action_index+1);self.inner_action=action;self.inner_widget=action.widget;return $.when(action.restore(index)).done(function(){if(!self.inner_widget.need_control_panel){self.main_control_panel.do_hide();}
if(action!==old_action){self.clear_action_stack(to_destroy);dom.append(self.$el,action.get_fragment(),{in_DOM:self.is_in_DOM,callbacks:[{widget:action.widget}],});}
self.trigger_up('current_action_updated',{action:action});});}).fail(function(){return $.Deferred().reject();});},clear_action_stack:function(action_stack){_.map(action_stack||this.action_stack,function(action){action.destroy();});if(!action_stack){this.action_stack=[];this.inner_action=null;this.inner_widget=null;}
this.toggle_fullscreen();},toggle_fullscreen:function(){var is_fullscreen=_.some(this.action_stack,function(action){return action.action_descr.target==="fullscreen";});this.trigger_up("toggle_fullscreen",{fullscreen:is_fullscreen});},do_push_state:function(state){if(!this.webclient||this.dialog){return;}
state=state||{};if(this.inner_action){var inner_action_descr=this.inner_action.get_action_descr();if(inner_action_descr._push_me===false){return;}
state.title=this.get_title();if(inner_action_descr.type=='ir.actions.act_window'){state.model=inner_action_descr.res_model;}
if(inner_action_descr.menu_id){state.menu_id=inner_action_descr.menu_id;}
if(inner_action_descr.id){state.action=inner_action_descr.id;}else if(inner_action_descr.type=='ir.actions.client'){state.action=inner_action_descr.tag;var params={};_.each(inner_action_descr.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(inner_action_descr.context){var active_id=inner_action_descr.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=inner_action_descr.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=inner_action_descr.context.active_ids.join(',');}}}
this.webclient.do_push_state(state);},do_load_state:function(state,warm){var self=this;var action_loaded;if(state.action){if(_.isString(state.action)&&core.action_registry.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};if(warm){this.null_action();}
action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
add_context.params=state;if(warm){this.null_action();}
action_loaded=this.do_action(state.action,{additional_context:add_context,res_id:state.id,view_type:state.view_type,});}}}else if(state.model&&state.id){if(warm){this.null_action();}
var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[_.isNumber(state.view_id)?state.view_id:false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){if(warm){this.null_action();}
action_loaded=this._rpc({route:'/web/session/get_session_action',params:{key:state.sa},}).then(function(action){if(action){return self.do_action(action);}});}
return $.when(action_loaded||null).then(function(){if(self.inner_widget&&self.inner_widget.do_load_state){return self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,replace_last_action:false,on_reverse_breadcrumb:function(){},hide_breadcrumb:false,on_close:function(){},on_load:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&core.action_registry.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;var additional_context={active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model};return data_manager.load_action(action,additional_context).then(function(result){return self.do_action(result,options);});}
core.bus.trigger('action',action);options.clear_breadcrumbs=(action.target==='main')||options.clear_breadcrumbs;var user_context=this.getSession().user_context;var ncontext=new Context(user_context,options.additional_context,action.context||{});action.context=pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');action.menu_id=options.action_menu_id;action.res_id=options.res_id||action.res_id;action.context.params=_.extend({'action':action.id},action.context.params);if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{headless:true,views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}else{var popup=action.target==='new';var inline=action.target==='inline'||action.target==='inlineview';var form=_.str.startsWith(action.view_mode,'form');action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!(popup&&form)&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:(!popup||!form)&&!inline,display_title:!popup,headless:(popup||inline)&&form,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters,});}
return $.when(this[type](action,options)).then(function(executor_action){options.on_load(executor_action);return action;});},null_action:function(){this.dialog_stop();this.clear_action_stack();},ir_actions_common:function(executor,options){var self=this;if(executor.action.target==='new'){var pre_dialog=(this.dialog&&!this.dialog.isDestroyed())?this.dialog:null;if(pre_dialog){pre_dialog.off('closed',null,pre_dialog.on_close);}
if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop(executor.action);this.dialog=new Dialog(this,_.defaults(options||{},{title:executor.action.name,dialogClass:executor.klass,buttons:[],size:executor.action.context.dialog_size,}));this.dialog.on_close=function(){options.on_close.apply(null,arguments);if(pre_dialog&&pre_dialog.on_close){pre_dialog.on_close();}
if(!pre_dialog){self.dialog=null;}};this.dialog.on("closed",null,this.dialog.on_close);this.dialog_widget=executor.widget();var $dialogFooter;if(this.dialog_widget instanceof ViewManager){executor.action.viewManager=this.dialog_widget;$dialogFooter=$('<div/>');_.defaults(this.dialog_widget.flags,{$buttons:$dialogFooter,footer_to_buttons:true,});if(this.dialog_widget.action.view_mode==='form'){this.dialog_widget.flags.headless=true;}}
if(this.dialog_widget.need_control_panel){this.dialog_widget.set_cp_bus(new Bus());}
this.dialog_widget.setParent(this.dialog);var fragment=document.createDocumentFragment();return this.dialog_widget.appendTo(fragment).then(function(){var def=$.Deferred();self.dialog.opened().then(function(){dom.append(self.dialog.$el,fragment,{in_DOM:true,callbacks:[{widget:self.dialog_widget}],});if($dialogFooter){self.dialog.$footer.empty().append($dialogFooter.contents());}
if(options.state&&self.dialog_widget.do_load_state){return self.dialog_widget.do_load_state(options.state);}}).done(def.resolve.bind(def)).fail(def.reject.bind(def));self.dialog.open();return def;}).then(function(){return executor.action;});}
var def=this.inner_action&&this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){self.dialog_stop(executor.action);return self.push_action(executor.action.viewManager=executor.widget(),executor.action,options).then(function(){return executor.action;});}).fail(function(){return $.Deferred().reject();});},ir_actions_act_window:function(action,options){var self=this;var flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
options.action=action;options.action_manager=this;var dataset=new data.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
var views=action.views;return this.ir_actions_common({widget:function(){return new ViewManager(self,dataset,views,flags,options);},action:action,klass:'o_act_window',},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=core.action_registry.get(action.tag);if(!ClientWidget){return self.do_warn("Action Error","Could not find client action '"+action.tag+"'.");}
if(!(ClientWidget.prototype instanceof Widget)){var next;if((next=ClientWidget(this,action))){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action,options);},action:action,klass:'oe_act_client',},options).then(function(){if(action.tag!=='reload'){self.do_push_state({});}});},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();if(action.effect){this.trigger_up('show_effect',action.effect);}
return $.when();},ir_actions_server:function(action,options){var self=this;return this._rpc({route:'/web/action/run',params:{action_id:action.id,context:action.context||{}},}).then(function(action){return self.do_action(action,options);});},ir_actions_act_url:function(action,options){var url=action.url;if(session.debug&&url&&url.length&&url[0]==='/'){url=$.param.querystring(url,{debug:session.debug});}
if(action.target==='self'){framework.redirect(url);return $.Deferred();}else{window.open(url,'_blank');options.on_close();}
return $.when();},});return ActionManager;});;

/* /web/static/src/js/chrome/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelMixin',function(require){"use strict";var ControlPanelMixin={need_control_panel:true,set_cp_bus:function(cp_bus){this.cp_bus=cp_bus;},update_control_panel:function(cp_status,options){this.cp_bus.trigger("update",cp_status||{},options||{});},};return ControlPanelMixin;});odoo.define('web.ControlPanel',function(require){"use strict";var Bus=require('web.Bus');var data=require('web.data');var Widget=require('web.Widget');var ControlPanel=Widget.extend({template:'ControlPanel',init:function(parent,template){this._super(parent);if(template){this.template=template;}
this.bus=new Bus(this);this.bus.on("update",this,this.update);},start:function(){this.nodes={$breadcrumbs:this.$('.breadcrumb'),$buttons:this.$('.o_cp_buttons'),$pager:this.$('.o_cp_pager'),$searchview:this.$('.o_cp_searchview'),$searchview_buttons:this.$('.o_search_options'),$sidebar:this.$('.o_cp_sidebar'),$switch_buttons:this.$('.o_cp_switch_buttons'),};this.$el.on('click.bs.dropdown','.o_search_options .dropdown-menu',function(e){e.stopPropagation();});this._toggle_visibility(false);return this._super();},destroy:function(){this._clear_breadcrumbs_handlers();return this._super.apply(this,arguments);},get_bus:function(){return this.bus;},update:function(status,options){this._toggle_visibility(!status.hidden);if(!status.hidden){options=_.defaults({},options,{clear:true,});var new_cp_content=status.cp_content||{};if(status.breadcrumbs){this._clear_breadcrumbs_handlers();this.$breadcrumbs=this._render_breadcrumbs(status.breadcrumbs);new_cp_content.$breadcrumbs=this.$breadcrumbs;}
if(options.clear){this._detach_content(this.nodes);this.nodes.$searchview_buttons.show();}else{this._detach_content(_.pick(this.nodes,_.keys(new_cp_content)));}
this._attach_content(new_cp_content);this._update_search_view(status.searchview,status.search_view_hidden);if(status.active_view_selector){this._update_switch_buttons(status.active_view_selector);}}},_toggle_visibility:function(visible){this.do_toggle(visible);if(!visible&&!this.$content){this.$content=this.$el.contents().detach();}else if(this.$content){this.$content.appendTo(this.$el);this.$content=null;}},_detach_content:function(elements_to_detach){_.each(elements_to_detach,function($nodeset){$nodeset.contents().detach();});},_attach_content:function(content){var self=this;_.each(content,function($nodeset,$element){if($nodeset&&self.nodes[$element]){self.nodes[$element].append($nodeset);}});},_update_switch_buttons:function(active_view_selector){_.each(this.nodes.$switch_buttons.find('button'),function(button){$(button).removeClass('active');});this.$(active_view_selector).addClass('active');},_render_breadcrumbs:function(breadcrumbs){var self=this;return breadcrumbs.map(function(bc,index){return self._render_breadcrumbs_li(bc,index,breadcrumbs.length);});},_render_breadcrumbs_li:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim())||data.noDisplayContent;var $bc=$('<li>').append(is_last?li_content:$('<a>').html(li_content)).toggleClass('active',is_last);if(!is_last){$bc.click(function(){self.trigger("on_breadcrumb_click",bc.action,bc.index);});}
return $bc;},_clear_breadcrumbs_handlers:function(){if(this.$breadcrumbs){_.each(this.$breadcrumbs,function($bc){$bc.off();});}},_update_search_view:function(searchview,is_hidden){if(searchview){searchview.$buttons=this.nodes.$searchview_buttons;searchview.toggle_visibility(!is_hidden);}
this.nodes.$searchview.toggle(!is_hidden);this.$el.toggleClass('o_breadcrumb_full',!!is_hidden);},});return ControlPanel;});;

/* /web/static/src/js/chrome/view_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ViewManager',function(require){"use strict";var Context=require('web.Context');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var dom=require('web.dom');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var view_registry=require('web.view_registry');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ViewManager=Widget.extend(ControlPanelMixin,{className:"o_view_manager_content",custom_events:{execute_action:function(event){var data=event.data;this.do_execute_action(data.action_data,data.env,data.on_closed).then(data.on_success,data.on_fail);},search:function(event){var d=event.data;_.extend(this.env,this._process_search_data(d.domains,d.contexts,d.groupbys));this.active_view.controller.reload(_.extend({offset:0},this.env));},switch_view:function(event){if('res_id'in event.data){this.env.currentId=event.data.res_id;}
var options={};if(event.data.view_type==='form'&&!this.env.currentId){options.mode='edit';}else if(event.data.mode){options.mode=event.data.mode;}
this.switch_mode(event.data.view_type,options);},env_updated:function(event){_.extend(this.env,event.data);},push_state:function(event){this.do_push_state(event.data);},get_controller_context:'_onGetControllerContext',switch_to_previous_view:'_onSwitchToPreviousView',},on_attach_callback:function(){this.is_in_DOM=true;var controller=this.active_view&&this.active_view.controller;if(controller&&this.active_view.controller.on_attach_callback){this.active_view.controller.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;var controller=this.active_view&&this.active_view.controller;if(controller&&controller.on_detach_callback){this.active_view.controller.on_detach_callback();}},init:function(parent,dataset,views,flags,options){var self=this;this._super(parent);this.action=options&&options.action||{};this.action_manager=options&&options.action_manager;this.flags=flags||{};this.dataset=dataset;this.view_order=[];this.views={};this.view_stack=[];this.active_view=null;this.registry=view_registry;this.title=this.action.name;_.each(views,function(view){var view_type=view[1]||view.view_type;var View=self.registry.get(view_type);if(!View){console.error("View type","'"+view_type+"'","is not present in the view registry.");return;}
var view_label=View.prototype.display_name;var view_descr={accesskey:View.prototype.accesskey,button_label:_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}),controller:null,fields_view:view[2]||view.fields_view,icon:View.prototype.icon,label:view_label,mobile_friendly:View.prototype.mobile_friendly,multi_record:View.prototype.multi_record,options:_.extend({action:self.action,limit:self.action.limit,views:self.action.views,},self.flags,self.flags[view_type],view.options),searchable:View.prototype.searchable,title:self.title,type:view_type,view_id:view[0]||view.view_id,};self.view_order.push(view_descr);self.views[view_type]=view_descr;});this.first_view=this.views[options&&options.view_type];this.default_view=this.get_default_view();this.env={modelName:this.dataset.model,ids:this.dataset.ids.length?this.dataset.ids:undefined,currentId:this.dataset.ids.length?this.dataset.ids[this.dataset.index]:undefined,domain:undefined,context:this.dataset.context,groupBy:undefined,};},willStart:function(){var views_def;var first_view_to_display=this.first_view||this.default_view;if(!first_view_to_display.fields_view||(this.flags.search_view&&!this.search_fields_view)){views_def=this.load_views();}
return $.when(this._super(),views_def);},start:function(){var self=this;var _super=this._super.bind(this,arguments);var def;if(this.flags.search_view){def=this.setup_search_view().then(function(){var d=self.searchview.build_search_data();_.extend(self.env,self._process_search_data(d.domains,d.contexts,d.groupbys));});}
return $.when(def).then(function(){var defs=[];defs.push(_super());if(self.flags.views_switcher){self.render_switch_buttons();}
if(self.first_view&&!self.first_view.multi_record&&self.default_view.multi_record){self.view_stack.push(self.default_view);}
var view_to_load=self.first_view||self.default_view;var options=_.extend({},view_to_load.options);defs.push(self.switch_mode(view_to_load.type,options));return $.when.apply($,defs);}).then(function(){if(self.flags.on_load){self.flags.on_load(self);}
core.bus.on('clear_uncommitted_changes',self,function(chain_callbacks){chain_callbacks(function(){if(self.active_view.controller){return self.active_view.controller.discardChanges(undefined,{readonlyIfRealDiscard:true,});}});});});},load_views:function(){var self=this;var views=[];_.each(this.views,function(view){if(!view.fields_view){views.push([view.view_id,view.type]);}});var options={action_id:this.action.id,toolbar:this.flags.sidebar,};if(this.flags.search_view&&!this.search_fields_view){options.load_filters=true;var searchview_id=this.action.search_view_id&&this.action.search_view_id[0];views.push([searchview_id||false,'search']);}
var params={model:this.dataset.model,context:this.dataset.get_context(),views_descr:views,};return data_manager.load_views(params,options).then(function(fields_views){_.each(fields_views,function(fields_view,view_type){if(view_type==='search'){self.search_fields_view=fields_view;}else{self.views[view_type].fields_view=fields_view;}});});},get_default_view:function(){return this.views[this.flags.default_view||this.view_order[0].type];},switch_mode:function(view_type,view_options){var self=this;var view=this.views[view_type];if(!view||this.currently_switching){return $.Deferred().reject();}else{this.currently_switching=true;}
var old_view=this.active_view;var views_def;if(!view.fields_view){views_def=this.load_views();}
return $.when(views_def).then(function(){if(view.multi_record){self.view_stack=[];}else if(self.view_stack.length>0&&!(_.last(self.view_stack).multi_record)){self.view_stack.pop();}
self.view_stack.push(view);self.active_view=view;if(!view.loaded||view.loaded.state()==='rejected'){view_options=_.extend({},view.options,view_options,self.env);view.loaded=$.Deferred();self.create_view(view,view_options).then(function(controller){view.controller=controller;view.$fragment=$('<div>');controller.appendTo(view.$fragment).done(function(){view.$fragment=view.$fragment.contents();view.loaded.resolve();});}).fail(view.loaded.reject.bind(view.loaded));}else{view.loaded=view.loaded.then(function(){view_options=_.extend({},view_options,self.env);return view.controller.reload(view_options);});}
return $.when(view.loaded).then(function(){self._display_view(old_view);self.trigger('switch_mode',view_type,view_options);}).fail(function(e){if(!(e&&e.code===200&&e.data.exception_type)){self.do_warn(_t("Error"),view.label+_t(" view couldn't be loaded"));}
self.active_view=old_view;self.view_stack.pop();});}).always(function(){self.currently_switching=false;});},_display_view:function(old_view){var view_controller=this.active_view.controller;var view_fragment=this.active_view.$fragment;var view_control_elements=this.render_view_control_elements();var cp_status={active_view_selector:'.o_cp_switch_'+this.active_view.type,breadcrumbs:this.action_manager&&this.action_manager.get_breadcrumbs(),cp_content:_.extend({},this.searchview_elements,view_control_elements),hidden:this.flags.headless,searchview:this.searchview,search_view_hidden:!this.active_view.searchable||this.active_view.searchview_hidden,};this.update_control_panel(cp_status);if(old_view&&old_view!==this.active_view){if(this.action_manager&&this.action_manager.webclient){old_view.controller.setScrollTop(this.action_manager.webclient.getScrollTop());}
var $to_detach=this.$el.contents().not('.ui-autocomplete');old_view.$fragment=dom.detach([{widget:old_view.controller}],{$to_detach:$to_detach});}
if(old_view&&old_view.controller.multi_record===true&&view_controller.multi_record===false){view_controller.setScrollTop(0);}
dom.append(this.$el,view_fragment,{in_DOM:this.is_in_DOM,callbacks:[{widget:view_controller}],});},create_view:function(view_descr,view_options){var self=this;var arch=view_descr.fields_view.arch;var View=this.registry.get(arch.attrs.js_class||view_descr.type);var params=_.extend({},view_options,{userContext:this.getSession().user_context});if(view_descr.type==="form"&&((this.action.target==='new'||this.action.target==='inline'||this.action.target==='fullscreen')||(view_options&&(view_options.mode==='edit'||view_options.context.form_view_initial_mode)))){params.mode=params.initial_mode||'edit';}
view_descr.searchview_hidden=View.prototype.searchview_hidden;var view=new View(view_descr.fields_view,params);return view.getController(this).then(function(controller){controller.on('history_back',this,function(){if(self.action_manager)self.action_manager.trigger('history_back');});controller.on("change:title",this,function(){if(self.action_manager&&!self.flags.headless){var breadcrumbs=self.action_manager.get_breadcrumbs();self.update_control_panel({breadcrumbs:breadcrumbs},{clear:false});}});return controller;});},select_view:function(index){var viewType=this.view_stack[index].type;var viewOptions={};if(viewType==='form'){viewOptions.mode=this.action.target==='inline'?'edit':'readonly';}
return this.switch_mode(viewType,viewOptions);},render_switch_buttons:function(){var self=this;var views=_.partition(this.view_order,function(view){return view.multi_record===true;});var multi_record_views=views[0];var mono_record_views=views[1];var _render_switch_buttons=function(views){if(views.length>1){var $switch_buttons=$(QWeb.render('ViewManager.switch-buttons',{views:views}));_.each(views,function(view){$switch_buttons.filter('.o_cp_switch_'+view.type).tooltip();});$switch_buttons.filter('button').click(_.debounce(function(event){var view_type=$(event.target).data('view-type');self.switch_mode(view_type);},200,true));return $switch_buttons;}};this.switch_buttons={};this.switch_buttons.$multi=_render_switch_buttons(multi_record_views);this.switch_buttons.$mono=_render_switch_buttons(mono_record_views);},render_view_control_elements:function(){if(!this.active_view.control_elements){var view_controller=this.active_view.controller;var $buttons=this.flags.$buttons;var elements={};if(!this.flags.headless){elements={$buttons:$("<div>"),$sidebar:$("<div>"),$pager:$("<div>"),};}
view_controller.renderButtons($buttons?$buttons.empty():elements.$buttons);view_controller.renderSidebar(elements.$sidebar);view_controller.renderPager(elements.$pager);elements=_.mapObject(elements,function($node){return $node&&$node.contents();});if(this.switch_buttons){if(this.active_view.multi_record){elements.$switch_buttons=this.switch_buttons.$multi;}else{elements.$switch_buttons=this.switch_buttons.$mono;}}
this.active_view.control_elements=elements;}
return this.active_view.control_elements;},setup_search_view:function(){var self=this;var search_defaults={};var context=this.action.context||[];_.each(context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,$buttons:$("<div>"),action:this.action,search_defaults:search_defaults,};this.searchview=new SearchView(this,this.dataset,this.search_fields_view,options);return $.when(this.searchview.appendTo($("<div>"))).done(function(){self.searchview_elements={};self.searchview_elements.$searchview=self.searchview.$el;self.searchview_elements.$searchview_buttons=self.searchview.$buttons.contents();});},_process_search_data:function(domains,contexts,groupbys){var action_context=this.action.context||{};var view_context={};var results=pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context,view_context].concat(contexts||[]),group_by_seq:groupbys||[],eval_context:this.getSession().user_context,});if(results.error){throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
return{context:results.context,domain:results.domain,groupBy:groupby||[],};},do_push_state:function(state){if(this.action_manager){state.view_type=this.active_view.type;this.action_manager.do_push_state(state);}},do_load_state:function(state){var stateChanged=false;if('id'in state&&state.id!==''&&state.id!==this.env.currentId){this.env.currentId=state.id;stateChanged=true;}
if(state.view_type&&state.view_type!==this.active_view.type){stateChanged=true;}
if(stateChanged){return this.switch_mode(state.view_type);}},do_execute_action:function(action_data,env,on_closed){var self=this;var result_handler=on_closed||function(){};var context=new Context(env.context,action_data.context||{});var recordID=env.currentID||null;var handler=function(action){var effect=false;if(action_data.effect){effect=pyeval.py_eval(action_data.effect);};if(action&&action.constructor===Object){var ncontext=new Context(_.object(_.reject(_.pairs(self.env.context),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids)$')!==null;})));ncontext.add(action_data.context||{});ncontext.add({active_model:env.model});if(recordID){ncontext.add({active_id:recordID,active_ids:[recordID],});}
ncontext.add(action.context||{});action.context=ncontext;action.effect=effect||action.effect;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close",'effect':effect});return result_handler();}};if(action_data.special){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type==="object"){var args=recordID?[[recordID]]:[env.resIDs];if(action_data.args){try{var additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);var dataset=new data.DataSet(this,env.model,env.context);return dataset.call_button(action_data.name,args).then(handler);}else if(action_data.type==="action"){return data_manager.load_action(action_data.name,_.extend(pyeval.eval('context',context),{active_model:env.model,active_ids:env.resIDs,active_id:recordID,})).then(handler);}},destroy:function(){if(this.control_elements){if(this.control_elements.$switch_buttons){this.control_elements.$switch_buttons.off();}}
return this._super.apply(this,arguments);},_onGetControllerContext:function(ev){ev.stopPropagation();var controller=this.active_view&&this.active_view.controller;var context=controller&&controller.getContext();ev.data.callback(context);},_onSwitchToPreviousView:function(){this.trigger_up('history_back');}});return ViewManager;});;

/* /web/static/src/js/chrome/abstract_web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var concurrency=require('web.concurrency');var core=require('web.core');var config=require('web.config');var crash_manager=require('web.crash_manager');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var Loading=require('web.Loading');var mixins=require('web.mixins');var NotificationManager=require('web.notification').NotificationManager;var RainbowMan=require('web.rainbow_man');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var AbstractWebClient=Widget.extend(mixins.ServiceProvider,{custom_events:{clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(e){this.current_action_updated(e.data.action);},notification:function(e){if(this.notification_manager){this.notification_manager.notify(e.data.title,e.data.message,e.data.sticky);}},warning:'_onDisplayWarning',load_views:function(event){var params={model:event.data.modelName,context:event.data.context,views_descr:event.data.views,};return data_manager.load_views(params,event.data.options||{}).then(event.data.on_success);},load_filters:function(event){return data_manager.load_filters(event.data.dataset,event.data.action_id).then(event.data.on_success);},show_effect:'_onShowEffect',get_session:function(event){if(event.data.callback){event.data.callback(session);}},do_action:function(event){this.do_action(event.data.action,event.data.options||{}).then(function(result){if(event.data.on_success){event.data.on_success(result);}}).fail(function(result){if(event.data.on_fail){event.data.on_fail(result);}});},},init:function(parent){this.client_options={};mixins.ServiceProvider.init.call(this);this._super(parent);this.origin=undefined;this._current_state=null;this.menu_dm=new concurrency.DropMisordered();this.action_mutex=new concurrency.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.$el.toggleClass('o_touch_device',config.device.touch);this.on("change:title_part",this,this._title_changed);this._title_changed();return session.is_bound.then(function(){self.bind_events();return $.when(self.set_action_manager(),self.set_notification_manager(),self.set_loading());}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return $.when();}}).then(function(){self.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));core.bus.trigger('web_client_ready');});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){self.$('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});core.bus.on('connection_lost',this,this.on_connection_lost);core.bus.on('connection_restored',this,this.on_connection_restored);core.bus.on('rpc_error',crash_manager,crash_manager.rpc_error);window.onerror=function(message,file,line,col,error){if(!file&&!line&&!col){if(window.onOriginError){window.onOriginError();delete window.onOriginError;}else{crash_manager.show_error({type:_t("Odoo Client Error"),message:_t("Unknown CORS error"),data:{debug:_t("An unknown CORS error occured. The error probably originates from a JavaScript file served from a different origin. (Opening your browser console might give you a hint on the error.)")},});}}else{var traceback=error?error.stack:'';crash_manager.show_error({type:_t("Odoo Client Error"),message:message,data:{debug:file+':'+line+"\n"+_t('Traceback:')+"\n"+traceback},});}};},set_action_manager:function(){this.action_manager=new ActionManager(this,{webclient:this});return this.action_manager.appendTo(this.$('.o_main_content'));},set_notification_manager:function(){this.notification_manager=new NotificationManager(this);return this.notification_manager.appendTo(this.$el);},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){var def=$.Deferred().resolve();core.bus.trigger('clear_uncommitted_changes',function chain_callbacks(callback){def=def.then(callback);});return def;},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.do_action.apply(this,arguments);},do_reload:function(){var self=this;return session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_connection_lost:function(){this.connection_notification=this.notification_manager.notify(_t('Connection lost'),_t('Trying to reconnect...'),true);},on_connection_restored:function(){if(this.connection_notification){this.connection_notification.destroy();this.notification_manager.notify(_t('Connection restored'),_t('You are back online'),false);this.connection_notification=false;}},current_action_updated:function(){},getScrollTop:function(){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},_onDisplayWarning:function(e){var data=e.data;if(data.type==='dialog'){new Dialog(this,{size:'medium',title:data.title,$content:qweb.render("CrashManager.warning",data),}).open();}else if(this.notification_manager){this.notification_manager.warn(e.data.title,e.data.message,e.data.sticky);}},_onShowEffect:function(e){var data=e.data||{};var type=data.type||'rainbow_man';if(type==='rainbow_man'){new RainbowMan(data).appendTo(this.$el);}else{throw new Error('Unknown effect type: '+type);}},});return AbstractWebClient;});;

/* /web/static/src/js/chrome/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var AbstractWebClient=require('web.AbstractWebClient');var core=require('web.core');var data_manager=require('web.data_manager');var framework=require('web.framework');var Menu=require('web.Menu');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');return AbstractWebClient.extend({events:{'click .oe_logo_edit_admin':'logo_edit','click .oe_logo img':function(ev){ev.preventDefault();return this.clear_uncommitted_changes().then(function(){framework.redirect("/web"+(core.debug?"?debug":""));});},},show_application:function(){var self=this;this.action_manager.is_in_DOM=true;this.toggle_bars(true);this.set_title();this.update_logo();this.menu=new Menu(this);this.menu.setElement(this.$el.parents().find('.oe_application_menu_placeholder'));this.menu.on('menu_click',this,this.on_menu_action);this.user_menu=new UserMenu(this);var $user_menu_placeholder=$('body').find('.oe_user_menu_placeholder').show();var user_menu_loaded=this.user_menu.appendTo($user_menu_placeholder);this.systray_menu=new SystrayMenu(this);this.systray_menu.setElement(this.$el.parents().find('.oe_systray'));var systray_menu_loaded=this.systray_menu.start();return $.when(systray_menu_loaded,user_menu_loaded).then(function(){self.menu.start();self.bind_hashchange();});},toggle_bars:function(value){this.$('tr:has(td.navbar),.oe_leftbar').toggle(value);},update_logo:function(reload){var company=session.company_id;var img=session.url('company_logo.png'+'?db='+session.db+(company?'&company='+company:''));this.$('.o_sub_menu_logo img').attr('src','').attr('src',img+(reload?"&t="+Date.now():''));this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',session.is_superuser);},logo_edit:function(ev){var self=this;ev.preventDefault();this._rpc({model:'res.users',method:'read',args:[[session.uid],['company_id']],}).then(function(data){self._rpc({route:'/web/action/load',params:{action_id:'base.action_res_company_form'},}).done(function(result){result.res_id=data[0].company_id[0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,headless:true,};self.action_manager.do_action(result,{on_close:self.update_logo.bind(self,true),});});});return false;},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var didHashChanged=false;$(window).one('hashchange',function(){didHashChanged=true;});var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action==="login"){self.menu.is_bound.done(function(){self._rpc({model:'res.users',method:'read',args:[[session.uid],['action_id']],}).done(function(result){if(didHashChanged){return;}
var data=result[0];if(data.action_id){self.action_manager.do_action(data.action_id[0]);self.menu.open_action(data.action_id[0]);}else{var first_menu_id=self.menu.$el.find("a:first").data("menu");if(first_menu_id){self.menu.menu_click(first_menu_id);}}});});}else{$(window).trigger('hashchange');}},on_hashchange:function(event){if(this._ignore_hashchange){this._ignore_hashchange=false;return;}
var self=this;this.clear_uncommitted_changes().then(function(){var stringstate=event.getState(false);if(!_.isEqual(self._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.is_bound.done(function(){self.menu.menu_click(state.menu_id);});}else{state._push_me=false;self.action_manager.do_load_state(state,!!self._current_state).then(function(){var action=self.action_manager.get_inner_action();if(action){self.menu.open_action(action.action_descr.id,state.menu_id);}});}}
self._current_state=stringstate;},function(){if(event){self._ignore_hashchange=true;window.location=event.originalEvent.oldURL;}});},on_menu_action:function(options){var self=this;return this.menu_dm.add(data_manager.load_action(options.action_id)).then(function(result){return self.action_mutex.exec(function(){var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:options.id,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});});},toggle_fullscreen:function(fullscreen){this._super(fullscreen);if(!fullscreen){this.menu.reflow();}},});});;

/* /web/static/src/js/_deprecated/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var Context=require('web.Context');var concurrency=require('web.concurrency');var mixins=require('web.mixins');var session=require('web.session');var translation=require('web.translation');var pyeval=require('web.pyeval');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=(q._filter||[]).concat(to_set.filter||[]);break;case'context':q._context=new Context(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyeval.eval('domains',[this._model.domain(this._filter)]),context:pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyeval.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};for(var key in fixed_group){if(fixed_group.hasOwnProperty(key)){if(!(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key))){aggregates[key]=fixed_group[key]||0;}}}
this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.setParent(parent);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new concurrency.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new Context(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();return this.orderer.add(query).done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return this.orderer.add(q.all()).done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var data={Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};var Model=Class.extend({init:function(name,context,domain){this.name=name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return this._domain.concat(domain);},context:function(context){return new Context(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyeval.ensure_evaluated(args,kwargs);var call_kw='call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyeval.ensure_evaluated(args,{});return session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});return data;});;

/* /web/static/src/js/core/context.js defined in bundle 'web.assets_backend' */
odoo.define('web.Context',function(require){"use strict";var Class=require('web.Class');var pyeval=require('web.pyeval');var Context=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},eval:function(){return pyeval.eval('context',this);},set_eval_context:function(evalContext){for(var key in evalContext){if(evalContext[key]instanceof moment){evalContext[key]=evalContext[key].toJSON();}}
this.__eval_context=evalContext;return this;},});return Context;});;

/* /web/static/src/js/core/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var ajax=require('web.ajax');var Widget=require('web.Widget');var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$(document.body).addClass('o_ui_blocked');return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$(document.body).removeClass('o_ui_blocked');return $.unblockUI.apply($,arguments);}
function redirect(url,wait){crash_manager.disable();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("version_info.php",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;core.bus.trigger('clear_cache');redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function HistoryBack(parent){parent.history_back().fail(function(){Home(parent);});}
core.action_registry.add("history_back",HistoryBack);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return $.Deferred();}
core.action_registry.add("logout",logout);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if(!document.contains){document.contains=function contains(node){if(!(0 in arguments)){throw new TypeError('1 argument is required');}
do{if(this===node){return true;}}while(node=node&&node.parentNode);return false;};}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,};});;

/* /web/static/src/js/services/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var map_title={user_error:_lt('Warning'),warning:_lt('Warning'),access_error:_lt('Access Error'),missing_error:_lt('Missing Record'),validation_error:_lt('Validation Error'),except_orm:_lt('Global Business Error'),access_denied:_lt('Access Denied'),};var CrashManager=core.Class.extend({init:function(){this.active=true;},enable:function(){this.active=true;},disable:function(){this.active=false;},rpc_error:function(error){var self=this;if(!this.active){return;}
if(this.connection_lost){return;}
if(error.code===-32098){core.bus.trigger('connection_lost');this.connection_lost=true;var timeinterval=setInterval(function(){var options={shadow:true};ajax.jsonRpc('version_info.php','call',{},options).then(function(){clearInterval(timeinterval);core.bus.trigger('connection_restored');self.connection_lost=false;});},2000);return;}
var handler=core.crash_registry.get(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(error.data.name==="odoo.http.SessionExpiredException"||error.data.name==="werkzeug.exceptions.Forbidden"){this.show_warning({type:_t("Odoo Session Expired"),data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});return;}
if(_.has(map_title,error.data.exception_type)){if(error.data.exception_type==='except_orm'){if(error.data.arguments[1]){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[1],title:error.data.arguments[0]!=='Warning'?(" - "+error.data.arguments[0]):'',})});}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:'',})});}}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:map_title[error.data.exception_type]!=='Warning'?(" - "+map_title[error.data.exception_type]):'',})});}
this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
return new Dialog(this,{size:'medium',title:_.str.capitalize(error.type||error.message)||_t("Odoo Warning"),subtitle:error.data.title,$content:$(QWeb.render('CrashManager.warning',{error:error}))}).open();},show_error:function(error){if(!this.active){return;}
var dialog=new Dialog(this,{title:_.str.capitalize(error.type||error.message)||_t("Odoo Error"),$content:$(QWeb.render('CrashManager.error',{error:error}))});var $clipboardBtn;var clipboard;dialog.opened(function(){dialog.$(".o_error_detail").on("shown.bs.collapse",function(e){e.target.scrollTop=e.target.scrollHeight;});$clipboardBtn=dialog.$(".o_clipboard_button");$clipboardBtn.tooltip({title:_t("Copied !"),trigger:"manual",placement:"left"});clipboard=new window.Clipboard($clipboardBtn[0],{text:function(){return(_t("Error")+":\n"+error.message+"\n\n"+error.data.debug).trim();}});clipboard.on("success",function(e){_.defer(function(){$clipboardBtn.tooltip("show");_.delay(function(){$clipboardBtn.tooltip("hide");},800);});});});dialog.on("closed",this,function(){$clipboardBtn.tooltip("destroy");clipboard.destroy();});return dialog.open();},show_message:function(exception){return this.show_error({type:_t("Odoo Client Error"),message:exception,data:{debug:""}});},});var ExceptionHandler={init:function(parent,error){},display:function(){},};var RedirectWarningHandler=Dialog.extend(ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;var error=this.error;error.data.message=error.data.arguments[0];new Dialog(this,{size:'medium',title:_.str.capitalize(error.type)||_t("Odoo Warning"),buttons:[{text:error.data.arguments[2],classes:"btn-primary",click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}},{text:_t("Cancel"),click:function(){self.destroy();},close:true}],$content:QWeb.render('CrashManager.warning',{error:error}),}).open();}});core.crash_registry.add('odoo.exceptions.RedirectWarning',RedirectWarningHandler);return CrashManager;});odoo.define('web.crash_manager',function(require){"use strict";var CrashManager=require('web.CrashManager');return new CrashManager();});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var config=require('web.config');var core=require('web.core');var fieldRegistry=require('web.field_registry');var pyeval=require('web.pyeval');var rpc=require('web.rpc');var utils=require('web.utils');return core.Class.extend({init:function(){this._init_cache();core.bus.on('clear_cache',this,this.invalidate.bind(this));},_init_cache:function(){this._cache={actions:{},fields_views:{},filters:{},views:{},};},invalidate:function(){this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(!this._cache.actions[key]){this._cache.actions[key]=rpc.query({route:"/web/action/load",params:{action_id:action_id,additional_context:additional_context,},}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;},this._invalidate.bind(this,this._cache.actions,key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:function(params,options){var self=this;var model=params.model;var context=params.context;var views_descr=params.views_descr;var key=this._gen_key(model,views_descr,options||{},context);if(!this._cache.views[key]){var filters_key;if(options.load_filters){filters_key=this._gen_key(model,options.action_id);options.load_filters=!this._cache.filters[filters_key];}
this._cache.views[key]=rpc.query({args:[],kwargs:{views:views_descr,options:options,context:context.eval(),},model:model,method:'load_views',}).then(function(result){result.fields_views=_.mapObject(result.fields_views,self._postprocess_fvg.bind(self));self.processViews(result.fields_views,result.fields);_.each(views_descr,function(view_descr){var toolbar=options.toolbar&&view_descr[1]!=='search';var fv_key=self._gen_key(model,view_descr[0],view_descr[1],toolbar,context);self._cache.fields_views[fv_key]=$.when(result.fields_views[view_descr[1]]);});if(result.filters){self._cache.filters[filters_key]=$.when(result.filters);}
return result.fields_views;},this._invalidate.bind(this,this._cache.views,key));}
return this._cache.views[key];},load_filters:function(dataset,action_id){var key=this._gen_key(dataset.model,action_id);if(!this._cache.filters[key]){this._cache.filters[key]=rpc.query({args:[dataset.model,action_id],kwargs:{context:dataset.get_context(),},model:'ir.filters',method:'get_filters',}).fail(this._invalidate.bind(this,this._cache.filters,key));}
return this._cache.filters[key];},create_filter:function(filter){var self=this;return rpc.query({args:[filter],model:'ir.filters',method:'create_or_replace',}).then(function(filter_id){var key=[filter.model_id,filter.action_id||false,].join(',');self._invalidate(self._cache.filters,key);return filter_id;});},delete_filter:function(filter){var self=this;return rpc.query({args:[filter.id],model:'ir.filters',method:'unlink',}).then(function(){self._cache.filters={};});},processViews:function(fieldsViews,fields){var fieldName,fieldsView,viewType;for(fieldName in fields){fields[fieldName].name=fieldName;}
for(viewType in fieldsViews){fieldsView=fieldsViews[viewType];for(fieldName in fieldsView.fields){fieldsView.fields[fieldName].name=fieldName;}
_.defaults(fieldsView.fields,fields);_.extend(fieldsView,this._processFieldsView({type:viewType,arch:fieldsView.arch,fields:fieldsView.fields,}));}},_postprocess_fvg:function(fields_view){var self=this;var doc=$.parseXML(fields_view.arch).documentElement;fields_view.arch=utils.xml_to_json(doc,(doc.nodeName.toLowerCase()!=='kanban'));_.each(fields_view.fields,function(field){_.each(field.views||{},function(view){self._postprocess_fvg(view);});});return fields_view;},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate:function(cache,key){delete cache[key];},_processField:function(viewType,field,attrs){var self=this;attrs.Widget=this._getFieldWidgetClass(viewType,field,attrs);if(!_.isObject(attrs.options)){attrs.options=attrs.options?pyeval.py_eval(attrs.options):{};}
if(attrs.on_change&&!field.onChange){field.onChange="1";}
if(attrs.modifiers.invisible===true||attrs.modifiers.column_invisible===true){attrs.__no_fetch=true;}
if(!_.isEmpty(field.views)){attrs.views={};_.each(field.views,function(innerFieldsView,viewType){viewType=viewType==='tree'?'list':viewType;innerFieldsView.type=viewType;attrs.views[viewType]=self._processFieldsView(_.extend({},innerFieldsView));});delete field.views;}
if(field.type==='one2many'||field.type==='many2many'){if(attrs.Widget.prototype.useSubview){if(!attrs.views){attrs.views={};}
var mode=attrs.mode;if(!mode){if(attrs.views.tree&&attrs.views.kanban){mode='tree';}else if(!attrs.views.tree&&attrs.views.kanban){mode='kanban';}else{mode='tree,kanban';}}
if(mode.indexOf(',')!==-1){mode=config.device.size_class!==config.device.SIZES.XS?'tree':'kanban';}
if(mode==='tree'){mode='list';if(!attrs.views.list&&attrs.views.tree){attrs.views.list=attrs.views.tree;}}
attrs.mode=mode;if(mode in attrs.views){var view=attrs.views[mode];var defaultOrder=view.arch.attrs.default_order;if(defaultOrder){attrs.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}else{var handleField=_.find(view.arch.children,function(child){return child.attrs&&child.attrs.widget==='handle';});if(handleField){attrs.orderedBy=[{name:handleField.attrs.name,asc:true}];}}
attrs.columnInvisibleFields={};_.each(view.arch.children,function(child){if(child.attrs&&child.attrs.modifiers){attrs.columnInvisibleFields[child.attrs.name]=child.attrs.modifiers.column_invisible||false;}});}}
if(attrs.Widget.prototype.fieldsToFetch){attrs.viewType='default';attrs.relatedFields=_.extend({},attrs.Widget.prototype.fieldsToFetch);attrs.fieldsInfo={default:_.mapObject(attrs.Widget.prototype.fieldsToFetch,function(){return{};}),};if(attrs.options.color_field){attrs.relatedFields[attrs.options.color_field]={type:'integer'};attrs.fieldsInfo.default[attrs.options.color_field]={};}}}
if(attrs.Widget.prototype.fieldDependencies){attrs.fieldDependencies=attrs.Widget.prototype.fieldDependencies;}
return attrs;},_processFields:function(viewType,arch,fields){var self=this;var fieldsInfo=Object.create(null);utils.traverse(arch,function(node){if(typeof node==='string'){return false;}
if(!_.isObject(node.attrs.modifiers)){node.attrs.modifiers=node.attrs.modifiers?JSON.parse(node.attrs.modifiers):{};}
if(!_.isObject(node.attrs.options)&&node.tag==='button'){node.attrs.options=node.attrs.options?JSON.parse(node.attrs.options):{};}
if(node.tag==='field'){fieldsInfo[node.attrs.name]=self._processField(viewType,fields[node.attrs.name],node.attrs?_.clone(node.attrs):{});if(fieldsInfo[node.attrs.name].fieldDependencies){var deps=fieldsInfo[node.attrs.name].fieldDependencies;for(var dependency_name in deps){var dependency_dict={name:dependency_name,type:deps[dependency_name].type};if(!(dependency_name in fieldsInfo)){fieldsInfo[dependency_name]=_.extend({},dependency_dict,{options:deps[dependency_name].options||{}});}
if(!(dependency_name in fields)){fields[dependency_name]=dependency_dict;}}}
return false;}
return node.tag!=='arch';});return fieldsInfo;},_processFieldsView:function(viewInfo){var viewFields=this._processFields(viewInfo.type,viewInfo.arch,viewInfo.fields);viewInfo.fieldsInfo={};viewInfo.fieldsInfo[viewInfo.type]=viewFields;utils.deepFreeze(viewInfo.fields);return viewInfo;},_getFieldWidgetClass:function(viewType,field,attrs){var Widget;if(attrs.widget){Widget=fieldRegistry.getAny([viewType+"."+attrs.widget,attrs.widget]);if(!Widget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}else if(viewType==='kanban'&&field.type==='many2many'){Widget=fieldRegistry.get('kanban.many2many_tags');}
return Widget||fieldRegistry.getAny([viewType+"."+field.type,field.type,"abstract"]);},});});odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/widgets/auto_complete.js defined in bundle 'web.assets_backend' */
odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;},start:function(){var self=this;this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER){if(self.search_string.length){self.select_item(ev);}
return;}
var search_string=self.get_search_string();if(self.search_string!==search_string){if(search_string.length){self.search_string=search_string;self.initiate_search(search_string);}else{self.close();}}});this.$input.on('keypress',function(ev){self.search_string=self.search_string+String.fromCharCode(ev.which);if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$el;$list.empty();results.forEach(function(result){var $item=self.make_list_item(result).appendTo($list);result.$el=$item;});this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').hover(function(){self.focus_element($li);}).mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}}).data('result',result);if(result.expand){var $expand=$('<a class="o-expand" href="#">').appendTo($li);$expand.mousedown(function(ev){ev.stopPropagation();ev.preventDefault();if(result.expanded){self.fold();}else{self.expand();}});$expand.click(function(ev){ev.preventDefault();});result.expanded=false;}
if(result.indent)$li.addClass('o-indent');$li.append($('<a href="#">').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('a.o-expand').removeClass('o-expand').addClass('o-expanded');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('o-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('a.o-expanded').removeClass('o-expanded').addClass('o-expand');},focus_element:function($li){this.$('li').removeClass('o-selection-focus');$li.addClass('o-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.o-selection-focus').next();if(!$next.length)$next=this.$('li').first();}else{$next=this.$('li.o-selection-focus').prev();if(!$next.length)$next=this.$('li').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.o-selection-focus .o-expand').length;},});});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=Widget.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self._rpc({route:'/web/session/change_password',params:{fields:$('form[name=change_password_form]').serializeArray()}}).done(function(result){if(result.error){self._display_error(result);}else{self.do_action('logout');}});});},_display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/widgets/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var dialogs=require('web.view_dialogs');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var DebugManager=Widget.extend({template:"WebClient.DebugManager",events:{"click a[data-action]":"perform_callback","mouseover .o_debug_dropdowns > li:not(.open)":function(e){var $opened=this.$('.o_debug_dropdowns > li.open');if($opened.length){$opened.removeClass('open');$(e.currentTarget).addClass('open').find('> a').focus();}},},init:function(){this._super.apply(this,arguments);this._update_stats=_.throttle(this._update_stats.bind(this),1000/15,{leading:false});this._events=null;if(document.querySelector('meta[name=debug]')){this._events=[];}},start:function(){core.bus.on('rpc:result',this,function(req,resp){this._debug_events(resp.debug);});this.on('update-stats',this,this._update_stats);var init;if((init=document.querySelector('meta[name=debug]'))){this._debug_events(JSON.parse(init.getAttribute('value')));}
this.$dropdown=this.$(".o_debug_dropdown");this._features_group=null;this._has_features=false;this._is_admin=session.is_system;return $.when(this._rpc({model:'res.users',method:'check_access_rights',kwargs:{operation:'write',raise_exception:false},}),session.user_has_group('base.group_no_one'),this._rpc({model:'ir.model.data',method:'xmlid_to_res_id',kwargs:{xmlid:'base.group_no_one'},}),this._super()).then(function(can_write_user,has_group_no_one,group_no_one_id){this._features_group=can_write_user&&group_no_one_id;this._has_features=has_group_no_one;return this.update();}.bind(this));},leave_debug_mode:function(){var qs=$.deparam.querystring();delete qs.debug;window.location.search='?'+$.param(qs);},perform_callback:function(evt){evt.preventDefault();var params=$(evt.target).data();var callback=params.action;if(callback&&this[callback]){this[callback](params,evt);}else{console.warn("No handler for ",callback);}},_debug_events:function(events){if(!this._events){return;}
if(events&&events.length){this._events.push(events);}
this.trigger('update-stats',this._events);},requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},_update_stats:function(rqs){var requests=0,rtime=0,queries=0,qtime=0;for(var r=0;r<rqs.length;++r){for(var i=0;i<rqs[r].length;i++){var event=rqs[r][i];var query_start,request_start;switch(event[0]){case'request-start':request_start=event[3]*1e3;break;case'request-end':++requests;rtime+=(event[3]*1e3-request_start)|0;break;case'sql-start':query_start=event[3]*1e3;break;case'sql-end':++queries;qtime+=(event[3]*1e3-query_start)|0;break;}}}
this.$('#debugmanager_requests_stats').text(_.str.sprintf(_t("%d requests (%d ms) %d queries (%d ms)"),requests,rtime,queries,qtime));},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(){this.$dropdown.empty().append(QWeb.render('WebClient.DebugManager.Global',{manager:this,}));return $.when();},select_view:function(){var self=this;new dialogs.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,domain:[['type','!=','qweb'],['type','!=','search']],on_selected:function(records){self._rpc({model:'ir.ui.view',method:'search_read',domain:[['id','=',records[0].id]],fields:['name','model','type'],limit:1,}).then(function(views){var view=views[0];view.type=view.type==='tree'?'list':view.type;self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},perform_js_mobile_tests:function(){this.do_action({name:_t("JS Mobile Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests/mobile?mod=*'});},split_assets:function(){window.location=$.param.querystring(window.location.href,'debug=assets');},});DebugManager.include({update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},get_view_fields:function(){var self=this;var model=this._action.res_model;this._rpc({model:model,method:'fields_get',kwargs:{attributes:['string','searchable','required','readonly','type','store','sortable','relation','help']},}).done(function(fields){new Dialog(self,{title:_.str.sprintf(_t("Fields of %s"),model),$content:$(QWeb.render('WebClient.DebugManager.Action.Fields',{fields:fields}))}).open();});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},translate:function(){this._rpc({model:'ir.translation',method:'get_technical_translations',args:[this._action.res_model],}).then(this.do_action);}});DebugManager.include({start:function(){this._can_edit_views=false;return $.when(this._super(),this._rpc({model:'ir.ui.view',method:'check_access_rights',kwargs:{operation:'write',raise_exception:false},}).then(function(ar){this._can_edit_views=ar;}.bind(this)));},update:function(tag,descriptor,widget){switch(tag){case'action':if(this._view_manager){this._view_manager.off('switch_mode',this);}
if(!(widget instanceof ViewManager)){this._active_view=null;this._view_manager=null;break;}
this._view_manager=widget;widget.on('switch_mode',this,function(){this.update('view',null,widget);});case'view':this._active_view=widget.active_view;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{manager:this,action:this._action,view:this._active_view,can_edit:this._can_edit_views,searchview:this._view_manager&&this._view_manager.searchview,}));}.bind(this));},get_metadata:function(){var ds=this._view_manager.dataset;if(!this._active_view.controller.getSelectedIds().length){console.warn(_t("No metadata available"));return;}
ds.call('get_metadata',[this._active_view.controller.getSelectedIds()]).done(function(result){var metadata=result[0];metadata.creator=field_utils.format.many2one(metadata.create_uid);metadata.lastModifiedBy=field_utils.format.many2one(metadata.write_uid);var createDate=field_utils.parse.datetime(metadata.create_date);metadata.create_date=field_utils.format.datetime(createDate);var modificationDate=field_utils.parse.datetime(metadata.write_date);metadata.write_date=field_utils.format.datetime(modificationDate);new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),ds.model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:metadata,})}).open();});},set_defaults:function(){var self=this;var display=function(fieldInfo,value){var displayed=value;if(value&&fieldInfo.type==='many2one'){displayed=value.data.display_name;value=value.data.id;}else if(value&&fieldInfo.type==='selection'){displayed=_.find(fieldInfo.selection,function(option){return option[0]===value;})[1];}
return[value,displayed];};var renderer=this._active_view.controller.renderer;var fields=self._active_view.fields_view.fields;var fieldsInfo=self._active_view.fields_view.fieldsInfo.form;var fieldNamesInView=renderer.state.getFieldNames();var fieldsValues=renderer.state.data;var modifierDatas={};_.each(fieldNamesInView,function(fieldName){modifierDatas[fieldName]=_.find(renderer.allModifiersData,function(modifierdata){return modifierdata.node.attrs.name===fieldName;});});this.fields=_.chain(fieldNamesInView).map(function(fieldName){var modifierData=modifierDatas[fieldName];var invisibleOrReadOnly;if(modifierData){var evaluatedModifiers=modifierData.evaluatedModifiers[renderer.state.id];invisibleOrReadOnly=evaluatedModifiers.invisible||evaluatedModifiers.readonly;}
var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];if(!value||invisibleOrReadOnly||fieldInfo.type==='one2many'||fieldInfo.type==='many2many'||fieldInfo.type==='binary'||fieldsInfo[fieldName].options.isPassword||!_.isEmpty(fieldInfo.depends)){return false;}
return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(fieldNamesInView).filter(function(fieldName){var fieldInfo=fields[fieldName];return fieldInfo.change_default;}).map(function(fieldName){var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var fieldToSet=$defaults.val();if(!fieldToSet){$defaults.parent().addClass('o_form_invalid');return;}
var selfUser=d.$el.find('#formview_default_self').is(':checked');var condition=d.$el.find('#formview_default_conditions').val();var value=_.find(self.fields,function(field){return field.name===fieldToSet;}).value;self._rpc({model:'ir.default',method:'set',args:[self._active_view.fields_view.model,fieldToSet,value,selfUser,true,condition||false,],}).done(function(){d.close();});}}]});d.args={fields:this.fields,conditions:conditions,};d.template='FormView.set_default';d.open();},fvg:function(){var self=this;var dialog=new Dialog(this,{title:_t("Fields View Get")});dialog.opened().then(function(){$('<pre>').text(utils.json_node_to_xml(self._active_view.controller.renderer.arch,true)).appendTo(dialog.$el);});dialog.open();},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:('…'+title.slice(-49));while(text_ctx.measureText(title).width>200){title='…'+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(core.debug){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action){this._super.apply(this,arguments);var action_descr=action&&action.action_descr;var action_widget=action&&action.widget;var debug_manager=_.find(this.systray_menu.widgets,function(item){return item instanceof DebugManager;});debug_manager.update('action',action_descr,action_widget);},});Dialog.include({open:function(){var self=this;var parent=self.getParent();if(parent instanceof ActionManager&&parent.dialog_widget){this.opened(function(){self.debug_manager=new DebugManager(self);var $header=self.$modal.find('.modal-header:first');return self.debug_manager.prependTo($header).then(function(){self.debug_manager.update('action',parent.dialog_widget.action,parent.dialog_widget);});});}
return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'click .o_expand_parent':function(e){this.on_expand_action(this.records[$(e.target).closest('.o_export_tree_item').data('id')]);},'click .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var row_index=$elem.prevAll('.o_export_tree_item').length;var row_index_level=$elem.parents('.o_export_tree_item').length;if(e.shiftKey&&row_index_level===this.row_index_level){var minIndex=Math.min(row_index,this.row_index);var maxIndex=Math.max(row_index,this.row_index);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(process_children);}
this.row_index=row_index;this.row_index_level=row_index_level;if(e.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(e.shiftKey){$elem.addClass('o_selected').focus();}else{this.$(".o_selected").removeClass("o_selected")
$elem.addClass("o_selected").focus();}
function process_children(){var $this=$(this);if($this.hasClass('open')){$this.children('.o_export_tree_item').addClass('o_selected').each(process_children);}}},'dblclick .o_export_tree_item':function(e){var $elem=$(e.currentTarget);$elem.removeClass('o_selected');this.add_field($elem.data('id'),$elem.find('.o_tree_column').first().text());},'keydown .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var record=this.records[$elem.data('id')];switch(e.keyCode||e.which){case $.ui.keyCode.LEFT:if($elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.RIGHT:if(!$elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.UP:var $prev=$elem.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('open')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$elem.parent('.o_export_tree_item');if($prev.length===0){break;}}
$elem.removeClass("o_selected").blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($elem.hasClass('open')){$next=$elem.children('.o_export_tree_item').first();}else{$next=$elem.next('.o_export_tree_item');if($next.length===0){$next=$elem.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$elem.removeClass("o_selected").blur();$next.addClass("o_selected").focus();break;}},'click .o_add_field':function(){var self=this;this.$('.o_field_tree_structure .o_selected').removeClass('o_selected').each(function(){var $this=$(this);self.add_field($this.data('id'),$this.children('.o_tree_column').text());});},'click .o_remove_field':function(){this.$fields_list.find('option:selected').remove();},'click .o_remove_all_field':function(){this.$fields_list.empty();},'click .o_move_up':function(){var $selected_rows=this.$fields_list.find('option:selected');var $prev_row=$selected_rows.first().prev();if($prev_row.length){$prev_row.before($selected_rows.detach());}},'click .o_move_down':function(){var $selected_rows=this.$fields_list.find('option:selected');var $next_row=$selected_rows.last().next();if($next_row.length){$next_row.after($selected_rows.detach());}},'click .o_toggle_save_list':function(e){e.preventDefault();var $saveList=this.$(".o_save_list");if($saveList.is(':empty')){$saveList.append(QWeb.render('Export.SaveList'));}else{if($saveList.is(':hidden')){$saveList.show();$saveList.find(".o_export_list_input").val("");}else{$saveList.hide();}}},'click .o_save_list > button':function(e){var $saveList=this.$(".o_save_list");var value=$saveList.find("input").val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this.get_fields();if(fields.length===0){return;}
$saveList.hide();var self=this;this.exports.create({name:value,resource:this.record.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(export_list_id){if(!export_list_id){return;}
var $select=self.$(".o_exported_lists_select");if($select.length===0||$select.is(":hidden")){self.show_exports_list();}
$select.append(new Option(value,export_list_id));});},},init:function(parent,record){var options={title:_t("Export Data"),buttons:[{text:_t("Export To File"),click:this.export_data,classes:"btn-primary"},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.record=record;this.exports=new data.DataSetSearch(this,'ir.exports',this.record.getContext());this.row_index=0;this.row_index_level=0;},start:function(){var self=this;var waitFor=[this._super.apply(this,arguments)];this.$modal.find(".modal-content").css("height","100%");this.$fields_list=this.$('.o_fields_list');this.$import_compat_radios=this.$('.o_import_compat input');waitFor.push(this._rpc({route:'/web/export/formats'}).then(do_setup_export_formats));var got_fields=new $.Deferred();this.$import_compat_radios.change(function(e){self.$('.o_field_tree_structure').remove();self._rpc({route:'/web/export/get_fields',params:{model:self.record.model,import_compat:!!$(e.target).val(),},}).done(function(records){var compatible_fields=_.map(records,function(record){return record.id;});self.$fields_list.find('option').filter(function(){var option_field=$(this).attr('value');if(compatible_fields.indexOf(option_field)===-1){return true;}}).remove();got_fields.resolve();self.on_show_data(records);});}).eq(0).change();waitFor.push(got_fields);waitFor.push(this.getParent().getActiveDomain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().getSelectedIds();self.domain=self.record.domain;}else{self.ids_to_export=false;self.domain=domain;}
self.on_show_domain();}));waitFor.push(this.show_exports_list());return $.when.apply($,waitFor);function do_setup_export_formats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format,i){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name'});var $label=$('<label/>',{html:format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
$fmts.append($("<div/>").append($radio,$label));});self.$export_format_inputs=$fmts.find('input');self.$export_format_inputs.first().prop('checked',true);}},show_exports_list:function(){if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return $.when();}
var self=this;return this._rpc({model:'ir.exports',method:'search_read',fields:['name'],domain:[['resource','=',this.record.model]]}).then(function(export_list){if(!export_list.length){return;}
self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{'existing_exports':export_list}));self.$('.o_exported_lists_select').on('change',function(){self.$fields_list.empty();var export_id=self.$('.o_exported_lists_select option:selected').val();if(export_id){self._rpc({route:'/web/export/namelist',params:{model:self.record.model,export_id:parseInt(export_id,10),},}).then(do_load_export_field);}});self.$('.o_delete_exported_list').click(function(){var select_exp=self.$('.o_exported_lists_select option:selected');var options={confirm_callback:function(){if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$fields_list.empty();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}}};Dialog.confirm(this,_t("Do you really want to delete this export template?"),options);});});function do_load_export_field(field_list){_.each(field_list,function(field){self.$fields_list.append(new Option(field.label,field.name));});}},on_expand_action:function(record){if(!record['children']){return;}
var model=record['params']['model'];var prefix=record['params']['prefix'];var name=record['params']['name'];var exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var self=this;this._rpc({route:'/web/export/get_fields',params:{model:model,prefix:prefix,parent_name:name,import_compat:!!this.$import_compat_radios.filter(':checked').val(),parent_field_type:record['field_type'],exclude:exclude_fields},}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{this.show_content(record.id);}},on_show_domain:function(){this.$('p').first().after(QWeb.render('Export.DomainMessage',{record:this}));},on_show_data:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('open').find('.o_expand_parent').toggleClass('fa-plus fa-minus').next().after(QWeb.render('Export.TreeItems',{'fields':records,'debug':this.getSession().debug}));}else{this.$('.o_left_field_panel').empty().append($("<div/>").addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{'fields':records,'debug':this.getSession().debug})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$(".o_export_tree_item");this.$records.each(function(i,el){var $elem=$(el);$elem.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$elem.data('id')].required);});},show_content:function(id){var $this=this.$('.o_export_tree_item[data-id="'+id+'"]');$this.toggleClass('open');var is_open=$this.hasClass('open');$this.children('.o_expand_parent').toggleClass('fa-minus',!!is_open).toggleClass('fa-plus',!is_open);var $child_field=$this.find('.o_export_tree_item');var child_len=(id.split("/")).length+1;for(var i=0;i<$child_field.length;i++){var $child=$child_field.eq(i);if(!is_open){$child.hide();}else if(child_len===$child_field.eq(i).data('id').split("/").length){if($child.hasClass('open')){$child.removeClass('open');$child.children('.o_expand_parent').removeClass('fa-minus').addClass('fa-plus');}
$child.show();}}},add_field:function(field_id,string){var $field_list=this.$('.o_fields_list');field_id=this.records[field_id].value||field_id;if($field_list.find("option[value='"+field_id+"']").length===0){$field_list.append(new Option(string,field_id));}},get_fields:function(){var $export_fields=this.$(".o_fields_list option").map(function(){return $(this).val();}).get();if($export_fields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return $export_fields;},export_data:function(){var self=this;var exported_fields=this.$('.o_fields_list option').map(function(){return{name:(self.records[this.value]||this).value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
exported_fields.unshift({name:'id',label:_t('External ID')});var export_format=this.$export_format_inputs.filter(':checked').val();framework.blockUI();this.getSession().get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.record.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:pyeval.eval('contexts',[this.record.getContext()]),import_compat:!!this.$import_compat_radios.filter(':checked').val(),})},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'dp.change':'changeDatetime','dp.show':'_onShow','change .o_datepicker_input':'changeDatetime',},init:function(parent,options){this._super.apply(this,arguments);var l10n=_t.database.parameters;this.name=parent.name;this.options=_.defaults(options||{},{format:this.type_of_date==='datetime'?time.getLangDatetimeFormat():time.getLangDateFormat(),minDate:moment({y:1900}),maxDate:moment().add(200,"y"),calendarWeeks:true,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',next:'fa fa-chevron-right',previous:'fa fa-chevron-left',up:'fa fa-chevron-up',down:'fa fa-chevron-down',close:'fa fa-times',},locale:moment.locale(),allowInputToggle:true,keyBinds:null,widgetParent:'body',useCurrent:false,});},start:function(){this.$input=this.$('input.o_datepicker_input');this.$input.focus(function(e){e.stopImmediatePropagation();});this.$input.datetimepicker(this.options);this.picker=this.$input.data('DateTimePicker');this.$input.click(this.picker.toggle.bind(this.picker));this._setReadonly(false);},destroy:function(){this.picker.destroy();this._super.apply(this,arguments);},changeDatetime:function(){if(this.isValid()){var oldValue=this.getValue();this._setValueFromUi();var newValue=this.getValue();var hasChanged=!oldValue!==!newValue;if(oldValue&&newValue){var formattedOldValue=oldValue.format(time.getLangDatetimeFormat());var formattedNewValue=newValue.format(time.getLangDatetimeFormat())
if(formattedNewValue!==formattedOldValue){hasChanged=true;}}
if(hasChanged){this.trigger("datetime_changed");}}},getValue:function(){var value=this.get('value');return value&&value.clone();},isValid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this._parseClient(value);return true;}catch(e){return false;}}},setValue:function(value){this.set({'value':value});var formatted_value=value?this._formatClient(value):null;this.$input.val(formatted_value);if(this.picker){this.picker.date(value||null);}},_formatClient:function(v){return field_utils.format[this.type_of_date](v,null,{timezone:false});},_parseClient:function(v){return field_utils.parse[this.type_of_date](v,null,{timezone:false});},_setReadonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},_setValueFromUi:function(){var value=this.$input.val()||false;this.setValue(this._parseClient(value));},_onShow:function(){if(this.$input.val().length!==0&&this.isValid()){var value=this._parseClient(this.$input.val());this.picker.date(value);this.$input.select();}},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime",init:function(){this._super.apply(this,arguments);this.options=_.defaults(this.options,{showClose:true,});},});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/domain_selector_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelectorDialog",function(require){"use strict";var core=require("web.core");var Dialog=require("web.Dialog");var DomainSelector=require("web.DomainSelector");var _t=core._t;return Dialog.extend({init:function(parent,model,domain,options){this.model=model;this.options=_.extend({readonly:true,debugMode:false,},options||{});var buttons;if(this.options.readonly){buttons=[{text:_t("Close"),close:true},];}else{buttons=[{text:_t("Save"),classes:"btn-primary",close:true,click:function(){this.trigger_up("domain_selected",{domain:this.domainSelector.getDomain()});}},{text:_t("Discard"),close:true},];}
this._super(parent,_.extend({},{title:_t("Domain"),buttons:buttons,},options||{}));this.domainSelector=new DomainSelector(this,model,domain,options);},start:function(){var self=this;this.opened().then(function(){self.$el.css('overflow','visible').closest('.modal-dialog').css('height','auto');});return $.when(this._super.apply(this,arguments),this.domainSelector.appendTo(this.$el));},});});;

/* /web/static/src/js/widgets/domain_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelector",function(require){"use strict";var core=require("web.core");var datepicker=require("web.datepicker");var Domain=require("web.Domain");var field_utils=require("web.field_utils");var ModelFieldSelector=require("web.ModelFieldSelector");var Widget=require("web.Widget");var _t=core._t;var _lt=core._lt;var operator_mapping={"=":"=","!=":_lt("not"),">":">","<":"<",">=":">=","<=":"<=","ilike":_lt("contains"),"not ilike":_lt("not contains"),"in":_lt("in"),"not in":_lt("not in"),"child_of":_lt("child of"),"parent_of":_lt("parent of"),"like":"like","not like":"not like","=like":"=like","=ilike":"=ilike","set":_lt("is set"),"not set":_lt("is not set"),};var DomainNode=Widget.extend({events:{"click .o_domain_add_node_button":"_onAddButtonClick","click .o_domain_delete_node_button":"_onDeleteButtonClick","mouseenter button":"_onButtonEntered","mouseleave button":"_onButtonLeft",},init:function(parent,model,domain,options){this._super.apply(this,arguments);this.model=model;this.options=_.extend({readonly:true,operators:null,debugMode:false,},options||{});this.readonly=this.options.readonly;this.debug=this.options.debugMode;},isValid:function(){},getDomain:function(){},_onAddButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("add_node_clicked",{newBranch:!!$(e.currentTarget).data("branch"),child:this});},_onDeleteButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("delete_node_clicked",{child:this});},_onButtonEntered:function(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);this.$el.toggleClass("o_hover_btns",$target.hasClass("o_domain_delete_node_button"));this.$el.toggleClass("o_hover_add_node",$target.hasClass("o_domain_add_node_button"));this.$el.toggleClass("o_hover_add_inset_node",!!$target.data("branch"));},_onButtonLeft:function(e){e.preventDefault();e.stopPropagation();this.$el.removeClass("o_hover_btns o_hover_add_node o_hover_add_inset_node");},});var DomainTree=DomainNode.extend({template:"DomainTree",events:_.extend({},DomainNode.prototype.events,{"click .o_domain_tree_operator_selector > ul > li > a":"_onOperatorChange",}),custom_events:{"add_node_clicked":"_onNodeAdditionAsk","delete_node_clicked":"_onNodeDeletionAsk",},init:function(parent,model,domain){this._super.apply(this,arguments);var parsedDomain=this._parseDomain(domain);if(parsedDomain){this._initialize(parsedDomain);}},start:function(){this._postRender();return $.when(this._super.apply(this,arguments),this._renderChildrenTo(this.$childrenContainer));},isValid:function(){for(var i=0;i<this.children.length;i++){var cValid=this.children[i].isValid();if(!cValid){return cValid;}}
return this._isValid;},getDomain:function(){var childDomains=[];var nbChildren=0;_.each(this.children,function(child){var childDomain=child.getDomain();if(childDomain.length){nbChildren++;childDomains=childDomains.concat(child.getDomain());}});var nbChildRequired=this.operator==="!"?1:2;var operators=_.times(nbChildren-nbChildRequired+1,_.constant(this.operator));return operators.concat(childDomains);},_addChild:function(domain,afterNode){var i=afterNode?_.indexOf(this.children,afterNode):this.children.length;if(i<0)return false;this.children.splice(i+1,0,instantiateNode(this,this.model,domain,this.options));this.trigger_up("domain_changed",{child:this});return true;},_addFlattenedChildren:function(domain){var node=instantiateNode(this,this.model,domain,this.options);if(node===null){return;}
if(!node.children||node.operator!==this.operator){this.children.push(node);return;}
_.each(node.children,(function(child){child.setParent(this);this.children.push(child);}).bind(this));node.destroy();},_changeOperator:function(operator,silent){this.operator=operator;if(!silent)this.trigger_up("domain_changed",{child:this});},_initialize:function(domain){this._isValid=true;this.operator=domain[0];this.children=[];if(domain.length<=1){return;}
var nbLeafsToFind=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){nbLeafsToFind++;}else if(domain[i]!=="!"){nbLeafsToFind--;}
if(!nbLeafsToFind){var partLeft=domain.slice(1,i+1);var partRight=domain.slice(i+1);if(partLeft.length){this._addFlattenedChildren(partLeft);}
if(partRight.length){this._addFlattenedChildren(partRight);}
break;}}
this._isValid=(nbLeafsToFind===0);if(this.operator==="!"){this.children[0].noControlPanel=true;}},_postRender:function(){this.$childrenContainer=this.$("> .o_domain_node_children_container");},_removeChild:function(oldChild){var i=_.indexOf(this.children,oldChild);if(i<0)return false;this.children[i].destroy();this.children.splice(i,1);this.trigger_up("domain_changed",{child:this});return true;},_renderChildrenTo:function($to){var $div=$("<div/>");return $.when.apply($,_.map(this.children,(function(child){return child.appendTo($div);}).bind(this))).then((function(){_.each(this.children,function(child){child.$el.appendTo($to);});}).bind(this));},_parseDomain:function(domain){var parsedDomain=false;try{parsedDomain=Domain.prototype.stringToArray(domain);this.invalidDomain=false;}catch(err){this.invalidDomain=true;this.children=[];}
return parsedDomain;},_onOperatorChange:function(e){e.preventDefault();e.stopPropagation();this._changeOperator($(e.target).data("operator"));},_onNodeAdditionAsk:function(e){var domain=[["id","=",1]];if(e.data.newBranch){domain=[this.operator==="&"?"|":"&"].concat(domain).concat(domain);}
if(this._addChild(domain,e.data.child)){e.stopPropagation();}},_onNodeDeletionAsk:function(e){if(this._removeChild(e.data.child)){e.stopPropagation();}},});var DomainSelector=DomainTree.extend({template:"DomainSelector",events:_.extend({},DomainTree.prototype.events,{"click .o_domain_add_first_node_button":"_onAddFirstButtonClick","change .o_domain_debug_input":"_onDebugInputChange",}),custom_events:_.extend({},DomainTree.prototype.custom_events,{domain_changed:"_onDomainChange",}),start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.invalidDomain){var msg=_t("This domain is not supported.");self.$el.html(msg);}});},setDomain:function(domain){if(domain===Domain.prototype.arrayToString(this.getDomain())){return $.when();}
var parsedDomain=this._parseDomain(domain);if(parsedDomain){return this._redraw(parsedDomain);}},_initialize:function(domain){if(domain.length>1){Domain.prototype.normalizeArray(domain);}else{domain=["&"].concat(domain);}
return this._super(domain);},_postRender:function(){this._super.apply(this,arguments);this.$debugInput=this.$(".o_domain_debug_input");if(this.$debugInput.length){this.$debugInput.val(Domain.prototype.arrayToString(this.getDomain()));}
if(!this._isValid){this.do_warn(_t("Domain error"),_t("The domain you entered is not properly formed"));}},_redraw:function(domain){var oldChildren=this.children.slice();this._initialize(domain||this.getDomain());return this._renderChildrenTo($("<div/>")).then((function(){this.renderElement();this._postRender();_.each(this.children,(function(child){child.$el.appendTo(this.$childrenContainer);}).bind(this));_.each(oldChildren,function(child){child.destroy();});}).bind(this));},_onAddFirstButtonClick:function(){this._addChild([["id","=",1]]);},_onDebugInputChange:function(e){var domain;try{domain=Domain.prototype.stringToArray($(e.currentTarget).val());}catch(err){this.do_warn(_t("Syntax error"),_t("The domain you entered is not properly formed"));return;}
this._redraw(domain).then((function(){this.trigger_up("domain_changed",{child:this,alreadyRedrawn:true});}).bind(this));},_onDomainChange:function(e){if(!e.data.alreadyRedrawn){this._redraw();}},});var DomainLeaf=DomainNode.extend({template:"DomainLeaf",events:_.extend({},DomainNode.prototype.events,{"change .o_domain_leaf_operator_select":"_onOperatorSelectChange","change .o_domain_leaf_value_input":"_onValueInputChange","click .o_domain_leaf_value_add_tag_button":"on_add_tag","keyup .o_domain_leaf_value_tags input":"on_add_tag","click .o_domain_leaf_value_remove_tag_button":"on_remove_tag",}),custom_events:{"field_chain_changed":"_onFieldChainChange",},init:function(parent,model,domain,options){this._super.apply(this,arguments);var currentDomain=Domain.prototype.stringToArray(domain);this.chain=currentDomain[0][0];this.operator=currentDomain[0][1];this.value=currentDomain[0][2];this.operator_mapping=operator_mapping;},willStart:function(){var defs=[this._super.apply(this,arguments)];this.fieldSelector=new ModelFieldSelector(this,this.model,this.chain?this.chain.split("."):[],this.options);defs.push(this.fieldSelector.appendTo($("<div/>")).then((function(){var wDefs=[];if(!this.readonly){var selectedField=this.fieldSelector.getSelectedField()||{};this.operators=this._getOperatorsFromType(selectedField.type);if(_.contains(["child_of","parent_of","like","not like","=like","=ilike"],this.operator)){this.operators[this.operator]=operator_mapping[this.operator];}else if(!this.operators[this.operator]){this.operators[this.operator]="?";}
this.selectionChoices=null;if(selectedField.type==="boolean"){this.selectionChoices=[["1",_t("set (true)")],["0",_t("not set (false)")]];}else if(selectedField.type==="selection"){this.selectionChoices=selectedField.selection;}
this.displayValue=this.value;try{if(selectedField&&!selectedField.relation&&!_.isArray(this.value)){this.displayValue=field_utils.format[selectedField.type](this.value,selectedField);}}catch(err){}
this.displayOperator=this.operator;if(selectedField.type==="boolean"){this.displayValue=this.value?"1":"0";}else if((this.operator==="!="||this.operator==="=")&&this.value===false){this.displayOperator=this.operator==="!="?"set":"not set";}
if(_.contains(["date","datetime"],selectedField.type)){this.valueWidget=new(selectedField.type==="datetime"?datepicker.DateTimeWidget:datepicker.DateWidget)(this);wDefs.push(this.valueWidget.appendTo("<div/>").then((function(){this.valueWidget.$el.addClass("o_domain_leaf_value_input");this.valueWidget.setValue(moment(this.value));this.valueWidget.on("datetime_changed",this,function(){this._changeValue(this.valueWidget.getValue());});}).bind(this)));}
return $.when.apply($,wDefs);}}).bind(this)));return $.when.apply($,defs);},start:function(){this.fieldSelector.$el.prependTo(this.$("> .o_domain_leaf_info, > .o_domain_leaf_edition"));if(!this.readonly&&this.valueWidget){this.$(".o_domain_leaf_value_input").replaceWith(this.valueWidget.$el);}
return this._super.apply(this,arguments);},isValid:function(){return this.fieldSelector&&this.fieldSelector.isValid();},getDomain:function(){return[[this.chain,this.operator,this.value]];},_changeFieldChain:function(chain,silent){this.chain=chain.join(".");this.fieldSelector.setChain(chain).then((function(){if(!this.fieldSelector.isValid())return;var selectedField=this.fieldSelector.getSelectedField()||{};var operators=this._getOperatorsFromType(selectedField.type);if(operators[this.operator]===undefined){this._changeOperator("=",true);}
this._changeValue(this.value,true);if(!silent)this.trigger_up("domain_changed",{child:this});}).bind(this));},_changeOperator:function(operator,silent){this.operator=operator;if(_.contains(["set","not set"],this.operator)){this.operator=this.operator==="not set"?"=":"!=";this.value=false;}else if(_.contains(["in","not in"],this.operator)){this.value=_.isArray(this.value)?this.value:this.value?(""+this.value).split(","):[];}else{if(_.isArray(this.value)){this.value=this.value.join(",");}
this._changeValue(this.value,true);}
if(!silent)this.trigger_up("domain_changed",{child:this});},_changeValue:function(value,silent){var couldNotParse=false;var selectedField=this.fieldSelector.getSelectedField()||{};try{this.value=field_utils.parse[selectedField.type](value,selectedField);}catch(err){this.value=value;couldNotParse=true;}
if(selectedField.type==="boolean"){if(!_.isBoolean(this.value)){this.value=!!parseFloat(this.value);}}else if(selectedField.type==="selection"){if(!_.some(selectedField.selection,(function(option){return option[0]===this.value;}).bind(this))){this.value=selectedField.selection[0][0];}}else if(_.contains(["date","datetime"],selectedField.type)){if(couldNotParse||_.isBoolean(this.value)){this.value=field_utils.parse[selectedField.type](field_utils.format[selectedField.type](moment())).toJSON();}else{this.value=this.value.toJSON();}}else{if(_.isBoolean(this.value)){this.value="";}else if(_.isObject(this.value)&&!_.isArray(this.value)){this.value=this.value.id||value||"";}}
if(!silent)this.trigger_up("domain_changed",{child:this});},_getOperatorsFromType:function(type){var operators={};switch(type){case"boolean":operators={"=":_t("is"),"!=":_t("is not"),};break;case"char":case"text":case"html":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set","in","not in");break;case"many2many":case"one2many":case"many2one":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set");break;case"integer":case"float":case"monetary":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","ilike","not ilike","set","not set");break;case"selection":operators=_.pick(operator_mapping,"=","!=","set","not set");break;case"date":case"datetime":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","set","not set");break;default:operators=_.extend({},operator_mapping);break;}
if(this.options.operators){operators=_.pick.apply(_,[operators].concat(this.options.operators));}
return operators;},_onOperatorSelectChange:function(e){this._changeOperator($(e.currentTarget).val());},_onValueInputChange:function(e){if(e.currentTarget!==e.target)return;this._changeValue($(e.currentTarget).val());},_onFieldChainChange:function(e){this._changeFieldChain(e.data.chain);},on_add_tag:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER)return;if(!_.contains(["not in","in"],this.operator))return;var values=_.isArray(this.value)?this.value.slice():[];var $input=this.$(".o_domain_leaf_value_tags input");var val=$input.val().trim();if(val&&values.indexOf(val)<0){values.push(val);_.defer(this._changeValue.bind(this,values));$input.focus();}},on_remove_tag:function(e){var values=_.isArray(this.value)?this.value.slice():[];var val=this.$(e.currentTarget).data("value");var index=values.indexOf(val);if(index>=0){values.splice(index,1);_.defer(this._changeValue.bind(this,values));}},});function instantiateNode(parent,model,domain,options){if(domain.length>1){return new DomainTree(parent,model,domain,options);}else if(domain.length===1){return new DomainLeaf(parent,model,domain,options);}
return null;}
return DomainSelector;});;

/* /web/static/src/js/widgets/iframe_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this._bindEvents.bind(this));return this._super();},_bindEvents:function(){this.$el.contents().click(this._onIFrameClicked.bind(this));},_onIFrameClicked:function(event){}});return IFrameWidget;});;

/* /web/static/src/js/chrome/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;core.bus.on('rpc_request',this,this.request_call);core.bus.on("rpc_response",this,this.response_call);core.bus.on("rpc_response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/model_field_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.ModelFieldSelector",function(require){"use strict";var core=require("web.core");var Widget=require("web.Widget");var _t=core._t;var modelFieldsCache={cache:{},cacheDefs:{},};core.bus.on('clear_cache',null,function(){modelFieldsCache.cache={};modelFieldsCache.cacheDefs={};});var ModelFieldSelector=Widget.extend({template:"ModelFieldSelector",events:{},editionEvents:{"focusin":"_onFocusIn","focusout":"_onFocusOut","click .o_field_selector_close":"_onCloseClick","click .o_field_selector_prev_page":"_onPrevPageClick","click .o_field_selector_next_page":"_onNextPageClick","click li.o_field_selector_select_button":"_onLastFieldClick","change input":"_onInputChange","mouseover li.o_field_selector_item":"_onItemHover","keydown":"_onKeydown",},init:function(parent,model,chain,options){this._super.apply(this,arguments);this.model=model;this.chain=chain;this.options=_.extend({readonly:true,filters:{},fields:null,followRelations:true,debugMode:false,},options||{});this.options.filters=_.extend({searchable:true,},this.options.filters);this.pages=[];this.dirty=false;if(!this.options.readonly){_.extend(this.events,this.editionEvents);}},willStart:function(){return $.when(this._super.apply(this,arguments),this._prefill());},start:function(){this.$value=this.$(".o_field_selector_value");this.$popover=this.$(".o_field_selector_popover");this.$input=this.$popover.find("input");this.$valid=this.$(".o_field_selector_warning");this._render();return this._super.apply(this,arguments);},getSelectedField:function(){return _.findWhere(this.pages[this.chain.length-1],{name:_.last(this.chain)});},isValid:function(){return this.valid;},setChain:function(chain){if(_.isEqual(chain,this.chain)){return $.when();}
this.chain=chain;return this._prefill().then(this._render.bind(this));},_addChainNode:function(fieldName){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.push(fieldName);},_getLastPageField:function(name){return _.findWhere(_.last(this.pages),{name:name,});},_getModelFieldsFromCache:function(model,filters){var def=modelFieldsCache.cacheDefs[model];if(!def){def=modelFieldsCache.cacheDefs[model]=this._rpc({model:model,method:'fields_get',args:[false,["store","searchable","type","string","relation","selection","related"]],context:this.getSession().user_context,}).then((function(fields){modelFieldsCache.cache[model]=sortFields(fields,model);}).bind(this));}
return def.then((function(){return _.filter(modelFieldsCache.cache[model],function(f){return!filters.searchable||f.searchable;});}).bind(this));},_goToNextPage:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._pushPageData(field.relation).then(this._render.bind(this));},_goToPrevPage:function(){if(this.pages.length<=0)return;this._validate(true);this._removeChainNode();if(this.pages.length>1){this.pages.pop();}
this._render();},_hidePopover:function(){if(!this._isOpen)return;this._isOpen=false;this.$popover.addClass("hidden");if(this.dirty){this.dirty=false;this.pages=this.pages.slice(0,this.chain.length||1);this.trigger_up("field_chain_changed",{chain:this.chain});}},_prefill:function(){this.pages=[];return this._pushPageData(this.model).then((function(){this._validate(true);return(this.chain.length?processChain.call(this,this.chain.slice().reverse()):$.when());}).bind(this));function processChain(chain){var field=this._getLastPageField(chain.pop());if(field&&field.relation&&chain.length>0){return this._pushPageData(field.relation).then(processChain.bind(this,chain));}else if(field&&chain.length===0){return $.when();}else{this._validate(false);}
return $.when();}},_pushPageData:function(model){var def;if(this.model===model&&this.options.fields){def=$.when(sortFields(this.options.fields,model));}else{def=this._getModelFieldsFromCache(model,this.options.filters);}
return def.then((function(fields){this.pages.push(fields);}).bind(this));},_removeChainNode:function(){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.pop();},_render:function(){this.$value.html(core.qweb.render(this.template+".value",{chain:this.chain,pages:this.pages,}));this.$valid.toggleClass("hidden",!!this.isValid());var page=_.last(this.pages);var title="";if(this.pages.length>1){var prevField=_.findWhere(this.pages[this.pages.length-2],{name:(this.chain.length===this.pages.length)?this.chain[this.chain.length-2]:_.last(this.chain),});if(prevField)title=prevField.string;}
this.$(".o_field_selector_popover_header .o_field_selector_title").text(title);this.$(".o_field_selector_page").replaceWith(core.qweb.render(this.template+".page",{lines:page,followRelations:this.options.followRelations,debug:this.options.debugMode,}));this.$input.val(this.chain.join("."));},_selectField:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._render();this._hidePopover();},_showPopover:function(){if(this._isOpen)return;this._isOpen=true;this.$popover.removeClass("hidden");},_validate:function(valid){this.valid=!!valid;if(!this.valid){this.do_warn(_t("Invalid field chain"),_t("The field chain is not valid. Did you maybe use a non-existing field name or followed a non-relational field?"));}},_onFocusIn:function(){clearTimeout(this._hidePopoverTimeout);this._showPopover();},_onFocusOut:function(){this._hidePopoverTimeout=_.defer(this._hidePopover.bind(this));},_onCloseClick:function(){this._hidePopover();},_onPrevPageClick:function(){this._goToPrevPage();},_onNextPageClick:function(e){e.stopPropagation();this._goToNextPage(this._getLastPageField($(e.currentTarget).data("name")));},_onLastFieldClick:function(e){this._selectField(this._getLastPageField($(e.currentTarget).data("name")));},_onInputChange:function(){var userChainStr=this.$input.val();var userChain=userChainStr.split(".");if(!this.options.followRelations&&userChain.length>1){this.do_warn(_t("Relation not allowed"),_t("You cannot follow relations for this field chain construction"));userChain=[userChain[0]];}
this.setChain(userChain).then((function(){this.trigger_up("field_chain_changed",{chain:this.chain});}).bind(this));},_onItemHover:function(e){this.$("li.o_field_selector_item").removeClass("active");$(e.currentTarget).addClass("active");},_onKeydown:function(e){if(!this.$popover.is(":visible"))return;var inputHasFocus=this.$input.is(":focus");switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.preventDefault();var $active=this.$("li.o_field_selector_item.active");var $to=$active[e.which===$.ui.keyCode.DOWN?"next":"prev"](".o_field_selector_item");if($to.length){$active.removeClass("active");$to.addClass("active");this.$popover.focus();var $page=$to.closest(".o_field_selector_page");var full_height=$page.height();var el_position=$to.position().top;var el_height=$to.outerHeight();var current_scroll=$page.scrollTop();if(el_position<0){$page.scrollTop(current_scroll-el_height);}else if(full_height<el_position+el_height){$page.scrollTop(current_scroll+el_height);}}
break;case $.ui.keyCode.RIGHT:if(inputHasFocus)break;e.preventDefault();var name=this.$("li.o_field_selector_item.active").data("name");if(name){var field=this._getLastPageField(name);if(field.relation){this._goToNextPage(field);}}
break;case $.ui.keyCode.LEFT:if(inputHasFocus)break;e.preventDefault();this._goToPrevPage();break;case $.ui.keyCode.ESCAPE:e.stopPropagation();this._hidePopover();break;case $.ui.keyCode.ENTER:if(inputHasFocus)break;e.preventDefault();this._selectField(this._getLastPageField(this.$("li.o_field_selector_item.active").data("name")));break;}}});return ModelFieldSelector;function sortFields(fields,model){return _.chain(fields).pairs().sortBy(function(p){return p[1].string;}).map(function(p){return _.extend({name:p[0],model:model,},p[1]);}).value();}});;

/* /web/static/src/js/widgets/notification.js defined in bundle 'web.assets_backend' */
odoo.define('web.notification',function(require){"use strict";var Widget=require('web.Widget');var Notification=Widget.extend({template:'Notification',events:{'click .o_close':function(e){e.preventDefault();this.destroy(true);}},init:function(parent,title,text,sticky){this._super.apply(this,arguments);this.title=title;this.text=text;this.sticky=!!sticky;},start:function(){this._super.apply(this,arguments);var self=this;this.$el.animate({opacity:1.0},400,"swing",function(){if(!self.sticky){setTimeout(function(){self.destroy(true);},2500);}});},destroy:function(animate){if(!animate){return this._super.apply(this,arguments);}
var self=this,superDestroy=this._super;this.$el.animate({opacity:0.0},400,"swing",function(){self.$el.animate({height:0},400,"swing",function(){superDestroy.call(self);});});},});var Warning=Notification.extend({template:'Warning',start:function(){this.$el.addClass('o_error');return this._super.apply(this,arguments);},});var NotificationManager=Widget.extend({className:'o_notification_manager',display:function(notification){notification.appendTo(this.$el);return notification;},notify:function(title,text,sticky){return this.display(new Notification(this,title,text,sticky));},warn:function(title,text,sticky){return this.display(new Warning(this,title,text,sticky));},});return{Notification:Notification,Warning:Warning,NotificationManager:NotificationManager,};});;

/* /web/static/src/js/chrome/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({events:{"click .dropdown-menu li a":"_onDropdownClicked"},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{'editable':true});this.env=options.env;this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};if(options.actions){this._addToolbarActions(options.actions);}},start:function(){this._super.apply(this,arguments);this.$el.addClass('btn-group');this._redraw();},updateEnv:function(env){this.env=env;this._redraw();},_addItems:function(sectionCode,items){if(items){this.items[sectionCode].unshift.apply(this.items[sectionCode],items);}},_addToolbarActions:function(toolbarActions){var self=this;_.each(['print','action','relate'],function(type){if(type in toolbarActions){var actions=toolbarActions[type];if(actions&&actions.length){var items=_.map(actions,function(action){return{label:action.name,action:action,};});self._addItems(type==='print'?'print':'other',items);}}});if('other'in toolbarActions){this._addItems('other',toolbarActions.other);}},_onItemActionClicked:function(item){var self=this;this.trigger_up('sidebar_data_asked',{callback:function(env){self.env=env;var activeIdsContext={active_id:env.activeIds[0],active_ids:env.activeIds,active_model:env.model,};if(env.domain){activeIdsContext.active_domain=env.domain;}
var context=pyeval.eval('context',new Context(env.context,activeIdsContext));self._rpc({route:'/web/action/load',params:{action_id:item.action.id,context:context,},}).done(function(result){result.context=new Context(result.context||{},activeIdsContext).set_eval_context(context);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.trigger_up('reload');},});});}});},_redraw:function(){this.$el.html(QWeb.render('Sidebar',{widget:this}));this.$('.o_dropdown').each(function(){if(!$(this).find('li').length){$(this).hide();}});this.$("[title]").tooltip({delay:{show:500,hide:0}});},_onDropdownClicked:function(event){var section=$(event.currentTarget).data('section');var index=$(event.currentTarget).data('index');var item=this.items[section][index];if(item.callback){item.callback.apply(this,[item]);}else if(item.action){this._onItemActionClicked(item);}else if(item.url){return true;}
event.preventDefault();},});return Sidebar;});;

/* /web/static/src/js/chrome/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_next':'_onNext','click .o_pager_previous':'_onPrevious','click .o_pager_value':'_onEdit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,validate:function(){return $.Deferred().resolve();},withAccessKey:true,});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},disable:function(){this.disabled=true;this._updateArrows();},enable:function(){this.disabled=false;this._updateArrows();},next:function(){this._changeSelection(direction.next);},previous:function(){this._changeSelection(direction.previous);},updateState:function(state,options){_.extend(this.state,state);this._render();if(options&&options.notifyChange){this.trigger('pager_changed',_.clone(this.state));}},_changeSelection:function(direction){var self=this;this.options.validate().then(function(){var size=self.state.size;var current_min=self.state.current_min;var limit=self.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
self.state.current_min=current_min;self._render();self.trigger('pager_changed',_.clone(self.state));});},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>',{class:'o_input',type:'text',value:this.$value.html()});this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;if(size===0||(this.options.single_page_hidden&&this._singlePage())){this.do_hide();}else{this.do_show();this._updateArrows();var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},_save:function($input){var self=this;this.options.validate().then(function(){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,self.state.size);var max=utils.confine(parseInt(value[1],10),1,self.state.size);if(!isNaN(min)){self.state.current_min=min;if(!isNaN(max)){self.state.limit=utils.confine(max-min+1,1,self.state.size);}else{self.state.limit=1;}
self.trigger('pager_changed',_.clone(self.state));}}).always(function(){self._render();});},_singlePage:function(){var state=this.state;return(1===state.current_min)&&(state.current_max===state.size);},_updateArrows:function(){var disabled=this.disabled||this._singlePage();this.$('button').prop('disabled',disabled);},_onEdit:function(event){event.stopPropagation();if(!this.disabled){this._edit();}},_onNext:function(event){event.stopPropagation();this.next();},_onPrevious:function(event){event.stopPropagation();this.previous();},});return Pager;});;

/* /web/static/src/js/chrome/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];this.load=$.Deferred();},start:function(){var self=this;self._super.apply(this,arguments);self._loadItems();$.when.apply($,self.items).always(function(){self.load.resolve();});return self.load;},_loadItems:function(){var self=this;SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});_.each(SystrayMenu.Items,function(WidgetClass){var cur_systray_item=new WidgetClass(self);self.widgets.push(cur_systray_item);self.items.push(cur_systray_item.prependTo(self.$el));});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var _t=core._t;var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',willStart:function(){this.isMobile=config.device.isMobile;if(!session.user_companies){return $.Deferred().reject();}
return this._super();},start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',_.debounce(function(ev){ev.preventDefault();var company_id=$(ev.currentTarget).data('company-id');self._rpc({model:'res.users',method:'write',args:[[session.uid],{'company_id':company_id}],}).then(function(){location.reload();});},1500,true));var companies_list='';if(this.isMobile){companies_list='<li class="bg-info">'+_t('Tap on the list to change company')+'</li>';}
else{self.$('.oe_topbar_name').text(session.user_companies.current_company[1]);}
_.each(session.user_companies.allowed_companies,function(company){var a='';if(company[0]===session.user_companies.current_company[0]){a='<i class="fa fa-check mr8"></i>';}else{a='<span class="mr24"/>';}
companies_list+='<li><a href="#" data-menu="company" data-company-id="'+company[0]+'">'+a+company[1]+'</a></li>';});self.$('.dropdown-menu').html(companies_list);return this._super();},});SystrayMenu.Items.push(SwitchCompanyMenu);return SwitchCompanyMenu;});;

/* /web/static/src/js/chrome/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var framework=require('web.framework');var Widget=require('web.Widget');var UserMenu=Widget.extend({template:'UserMenu',start:function(){var self=this;var session=this.getSession();this.$el.on('click','li a[data-menu]',function(ev){ev.preventDefault();var menu=$(this).data('menu');self['_onMenu'+menu.charAt(0).toUpperCase()+menu.slice(1)]();});return this._super.apply(this,arguments).then(function(){var $avatar=self.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return $.when();}
var topbar_name=session.name;if(session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
self.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid,});$avatar.attr('src',avatar_src);});},_onMenuAccount:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:'/web/session/account'}).then(function(url){framework.redirect(url);}).fail(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},_onMenuDocumentation:function(){window.open('https://www.odoo.com/documentation/user','_blank');},_onMenuLogout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},_onMenuSettings:function(){var self=this;var session=this.getSession();this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:"/web/action/load",params:{action_id:"base.action_res_users_my",},}).done(function(result){result.res_id=session.uid;self.do_action(result);});},});},_onMenuSupport:function(){window.open('https://www.odoo.com/buy','_blank');},});return UserMenu;});;

/* /web/static/src/js/chrome/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.Menu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var Menu=Widget.extend({init:function(){this._super.apply(this,arguments);this.is_bound=$.Deferred();this.data={data:{children:[]}};core.bus.on('change_menu_section',this,this.on_change_top_menu);},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.o_sub_menu');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.on('click','a[data-menu]',function(event){event.preventDefault();var menu_id=$(event.currentTarget).data('menu');core.bus.trigger('change_menu_section',menu_id);});this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').addClass('o_hidden');if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);core.bus.on('resize',this,function(){if($(window).width()<768){lazyreflow('all_outside');}else{lazyreflow();}});core.bus.trigger('resize');this.is_bound.resolve();},reflow:function(behavior){var self=this;var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){self.$el.show();this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li').not($more_container).not($systray.find('li')).hide();self.$el.show();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>=remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);var $toplevel=self.$el.children("li:visible");if($toplevel.length===1){$toplevel.hide();}},open_menu:function(id){this.current_menu=id;session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.toggleClass('o_hidden',!$sub_menu.children().length);this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){$clicked_menu.parents().removeClass('o_hidden');if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggleClass('o_hidden');}else{$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});},open_action:function(id,menuID){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');if(!(menuID&&$menu.filter("[data-menu='"+menuID+"']").length)){menuID=$menu.data('menu');}
if(menuID){this.open_menu(menuID);}},menu_click:function(id){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){this.trigger('menu_click',{action_id:action_id,id:id,previous_menu_id:this.current_menu},$item);}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},on_change_top_menu:function(menu_id){var self=this;this.menu_click(menu_id);},on_menu_click:function(ev){ev.preventDefault();this.menu_click($(ev.currentTarget).data('menu'));},});return Menu;});;

/* /web/static/src/js/chrome/search_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchView',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var config=require('web.config');var core=require('web.core');var FavoriteMenu=require('web.FavoriteMenu');var FilterMenu=require('web.FilterMenu');var GroupByMenu=require('web.GroupByMenu');var pyeval=require('web.pyeval');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');var _t=core._t;var Backbone=window.Backbone;var FacetValue=Backbone.Model.extend({});var FacetValues=Backbone.Collection.extend({model:FacetValue});var Facet=Backbone.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;Backbone.Model.prototype.initialize.apply(this,arguments);this.values=new FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return Backbone.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return Backbone.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});var SearchQuery=Backbone.Collection.extend({model:Facet,initialize:function(){Backbone.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
Backbone.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});var InputView=Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.val('');this.trigger('blurred',this);},keydown:'onKeydown',},onKeydown:function(e){switch(e.which){case $.ui.keyCode.BACKSPACE:if(this.$el.val()===''){var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:if(this.el.selectionStart>0){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:if(this.el.selectionStart<this.$el.val().length){e.stopPropagation();}
break;}}});var FacetView=Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).hasClass('o_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('.o_facet_values').last();return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value,index){if(index>0){$('<span/>',{html:self.model.get('separator')||_t(" or ")}).addClass('o_facet_values_sep').appendTo($e);}
return new FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var FacetValueView=Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var SearchView=Widget.extend({events:{'click .o_searchview_more':function(e){$(e.target).toggleClass('fa-search-plus fa-search-minus');var visibleSearchMenu=this.call('local_storage','getItem','visible_search_menu');this.call('local_storage','setItem','visible_search_menu',visibleSearchMenu!=='true');this.toggle_buttons();},'keydown .o_searchview_input, .o_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;}},},defaults:_.extend({},Widget.prototype.defaults,{hidden:false,disable_filters:false,disable_groupby:false,disable_favorites:false,disable_custom_filters:false,}),template:"SearchView",init:function(parent,dataset,fvg,options){this._super.apply(this,arguments);this.options=options;this.dataset=dataset;this.fields_view=fvg;this.fields=this.fields_view.fields;this.query=undefined;this.title=this.options.action&&this.options.action.name;this.action_id=this.options.action&&this.options.action.id;this.search_fields=[];this.filters=[];this.groupbys=[];var visibleSearchMenu=this.call('local_storage','getItem','visible_search_menu');this.visible_filters=(visibleSearchMenu==='true');this.input_subviews=[];this.search_defaults=this.options.search_defaults||{};this.headless=this.options.hidden&&_.isEmpty(this.search_defaults);this.$buttons=this.options.$buttons;this.filter_menu=undefined;this.groupby_menu=undefined;this.favorite_menu=undefined;},willStart:function(){var self=this;var def;if(!this.options.disable_favorites){def=this.loadFilters(this.dataset,this.action_id).then(function(filters){self.favorite_filters=filters;});}
return $.when(this._super(),def);},start:function(){if(this.headless){this.do_hide();}
this.toggle_visibility(false);this.setup_global_completion();this.query=new SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));this.$('.o_searchview_more').toggleClass('fa-search-minus',this.visible_filters).toggleClass('fa-search-plus',!this.visible_filters);var menu_defs=[];this.prepare_search_inputs();if(this.$buttons){if(!this.options.disable_filters){this.filter_menu=new FilterMenu(this,this.filters,this.fields);menu_defs.push(this.filter_menu.appendTo(this.$buttons));}
if(!this.options.disable_groupby){this.groupby_menu=new GroupByMenu(this,this.groupbys,this.fields);menu_defs.push(this.groupby_menu.appendTo(this.$buttons));}
if(!this.options.disable_favorites){this.favorite_menu=new FavoriteMenu(this,this.query,this.dataset.model,this.action_id,this.favorite_filters);menu_defs.push(this.favorite_menu.appendTo(this.$buttons));}}
return $.when.apply($,menu_defs).then(this.set_default_filters.bind(this));},get_title:function(){return this.title;},set_default_filters:function(){var self=this,default_custom_filter=this.$buttons&&this.favorite_menu&&this.favorite_menu.get_default_filter();if(!self.options.disable_custom_filters&&default_custom_filter){return this.favorite_menu.toggle_filter(default_custom_filter,true);}
if(!_.isEmpty(this.search_defaults)){var inputs=this.search_fields.concat(this.filters,this.groupbys),search_defaults=_.invoke(inputs,'facet_for_defaults',this.search_defaults);return $.when.apply(null,search_defaults).then(function(){self.query.reset(_(arguments).compact(),{preventSearch:true});});}
this.query.reset([],{preventSearch:true});return $.when();},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();this.trigger_up('search',search);},build_search_data:function(){var domains=[],contexts=[],groupbys=[];this.query.each(function(facet){var field=facet.get('field');var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}});return{domains:domains,contexts:contexts,groupbys:groupbys,};},toggle_visibility:function(is_visible){this.do_toggle(!this.headless&&is_visible);if(this.$buttons){this.$buttons.toggle(!this.headless&&is_visible&&this.visible_filters);}
if(!config.device.touch&&config.device.size_class>=config.device.SIZES.SM){this.$('input').focus();}},toggle_buttons:function(is_visible){this.visible_filters=is_visible||!this.visible_filters;if(this.$buttons){this.$buttons.toggle(this.visible_filters);}},setup_global_completion:function(){var self=this;this.autocomplete=new AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),get_search_string:function(){return self.$('.o_searchview_input').val().trim();},});this.autocomplete.appendTo(this.$el);},complete_global_search:function(req,resp){var inputs=this.search_fields.concat(this.filters,this.groupbys);$.when.apply(null,_(inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){e.preventDefault();if(ui.item.facet&&ui.item.facet.values&&ui.item.facet.values.length&&String(ui.item.facet.values[0].value).trim()!==""){this.query.add(ui.item.facet);}else{this.query.trigger('add');}},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},renderFacets:function(collection,model,options){var self=this;var started=[];_.invoke(this.input_subviews,'destroy');this.input_subviews=[];this.query.each(function(facet){var f=new FacetView(this,facet);started.push(f.appendTo(self.$el));self.input_subviews.push(f);},this);var i=new InputView(this);started.push(i.appendTo(self.$el));self.input_subviews.push(i);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){_.last(self.input_subviews).$el.focus();});},childFocused:function(){this.$el.addClass('active');},childBlurred:function(){this.$el.val('').removeClass('active').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},prepare_search_inputs:function(){var self=this,arch=this.fields_view.arch;var filters=[].concat.apply([],_.map(arch.children,function(item){return item.tag!=='group'?eval_item(item):item.children.map(eval_item);}));function eval_item(item){var category='filters';if(item.attrs.context){try{var context=pyeval.eval('context',item.attrs.context);if(context.group_by){category='group_by';}}catch(e){}}
return{item:item,category:category,};}
var current_group=[],current_category='filters',categories={filters:this.filters,group_by:this.groupbys};_.each(filters.concat({category:'filters',item:'separator'}),function(filter){if(filter.item.tag==='filter'&&filter.category===current_category){return current_group.push(new search_inputs.Filter(filter.item,self));}
if(current_group.length){var group=new search_inputs.FilterGroup(current_group,self);categories[current_category].push(group);current_group=[];}
if(filter.item.tag==='field'){var attrs=filter.item.attrs;var field=self.fields_view.fields[attrs.name];if(field.type==="many2one"&&attrs.widget==="selection"){attrs.widget=undefined;}
var Obj=core.search_widgets_registry.getAny([attrs.widget,field.type]);if(Obj){self.search_fields.push(new(Obj)(filter.item,field,self));}}
if(filter.item.tag==='filter'){current_group.push(new search_inputs.Filter(filter.item,self));}
current_category=filter.category;});},});_.extend(SearchView,{SearchQuery:SearchQuery,Facet:Facet,});return SearchView;});;

/* /web/static/src/js/chrome/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var field_utils=require('web.field_utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .o_searchview_extended_prop_field':'changed','change .o_searchview_extended_prop_op':'operator_changed','click .o_searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".o_searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){this.value.show_inputs($(e.target));},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.o_searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=core.search_filters_registry.getAny([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.o_searchview_extended_prop_op'));});var $value_loc=this.$('.o_searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected,op_select=this.$('.o_searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:this.value.get_domain(field,operator),string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});var Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){var $value=this.$el.parent();switch($operator.val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},toString:function(){return this.get_value();}});var Char=Field.extend({tagName:'input',className:'o_input',attributes:{type:'text'},operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});var DateTime=Field.extend({tagName:'span',attributes:{type:'datetime'},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">=",text:_lt("is after")},{value:"<=",text:_lt("is before")},{value:"between",text:_lt("is between")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(index){var value=this["datewidget_"+(index||0)].getValue();return value.add(-this.getSession().getTZOffset(value),'minutes');},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];case'between':return[[field.name,'>=',this.get_value()],[field.name,'<=',this.get_value(1)]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){this._super.apply(this,arguments);if($operator.val()==="between"){if(!this.datewidget_1){this._create_new_widget("datewidget_1");}else{this.datewidget_1.do_show();}}else{if(this.datewidget_1){this.datewidget_1.do_hide();}}},toString:function(){var str=field_utils.format[this.attributes.type](this.get_value(),{type:this.attributes.type});var date_1_value=this.datewidget_1&&this.get_value(1);if(date_1_value){str+=_lt(" and ")+field_utils.format[this.attributes.type](date_1_value,{type:this.attributes.type});}
return str;},start:function(){return $.when(this._super.apply(this,arguments),this._create_new_widget("datewidget_0"));},_create_new_widget:function(name){this[name]=new(this._get_widget_class())(this);return this[name].appendTo(this.$el).then((function(){this[name].setValue(moment(new Date()));}).bind(this));},_get_widget_class:function(){return datepicker.DateTimeWidget;},});var Date=DateTime.extend({attributes:{type:'date'},get_value:function(index){return this["datewidget_"+(index||0)].getValue();},_get_widget_class:function(){return datepicker.DateWidget;},});var Integer=Field.extend({tagName:'input',className:'o_input',attributes:{type:'number',value:'0',},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.integer(val===""?0:val);}catch(e){return"";}}});var Id=Integer.extend({operators:[{value:"=",text:_lt("is")}]});var Float=Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.float(val===""?0.0:val);}catch(e){return"";}}});var Selection=Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});var Boolean=Field.extend({tagName:'span',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});core.search_filters_registry.add('char',Char).add('text',Char).add('one2many',Char).add('many2one',Char).add('many2many',Char).add('datetime',DateTime).add('date',Date).add('integer',Integer).add('float',Float).add('monetary',Float).add('boolean',Boolean).add('selection',Selection).add('id',Id);return{ExtendedSearchProposition:ExtendedSearchProposition};});;

/* /web/static/src/js/chrome/search_inputs.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_inputs',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var field_utils=require('web.field_utils');var pyeval=require('web.pyeval');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var Input=Widget.extend({init:function(parent){this._super(parent);this.searchview=parent;this.load_attrs({});},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){if(!_.isObject(attrs.modifiers)){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};}
this.attrs=attrs;},visible:function(){return!this.attrs.modifiers.invisible;},});var Field=Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new Context(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new Context(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs.filter_domain;if(domain){value_to_domain=function(facetValue){return Domain.prototype.stringToArray(domain,{self:self.value_from(facetValue),raw_value:facetValue.attributes.value});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
_.each(domains,Domain.prototype.normalizeArray);var ors=_.times(domains.length-1,_.constant("|"));return ors.concat.apply(ors,domains);}});var CharField=Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});var NumberField=Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return field_utils.parse.integer(value);}catch(e){return NaN;}}});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return field_utils.parse.float(value);}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field.attrs.string,values:[{label:pair[1],value:pair[0]}]};}
var SelectionField=Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});var DateField=Field.extend({value_from:function(facetValue){return time.date_to_str(facetValue.get('value'));},complete:function(needle){var t,v;try{t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';v=field_utils.parse[t](needle,{type:t},{timezone:true});}catch(e){return $.when(null);}
var m=moment(v,t==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD');if(!m.isValid()){return $.when(null);}
var date_string=field_utils.format[t](m,{type:t});var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:m.toDate()}]}}]);}});var DateTimeField=DateField.extend({value_from:function(facetValue){return time.datetime_to_str(facetValue.get('value'));}});var ManyToOneField=CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.searchview=parent;},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);var args=this.attrs.domain;if(typeof args==='string'){try{args=Domain.prototype.stringToArray(args);}catch(e){args=[];}}
return this._rpc({model:this.attrs.relation,method:'name_search',kwargs:{name:needle,args:args,limit:8,context:context},}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
utils.assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);return this._rpc({model:this.attrs.relation,method:'name_get',args:[value],context:context,}).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});var FilterGroup=Input.extend({template:'SearchView.filters',icon:"fa-filter",completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.searchview=parent;this.searchview.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','a',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$el.removeClass('selected');var facet=this.searchview.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,separator:_t(" or "),values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new Context(),{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var userContext=this.getSession().user_context;var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).map(function(d){return Domain.prototype.stringToArray(d,userContext);}).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
_.each(domains,Domain.prototype.normalizeArray);var ors=_.times(domains.length-1,_.constant("|"));return ors.concat.apply(ors,domains);},toggle_filter:function(e){e.preventDefault();e.stopPropagation();this.toggle(this.filters[Number($(e.target).parent().data('index'))]);},toggle:function(filter,options){this.searchview.query.toggle(this.make_facet([this.make_value(filter)]),options);},is_visible:function(){return _.some(this.filters,function(filter){return!filter.attrs.invisible;});},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));}});var GroupbyGroup=FilterGroup.extend({icon:'fa-bars',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);this.searchview=parent;if(!this.searchview._s_groupby){this.searchview._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.searchview._s_groupby;},make_facet:function(values){return{category:_t("Group By"),icon:this.icon,separator:" > ",values:values,field:this.searchview._s_groupby};}});var Filter=Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});core.search_widgets_registry.add('char',CharField).add('text',CharField).add('html',CharField).add('boolean',BooleanField).add('integer',IntegerField).add('id',IntegerField).add('float',FloatField).add('monetary',FloatField).add('selection',SelectionField).add('datetime',DateTimeField).add('date',DateField).add('many2one',ManyToOneField).add('many2many',CharField).add('one2many',CharField);return{FilterGroup:FilterGroup,Filter:Filter,Field:Field,GroupbyGroup:GroupbyGroup,};});;

/* /web/static/src/js/chrome/search_menus.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var pyeval=require('web.pyeval');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;return Widget.extend({template:'SearchView.FavoriteMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'click li a':function(event){event.preventDefault();},'click .o_save_search a':function(event){event.preventDefault();this.toggle_save_menu();},'click .o_save_name button':'save_favorite','hidden.bs.dropdown':'_closeMenus','keyup .o_save_name input':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.save_favorite();}},},init:function(parent,query,target_model,action_id,filters){this._super.apply(this,arguments);this.searchview=parent;this.query=query;this.target_model=target_model;this.action_id=action_id;this.filters={};_.each(filters,this.add_filter.bind(this));},start:function(){var self=this;this.$filters={};this.$save_search=this.$('.o_save_search');this.$save_name=this.$('.o_save_name');this.$inputs=this.$save_name.find('input');this.$user_divider=this.$('.divider.user_filter');this.$shared_divider=this.$('.divider.shared_filter');this.$inputs.eq(0).val(this.searchview.get_title());var $shared_filter=this.$inputs.eq(1),$default_filter=this.$inputs.eq(2);$shared_filter.click(function(){$default_filter.prop('checked',false);});$default_filter.click(function(){$shared_filter.prop('checked',false);});this.query.on('remove',function(facet){if(facet.get('is_custom_filter')){self.clear_selection();}}).on('reset',this.proxy('clear_selection'));_.each(this.filters,this.append_filter.bind(this));return this._super();},toggle_save_menu:function(is_open){this.$save_search.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$save_name.toggle(is_open);if(this.$save_search.hasClass('o_open_menu')){this.$save_name.find('input').first().focus();}},_closeMenus:function(){this.toggle_save_menu(false);},save_favorite:function(){var self=this,filter_name=this.$inputs[0].value,default_filter=this.$inputs[1].checked,shared_filter=this.$inputs[2].checked;if(!filter_name.length){this.do_warn(_t("Error"),_t("Filter name is required."));this.$inputs.first().focus();return;}
if(_.chain(this.filters).pluck('name').contains(filter_name).value()){this.do_warn(_t("Error"),_t("Filter with same name already exists."));this.$inputs.first().focus();return;}
var user_context=this.getSession().user_context;var search=this.searchview.build_search_data();var controllerContext;this.trigger_up('get_controller_context',{callback:function(ctx){controllerContext=ctx;},});var results=pyeval.eval_domains_and_contexts({domains:search.domains,contexts:[user_context].concat(search.contexts.concat(controllerContext||[])),group_by_seq:search.groupbys||[],});if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(session.user_context)).each(function(key){delete ctx[key];});var filter={name:filter_name,user_id:shared_filter?false:session.uid,model_id:this.target_model,context:results.context,domain:results.domain,sort:JSON.stringify(this.searchview.dataset._sort),is_default:default_filter,action_id:this.action_id,};return data_manager.create_filter(filter).done(function(id){filter.id=id;self.toggle_save_menu(false);self.$save_name.find('input').val('').prop('checked',false);self.add_filter(filter);self.append_filter(filter);self.toggle_filter(filter,true);});},get_default_filter:function(){var personal_filter=_.find(this.filters,function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){return personal_filter;}
return _.find(this.filters,function(filter){return!filter.user_id&&filter.is_default;});},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id,uid=(user_id instanceof Array)?user_id[0]:user_id,act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter.id,is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('li.selected').removeClass('selected');},add_filter:function(filter){this.filters[this.key_for(filter)]=filter;},append_filter:function(filter){var self=this;var key=this.key_for(filter);if(filter.user_id){this.$user_divider.show();}else{this.$shared_divider.show();}
if(!(key in this.$filters)){var $filter=$('<li>').addClass(filter.user_id?'o-searchview-custom-private':'o-searchview-custom-public').append($('<a>',{'href':'#'}).text(filter.name)).append($('<span>',{class:'fa fa-trash-o o-remove-filter',on:{click:function(event){event.stopImmediatePropagation();self.remove_filter(filter,$filter,key);},},})).insertBefore(filter.user_id?this.$user_divider:this.$shared_divider);this.$filters[key]=$filter;}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.query.remove(current);this.$filters[this.key_for(filter)].removeClass('selected');return;}
this.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});if(!_.isUndefined(filter.sort)){var sort_items=JSON.parse(filter.sort);this.searchview.dataset.set_sort(sort_items);}
this.$filters[this.key_for(filter)].addClass('selected');},remove_filter:function(filter,$filter,key){var self=this;var global_warning=_t("This filter is global and will be removed for everybody if you continue."),warning=_t("Are you sure that you want to remove this filter?");if(!confirm(filter.user_id?warning:global_warning)){return;}
return data_manager.delete_filter(filter).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];var has_user_filter=_.find(self.filters,function(filter){return filter.user_id;});var has_shared_filer=_.find(self.filters,function(filter){return!filter.user_id;});if(!has_user_filter){self.$user_divider.hide();}
if(!has_shared_filer){self.$shared_divider.hide();}});},});});odoo.define('web.FilterMenu',function(require){"use strict";var search_filters=require('web.search_filters');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');return Widget.extend({template:'SearchView.FilterMenu',events:{'click .o_add_filter':function(event){event.preventDefault();this.toggle_custom_filter_menu();},'click li':function(event){event.preventDefault();event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_custom_filter_menu(false);},'click .o_add_condition':'append_proposition','click .o_apply_filter':'commit_search','keyup .o_searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.commit_search();}},},init:function(parent,filters,fields){this._super(parent);this.filters=filters||[];this.searchview=parent;this.propositions=[];this.custom_filters_open=false;this.fields=_.pick(fields,function(field,name){return field.selectable!==false&&name!=='id';});this.fields.id={string:'ID',type:'id',searchable:true};},start:function(){var self=this;this.$menu=this.$('.o_filters_menu');this.$add_filter=this.$('.o_add_filter');this.$apply_filter=this.$('.o_apply_filter');this.$add_filter_menu=this.$('.o_add_filter_menu');_.each(this.filters,function(group){if(group.is_visible()){group.insertBefore(self.$add_filter);$('<li class="divider">').insertBefore(self.$add_filter);}});},toggle_custom_filter_menu:function(is_open){var self=this;this.custom_filters_open=!_.isUndefined(is_open)?is_open:!this.custom_filters_open;var def;if(this.custom_filters_open&&!this.propositions.length){def=this.append_proposition();}
$.when(def).then(function(){self.$add_filter.toggleClass('o_closed_menu',!self.custom_filters_open).toggleClass('o_open_menu',self.custom_filters_open);self.$add_filter_menu.toggle(self.custom_filters_open);self.$('.o_filter_condition').toggle(self.custom_filters_open);});},append_proposition:function(){var prop=new search_filters.ExtendedSearchProposition(this,this.fields);this.propositions.push(prop);this.$apply_filter.prop('disabled',false);return prop.insertBefore(this.$add_filter_menu);},remove_proposition:function(prop){this.propositions=_.without(this.propositions,prop);if(!this.propositions.length){this.$apply_filter.prop('disabled',true);}
prop.destroy();},commit_search:function(){var filters=_.invoke(this.propositions,'get_filter'),filters_widgets=_.map(filters,function(filter){return new search_inputs.Filter(filter,this);}),filter_group=new search_inputs.FilterGroup(filters_widgets,this.searchview),facets=filters_widgets.map(function(filter){return filter_group.make_facet([filter_group.make_value(filter)]);});filter_group.insertBefore(this.$add_filter);$('<li class="divider">').insertBefore(this.$add_filter);this.searchview.query.add(facets,{silent:true});this.searchview.query.trigger('reset');_.invoke(this.propositions,'destroy');this.propositions=[];this.append_proposition();this.toggle_custom_filter_menu(false);},});});odoo.define('web.GroupByMenu',function(require){"use strict";var core=require('web.core');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');var QWeb=core.qweb;return Widget.extend({template:'SearchView.GroupByMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_add_menu(false);},'click .o_add_custom_group a':function(event){event.preventDefault();this.toggle_add_menu();},},init:function(parent,groups,fields){var self=this;this._super(parent);this.searchview=parent;this.groups=groups||[];this.groupableFields=[];var groupable_types=['many2one','char','boolean','selection','date','datetime'];_.each(fields,function(field,name){if(field.sortable&&_.contains(groupable_types,field.type)){self.groupableFields.push(_.extend({},field,{name:name}));}});self.groupableFields=_.sortBy(this.groupableFields,'string');},start:function(){var self=this;this.$menu=this.$('.o_group_by_menu');var divider=this.$menu.find('.divider');_.invoke(this.groups,'insertBefore',divider);if(this.groups.length){divider.show();}
this.$add_group=this.$menu.find('.o_add_custom_group');this.$menu.append(QWeb.render('GroupByMenuSelector',this));this.$add_group_menu=this.$('.o_add_group');this.$group_selector=this.$('.o_group_selector');this.$('.o_select_group').click(function(){self.toggle_add_menu(false);var field=self.$group_selector.find(':selected').data('name');self.add_groupby_to_menu(field);});},toggle_add_menu:function(is_open){this.$add_group.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$add_group_menu.toggle(is_open);if(this.$add_group.hasClass('o_open_menu')){this.$group_selector.focus();}},add_groupby_to_menu:function(field_name){var filter=new search_inputs.Filter({attrs:{context:"{'group_by':'"+field_name+"''}",name:_.find(this.groupableFields,{name:field_name}).string,}},this.searchview);var group=new search_inputs.FilterGroup([filter],this.searchview),divider=this.$('.divider').show();group.insertBefore(divider);group.toggle(filter);},});});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var apps_client=null;var Apps=Widget.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(apps_client){return check_client_available(apps_client);}else{return this._rpc({model:'ir.module.module',method:'get_apps_server'}).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){return self._rpc({route:m.args[0],params:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){return self._rpc({model:m.model,method:m.args[0],args:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;var def=$.Deferred();self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(session.debug){qs.debug=session.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:session.db,origin:session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');def.resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return self._rpc({route:'/web/action/load',params:{action_id:self.failback_action_id},}).then(function(action){return self.do_action(action);}).always(function(){def.reject();});});return def;},});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /web/static/src/js/fields/abstract_field.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractField',function(require){"use strict";var ajax=require('web.ajax');var field_utils=require('web.field_utils');var Widget=require('web.Widget');var AbstractField=Widget.extend({cssLibs:[],jsLibs:[],events:{'keydown':'_onKeydown',},custom_events:{navigation_move:'_onNavigationMove',},fieldDependencies:{},resetOnAnyFieldChange:false,specialData:false,supportedFieldTypes:[],init:function(parent,name,record,options){this._super(parent);options=options||{};this.name=name;this.record=record;this.field=record.fields[name];this.viewType=options.viewType||'default';var fieldsInfo=record.fieldsInfo[this.viewType];this.attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};this.value=record.data[name];this.recordData=record.data;this.string=this.attrs.string||this.field.string||this.name;this.nodeOptions=this.attrs.options||{};this.dataPointID=record.id;this.res_id=record.res_id;this.model=record.model;this.mode=options.mode||"readonly";this._isValid=true;this.lastSetValue=undefined;this.formatType=this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;this.formatOptions={};this.parseOptions={};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.attr('name',self.name);self.$el.addClass('o_field_widget');return self._render();});},willStart:function(){return $.when(ajax.loadLibs(this),this._super.apply(this,arguments));},activate:function(options){if(this.isFocusable()){var $focusable=this.getFocusableElement();$focusable.focus();if($focusable.is('input[type="text"], textarea')){$focusable[0].selectionStart=$focusable[0].selectionEnd=$focusable[0].value.length;if(options&&!options.noselect){$focusable.select();}}
return true;}
return false;},commitChanges:function(){},getFocusableElement:function(){return $();},isFocusable:function(){var $focusable=this.getFocusableElement();return $focusable.length&&$focusable.is(':visible');},isSet:function(){return!!this.value;},isValid:function(){return this._isValid;},reset:function(record,event){this._reset(record,event);return this._render()||$.when();},_formatValue:function(value){var options=_.extend({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[this.formatType](value,this.field,options);},_isSameValue:function(value){return this.value===value;},_parseValue:function(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);},_render:function(){if(this.mode==='edit'){return this._renderEdit();}else if(this.mode==='readonly'){return this._renderReadonly();}},_renderEdit:function(){},_renderReadonly:function(){},_reset:function(record,event){this.lastSetValue=undefined;this.record=record;this.value=record.data[this.name];this.recordData=record.data;},_setValue:function(value,options){if(this.lastSetValue===value||(this.value===false&&value==='')){return $.when();}
this.lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger_up('set_dirty',{dataPointID:this.dataPointID});return $.Deferred().reject();}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return $.when();}
var def=$.Deferred();var changes={};changes[this.name]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});return def;},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.TAB:ev.preventDefault();ev.stopPropagation();this.trigger_up('navigation_move',{direction:ev.shiftKey?'previous':'next',});break;case $.ui.keyCode.ENTER:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger_up('navigation_move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'left'});break;}},_onNavigationMove:function(ev){ev.data.target=this;},});return AbstractField;});;

/* /web/static/src/js/fields/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var config=require('web.config');var core=require('web.core');var crash_manager=require('web.crash_manager');var datepicker=require('web.datepicker');var dom=require('web.dom');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var DomainSelectorDialog=require('web.DomainSelectorDialog');var framework=require('web.framework');var session=require('web.session');var utils=require('web.utils');var view_dialogs=require('web.view_dialogs');var field_utils=require('web.field_utils');var qweb=core.qweb;var _t=core._t;var TranslatableFieldMixin={_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate&&this.res_id){return $('<button>',{type:'button','class':'o_field_translate fa fa-globe btn btn-link',}).on('click',this._onTranslate.bind(this));}
return $();},_onTranslate:function(){this.trigger_up('translate',{fieldName:this.name,id:this.dataPointID});},};var DebouncedField=AbstractField.extend({DEBOUNCE:1000000000,init:function(){this._super.apply(this,arguments);this._isDirty=false;if(this.mode==='edit'){if(this.DEBOUNCE){this._doDebouncedAction=_.debounce(this._doAction,this.DEBOUNCE);}else{this._doDebouncedAction=this._doAction;}
var self=this;var debouncedFunction=this._doDebouncedAction;this._doDebouncedAction=function(){self._isDirty=true;debouncedFunction.apply(self,arguments);};}},commitChanges:function(){if(this._isDirty&&this.mode==='edit'){this._doAction();}},_doAction:function(){if(!this.isDestroyed()){this._setValue(this._getValue());}},_getValue:function(){},});var InputField=DebouncedField.extend({custom_events:_.extend({},DebouncedField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},DebouncedField.prototype.events,{'input':'_onInput','change':'_onChange',}),init:function(){this._super.apply(this,arguments);this.nodeOptions.isPassword='password'in this.attrs;if(this.mode==='edit'){this.tagName='input';}
this.isDirty=false;this.lastChangeEvent=undefined;},getFocusableElement:function(){return this.$input||$();},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty||(event&&event.target===this&&event.data.changes[this.name]===this.value)){return $.when();}else{return this._render();}},_getValue:function(){return this.$input.val();},_prepareInput:function($input){this.$input=$input||$("<input/>");this.$input.addClass('o_input');this.$input.attr({type:this.nodeOptions.isPassword?'password':'text',placeholder:this.attrs.placeholder||"",autocomplete:this.nodeOptions.isPassword?'new-password':this.attrs.autocomplete,});this.$input.val(this._formatValue(this.value));return this.$input;},_renderEdit:function(){this._prepareInput(this.$el);},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_onChange:function(){this._doAction();},_onFieldChanged:function(event){this.lastChangeEvent=event;},_onInput:function(){this.isDirty=true;this._doDebouncedAction();},_onNavigationMove:function(ev){this._super.apply(this,arguments);if(this.mode==='edit'){var input=this.$input[0];var selecting=(input.selectionEnd!==input.selectionStart);if((ev.data.direction==="left"&&(selecting||input.selectionStart!==0))||(ev.data.direction==="right"&&(selecting||input.selectionStart!==input.value.length))){ev.stopPropagation();}}},});var FieldChar=InputField.extend(TranslatableFieldMixin,{className:'o_field_char',tagName:'span',supportedFieldTypes:['char'],_renderEdit:function(){var def=this._super.apply(this,arguments);if(this.field.size&&this.field.size>0){this.$el.attr('maxlength',this.field.size);}
this.$el=this.$el.add(this._renderTranslateButton());return def;},});var LinkButton=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click':'_onClick'}),_render:function(){if(this.value){var className=this.attrs.icon||'fa-globe';this.$el.html("<span />");this.$el.addClass("fa "+className);this.$el.attr('title',this.value);}},_onClick:function(event){event.stopPropagation();window.open(this.value,'_blank');},});var FieldDate=InputField.extend({className:"o_field_date",tagName:"span",supportedFieldTypes:['date','datetime'],init:function(){this._super.apply(this,arguments);this.formatOptions.timezone=true;},start:function(){var self=this;var def;if(this.mode==='edit'){this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,function(){var value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});def=this.datewidget.appendTo('<div>').done(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self._prepareInput(self.datewidget.$input);self.replaceElement(self.datewidget.$el);});}
return $.when(def,this._super.apply(this,arguments));},_doDebouncedAction:function(){this.datewidget.changeDatetime();},_getValue:function(){return this.datewidget.getValue();},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value,'day');},_makeDatePicker:function(){return new datepicker.DateWidget(this,_.defaults(this.nodeOptions.datepicker||{},{defaultDate:this.value}));},_renderEdit:function(){this.datewidget.setValue(this.value);this.$input=this.datewidget.$input;},});var FieldDateTime=FieldDate.extend({supportedFieldTypes:['datetime'],_getValue:function(){var value=this.datewidget.getValue();return value&&value.add(-this.getSession().getTZOffset(value),'minutes');},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value);},_makeDatePicker:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');return new datepicker.DateTimeWidget(this,{defaultDate:value});},_renderEdit:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');this.datewidget.setValue(value);this.$input=this.datewidget.$input;},});var FieldMonetary=InputField.extend({className:'o_field_monetary o_field_number',tagName:'span',supportedFieldTypes:['float','monetary'],resetOnAnyFieldChange:true,init:function(){this._super.apply(this,arguments);this._setCurrency();if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}
this.formatOptions.currency=this.currency;this.formatOptions.digits=[16,2];this.formatOptions.field_digits=this.nodeOptions.field_digits;},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_renderEdit:function(){this.$el.empty();this._prepareInput().appendTo(this.$el);if(this.currency){var $currencySymbol=$('<span>',{text:this.currency.symbol});if(this.currency.position==="after"){this.$el.append($currencySymbol);}else{this.$el.prepend($currencySymbol);}}},_renderReadonly:function(){this.$el.html(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setCurrency();},_setCurrency:function(){var currencyField=this.nodeOptions.currency_field||this.field.currency_field||'currency_id';var currencyID=this.record.data[currencyField]&&this.record.data[currencyField].res_id;this.currency=session.get_currency(currencyID);this.formatOptions.currency=this.currency;},});var FieldBoolean=AbstractField.extend({className:'o_field_boolean',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),supportedFieldTypes:['boolean'],activate:function(options){var activated=this._super.apply(this,arguments);if(activated&&options&&options.event&&$(options.event.target).parents('.o_checkbox').length){this._setValue(!this.value);}
return activated;},getFocusableElement:function(){return this.$input||$();},isSet:function(){return true;},reset:function(record,event){var rendered=this._super.apply(this,arguments);if(event&&event.target.name===this.name){this.activate();}
return rendered;},_render:function(){var $checkbox=this._formatValue(this.value);this.$input=$checkbox.find('input');this.$input.prop('disabled',this.mode==='readonly');this.$el.addClass($checkbox.attr('class'));this.$el.empty().append($checkbox.contents());},_onChange:function(){this._setValue(this.$input[0].checked);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:this.$input.prop('checked',!this.value);this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
this._super.apply(this,arguments);},});var FieldInteger=InputField.extend({className:'o_field_integer o_field_number',tagName:'span',supportedFieldTypes:['integer'],isSet:function(){return this.value===0||this._super.apply(this,arguments);},_formatValue:function(value){if(typeof value==='string'){if(!/^[0-9]+-/.test(value)){throw new Error('"'+value+'" is not an integer or a virtual id');}
return value;}
return this._super.apply(this,arguments);},});var FieldFloat=InputField.extend({className:'o_field_float o_field_number',tagName:'span',supportedFieldTypes:['float'],init:function(){this._super.apply(this,arguments);if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}},isSet:function(){return this.value===0||this._super.apply(this,arguments);},});var FieldFloatTime=FieldFloat.extend({formatType:'float_time',});var FieldText=InputField.extend(TranslatableFieldMixin,{className:'o_field_text',supportedFieldTypes:['text'],tagName:'span',init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='textarea';}},start:function(){if(this.mode==='edit'){dom.autoresize(this.$el,{parent:this});this.$el=this.$el.add(this._renderTranslateButton());}
return this._super();},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},});var HandleWidget=AbstractField.extend({className:'o_row_handle fa fa-arrows ui-sortable-handle',tagName:'span',description:"",supportedFieldTypes:['integer'],isSet:function(){return true;},});var FieldEmail=InputField.extend({className:'o_field_email',prefix:'mailto',supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.value).addClass('o_form_uri o_text_overflow').attr('href',this.prefix+':'+this.value);}});var FieldPhone=FieldEmail.extend({className:'o_field_phone',prefix:'tel',init:function(){this._super.apply(this,arguments);if(this.mode==='readonly'&&!this._canCall()){this.tagName='span';}},getFocusableElement:function(){if(this.mode!=='readonly'||this._canCall()){return this._super.apply(this,arguments);}
return $();},_renderReadonly:function(){this._super();if(this._canCall()){var text=this.$el.text();var part1=_.escape(text.substr(0,text.length/2));var part2=_.escape(text.substr(text.length/2));this.$el.html(part1+"&shy;"+part2);}else{this.$el.removeClass('o_form_uri');}
this.$el.removeClass('o_text_overflow');},_setValue:function(value,options){if(value){value=value.replace(/\u00AD/g,'');}
return this._super(value,options);},_canCall:function(){return config.device.size_class<=config.device.SIZES.XS;}});var UrlWidget=InputField.extend({className:'o_field_url',supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.attrs.text||this.value).addClass('o_form_uri o_text_overflow').attr('target','_blank').attr('href',this.value);}});var AbstractFieldBinary=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'change .o_input_file':'on_file_change','click .o_select_file_button':function(){this.$('.o_input_file').click();},'click .o_clear_file_button':'on_clear',}),init:function(parent,name,record){this._super.apply(this,arguments);this.fields=record.fields;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){var self=this;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},destroy:function(){if(this.fileupload_id){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$('form.o_form_binary_form input[name=session_id]').val(this.getSession().session_id);this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.set_filename(name);this._setValue(file_base64);this._render();},set_filename:function(value){var filename=this.attrs.filename;if(filename&&filename in this.fields){var changes={};changes[filename]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,});}},on_clear:function(){this.set_filename('');this._setValue(false);this._render();},});var FieldBinaryImage=AbstractFieldBinary.extend({fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",events:_.extend({},AbstractFieldBinary.prototype.events,{'click img':function(){if(this.mode==="readonly"){this.trigger_up('bounce_edit');}},}),supportedFieldTypes:['binary'],_render:function(){var self=this;var url=this.placeholder;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/png;base64,'+this.value;}else{url=session.url('/web/image',{model:this.model,id:JSON.stringify(this.res_id),field:this.nodeOptions.preview_image||this.name,unique:field_utils.format.datetime(this.recordData.__last_update).replace(/[^0-9]/g,''),});}}
var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));this.$('> img').remove();this.$el.prepend($img);$img.on('error',function(){self.on_clear();$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},});var FieldBinaryFile=AbstractFieldBinary.extend({template:'FieldBinaryFile',events:_.extend({},AbstractFieldBinary.prototype.events,{'click':function(event){if(this.mode==='readonly'&&this.value&&this.recordData.id){this.on_save_as(event);}},'click .o_input':function(){this.$('.o_input_file').click();},}),supportedFieldTypes:['binary'],init:function(){this._super.apply(this,arguments);this.filename_value=this.recordData[this.attrs.filename];},_renderReadonly:function(){this.do_toggle(!!this.value);if(this.value){this.$el.empty().append($("<span/>").addClass('fa fa-download'));if(this.recordData.id){this.$el.css('cursor','pointer');}else{this.$el.css('cursor','not-allowed');}
if(this.filename_value){this.$el.append(" "+this.filename_value);}}
if(!this.res_id){this.$el.css('cursor','not-allowed');}else{this.$el.css('cursor','pointer');}},_renderEdit:function(){if(this.value){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$('.o_input').eq(0).val(this.filename_value||this.value);}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}},set_filename:function(value){this._super.apply(this,arguments);this.filename_value=value;this.$('.o_save_file_button').prop('disabled',true);},on_save_as:function(ev){if(!this.value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else if(this.res_id){framework.blockUI();var c=crash_manager;var filename_fieldname=this.attrs.filename;this.getSession().get_file({'url':'/web/content','data':{'model':this.model,'id':this.res_id,'field':this.name,'filename_field':filename_fieldname,'filename':this.recordData[filename_fieldname]||null,'download':true,'data':utils.is_bin_size(this.value)?null:this.value,},'complete':framework.unblockUI,'error':c.rpc_error.bind(c),});ev.stopPropagation();}},});var PriorityWidget=AbstractField.extend({className:"o_priority",events:{'mouseover > a':'_onMouseOver','mouseout > a':'_onMouseOut','click > a':'_onClick',},supportedFieldTypes:['selection'],isSet:function(){return true;},_render:function(){var self=this;var index_value=this.value?_.findIndex(this.field.selection,function(v){return v[0]===self.value;}):0;this.$el.empty();this.empty_value=this.field.selection[0][0];_.each(this.field.selection.slice(1),function(choice,index){self.$el.append(self._renderStar('<a href="#">',index_value>=index+1,index+1,choice[1]));});},_renderStar:function(tag,isFull,index,tip){return $(tag).attr('title',tip).attr('data-index',index).addClass('o_priority_star fa').toggleClass('fa-star',isFull).toggleClass('fa-star-o',!isFull);},_onClick:function(event){event.preventDefault();event.stopPropagation();var index=$(event.currentTarget).data('index');var newValue=this.field.selection[index][0];if(newValue===this.value){newValue=this.empty_value;}
this._setValue(newValue);},_onMouseOut:function(){clearTimeout(this.hoverTimer);var self=this;this.hoverTimer=setTimeout(function(){self._render();},200);},_onMouseOver:function(event){clearTimeout(this.hoverTimer);this.$('.o_priority_star').removeClass('fa-star-o').addClass('fa-star');$(event.currentTarget).nextAll().removeClass('fa-star').addClass('fa-star-o');},});var AttachmentImage=AbstractField.extend({className:'o_attachment_image',_render:function(){if(this.value){this.$el.empty().append($('<img>/',{src:"/web/image/"+this.value.data.id+"?unique=1",title:this.value.data.display_name}));}}});var StateSelectionWidget=AbstractField.extend({template:'FormSelection',events:{'click a':function(e){e.preventDefault();},'click li':'_setSelection'},supportedFieldTypes:['selection'],_prepareDropdownValues:function(){var self=this;var _data=[];var current_stage_id=self.recordData.stage_id&&self.recordData.stage_id[0];var stage_data={id:current_stage_id,legend_normal:this.recordData.legend_normal||undefined,legend_blocked:this.recordData.legend_blocked||undefined,legend_done:this.recordData.legend_done||undefined,};_.map(this.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='o_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='o_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},_render:function(){var self=this;var states=this._prepareDropdownValues();var currentState=_.findWhere(states,{name:self.value})||states[0];this.$('.o_status').removeClass('o_status_red o_status_green').addClass(currentState.state_class).prop('special_click',true);var $items=$(qweb.render('FormSelection.items',{states:_.without(states,currentState)}));var $dropdown=this.$('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);},_setSelection:function(ev){var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));this._setValue(value);if(this.mode==='edit'){this._render();}}},});var FavoriteWidget=AbstractField.extend({className:'o_favorite',events:{'click':'_setFavorite'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){var template=this.attrs.nolabel?'<a href="#"><i class="fa %s" title="%s"></i></a>':'<a href="#"><i class="fa %s"></i> %s</a>';this.$el.empty().append(_.str.sprintf(template,this.value?'fa-star':'fa-star-o',this.value?_t('Remove from Favorites'):_t('Add to Favorites')));},_setFavorite:function(event){event.preventDefault();event.stopPropagation();this._setValue(!this.value);},});var LabelSelection=AbstractField.extend({supportedFieldTypes:['selection'],_render:function(){this.classes=this.nodeOptions&&this.nodeOptions.classes||{};var labelClass=this.classes[this.value]||'primary';this.$el.addClass('label label-'+labelClass).text(this._formatValue(this.value));},});var FieldBooleanButton=AbstractField.extend({className:'o_stat_info',supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$el.empty();var text,hover;switch(this.nodeOptions.terminology){case"active":text=this.value?_t("Active"):_t("Inactive");hover=this.value?_t("Deactivate"):_t("Activate");break;case"archive":text=this.value?_t("Active"):_t("Archived");hover=this.value?_t("Archive"):_t("Restore");break;case"close":text=this.value?_t("Active"):_t("Closed");hover=this.value?_t("Close"):_t("Open");break;default:var opt_terms=this.nodeOptions.terminology||{};if(typeof opt_terms==='string'){opt_terms={};}
text=this.value?_t(opt_terms.string_true)||_t("On"):_t(opt_terms.string_false)||_t("Off");hover=this.value?_t(opt_terms.hover_true)||_t("Switch Off"):_t(opt_terms.hover_false)||_t("Switch On");}
var val_color=this.value?'text-success':'text-danger';var hover_color=this.value?'text-danger':'text-success';var $val=$('<span>').addClass('o_stat_text o_not_hover '+val_color).text(text);var $hover=$('<span>').addClass('o_stat_text o_hover '+hover_color).text(hover);this.$el.append($val).append($hover);},});var BooleanToggle=FieldBoolean.extend({events:{'click':'_onClick'},_render:function(){this._super.apply(this,arguments);this._renderToggleSwitch();},_renderToggleSwitch:function(){this.$el.addClass("o_boolean_toggle");var $div=$('<div class="slider"></div>');$div.insertAfter(this.$("input[type=checkbox]"));},_onClick:function(event){event.stopPropagation();this._setValue(!this.value);this.$el.closest(".o_data_row").toggleClass('text-muted',this.value);},});var StatInfo=AbstractField.extend({supportedFieldTypes:['integer','float'],isSet:function(){return true;},_render:function(){var options={value:this._formatValue(this.value||0),};if(!this.attrs.nolabel){if(this.nodeOptions.label_field&&this.recordData[this.nodeOptions.label_field]){options.text=this.recordData[this.nodeOptions.label_field];}else{options.text=this.string;}}
this.$el.html(qweb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldPercentPie=AbstractField.extend({template:'FieldPercentPie',supportedFieldTypes:['integer','float'],start:function(){this.$leftMask=this.$('.o_mask').first();this.$rightMask=this.$('.o_mask').last();this.$pieValue=this.$('.o_pie_value');return this._super();},isSet:function(){return true;},_render:function(){var value=this.value||0;var degValue=360*value/100;this.$rightMask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$leftMask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$rightMask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pieValue.text(Math.round(value)+'%');},});var FieldProgressBar=AbstractField.extend({template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},supportedFieldTypes:['integer','float'],init:function(){this._super.apply(this,arguments);if(this.recordData[this.nodeOptions.current_value]){this.value=this.recordData[this.nodeOptions.current_value];}
this.max_value=this.recordData[this.nodeOptions.max_value]||100;this.readonly=this.nodeOptions.readonly||!this.nodeOptions.editable;this.edit_max_value=this.nodeOptions.edit_max_value||false;this.title=_t(this.attrs.title||this.nodeOptions.title)||'';this.edit_on_click=!this.nodeOptions.edit_max_value||false;this.write_mode=false;},_render:function(){var self=this;this._render_value();if(!this.readonly){if(this.edit_on_click){this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);self.value=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self._render_value();self.on_update(self.value);});}else{this.$el.on('click',function(){if(!self.write_mode){var $input=$('<input>',{type:'text',class:'o_progressbar_value o_input'});$input.on('blur',_.bind(self.on_change_input,self));self.$('.o_progressbar_value').replaceWith($input);self.write_mode=true;self._render_value();}});}}
return this._super();},on_update:function(value){if(!isNaN(value)){if(this.edit_max_value){try{this.max_value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;}
var changes={};changes[this.nodeOptions.max_value]=this.max_value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}else{this._setValue(value);}}},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
if(isNaN($input.val())){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{if(e.type==='input'){this._render_value($input.val());if(parseFloat($input.val())===0){$input.select();}}else{if(this.edit_max_value){this.max_value=$(e.target).val();}else{this.value=$(e.target).val()||0;}
var $div=$('<div>',{class:'o_progressbar_value'});this.$('.o_progressbar_value').replaceWith($div);this.write_mode=false;this._render_value();this.on_update(this.edit_max_value?this.max_value:this.value);}}},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(!this.write_mode){if(max_value!==100){this.$('.o_progressbar_value').text(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').text(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);this.$('.o_progressbar_value').focus().select();}},isSet:function(){return true;},});var FieldToggleBoolean=AbstractField.extend({template:"toggle_button",events:{'click':'_onToggleButton'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$('i').toggleClass('o_toggle_button_success',!!this.value).toggleClass('text-muted',!this.value);var title=this.value?this.attrs.options.active:this.attrs.options.inactive;this.$el.attr('title',title);},_onToggleButton:function(event){event.stopPropagation();this._setValue(!this.value);},});var JournalDashboardGraph=AbstractField.extend({className:"o_dashboard_graph",cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],init:function(){this._super.apply(this,arguments);this.graph_type=this.attrs.graph_type;this.data=JSON.parse(this.value);},start:function(){this._onResize=this._onResize.bind(this);nv.utils.windowResize(this._onResize);return this._super.apply(this,arguments);},destroy:function(){if('nv'in window&&nv.utils&&nv.utils.offWindowResize){nv.utils.offWindowResize(this._onResize);}
this._super.apply(this,arguments);},_customizeChart:function(){if(this.graph_type==='bar'){var bar_classes=_.map(this.data[0].values,function(v){return v.type;});_.each(this.$('.nv-bar'),function(v,k){$(v).attr('class',$(v).attr('class')+' '+bar_classes[k]);});}},_render:function(){var self=this;this.$el.empty();this.chart=null;nv.addGraph(function(){self.$svg=self.$el.append('<svg>');switch(self.graph_type){case"line":self.$svg.addClass('o_graph_linechart');self.chart=nv.models.lineChart();self.chart.forceY([0]);self.chart.options({x:function(d,u){return u;},margin:{'left':0,'right':0,'top':0,'bottom':0},showYAxis:false,showLegend:false,});self.chart.xAxis.tickFormat(function(d){var label='';_.each(self.data,function(v){if(v.values[d]&&v.values[d].x){label=v.values[d].x;}});return label;});self.chart.yAxis.tickFormat(d3.format(',.2f'));self.chart.tooltip.contentGenerator(function(key){return qweb.render('GraphCustomTooltip',{'color':key.point.color,'key':self.data[0].key,'value':d3.format(',.2f')(key.point.y)});});break;case"bar":self.$svg.addClass('o_graph_barchart');self.chart=nv.models.discreteBarChart().x(function(d){return d.label;}).y(function(d){return d.value;}).showValues(false).showYAxis(false).color(['#875A7B','#526774','#FA8072']).margin({'left':0,'right':0,'top':20,'bottom':20});self.chart.xAxis.axisLabel(self.data[0].title);self.chart.yAxis.tickFormat(d3.format(',.2f'));self.chart.tooltip.contentGenerator(function(key){return qweb.render('GraphCustomTooltip',{'color':key.color,'key':self.data[0].key,'value':d3.format(',.2f')(key.data.value)});});break;}
d3.select(self.$('svg')[0]).datum(self.data).transition().duration(600).call(self.chart);self._customizeChart();});},_onResize:function(){if(this.chart){this.chart.update();this._customizeChart();}},});var FieldDomain=AbstractField.extend({specialData:"_fetchSpecialDomain",events:_.extend({},AbstractField.prototype.events,{"click .o_domain_show_selection_button":"_onShowSelectionButtonClick","click .o_field_domain_dialog_button":"_onDialogEditButtonClick",}),custom_events:_.extend({},AbstractField.prototype.custom_events,{domain_changed:"_onDomainSelectorValueChange",domain_selected:"_onDomainSelectorDialogValueChange",open_record:"_onOpenRecord",}),init:function(){this._super.apply(this,arguments);this.inDialog=!!this.nodeOptions.in_dialog;this.fsFilters=this.nodeOptions.fs_filters||{};this.className="o_field_domain";if(this.mode==="edit"){this.className+=" o_edit_mode";}
if(!this.inDialog){this.className+=" o_inline_mode";}
this._setState();},isSet:function(){return true;},isValid:function(){return(this._super.apply(this,arguments)&&(!this.domainSelector||this.domainSelector.isValid())&&this._isValidForModel);},_render:function(){if(!this._domainModel){this._replaceContent();return $.when();}
var value=this.value||"[]";var def;if(!this.domainSelector){this.domainSelector=new DomainSelector(this,this._domainModel,value,{readonly:this.mode==="readonly"||this.inDialog,filters:this.fsFilters,debugMode:session.debug,});def=this.domainSelector.prependTo(this.$el);}else{def=this.domainSelector.setDomain(value);}
return def.then(this._replaceContent.bind(this));},_replaceContent:function(){if(this._$content){this._$content.remove();}
this._$content=$(qweb.render("FieldDomain.content",{hasModel:!!this._domainModel,isValid:!!this._isValidForModel,nbRecords:this.record.specialData[this.name].nbRecords||0,inDialogEdit:this.inDialog&&this.mode==="edit",}));this._$content.appendTo(this.$el);},_reset:function(){this._super.apply(this,arguments);var oldDomainModel=this._domainModel;this._setState();if(this.domainSelector&&this._domainModel!==oldDomainModel){this.domainSelector.destroy();this.domainSelector=null;}},_setState:function(){var specialData=this.record.specialData[this.name];this._domainModel=specialData.model;this._isValidForModel=(specialData.nbRecords!==false);},_onShowSelectionButtonClick:function(e){e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,domain:this.value||"[]",no_create:true,readonly:true,disable_multiple_selection:true,}).open();},_onDialogEditButtonClick:function(e){e.preventDefault();new DomainSelectorDialog(this,this._domainModel,this.value||"[]",{readonly:this.mode==="readonly",filters:this.fsFilters,debugMode:session.debug,}).open();},_onDomainSelectorValueChange:function(e){if(this.inDialog)return;this._setValue(Domain.prototype.arrayToString(this.domainSelector.getDomain()));},_onDomainSelectorDialogValueChange:function(e){this._setValue(Domain.prototype.arrayToString(e.data.domain));},_onOpenRecord:function(event){event.stopPropagation();},});var AceEditor=DebouncedField.extend({template:"AceEditor",jsLibs:['/web/static/lib/ace/ace.odoo-custom.js',['/web/static/lib/ace/mode-python.js','/web/static/lib/ace/mode-xml.js']],events:{},start:function(){this._startAce(this.$('.ace-view-editor')[0]);return this._super.apply(this,arguments);},destroy:function(){if(this.aceEditor){this.aceEditor.destroy();}},_formatValue:function(value){return this._super.apply(this,arguments)||'';},_getValue:function(){return this.aceSession.getValue();},_render:function(){var newValue=this._formatValue(this.value);if(this.aceSession.getValue()!==newValue){this.aceSession.setValue(newValue);}},_startAce:function(node){this.aceEditor=ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,});if(this.mode==='readonly'){this.aceEditor.renderer.setOptions({displayIndentGuides:false,showGutter:false,});this.aceEditor.setOptions({highlightActiveLine:false,highlightGutterLine:false,readOnly:true,});this.aceEditor.renderer.$cursorLayer.element.style.display="none";}
this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();this.aceSession.setOptions({useWorker:false,mode:"ace/mode/"+(this.nodeOptions.mode||'xml'),tabSize:2,useSoftTabs:true,});if(this.mode==="edit"){this.aceEditor.on("change",this._doDebouncedAction.bind(this));this.aceEditor.on("blur",this._doAction.bind(this));}},});var ImageSelection=AbstractField.extend({supportedFieldTypes:['selection'],events:_.extend({},AbstractField.prototype.events,{'click img':'_onImgClicked',}),_render:function(){var self=this;this.$el.empty();_.each(this.nodeOptions,function(val,key){var $container=$('<div>').addClass('col-xs-3 text-center');var $img=$('<img>').addClass('img img-responsive img-thumbnail ml16').toggleClass('btn-info',key===self.value).attr('src',val.image_link).data('key',key);$container.append($img);if(val.preview_link){var $previewLink=$('<a>').text('Preview').attr('href',val.preview_link).attr('target','_blank');$container.append($previewLink);}
self.$el.append($container);});},_onImgClicked:function(event){this._setValue($(event.currentTarget).data('key'));},});return{TranslatableFieldMixin:TranslatableFieldMixin,DebouncedField:DebouncedField,FieldEmail:FieldEmail,FieldBinaryFile:FieldBinaryFile,FieldBinaryImage:FieldBinaryImage,FieldBoolean:FieldBoolean,FieldBooleanButton:FieldBooleanButton,BooleanToggle:BooleanToggle,FieldChar:FieldChar,LinkButton:LinkButton,FieldDate:FieldDate,FieldDateTime:FieldDateTime,FieldDomain:FieldDomain,FieldFloat:FieldFloat,FieldFloatTime:FieldFloatTime,FieldInteger:FieldInteger,FieldMonetary:FieldMonetary,FieldPercentPie:FieldPercentPie,FieldPhone:FieldPhone,FieldProgressBar:FieldProgressBar,FieldText:FieldText,FieldToggleBoolean:FieldToggleBoolean,HandleWidget:HandleWidget,InputField:InputField,AttachmentImage:AttachmentImage,ImageSelection:ImageSelection,LabelSelection:LabelSelection,StateSelectionWidget:StateSelectionWidget,FavoriteWidget:FavoriteWidget,PriorityWidget:PriorityWidget,StatInfo:StatInfo,UrlWidget:UrlWidget,JournalDashboardGraph:JournalDashboardGraph,AceEditor:AceEditor,};});;

/* /web/static/src/js/fields/field_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._field_registry',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var relational_fields=require('web.relational_fields');var registry=require('web.field_registry');var special_fields=require('web.special_fields');registry.add('abstract',AbstractField).add('input',basic_fields.InputField).add('integer',basic_fields.FieldInteger).add('boolean',basic_fields.FieldBoolean).add('date',basic_fields.FieldDate).add('datetime',basic_fields.FieldDateTime).add('domain',basic_fields.FieldDomain).add('text',basic_fields.FieldText).add('html',basic_fields.FieldText).add('float',basic_fields.FieldFloat).add('char',basic_fields.FieldChar).add('link_button',basic_fields.LinkButton).add('handle',basic_fields.HandleWidget).add('email',basic_fields.FieldEmail).add('phone',basic_fields.FieldPhone).add('url',basic_fields.UrlWidget).add('image',basic_fields.FieldBinaryImage).add('binary',basic_fields.FieldBinaryFile).add('monetary',basic_fields.FieldMonetary).add('priority',basic_fields.PriorityWidget).add('attachment_image',basic_fields.AttachmentImage).add('image_selection',basic_fields.ImageSelection).add('label_selection',basic_fields.LabelSelection).add('state_selection',basic_fields.StateSelectionWidget).add('kanban_state_selection',basic_fields.StateSelectionWidget).add('boolean_favorite',basic_fields.FavoriteWidget).add('boolean_button',basic_fields.FieldBooleanButton).add('boolean_toggle',basic_fields.BooleanToggle).add('statinfo',basic_fields.StatInfo).add('percentpie',basic_fields.FieldPercentPie).add('float_time',basic_fields.FieldFloatTime).add('progressbar',basic_fields.FieldProgressBar).add('toggle_button',basic_fields.FieldToggleBoolean).add('dashboard_graph',basic_fields.JournalDashboardGraph).add('ace',basic_fields.AceEditor);registry.add('selection',relational_fields.FieldSelection).add('radio',relational_fields.FieldRadio).add('many2one',relational_fields.FieldMany2One).add('list.many2one',relational_fields.ListFieldMany2One).add('kanban.many2one',relational_fields.KanbanFieldMany2One).add('many2many',relational_fields.FieldMany2Many).add('many2many_binary',relational_fields.FieldMany2ManyBinaryMultiFiles).add('many2many_tags',relational_fields.FieldMany2ManyTags).add('form.many2many_tags',relational_fields.FormFieldMany2ManyTags).add('kanban.many2many_tags',relational_fields.KanbanFieldMany2ManyTags).add('many2many_checkboxes',relational_fields.FieldMany2ManyCheckBoxes).add('one2many',relational_fields.FieldOne2Many).add('statusbar',relational_fields.FieldStatus).add('reference',relational_fields.FieldReference).add('one2many_list',relational_fields.FieldOne2Many);registry.add('timezone_mismatch',special_fields.FieldTimezoneMismatch);});;

/* /web/static/src/js/views/basic/widget_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/fields/field_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_utils',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function formatBinary(value,field,options){if(!value){return'';}
return utils.binaryToBinsize(value);}
function formatBoolean(value,field,options){if(options&&options.forceString){return value?_t('True'):_t('False');}
return dom.renderCheckbox({prop:{checked:value,disabled:true,},});}
function formatChar(value,field,options){value=typeof value==='string'?value:'';if(options&&options.isPassword){return _.str.repeat('*',value?value.length:0);}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatDate(value,field,options){if(value===false){return"";}
if(field&&field.type==='datetime'){if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}}
var date_format=time.getLangDateFormat();return value.format(date_format);}
function formatDateTime(value,field,options){if(value===false){return"";}
if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}
return value.format(time.getLangDatetimeFormat());}
function formatFloat(value,field,options){if(value===false){return"";}
var l10n=core._t.database.parameters;var precision;if(options&&options.digits){precision=options.digits[1];}else if(field&&field.digits){precision=field.digits[1];}else{precision=2;}
var formatted=_.str.sprintf('%.'+precision+'f',value||0).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);}
function formatFloatTime(value){var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);}
function formatInteger(value,field,options){if(options&&options.isPassword){return _.str.repeat('*',String(value).length);}
if(!value&&value!==0){return"";}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));}
function formatMany2one(value,field,options){value=value&&(_.isArray(value)?value[1]:value.data.display_name)||'';if(options&&options.escape){value=_.escape(value);}
return value;}
function formatX2Many(value){if(value.data.length===0){return _t('No records');}else if(value.data.length===1){return _t('1 record');}else{return value.data.length+_t(' records');}}
function formatMonetary(value,field,options){if(value===false){return"";}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
var digits=(currency&&currency.digits)||options.digits;if(options.field_digits===true){digits=field.digits||digits;}
var formatted_value=formatFloat(value,field,{digits:digits,});if(!currency||options.noSymbol){return formatted_value;}
if(currency.position==="after"){return formatted_value+='&nbsp;'+currency.symbol;}else{return currency.symbol+'&nbsp;'+formatted_value;}}
function formatSelection(value,field,options){var val=_.find(field.selection,function(option){return option[0]===value;});if(!val){return'';}
value=val[1];if(options&&options.escape){value=_.escape(value);}
return value;}
function parseDate(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D');var date;if(options&&options.isUTC){date=moment.utc(value);}else{date=moment.utc(value,[datePattern,datePatternWoZero,moment.ISO_8601],true);}
if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1900){date.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD');};return date;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct date"),value));}
function parseDateTime(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat(),timePattern=time.getLangTimeFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D'),timePatternWoZero=timePattern.replace('HH','H').replace('mm','m').replace('ss','s');var pattern1=datePattern+' '+timePattern;var pattern2=datePatternWoZero+' '+timePatternWoZero;var datetime;if(options&&options.isUTC){datetime=moment.utc(value.replace(' ','T')+'Z');}else{datetime=moment.utc(value,[pattern1,pattern2,moment.ISO_8601],true);if(options&&options.timezone){datetime.add(-session.getTZOffset(datetime),'minutes');}}
if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1900){datetime.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD HH:mm:ss');};return datetime;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct datetime"),value));}
function parseNumber(value){if(core._t.database.parameters.thousands_sep){var escapedSep=_.str.escapeRegExp(core._t.database.parameters.thousands_sep);value=value.replace(new RegExp(escapedSep,'g'),'');}
if(core._t.database.parameters.decimal_point){value=value.replace(core._t.database.parameters.decimal_point,'.');}
return Number(value);}
function parseFloat(value){var parsed=parseNumber(value);if(isNaN(parsed)){throw new Error(_.str.sprintf(core._t("'%s' is not a correct float"),value));}
return parsed;}
function parseMonetary(value,field,options){var values=value.split('&nbsp;');if(values.length===1){return parseFloat(value);}
else if(values.length!==2){throw new Error(_.str.sprintf(core._t("'%s' is not a correct monetary field"),value));}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
return parseFloat(values[0]===currency.symbol?values[1]:values[0]);}
function parseFloatTime(value){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!==2)
return factor*parseFloat(value);var hours=parseInteger(float_time_pair[0]);var minutes=parseInteger(float_time_pair[1]);return factor*(hours+(minutes/60));}
function parseInteger(value){var parsed=parseNumber(value);if(isNaN(parsed)||parsed%1||parsed<-2147483648||parsed>2147483647){throw new Error(_.str.sprintf(core._t("'%s' is not a correct integer"),value));}
return parsed;}
function parseMany2one(value){if(_.isArray(value)){return{id:value[0],display_name:value[1],};}
if(_.isNumber(value)||_.isString(value)){return{id:parseInt(value,10),};}
return value;}
return{format:{binary:formatBinary,boolean:formatBoolean,char:formatChar,date:formatDate,datetime:formatDateTime,float:formatFloat,float_time:formatFloatTime,html:_.identity,integer:formatInteger,many2many:formatX2Many,many2one:formatMany2one,monetary:formatMonetary,one2many:formatX2Many,reference:formatMany2one,selection:formatSelection,text:formatChar,},parse:{binary:_.identity,boolean:_.identity,char:_.identity,date:parseDate,datetime:parseDateTime,float:parseFloat,float_time:parseFloatTime,html:_.identity,integer:parseInteger,many2many:_.identity,many2one:parseMany2one,monetary:parseMonetary,one2many:_.identity,reference:parseMany2one,selection:_.identity,text:_.identity,},};});;

/* /web/static/src/js/fields/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.relational_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var concurrency=require('web.concurrency');var ControlPanel=require('web.ControlPanel');var dialogs=require('web.view_dialogs');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var KanbanRenderer=require('web.KanbanRenderer');var ListRenderer=require('web.ListRenderer');var Pager=require('web.Pager');var _t=core._t;var qweb=core.qweb;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent,name,value){this.name=name;this.value=value;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),this.name),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(){if(this.$("input").val()!==''){this.trigger_up('quick_create',{value:this.$('input').val()});this.close(true);}else{this.$("input").focus();}},},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.trigger_up('search_create_popup',{view_type:'form',value:this.$('input').val(),});},},{text:_t('Cancel'),close:true,}],});},start:function(){this.$("p").text(_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name));this.$("input").val(this.value);},close:function(isSet){this.isSet=isSet;this._super.apply(this,arguments);},destroy:function(){if(!this.isSet){this.trigger_up('closed_unset');}
this._super.apply(this,arguments);},});var FieldMany2One=AbstractField.extend({supportedFieldTypes:['many2one'],template:'FieldMany2One',custom_events:_.extend({},AbstractField.prototype.custom_events,{'closed_unset':'_onDialogClosedUnset','field_changed':'_onFieldChanged','quick_create':'_onQuickCreate','search_create_popup':'_onSearchCreatePopup',}),events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick','focusout input':'_onInputFocusout','keyup input':'_onInputKeyup','click .o_external_button':'_onExternalButtonClick','click':'_onClick',}),AUTOCOMPLETE_DELAY:200,init:function(){this._super.apply(this,arguments);this.limit=7;this.orderer=new concurrency.DropMisordered();this.can_create=('can_create'in this.attrs?JSON.parse(this.attrs.can_create):true)&&!this.nodeOptions.no_create;this.can_write='can_write'in this.attrs?JSON.parse(this.attrs.can_write):true;this.nodeOptions=_.defaults(this.nodeOptions,{quick_create:true,});this.m2o_value=this._formatValue(this.value);this.recordParams={fieldName:this.name,viewType:this.viewType};this.isDirty=false;this.lastChangeEvent=undefined;},start:function(){this.floating=false;this.$input=this.$('input');this.$external_button=this.$('.o_external_button');return this._super.apply(this,arguments);},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},reinitialize:function(value){this.isDirty=false;this.floating=false;this._setValue(value);},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty){return $.when();}else{return this._render();}},_bindAutoComplete:function(){var self=this;this.$input.autocomplete({source:function(req,resp){self._search(req.term).then(function(result){resp(result);});},select:function(event,ui){event.stopImmediatePropagation();event.preventDefault();var item=ui.item;self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
return false;},focus:function(event){event.preventDefault();},close:function(event){if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.autocomplete_bound=true;},_createContext:function(name){var tmp={};var field=this.nodeOptions.create_name_field;if(field===undefined){field="name";}
if(field!==false&&name&&this.nodeOptions.quick_create!==false){tmp["default_"+field]=name;}
return tmp;},_getSearchBlacklist:function(){return[];},_getDisplayName:function(value){return value.split('\n')[0];},_onFieldChanged:function(event){this.lastChangeEvent=event;},_quickCreate:function(name){var self=this;var def=$.Deferred();var slowCreate=function(){var dialog=self._searchCreatePopup("form",false,self._createContext(name));dialog.on('closed',self,def.resolve.bind(def));};if(this.nodeOptions.quick_create){this.trigger_up('mutexify',{action:function(){return self._rpc({model:self.field.relation,method:'name_create',args:[name],context:self.record.getContext(self.recordParams),}).then(function(result){if(self.mode==="edit"){self.reinitialize({id:result[0],display_name:result[1]});}
def.resolve();}).fail(function(error,event){event.preventDefault();slowCreate();});},});}else{slowCreate();}
return def;},_renderEdit:function(){var value=this.m2o_value;if(this.nodeOptions.always_reload){value=this._getDisplayName(value);}
this.$input.val(value);if(!this.autocomplete_bound){this._bindAutoComplete();}
this._updateExternalButton();},_renderReadonly:function(){var value=_.escape((this.m2o_value||"").trim()).split("\n").join("<br/>");this.$el.html(value);if(!this.nodeOptions.no_open&&this.value){this.$el.attr('href',_.str.sprintf('#id=%s&model=%s',this.value.res_id,this.field.relation));this.$el.addClass('o_form_uri');}},_reset:function(){this._super.apply(this,arguments);this.floating=false;this.m2o_value=this._formatValue(this.value);},_search:function(search_val){var self=this;var def=$.Deferred();this.orderer.add(def);var context=this.record.getContext(this.recordParams);var domain=this.record.getDomain(this.recordParams);var blacklisted_ids=this._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
this._rpc({model:this.field.relation,method:"name_search",kwargs:{name:search_val,args:domain,operator:"ilike",limit:this.limit+1,context:context,}}).then(function(result){var values=_.map(result,function(x){x[1]=self._getDisplayName(x[1]);return{label:_.str.escapeHTML(x[1].trim())||data.noDisplayContent,value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:160,context:context,},}).then(self._searchCreatePopup.bind(self,"search"));},classname:'o_m2o_dropdown_option',});}
var create_enabled=self.can_create&&!self.nodeOptions.no_create;var raw_result=_.map(result,function(x){return x[1];});if(create_enabled&&!self.nodeOptions.no_quick_create&&search_val.length>0&&!_.contains(raw_result,search_val)){values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:self._quickCreate.bind(self,search_val),classname:'o_m2o_dropdown_option'});}
if(create_enabled&&!self.nodeOptions.no_create_edit){var createAndEditAction=function(){self.$('input').val('');return self._searchCreatePopup("form",false,self._createContext(search_val));};values.push({label:_t("Create and Edit..."),action:createAndEditAction,classname:'o_m2o_dropdown_option',});}else if(values.length===0){values.push({label:_t("No results to show..."),});}
def.resolve(values);});return def;},_searchCreatePopup:function(view,ids,context){var self=this;return new dialogs.SelectCreateDialog(this,_.extend({},this.nodeOptions,{res_model:this.field.relation,domain:this.record.getDomain({fieldName:this.name}),context:_.extend({},this.record.getContext(this.recordParams),context||{}),title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true,on_selected:function(records){self.reinitialize(records[0]);self.activate();}})).open();},_updateExternalButton:function(){var has_external_button=!this.nodeOptions.no_open&&!this.floating&&this.isSet();this.$external_button.toggle(has_external_button);this.$el.toggleClass('o_with_button',has_external_button);},_onClick:function(event){var self=this;if(this.mode==='readonly'&&!this.nodeOptions.no_open){event.preventDefault();event.stopPropagation();this._rpc({model:this.field.relation,method:'get_formview_action',args:[[this.value.res_id]],context:this.record.getContext(this.recordParams),}).then(function(action){self.trigger_up('do_action',{action:action});});}},_onDialogClosedUnset:function(){this.isDirty=false;this.floating=false;this._render();},_onExternalButtonClick:function(){if(!this.value){this.activate();return;}
var self=this;var context=this.record.getContext(this.recordParams);this._rpc({model:this.field.relation,method:'get_formview_id',args:[[this.value.res_id]],context:context,}).then(function(view_id){new dialogs.FormViewDialog(self,{res_model:self.field.relation,res_id:self.value.res_id,context:context,title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write,on_saved:function(record,changed){if(changed){self._setValue(self.value.data,{forceChange:true});self.trigger_up('reload',{db_id:self.value.id});}},}).open();});},_onInputClick:function(){if(this.$input.autocomplete("widget").is(":visible")){this.$input.autocomplete("close");}else if(this.floating){this.$input.autocomplete("search");}else{this.$input.autocomplete("search",'');}},_onInputFocusout:function(){if(this.can_create&&this.floating){new M2ODialog(this,this.string,this.$input.val()).open();}},_onInputKeyup:function(ev){if(ev.which===$.ui.keyCode.ENTER||ev.which===$.ui.keyCode.TAB){return;}
this.isDirty=true;if(this.$input.val()===""){this.reinitialize(false);}else if(this._getDisplayName(this.m2o_value)!==this.$input.val()){this.floating=true;this._updateExternalButton();}},_onKeydown:function(){this.floating=false;this._super.apply(this,arguments);},_onNavigationMove:function(ev){basicFields.InputField.prototype._onNavigationMove.apply(this,arguments);if(this.mode==='edit'&&$(this.$input.autocomplete('widget')).is(':visible')){ev.stopPropagation();}},_onQuickCreate:function(event){this._quickCreate(event.data.value);},_onSearchCreatePopup:function(event){var data=event.data;this._searchCreatePopup(data.view_type,false,this._createContext(data.value));},});var ListFieldMany2One=FieldMany2One.extend({_renderReadonly:function(){this.$el.text(this.m2o_value);},});var KanbanFieldMany2One=AbstractField.extend({tagName:'span',init:function(){this._super.apply(this,arguments);this.m2o_value=this._formatValue(this.value);},_render:function(){this.$el.text(this.m2o_value);},});var FieldX2Many=AbstractField.extend({tagName:'div',custom_events:_.extend({},AbstractField.prototype.custom_events,{add_record:'_onAddRecord',discard_changes:'_onDiscardChanges',edit_line:'_onEditLine',field_changed:'_onFieldChanged',kanban_record_delete:'_onDeleteRecord',list_record_delete:'_onDeleteRecord',open_record:'_onOpenRecord',save_line:'_onSaveLine',resequence:'_onResequence',toggle_column_order:'_onToggleColumnOrder',}),resetOnAnyFieldChange:true,useSubview:true,init:function(parent,name,record,options){this._super.apply(this,arguments);this.operations=[];this.isReadonly=this.mode==='readonly';this.view=this.attrs.views[this.attrs.mode];this.activeActions={};this.recordParams={fieldName:this.name,viewType:this.viewType};var arch=this.view&&this.view.arch;if(arch){this.activeActions.create=arch.attrs.create?JSON.parse(arch.attrs.create):true;this.activeActions.delete=arch.attrs.delete?JSON.parse(arch.attrs.delete):true;this.editable=arch.attrs.editable;}
if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}},start:function(){return this._renderControlPanel().then(this._super.bind(this));},commitChanges:function(){var self=this;var inEditionRecordID=this.renderer&&this.renderer.viewType==="list"&&this.renderer.getEditableRecordID();if(inEditionRecordID){return this.renderer.commitChanges(inEditionRecordID).then(function(){return self._saveLine(inEditionRecordID);});}
return this._super.apply(this,arguments);},isSet:function(){return true;},reset:function(record,ev,fieldChanged){if(!fieldChanged){var newEval=this._evalColumnInvisibleFields();if(_.isEqual(this.currentColInvisibleFields,newEval)){return $.when();}}else if(ev&&ev.target===this&&ev.data.changes&&this.view.arch.tag==='tree'){var command=ev.data.changes[this.name];if(command.operation==='UPDATE'&&command.data){var state=record.data[this.name];var fieldNames=state.getFieldNames();this._reset(record,ev);return this.renderer.confirmUpdate(state,command.id,fieldNames,ev.initialEvent);}}
return this._super.apply(this,arguments);},_evalColumnInvisibleFields:function(){var self=this;return _.mapObject(this.columnInvisibleFields,function(domains){return self.record.evalModifiers({column_invisible:domains,}).column_invisible;});},_render:function(){if(!this.view){return this._super();}
if(this.renderer){this.currentColInvisibleFields=this._evalColumnInvisibleFields();this.renderer.updateState(this.value,{'columnInvisibleFields':this.currentColInvisibleFields});this.pager.updateState({size:this.value.count});return $.when();}
var arch=this.view.arch;var viewType;if(arch.tag==='tree'){viewType='list';this.currentColInvisibleFields=this._evalColumnInvisibleFields();this.renderer=new ListRenderer(this,this.value,{arch:arch,editable:this.mode==='edit'&&arch.attrs.editable,addCreateLine:!this.isReadonly&&this.activeActions.create,addTrashIcon:!this.isReadonly&&this.activeActions.delete,viewType:viewType,columnInvisibleFields:this.currentColInvisibleFields,});}
if(arch.tag==='kanban'){viewType='kanban';var record_options={editable:false,deletable:false,read_only_mode:this.isReadonly,};this.renderer=new KanbanRenderer(this,this.value,{arch:arch,record_options:record_options,viewType:viewType,});}
this.$el.addClass('o_field_x2many o_field_x2many_'+viewType);return this.renderer?this.renderer.appendTo(this.$el):this._super();},_renderControlPanel:function(){if(!this.view){return $.when();}
var self=this;var defs=[];this.control_panel=new ControlPanel(this,"X2ManyControlPanel");this.pager=new Pager(this,this.value.count,this.value.offset+1,this.value.limit,{single_page_hidden:true,withAccessKey:false,validate:function(){var isList=self.view.arch.tag==='tree';return isList?self.renderer.unselectRow():$.when();},});this.pager.on('pager_changed',this,function(new_state){self.trigger_up('load',{id:self.value.id,limit:new_state.limit,offset:new_state.current_min-1,on_success:function(value){self.value=value;self._render();},});});this._renderButtons();defs.push(this.pager.appendTo($('<div>')));defs.push(this.control_panel.prependTo(this.$el));return $.when.apply($,defs).then(function(){self.control_panel.update({cp_content:{$buttons:self.$buttons,$pager:self.pager.$el,}});});},_renderButtons:function(){if(!this.isReadonly&&this.view.arch.tag==='kanban'){var options={create_text:this.nodeOptions.create_text};this.$buttons=$(qweb.render('KanbanView.buttons',options));this.$buttons.on('click','button.o-kanban-button-new',this._onAddRecord.bind(this));}},_saveLine:function(recordID){var self=this;var def=$.Deferred();var fieldNames=this.renderer.canBeSaved(recordID);if(fieldNames.length){this.trigger_up('discard_changes',{recordID:recordID,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});}else{this.renderer.setRowMode(recordID,'readonly').done(def.resolve.bind(def));}
return def.then(function(){self.pager.updateState({size:self.value.count});});},_processColumnInvisibleFields:function(){var columnInvisibleFields={};_.each(this.attrs.columnInvisibleFields,function(domains,fieldName){if(_.isArray(domains)){columnInvisibleFields[fieldName]=_.map(domains,function(domain){if(_.isArray(domain)){return[domain[0].split('.')[1]].concat(domain.slice(1));}
return domain;});}});this.columnInvisibleFields=columnInvisibleFields;},_onAddRecord:function(){},_onDeleteRecord:function(ev){ev.stopPropagation();var shouldForget=this.attrs.widget==='many2many'||this.field.type==='many2many';var operation=shouldForget?'FORGET':'DELETE';this._setValue({operation:operation,ids:[ev.data.id],});},_onDiscardChanges:function(ev){if(ev.target!==this){ev.stopPropagation();this.trigger_up('discard_changes',_.extend({},ev.data,{fieldName:this.name}));}},_onEditLine:function(ev){ev.stopPropagation();this.trigger_up('edited_list',{id:this.value.id});var editedRecord=this.value.data[ev.data.index];this.renderer.setRowMode(editedRecord.id,'edit').done(ev.data.onSuccess);},_onFieldChanged:function(ev){if(ev.target===this){ev.initialEvent=this.lastInitialEvent;return;}
ev.stopPropagation();var changes=ev.data.changes;this.lastInitialEvent=undefined;if(Object.keys(changes).length){this.lastInitialEvent=ev;this._setValue({operation:'UPDATE',id:ev.data.dataPointID,data:changes,});}},_onOpenRecord:function(){},_onSaveLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){return self.renderer.commitChanges(ev.data.recordID).then(function(){self.trigger_up('mutexify',{action:function(){return self._saveLine(ev.data.recordID).done(ev.data.onSuccess).fail(ev.data.onFailure);},});});},});},_onResequence:function(event){event.stopPropagation();var self=this;this.trigger_up('edited_list',{id:this.value.id});var rowIDs=event.data.rowIDs.slice();var rowID=rowIDs.pop();var defs=_.map(rowIDs,function(rowID,index){var data={};data[event.data.handleField]=event.data.offset+index;return self._setValue({operation:'UPDATE',id:rowID,data:data,},{notifyChange:false,});});$.when.apply($,defs).then(function(){self._setValue({operation:'UPDATE',id:rowID,data:_.object([event.data.handleField],[event.data.offset+rowIDs.length]),}).always(function(){self.trigger_up('toggle_column_order',{id:self.value.id,name:event.data.handleField,});});});},_onToggleColumnOrder:function(ev){ev.data.field=this.name;},});var FieldOne2Many=FieldX2Many.extend({className:'o_field_one2many',supportedFieldTypes:['one2many'],init:function(){this._super.apply(this,arguments);this.creatingRecord=false;},reset:function(record,ev){var self=this;return this._super.apply(this,arguments).then(function(){if(ev&&ev.target===self&&ev.data.changes&&self.view.arch.tag==='tree'){if(ev.data.changes[self.name].operation==='CREATE'){var index=0;if(self.editable!=='top'){index=self.value.data.length-1;self.pager.updateState({size:self.value.count-1});}
var newID=self.value.data[index].id;self.renderer.editRecord(newID);}}});},_renderButtons:function(){if(this.activeActions.create){this._super.apply(this,arguments);}},_openFormDialog:function(params){this.trigger_up('open_one2many_record',_.extend(params,{domain:this.record.getDomain(this.recordParams),context:this.record.getContext(this.recordParams),field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,}));},_onAddRecord:function(ev){var self=this;ev.stopPropagation();if(this.editable){if(!this.activeActions.create){if(ev.data.onFail){ev.data.onFail();}}else if(!this.creatingRecord){this.creatingRecord=true;this.trigger_up('edited_list',{id:this.value.id});this._setValue({operation:'CREATE',position:this.editable,}).always(function(){self.creatingRecord=false;});}}else{this._openFormDialog({on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});}},_onOpenRecord:function(ev){ev.stopPropagation();var self=this;var id=ev.data.id;var onSaved=function(record){if(_.some(self.value.data,{id:record.id})){self._setValue({operation:'UPDATE',id:record.id});}else{self._setValue({operation:'ADD',id:record.id});}};this._openFormDialog({id:id,on_saved:onSaved,readonly:this.mode==='readonly',});},});var FieldMany2Many=FieldX2Many.extend({className:'o_field_many2many',supportedFieldTypes:['many2many'],init:function(){this._super.apply(this,arguments);this.nodeOptions=_.defaults(this.nodeOptions,{create_text:_t('Add'),});},_onAddRecord:function(ev){var self=this;ev.stopPropagation();var domain=this.record.getDomain({fieldName:this.name});new dialogs.SelectCreateDialog(this,{res_model:this.field.relation,domain:domain.concat(["!",["id","in",this.value.res_ids]]),context:this.record.getContext(this.recordParams),title:_t("Add: ")+this.string,no_create:this.nodeOptions.no_create||!this.activeActions.create,fields_view:this.attrs.views.form,on_selected:function(records){var resIDs=_.pluck(records,'id');var newIDs=_.difference(resIDs,self.value.res_ids);if(newIDs.length){var values=_.map(newIDs,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}}}).open();},_onOpenRecord:function(ev){var self=this;_.extend(ev.data,{context:this.record.getContext(this.recordParams),domain:this.record.getDomain(this.recordParams),fields_view:this.attrs.views&&this.attrs.views.form,on_saved:function(){self._setValue({operation:'TRIGGER_ONCHANGE'},{forceChange:true});self.trigger_up('reload',{db_id:ev.data.id});},readonly:this.mode==='readonly',string:this.string,});},});var FieldMany2ManyBinaryMultiFiles=AbstractField.extend({template:"FieldBinaryFileUploader",supportedFieldTypes:['many2many'],fieldsToFetch:{name:{type:'char'},datas_fname:{type:'char'},mimetype:{type:'char'},},events:{'click .o_attach':'_onAttach','click .oe_delete':'_onDelete','change .o_input_file':'_onFileChanged',},init:function(){this._super.apply(this,arguments);if(this.field.type!=='many2many'||this.field.relation!=='ir.attachment'){var msg=_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model.");throw _.str.sprintf(msg,this.field.string);}
this.uploadedFiles={};this.uploadingFiles=[];this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,this._onFileLoaded.bind(this));this.metadata={};},destroy:function(){this._super();$(window).off(this.fileupload_id);},_getFileUrl:function(attachment){return'/web/content/'+attachment.id+'?download=true';},_generatedMetadata:function(){var self=this;_.each(this.value.data,function(record){self.metadata[record.id]={allowUnlink:self.uploadedFiles[record.data.id]||false,url:self._getFileUrl(record.data),};});},_render:function(){this._generatedMetadata();this.$('.oe_placeholder_files, .oe_attachments').replaceWith($(qweb.render('FieldBinaryFileUploader.files',{widget:this,})));this.$('.oe_fileupload').show();this.$('.o_image[data-mimetype^="image"]').each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});},_onAttach:function(){this.$('.o_input_file').click();},_onDelete:function(ev){ev.preventDefault();ev.stopPropagation();var fileID=$(ev.currentTarget).data('id');var record=_.findWhere(this.value.data,{res_id:fileID});if(record){this._setValue({operation:'FORGET',ids:[record.id],});var metadata=this.metadata[record.id];if(!metadata||metadata.allowUnlink){this._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}},_onFileChanged:function(ev){var self=this;ev.stopPropagation();var files=ev.target.files;var attachment_ids=this.value.res_ids;_.each(files,function(file){var record=_.find(self.value.data,function(attachment){return attachment.data.name===file.name;});if(record){var metadata=self.metadata[record.id];if(!metadata||metadata.allowUnlink){attachment_ids=_.without(attachment_ids,record.res_id);self._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}
self.uploadingFiles.push(file);});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});this.$('form.o_form_binary_form').submit();this.$('.oe_fileupload').hide();ev.target.value="";},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);this.uploadingFiles=[];var attachment_ids=this.value.res_ids;_.each(files,function(file){if(file.error){self.do_warn(_t('Uploading Error'),file.error);}else{attachment_ids.push(file.id);self.uploadedFiles[file.id]=true;}});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});},});var FieldMany2ManyTags=AbstractField.extend({tag_template:"FieldMany2ManyTag",className:"o_field_many2manytags",supportedFieldTypes:['many2many'],custom_events:_.extend({},AbstractField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},AbstractField.prototype.events,{'click .o_delete':'_onDeleteTag',}),fieldsToFetch:{display_name:{type:'char'},},init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.className+=' o_input';}
this.colorField=this.nodeOptions.color_field;},activate:function(){return this.many2one?this.many2one.activate():false;},getFocusableElement:function(){return this.many2one?this.many2one.getFocusableElement():$();},isSet:function(){return!!this.value&&this.value.count;},reset:function(record,event){this._super.apply(this,arguments);if(event&&event.target===this){this.activate();}},_addTag:function(data){if(!_.contains(this.value.res_ids,data.id)){this._setValue({operation:'ADD_M2M',ids:data});}},_getRenderTagsContext:function(){var elements=this.value?_.pluck(this.value.data,'data'):[];return{colorField:this.colorField,elements:elements,readonly:this.mode==="readonly",};},_removeTag:function(id){var record=_.findWhere(this.value.data,{res_id:id});this._setValue({operation:'FORGET',ids:[record.id],});},_renderEdit:function(){var self=this;this._renderTags();if(this.many2one){this.many2one.destroy();}
this.many2one=new FieldMany2One(this,this.name,this.record,{mode:'edit',viewType:this.viewType,});this.many2one.value=false;this.many2one.m2o_value='';this.many2one.nodeOptions.no_open=true;this.many2one._getSearchBlacklist=function(){return self.value.res_ids;};return this.many2one.appendTo(this.$el);},_renderReadonly:function(){this._renderTags();},_renderTags:function(){this.$el.html(qweb.render(this.tag_template,this._getRenderTagsContext()));},_onDeleteTag:function(event){this._removeTag($(event.target).parent().data('id'));},_onFieldChanged:function(ev){if(ev.target!==this.many2one){return;}
ev.stopPropagation();var newValue=ev.data.changes[this.name];if(newValue){this._addTag(newValue);this.many2one.reinitialize(false);}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.BACKSPACE&&this.$('input').val()===""){var $badges=this.$('.badge');if($badges.length){this._removeTag($badges.last().data('id'));return;}}
this._super.apply(this,arguments);},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var FormFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.extend({},FieldMany2ManyTags.prototype.events,{'click .badge':'_onOpenColorPicker','mousedown .o_colorpicker a':'_onUpdateColor','focusout .o_colorpicker':'_onCloseColorPicker',}),_onCloseColorPicker:function(){this.$color_picker.remove();},_onOpenColorPicker:function(event){var tag_id=$(event.currentTarget).data('id');var tag=_.findWhere(this.value.data,{res_id:tag_id});if(tag&&this.colorField in tag.data){this.$color_picker=$(qweb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':tag_id,}));$(event.currentTarget).append(this.$color_picker);this.$color_picker.dropdown('toggle');this.$color_picker.attr("tabindex",1).focus();}},_onUpdateColor:function(event){event.preventDefault();var self=this;var color=$(event.currentTarget).data('color');var id=$(event.currentTarget).data('id');var tag=self.$("span.badge[data-id='"+id+"']");var current_color=tag.data('color');if(color===current_color){return;}
var changes={};changes[this.colorField]=color;this.trigger_up('field_changed',{dataPointID:_.findWhere(this.value.data,{res_id:id}).id,changes:changes,force_save:true,});},});var KanbanFieldMany2ManyTags=FieldMany2ManyTags.extend({events:AbstractField.prototype.events,_render:function(){var self=this;this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');_.each(this.value.data,function(m2m){if(self.colorField in m2m.data&&!m2m.data[self.colorField]){return;}
$('<span>',{class:'o_tag o_tag_color_'+(m2m.data[self.colorField]||0),text:m2m.data.display_name,}).prepend('<span>').appendTo(self.$el);});},});var FieldMany2ManyCheckBoxes=AbstractField.extend({template:'FieldMany2ManyCheckBoxes',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),specialData:"_fetchSpecialRelation",supportedFieldTypes:['many2many'],init:function(){this._super.apply(this,arguments);this.m2mValues=this.record.specialData[this.name];},isSet:function(){return true;},_render:function(){var self=this;this._super.apply(this,arguments);_.each(this.value.res_ids,function(id){self.$('input[data-record-id="'+id+'"]').prop('checked',true);});},_renderReadonly:function(){this.$("input").prop("disabled",true);},_onChange:function(){var ids=_.map(this.$('input:checked'),function(input){return $(input).data("record-id");});this._setValue({operation:'REPLACE_WITH',ids:ids,});},});var FieldStatus=AbstractField.extend({className:'o_statusbar_status',events:{'click button:not(.dropdown-toggle)':'_onClickStage',},specialData:"_fetchSpecialStatus",supportedFieldTypes:['selection','many2one'],init:function(){this._super.apply(this,arguments);this._setState();this._onClickStage=_.debounce(this._onClickStage,300,true);},_reset:function(){this._super.apply(this,arguments);this._setState();},_setState:function(){var self=this;if(this.field.type==='many2one'){this.status_information=_.map(this.record.specialData[this.name],function(info){return _.extend({selected:info.id===self.value.res_id,},info);});}else{var selection=this.field.selection;if(this.attrs.statusbar_visible){var restriction=this.attrs.statusbar_visible.split(",");selection=_.filter(selection,function(val){return _.contains(restriction,val[0])||val[0]===self.value;});}
this.status_information=_.map(selection,function(val){return{id:val[0],display_name:val[1],selected:val[0]===self.value,fold:false};});}},_render:function(){var selections=_.partition(this.status_information,function(info){return(info.selected||!info.fold);});this.$el.html(qweb.render("FieldStatus.content",{selection_unfolded:selections[0],selection_folded:selections[1],clickable:!!this.attrs.clickable,}));},_onClickStage:function(e){this._setValue($(e.currentTarget).data("value"));},});var FieldSelection=AbstractField.extend({template:'FieldSelection',specialData:"_fetchSpecialRelation",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'change':'_onChange',}),init:function(){this._super.apply(this,arguments);this._setValues();},getFocusableElement:function(){return this.$el.is('select')?this.$el:$();},isSet:function(){return this.value!==false;},_renderEdit:function(){this.$el.empty();for(var i=0;i<this.values.length;i++){this.$el.append($('<option/>',{value:JSON.stringify(this.values[i][0]),text:this.values[i][1]}));}
var value=this.value;if(this.field.type==='many2one'&&value){value=value.data.id;}
this.$el.val(JSON.stringify(value));},_renderReadonly:function(){this.$el.empty().text(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='many2one'){this.values=this.record.specialData[this.name];this.formatType='many2one';}else{this.values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});}
this.values=[[false,this.attrs.placeholder||'']].concat(this.values);},_onChange:function(){var res_id=JSON.parse(this.$el.val());if(this.field.type==='many2one'){var value=_.find(this.values,function(val){return val[0]===res_id;});this._setValue({id:res_id,display_name:value[1]});}else{this._setValue(res_id);}},});var FieldRadio=FieldSelection.extend({template:null,className:'o_field_radio',tagName:'span',specialData:"_fetchSpecialMany2ones",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick',}),init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='div';this.className+=this.nodeOptions.horizontal?' o_horizontal':' o_vertical';}
this.unique_id=_.uniqueId("radio");this._setValues();},isSet:function(){return true;},_renderEdit:function(){var self=this;var currentValue;if(this.field.type==='many2one'){currentValue=this.value&&this.value.data.id;}else{currentValue=this.value;}
this.$el.empty();_.each(this.values,function(value,index){self.$el.append(qweb.render('FieldRadio.button',{checked:value[0]===currentValue,id:self.unique_id+'_'+value[0],index:index,value:value,}));});},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onInputClick:function(event){var index=$(event.target).data('index');var value=this.values[index];if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}},});var FieldReference=FieldMany2One.extend({specialData:"_fetchSpecialReference",supportedFieldTypes:['char','reference'],template:'FieldReference',events:_.extend({},FieldMany2One.prototype.events,{'change select':'_onSelectionChange',}),init:function(){this._super.apply(this,arguments);this.field=_.extend({},this.field);this._setState();},start:function(){this.$('select').val(this.field.relation);return this._super.apply(this,arguments);},getFocusableElement:function(){if(this.mode==='edit'&&!this.field.relation){return this.$('select');}
return this._super.apply(this,arguments);},_formatValue:function(){var value;if(this.field.type==='char'){value=this.record.specialData[this.name];}else{value=this.value;}
return value&&value.data&&value.data.display_name||'';},_renderEdit:function(){this._super.apply(this,arguments);if(this.$('select').val()){this.$('.o_input_dropdown').show();this.$el.addClass('o_row');}else{this.$('.o_input_dropdown').hide();}},_reset:function(){var value=this.$('select').val();this._setState();this._super.apply(this,arguments);this.$('select').val(this.value&&this.value.model||value);},_setRelation:function(model){this.field.relation=model;},_setState:function(){if(this.field.type==='char'){this.value=this.record.specialData[this.name];}
if(this.value){this._setRelation(this.value.model);}},_setValue:function(value,options){value=value||{};value.model=this.$('select').val();return this._super(value,options);},_onSelectionChange:function(){var value=this.$('select').val();this.reinitialize(false);this._setRelation(value);},});return{FieldMany2One:FieldMany2One,KanbanFieldMany2One:KanbanFieldMany2One,ListFieldMany2One:ListFieldMany2One,FieldOne2Many:FieldOne2Many,FieldMany2Many:FieldMany2Many,FieldMany2ManyBinaryMultiFiles:FieldMany2ManyBinaryMultiFiles,FieldMany2ManyCheckBoxes:FieldMany2ManyCheckBoxes,FieldMany2ManyTags:FieldMany2ManyTags,FormFieldMany2ManyTags:FormFieldMany2ManyTags,KanbanFieldMany2ManyTags:KanbanFieldMany2ManyTags,FieldRadio:FieldRadio,FieldSelection:FieldSelection,FieldStatus:FieldStatus,FieldReference:FieldReference,};});;

/* /web/static/src/js/fields/special_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.special_fields',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var relational_fields=require('web.relational_fields');var FieldSelection=relational_fields.FieldSelection;var _t=core._t;var FieldTimezoneMismatch=FieldSelection.extend({start:function(){var interval=navigator.platform.toUpperCase().indexOf('MAC')>=0?60000:1000;this._datetime=setInterval(this._renderDateTimeTimezone.bind(this),interval);return this._super.apply(this,arguments);},destroy:function(){clearInterval(this._datetime);return this._super();},_render:function(){this._super.apply(this,arguments);this._renderTimezoneMismatch();},_renderDateTimeTimezone:function(){if(!this.mismatch){return;}
var offset=this.recordData.tz_offset.match(/([+-])([0-9]{2})([0-9]{2})/);offset=(offset[1]==='-'?-1:1)*(parseInt(offset[2])*60+parseInt(offset[3]));var datetime=field_utils.format.datetime(moment.utc().add(offset,'minutes'),this.field,{timezone:false});var content=this.$option.html().split(' ')[0];content+='    ('+datetime+')';this.$option.html(content);},_renderTimezoneMismatch:function(){this.$el.last().filter('.o_tz_warning').remove();this.$el=this.$el.first();var value=this.$el.val();if(this.$option){this.$option.html(this.$option.html().split(' ')[0]);}
var userOffset=this.recordData.tz_offset;this.mismatch=false;if(userOffset&&value!==""&&value!=="false"){var offset=-(new Date().getTimezoneOffset());var browserOffset=(offset<0)?"-":"+";browserOffset+=_.str.sprintf("%02d",Math.abs(offset/60));browserOffset+=_.str.sprintf("%02d",Math.abs(offset%60));this.mismatch=(browserOffset!==userOffset);}
if(this.mismatch){var $span=$('<span class="fa fa-exclamation-triangle o_tz_warning"/>');$span.insertAfter(this.$el);$span.attr('title',_t("Timezone Mismatch : The timezone of your browser doesn't match the selected one. The time in Odoo is displayed according to your field timezone."));this.$el=this.$el.add($span);this.$option=this.$('option').filter(function(){return $(this).attr('value')===value;});this._renderDateTimeTimezone();}},});return{FieldTimezoneMismatch:FieldTimezoneMismatch,};});;

/* /web/static/src/js/fields/upgrade_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.upgrade_widgets',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var core=require('web.core');var Dialog=require('web.Dialog');var field_registry=require('web.field_registry');var framework=require('web.framework');var relational_fields=require('web.relational_fields');var _t=core._t;var QWeb=core.qweb;var FieldBoolean=basic_fields.FieldBoolean;var FieldRadio=relational_fields.FieldRadio;var AbstractFieldUpgrade={_confirmUpgrade:function(){return this._rpc({model:'res.users',method:'search_count',args:[[["share","=",false]]],}).then(function(data){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+data);});},_insertEnterpriseLabel:function($enterpriseLabel){},_openDialog:function(){var message=$(QWeb.render('EnterpriseUpgrade'));var buttons=[{text:_t("Upgrade now"),classes:'btn-primary',close:true,click:this._confirmUpgrade.bind(this),},{text:_t("Cancel"),close:true,},];return new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{html:message,}),title:_t("Odoo Enterprise"),}).open();},_render:function(){this._super.apply(this,arguments);this._insertEnterpriseLabel($("<span>",{text:"Enterprise",'class':"label label-primary oe_inline o_enterprise_label"}));},_resetValue:function(){},_onInputClicked:function(event){if($(event.currentTarget).prop("checked")){this._openDialog().on('closed',this,this._resetValue.bind(this));}},};var UpgradeBoolean=FieldBoolean.extend(AbstractFieldUpgrade,{supportedFieldTypes:[],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClicked',}),renderWithLabel:function($label){this.$label=$label;this._render();},_insertEnterpriseLabel:function($enterpriseLabel){var $el=this.$label||this.$el;$el.append('&nbsp;').append($enterpriseLabel);},_resetValue:function(){this.$input.prop("checked",false).change();},});var UpgradeRadio=FieldRadio.extend(AbstractFieldUpgrade,{supportedFieldTypes:[],events:_.extend({},FieldRadio.prototype.events,{'click input:last':'_onInputClicked',}),isSet:function(){return true;},_insertEnterpriseLabel:function($enterpriseLabel){this.$('label').last().append('&nbsp;').append($enterpriseLabel);},_resetValue:function(){this.$('input').first().prop("checked",true).click();},});field_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web/static/src/js/views/abstract_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractView',function(require){"use strict";var ajax=require('web.ajax');var Class=require('web.Class');var Context=require('web.Context');var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');var AbstractView=Class.extend({display_name:'',mobile_friendly:false,icon:'fa-question',multi_record:true,searchable:true,config:{Model:AbstractModel,Renderer:AbstractRenderer,Controller:AbstractController,},init:function(viewInfo,params){this.rendererParams={arch:viewInfo.arch,noContentHelp:params.action&&params.action.help,};this.controllerParams={modelName:params.modelName,activeActions:{edit:viewInfo.arch.attrs.edit?JSON.parse(viewInfo.arch.attrs.edit):true,create:viewInfo.arch.attrs.create?JSON.parse(viewInfo.arch.attrs.create):true,delete:viewInfo.arch.attrs.delete?JSON.parse(viewInfo.arch.attrs.delete):true,duplicate:viewInfo.arch.attrs.duplicate?JSON.parse(viewInfo.arch.attrs.duplicate):true,},};this.loadParams={context:params.context,count:params.count||((this.controllerParams.ids!==undefined)&&this.controllerParams.ids.length)||0,domain:params.domain,groupedBy:params.groupBy,modelName:params.modelName,res_id:params.currentId,res_ids:params.ids,};if(params.modelName){this.loadParams.modelName=params.modelName;}
var defaultOrder=viewInfo.arch.attrs.default_order;if(defaultOrder){this.loadParams.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}
this.userContext=params.userContext;},getController:function(parent){var self=this;var alreadyHasModel=!!this.model;return $.when(this._loadData(parent),ajax.loadLibs(this)).then(function(){var state=self.model.get(arguments[0]);var renderer=self.getRenderer(parent,state);var Controller=self.Controller||self.config.Controller;var controllerParams=_.extend({initialState:state,},self.controllerParams);var controller=new Controller(parent,self.model,renderer,controllerParams);renderer.setParent(controller);if(!alreadyHasModel){self.model.setParent(controller);}
return controller;});},getModel:function(parent){if(!this.model){var Model=this.config.Model;this.model=new Model(parent);}
return this.model;},getRenderer:function(parent,state){var Renderer=this.config.Renderer;return new Renderer(parent,state,this.rendererParams);},setController:function(Controller){this.Controller=Controller;},_loadData:function(parent){var model=this.getModel(parent);return model.load(this.loadParams);},_loadSubviews:function(parent){var self=this;var defs=[];if(this.loadParams&&this.loadParams.fieldsInfo){var fields=this.loadParams.fields;_.each(this.loadParams.fieldsInfo.form,function(attrs,fieldName){var field=fields[fieldName];if(!field){return;}
if(field.type!=='one2many'&&field.type!=='many2many'){return;}
if(attrs.Widget.prototype.useSubview&&!attrs.__no_fetch&&!attrs.views[attrs.mode]){var context={};var regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;var matches;while(matches=regex.exec(attrs.context)){context[matches[1]]=matches[2];}
defs.push(parent.loadViews(field.relation,new Context(context,self.userContext,self.loadParams.context),[[null,attrs.mode==='tree'?'list':attrs.mode]]).then(function(views){for(var viewName in views){attrs.views[viewName]=views[viewName];}
self._setSubViewLimit(attrs);}));}else{self._setSubViewLimit(attrs);}});}
return $.when.apply($,defs);},_setSubViewLimit:function(attrs){var view=attrs.views&&attrs.views[attrs.mode];var limit=view&&view.arch.attrs.limit&&parseInt(view.arch.attrs.limit);if(!limit&&attrs.widget==='many2many_tags'){limit=1000;}
attrs.limit=limit||40;},});return AbstractView;});;

/* /web/static/src/js/views/abstract_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractRenderer',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({init:function(parent,state,params){this._super(parent);this.state=state;this.arch=params.arch;this.noContentHelp=params.noContentHelp;},start:function(){this.$el.addClass(this.arch.attrs.class);return $.when(this._render(),this._super());},on_attach_callback:function(){},on_detach_callback:function(){},getLocalState:function(){},setLocalState:function(localState){},updateState:function(state,params){this.state=state;return params.noRender?$.when():this._render();},_render:function(){return $.when();},});});;

/* /web/static/src/js/views/abstract_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractModel',function(require){"use strict";var Class=require('web.Class');var fieldUtils=require('web.field_utils');var mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var AbstractModel=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);},get:function(){},load:function(params){return $.when();},reload:function(params){return $.when();},_parseServerValue:function(field,value){if(field.type==='date'||field.type==='datetime'){value=fieldUtils.parse[field.type](value,field,{isUTC:true});}else if(field.type==='selection'&&value===false){var hasKey0=_.find(field.selection,function(option){return option[0]===0;});value=hasKey0?0:value;}
return value;},});return AbstractModel;});;

/* /web/static/src/js/views/abstract_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractController',function(require){"use strict";var concurrency=require('web.concurrency');var Widget=require('web.Widget');var AbstractController=Widget.extend({custom_events:{open_record:'_onOpenRecord',},events:{'click a[type="action"]':'_onActionClicked',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.renderer=renderer;this.modelName=params.modelName;this.handle=params.handle;this.activeActions=params.activeActions;this.initialState=params.initialState;this.dp=new concurrency.DropPrevious();},start:function(){return $.when(this._super.apply(this,arguments),this.renderer.appendTo(this.$el)).then(this._update.bind(this,this.initialState));},destroy:function(){if(this.$buttons){this.$buttons.off();}
return this._super.apply(this,arguments);},on_attach_callback:function(){this.renderer.on_attach_callback();},on_detach_callback:function(){this.renderer.on_detach_callback();},discardChanges:function(recordID){return $.when();},getContext:function(){return{};},getScrollTop:function(){return this.scrollTop;},getTitle:function(){return this.display_name;},is_action_enabled:function(action){return this.activeActions[action];},reload:function(params){return this.update(params||{});},renderButtons:function($node){},renderPager:function($node){},renderSidebar:function($node){},setScrollTop:function(scrollTop){this.scrollTop=scrollTop;},update:function(params,options){var self=this;var shouldReload=(options&&'reload'in options)?options.reload:true;var def=shouldReload?this.model.reload(this.handle,params):$.when();return this.dp.add(def).then(function(handle){self.handle=handle||self.handle;var state=self.model.get(self.handle);var localState=self.renderer.getLocalState();return self.dp.add(self.renderer.updateState(state,params)).then(function(){self.renderer.setLocalState(localState);self._update(state);});});},_pushState:function(state){this.trigger_up('push_state',state||{});},_update:function(state){this._pushState();return $.when();},_onOpenRecord:function(event){event.stopPropagation();var record=this.model.get(event.data.id,{raw:true});this.trigger_up('switch_view',{view_type:'form',res_id:record.res_id,mode:event.data.mode||'readonly',model:this.modelName,});},_onActionClicked:function(event){event.preventDefault();this.do_action(event.target.name);},});return AbstractController;});;

/* /web/static/src/js/views/basic/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var x2ManyCommands={CREATE:0,create:function(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update:function(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete:function(id){return[x2ManyCommands.DELETE,id,false];},FORGET:3,forget:function(id){return[x2ManyCommands.FORGET,id,false];},LINK_TO:4,link_to:function(id){return[x2ManyCommands.LINK_TO,id,false];},DELETE_ALL:5,delete_all:function(){return[5,false,false];},REPLACE_WITH:6,replace_with:function(ids){return[6,false,ids];}};var BasicModel=AbstractModel.extend({init:function(){this.mutex=new concurrency.Mutex();this.localData=Object.create(null);this._super.apply(this,arguments);},addDefaultRecord:function(listID,options){var self=this;var list=this.localData[listID];var context=this._getContext(list);var position=(options&&options.position)||'top';var params={context:context,fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){list.count++;if(position==='top'){list.data.unshift(id);}else{list.data.push(id);}
var record=self.localData[id];list._cache[record.res_id]=id;return id;});},applyDefaultValues:function(recordID,values,options){options=options||{};var record=this.localData[recordID];var viewType=options.viewType||record.viewType;var fieldNames=options.fieldNames||Object.keys(record.fieldsInfo[viewType]);var field;var fieldName;record._changes=record._changes||{};values=_.pick(values,fieldNames);for(var i=0;i<fieldNames.length;i++){fieldName=fieldNames[i];if(!(fieldName in values)&&!(fieldName in record._changes)){field=record.fields[fieldName];if(field.type==='float'||field.type==='integer'||field.type==='monetary'){values[fieldName]=0;}else if(field.type==='one2many'||field.type==='many2many'){values[fieldName]=[];}else{values[fieldName]=null;}}}
var defs=[];for(fieldName in values){field=record.fields[fieldName];record.data[fieldName]=null;var dp;if(field.type==='many2one'&&values[fieldName]){dp=this._makeDataPoint({context:record.context,data:{id:values[fieldName]},modelName:field.relation,parentID:record.id,});record._changes[fieldName]=dp.id;}else if(field.type==='reference'&&values[fieldName]){var ref=values[fieldName].split(',');dp=this._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:ref[0],parentID:record.id,});defs.push(this._fetchNameGet(dp));record._changes[fieldName]=dp.id;}else if(field.type==='one2many'||field.type==='many2many'){defs.push(this._processX2ManyCommands(record,fieldName,values[fieldName],options));}else{record._changes[fieldName]=this._parseServerValue(field,values[fieldName]);}}
return $.when.apply($,defs);},applyRawChanges:function(recordID,viewType){var record=this.localData[recordID];return this._applyOnChange(record._rawChanges,record,viewType).then(function(){return record.id;});},deleteRecords:function(recordIds,modelName){var self=this;var records=_.map(recordIds,function(id){return self.localData[id];});return this._rpc({model:modelName,method:'unlink',args:[_.pluck(records,'res_id')],context:session.user_context,}).then(function(){_.each(records,function(record){var parent=record.parentID&&self.localData[record.parentID];if(parent&&parent.type==='list'){parent.data=_.without(parent.data,record.id);delete self.localData[record.id];}else{record.res_ids.splice(record.offset,1);record.offset=Math.min(record.offset,record.res_ids.length-1);record.res_id=record.res_ids[record.offset];record.count--;}});});},discardChanges:function(id,options){options=options||{};var element=this.localData[id];var isNew=this.isNew(id);var rollback='rollback'in options?options.rollback:isNew;var initialOffset=element.offset;this._visitChildren(element,function(elem){if(rollback&&elem._savePoint){if(elem._savePoint instanceof Array){elem._changes=elem._savePoint.slice(0);}else{elem._changes=_.extend({},elem._savePoint);}
elem._isDirty=!isNew;}else{elem._changes=null;elem._isDirty=false;}
elem.offset=0;if(elem.tempLimitIncrement){elem.limit-=elem.tempLimitIncrement;delete elem.tempLimitIncrement;}});element.offset=initialOffset;},duplicateRecord:function(recordID){var self=this;var record=this.localData[recordID];var context=this._getContext(record);return this._rpc({model:record.model,method:'copy',args:[record.data.id],context:context,}).then(function(res_id){var index=record.res_ids.indexOf(record.res_id);record.res_ids.splice(index+1,0,res_id);return self.load({fieldsInfo:record.fieldsInfo,fields:record.fields,modelName:record.model,res_id:res_id,res_ids:record.res_ids.slice(0),viewType:record.viewType,context:context,});});},get:function(id,options){var self=this;options=options||{};if(!(id in this.localData)){return null;}
var element=this.localData[id];if(options.env){var env={ids:element.res_ids?element.res_ids.slice(0):[],};if(element.type==='record'){env.currentId=this.isNew(element.id)?undefined:element.res_id;}
return env;}
if(element.type==='record'){var data=_.extend({},element.data,element._changes);var relDataPoint;for(var fieldName in data){var field=element.fields[fieldName];if(data[fieldName]===null){data[fieldName]=false;}
if(!field){continue;}
if(field.type==='many2one'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='reference'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.model+','+relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='one2many'||field.type==='many2many'){if(options.raw){relDataPoint=this.localData[data[fieldName]];relDataPoint=this._applyX2ManyOperations(relDataPoint);data[fieldName]=relDataPoint.res_ids;}else{data[fieldName]=this.get(data[fieldName])||[];}}}
var record={context:_.extend({},element.context),count:element.count,data:data,domain:element.domain.slice(0),evalModifiers:element.evalModifiers,fields:element.fields,fieldsInfo:element.fieldsInfo,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,id:element.id,limit:element.limit,model:element.model,offset:element.offset,ref:element.ref,res_ids:element.res_ids.slice(0),specialData:_.extend({},element.specialData),type:'record',viewType:element.viewType,};if(!this.isNew(element.id)){record.res_id=element.res_id;}
var evalContext;Object.defineProperty(record,'evalContext',{get:function(){evalContext=evalContext||self._getEvalContext(element);return evalContext;},});return record;}
element=this._applyX2ManyOperations(element);this._sortList(element);if(!element.orderedResIDs&&element._changes){_.each(element._changes,function(change){if(change.operation==='ADD'&&change.isNew){element.data=_.without(element.data,change.id);if(change.position==='top'){element.data.unshift(change.id);}else{element.data.push(change.id);}}});}
var list={aggregateValues:_.extend({},element.aggregateValues),context:_.extend({},element.context),count:element.count,data:_.map(element.data,function(elemID){return self.get(elemID,options);}),domain:element.domain.slice(0),fields:element.fields,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,groupedBy:element.groupedBy,id:element.id,isOpen:element.isOpen,limit:element.limit,model:element.model,offset:element.offset,orderedBy:element.orderedBy,res_id:element.res_id,res_ids:element.res_ids.slice(0),type:'list',value:element.value,viewType:element.viewType,};if(element.fieldsInfo){list.fieldsInfo=element.fieldsInfo;}
return list;},getName:function(id){var record=this.localData[id];if(record._changes&&'display_name'in record._changes){return record._changes.display_name;}
if('display_name'in record.data){return record.data.display_name;}
return _t("New");},canBeAbandoned:function(id){if(this.localData[id]._noAbandon){return false;}
var record=this.localData[id];var parent=this.localData[record.parentID];if(parent){var entry=_.findWhere(parent._savePoint,{operation:'ADD',id:id});if(entry){if(!entry.isNew){return false;}
var lastEntry=_.last(parent._savePoint);if(lastEntry.operation==='UPDATE'&&lastEntry.id===id){return false;}}}
return this.isNew(id);},isDirty:function(id){var isDirty=false;this._visitChildren(this.localData[id],function(r){if(r._isDirty){isDirty=true;}});return isDirty;},isNew:function(id){var data=this.localData[id];if(data.type!=="record"){return false;}
var res_id=data.res_id;if(typeof res_id==='number'){return false;}else if(typeof res_id==='string'&&/^[0-9]+-/.test(res_id)){return false;}
return true;},load:function(params){params.type=params.type||(params.res_id!==undefined?'record':'list');params.viewType=params.viewType||'default';if(!params.fieldsInfo){var fieldsInfo={};for(var fieldName in params.fieldNames){fieldsInfo[params.fieldNames[fieldName]]={};}
params.fieldsInfo={};params.fieldsInfo[params.viewType]=fieldsInfo;}
if(params.type==='record'&&params.res_id===undefined){params.allowWarning=true;return this._makeDefaultRecord(params.modelName,params);}
var dataPoint=this._makeDataPoint(params);return this._load(dataPoint).then(function(){return dataPoint.id;});},makeRecord:function(model,fields,fieldInfo){var self=this;var defs=[];var record_fields={};_.each(fields,function(field){record_fields[field.name]=_.pick(field,'type','relation','domain');});fieldInfo=fieldInfo||{};var fieldsInfo={};fieldsInfo.default={};_.each(fields,function(field){fieldsInfo.default[field.name]=fieldInfo[field.name]||{};});var record=this._makeDataPoint({modelName:model,fields:record_fields,fieldsInfo:fieldsInfo,viewType:'default',});_.each(fields,function(field){var dataPoint;if(field.type==='many2one'){if(field.value){var id=_.isArray(field.value)?field.value[0]:field.value;var display_name=_.isArray(field.value)?field.value[1]:undefined;dataPoint=self._makeDataPoint({modelName:field.relation,data:{id:id,display_name:display_name,},parentID:record.id,});record.data[field.name]=dataPoint.id;if(display_name===undefined){defs.push(self._fetchNameGet(dataPoint));}}}else if(field.type==='one2many'||field.type==='many2many'){var relatedFieldsInfo={};relatedFieldsInfo.default={};_.each(field.fields,function(field){relatedFieldsInfo.default[field.name]={};});var dpParams={fieldsInfo:relatedFieldsInfo,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:'default',};var needLoad=false;if(field.value&&field.value.length){if(_.isObject(field.value[0])){dpParams.res_ids=_.pluck(field.value,'id');dataPoint=self._makeDataPoint(dpParams);_.each(field.value,function(data){var recordDP=self._makeDataPoint({data:data,modelName:field.relation,parentID:dataPoint.id,type:'record',});dataPoint.data.push(recordDP.id);dataPoint._cache[recordDP.res_id]=recordDP.id;});}else{dpParams.res_ids=field.value;dataPoint=self._makeDataPoint(dpParams);needLoad=true;}}else{dpParams.res_ids=[];dataPoint=self._makeDataPoint(dpParams);}
if(needLoad){defs.push(self._load(dataPoint));}
record.data[field.name]=dataPoint.id;}else if(field.value){record.data[field.name]=field.value;}});return $.when.apply($,defs).then(function(){return record.id;});},notifyChanges:function(record_id,changes,options){return this.mutex.exec(this._applyChange.bind(this,record_id,changes,options));},reload:function(id,options){return this.mutex.exec(this._reload.bind(this,id,options));},removeLine:function(elementID){var record=this.localData[elementID];var parent=this.localData[record.parentID];if(parent.static){parent._changes=_.filter(parent._changes,function(change){if(change.id===elementID&&change.operation==='ADD'&&parent.tempLimitIncrement){parent.tempLimitIncrement--;parent.limit--;}
return change.id!==elementID;});}else{parent.data=_.without(parent.data,elementID);parent.count--;}},resequence:function(modelName,resIDs,parentID,options){options=options||{};if((resIDs.length<=1)){return $.when(parentID);}
var self=this;var data=this.localData[parentID];var params={model:modelName,ids:resIDs,};if(options.offset){params.offset=options.offset;}
if(options.field){params.field=options.field;}
return this._rpc({route:'/web/dataset/resequence',params:params,}).then(function(){var offset=options.offset?options.offset:0;var old_data=data.data.slice();data.data=_.sortBy(data.data,function(d){if(_.contains(resIDs,self.localData[d].res_id)){return _.indexOf(resIDs,self.localData[d].res_id)+offset;}else{return _.indexOf(old_data,d);}});data.res_ids=[];_.each(data.data,function(d){var dataPoint=self.localData[d];if(dataPoint.type==='record'){data.res_ids.push(dataPoint.res_id);}else{data.res_ids=data.res_ids.concat(dataPoint.res_ids);}});self._updateParentResIDs(data);return parentID;});},save:function(recordID,options){var self=this;return this.mutex.exec(function(){options=options||{};var record=self.localData[recordID];if(options.savePoint){self._visitChildren(record,function(rec){var newValue=rec._changes||rec.data;if(newValue instanceof Array){rec._savePoint=newValue.slice(0);}else{rec._savePoint=_.extend({},newValue);}});_.each((record._changes||{}),function(value,fieldName){record._editionViewType[fieldName]=options.viewType;});}
var shouldReload='reload'in options?options.reload:true;var method=self.isNew(recordID)?'create':'write';if(record._changes){delete record._changes.id;}
var changes=self._generateChanges(record,{viewType:options.viewType,changesOnly:method!=='create'});delete changes.id;if(method==='create'){var fieldNames=record.getFieldNames();_.each(fieldNames,function(name){if(changes[name]===null){delete changes[name];}});}
var def=$.Deferred();var changedFields=Object.keys(changes);if(options.savePoint){return def.resolve(changedFields);}
def.then(function(){record._isDirty=false;});if(method==='create'||changedFields.length){var args=method==='write'?[[record.data.id],changes]:[changes];self._rpc({model:record.model,method:method,args:args,context:record.getContext(),}).then(function(id){if(method==='create'){record.res_id=id;record.data.id=id;record.offset=record.res_ids.length;record.res_ids.push(id);record.count++;}
var _changes=record._changes;record._changes={};self.unfreezeOrder(record.id);if(shouldReload){self._fetchRecord(record).then(function(record){def.resolve(changedFields);});}else{_.extend(record.data,_changes);def.resolve(changedFields);}}).fail(def.reject.bind(def));}else{def.resolve(changedFields);}
return def;});},addFieldsInfo:function(recordID,viewInfo){var record=this.localData[recordID];record.fields=_.extend({},record.fields,viewInfo.fields);var fieldsInfo=_.mapObject(viewInfo.fieldsInfo,function(fieldsInfo){return _.defaults({},fieldsInfo,record.fieldsInfo[record.viewType]);});record.fieldsInfo=_.extend({},record.fieldsInfo,fieldsInfo);},freezeOrder:function(listID){var list=this.localData[listID];if(list.type==='record'){return;}
list=this._applyX2ManyOperations(list);this._sortList(list);this.localData[listID].orderedResIDs=list.res_ids;},setDirty:function(id){this.localData[id]._isDirty=true;},setSort:function(list_id,fieldName){var list=this.localData[list_id];if(list.type==='record'){return;}else if(list._changes){_.each(list._changes,function(change){delete change.isNew;});}
if(list.orderedBy.length===0){list.orderedBy.push({name:fieldName,asc:true});}else if(list.orderedBy[0].name===fieldName){if(!list.orderedResIDs){list.orderedBy[0].asc=!list.orderedBy[0].asc;}}else{var orderedBy=_.reject(list.orderedBy,function(o){return o.name===fieldName;});list.orderedBy=[{name:fieldName,asc:true}].concat(orderedBy);}
list.orderedResIDs=null;if(list.static){return this._fetchUngroupedList(list);}
return $.when();},toggleActive:function(recordIDs,value,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'write',args:[resIDs,{active:value}],}).then(this.reload.bind(this,parentID));},toggleGroup:function(groupId){var self=this;var group=this.localData[groupId];if(group.isOpen){group.isOpen=false;group.data=[];group.res_ids=[];group.offset=0;this._updateParentResIDs(group);return $.when(groupId);}
if(!group.isOpen){group.isOpen=true;var def;if(group.count>0){def=this._load(group).then(function(){self._updateParentResIDs(group);});}
return $.when(def).then(function(){return groupId;});}},unfreezeOrder:function(elementID){var list=this.localData[elementID];if(list.type==='record'){var data=_.extend({},list.data,list._changes);for(var fieldName in data){var field=list.fields[fieldName];if(!field||!data[fieldName]){continue;}
if(field.type==='one2many'||field.type==='many2many'){var recordlist=this.localData[data[fieldName]];recordlist.orderedResIDs=null;for(var index in recordlist.data){this.unfreezeOrder(recordlist.data[index]);}}}
return;}
list.orderedResIDs=null;this._sortList(list);},_addX2ManyDefaultRecord:function(list,options){var self=this;var params={context:this._getContext(list),fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){var position=options&&options.position||'top';list._changes.push({operation:'ADD',id:id,position:position,isNew:true});var record=self.localData[id];list._cache[record.res_id]=id;if(list.orderedResIDs){var index=list.offset+(position!=='top'?list.limit:0);list.orderedResIDs.splice(index,0,record.res_id);self.localData[list.id].orderedResIDs=list.orderedResIDs;}
return id;});},_applyChange:function(recordID,changes,options){var self=this;var record=this.localData[recordID];var field;var defs=[];options=options||{};record._changes=record._changes||{};if(!options.doNotSetDirty){record._isDirty=true;}
var initialData={};this._visitChildren(record,function(elem){initialData[elem.id]=$.extend(true,{},_.pick(elem,'data','_changes'));});for(var fieldName in changes){field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){defs.push(this._applyX2ManyChange(record,fieldName,changes[fieldName],options.viewType));}else if(field.type==='many2one'||field.type==='reference'){defs.push(this._applyX2OneChange(record,fieldName,changes[fieldName]));}else{record._changes[fieldName]=changes[fieldName];}}
if(options.notifyChange===false){return $.Deferred().resolve(_.keys(changes));}
return $.when.apply($,defs).then(function(){var onChangeFields=[];for(var fieldName in changes){field=record.fields[fieldName];if(field.onChange){var isX2Many=field.type==='one2many'||field.type==='many2many';if(!isX2Many||(self._isX2ManyValid(record._changes[fieldName]||record.data[fieldName]))){onChangeFields.push(fieldName);}}}
var onchangeDef=$.Deferred();if(onChangeFields.length){self._performOnChange(record,onChangeFields,options.viewType).then(function(result){delete record._warning;onchangeDef.resolve(_.keys(changes).concat(Object.keys(result&&result.value||{})));}).fail(function(){self._visitChildren(record,function(elem){_.extend(elem,initialData[elem.id]);});onchangeDef.resolve({});});}else{onchangeDef=$.Deferred().resolve(_.keys(changes));}
return onchangeDef.then(function(fieldNames){_.each(fieldNames,function(name){if(record._changes&&record._changes[name]===record.data[name]){delete record._changes[name];record._isDirty=!_.isEmpty(record._changes);}});return self._fetchSpecialData(record).then(function(fieldNames2){return _.union(fieldNames,fieldNames2);});});});},_applyX2OneChange:function(record,fieldName,data){var self=this;if(!data||!data.id){record._changes[fieldName]=false;return $.when();}
var relatedID;if(record._changes&&fieldName in record._changes){relatedID=record._changes[fieldName];}else{relatedID=record.data[fieldName];}
var relatedRecord=this.localData[relatedID];if(relatedRecord&&(data.id===this.localData[relatedID].res_id)){return $.when();}
var rel_data=_.pick(data,'id','display_name');var field=record.fields[fieldName];var coModel=field.type==='reference'?data.model:field.relation;var def;if(rel_data.display_name===undefined){def=this._rpc({model:coModel,method:'name_get',args:[data.id],context:record.context,}).then(function(result){rel_data.display_name=result[0][1];});}
return $.when(def).then(function(){var rec=self._makeDataPoint({context:record.context,data:rel_data,fields:{},fieldsInfo:{},modelName:coModel,parentID:record.id,});record._changes[fieldName]=rec.id;});},_applyOnChange:function(values,record,viewType){var self=this;var defs=[];var rec;viewType=viewType||record.viewType;record._changes=record._changes||{};_.each(values,function(val,name){var field=record.fields[name];if(!field){record._rawChanges[name]=val;return;}
var oldValue=name in record._changes?record._changes[name]:record.data[name];var id;if(field.type==='many2one'){id=false;if(val){var data=_.isArray(val)?{id:val[0],display_name:val[1]}:{id:val};if(!oldValue||(self.localData[oldValue].res_id!==data.id)){rec=self._makeDataPoint({context:record.context,data:data,modelName:field.relation,parentID:record.id,});id=rec.id;record._changes[name]=id;}}else{record._changes[name]=false;}}else if(field.type==='reference'){id=false;if(val){var ref=val.split(',');var modelName=ref[0];var resID=parseInt(ref[1]);if(!oldValue||self.localData[oldValue].res_id!==resID||self.localData[oldValue].model!==modelName){rec=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:modelName,parentID:record.id,});defs.push(self._fetchNameGet(rec));id=rec.id;record._changes[name]=id;}}else{record._changes[name]=id;}}else if(field.type==='one2many'||field.type==='many2many'){var listId=record._changes[name]||record.data[name];var list;if(listId){list=self.localData[listId];}else{var fieldInfo=record.fieldsInfo[viewType][name];if(!fieldInfo){return;}
var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];list=self._makeDataPoint({fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:view?view.type:fieldInfo.viewType,});}
record._changes[name]=list.id;list._changes=list._changes||[];var oldChanges=list._changes;_.each(val,function(command){var rec,recID;if(command[0]===0||command[0]===1){if(command[0]===0&&command[1]){var previousChange=_.find(oldChanges,function(operation){var child=self.localData[operation.id];return child&&(child.res_id===command[1]);});recID=previousChange&&previousChange.id;rec=self.localData[recID];}
if(command[0]===1&&command[1]){rec=self.localData[list._cache[command[1]]];}
if(!rec){var params={context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,ref:command[1],};if(command[0]===1){params.res_id=command[1];}
rec=self._makeDataPoint(params);list._cache[rec.res_id]=rec.id;}
rec._noAbandon=!list._savePoint;list._changes.push({operation:'ADD',id:rec.id});if(command[0]===1){list._changes.push({operation:'UPDATE',id:rec.id});}
defs.push(self._applyOnChange(command[2],rec));}else if(command[0]===4){linkRecord(list,command[1]);}else if(command[0]===5){list._changes=[{operation:'REMOVE_ALL'}];}else if(command[0]===6){list._changes=[{operation:'REMOVE_ALL'}];_.each(command[2],function(resID){linkRecord(list,resID);});}});var def=self._readUngroupedList(list).then(function(){var x2ManysDef=self._fetchX2ManysBatched(list);var referencesDef=self._fetchReferencesBatched(list);return $.when(x2ManysDef,referencesDef);});defs.push(def);}else{var newValue=self._parseServerValue(field,val);if(newValue!==oldValue){record._changes[name]=newValue;}}});return $.when.apply($,defs);function linkRecord(list,resID){rec=self.localData[list._cache[resID]];if(rec){self.discardChanges(rec.id);}
list._changes.push({operation:'ADD',id:rec?rec.id:null,resID:resID,});}},_applyX2ManyChange:function(record,fieldName,command,viewType){if(command.operation==='TRIGGER_ONCHANGE'){return $.when();}
var self=this;var localID=(record._changes&&record._changes[fieldName])||record.data[fieldName];var list=this.localData[localID];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[viewType||record.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var def,rec;var defs=[];list._changes=list._changes||[];switch(command.operation){case'ADD':var newRecord=this.localData[command.id];_.defaults(list.fields,newRecord.fields);_.defaults(list.fieldsInfo,newRecord.fieldsInfo);newRecord.fields=list.fields;newRecord.fieldsInfo=list.fieldsInfo;newRecord.viewType=list.viewType;list._cache[newRecord.res_id]=newRecord.id;list._changes.push(command);break;case'ADD_M2M':list._forceM2MLink=true;var data=_.isArray(command.ids)?command.ids:[command.ids];if(data.length+list.res_ids.length>list.limit){list.limit=data.length+list.res_ids.length;}
var list_records={};_.each(data,function(d){rec=self._makeDataPoint({context:record.context,modelName:field.relation,fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,res_id:d.id,viewType:view?view.type:fieldInfo.viewType,parentID:list.id,});list_records[d.id]=rec;list._cache[rec.res_id]=rec.id;list._changes.push({operation:'ADD',id:rec.id});});var fieldNames=list.getFieldNames();if(fieldNames.length){def=this._rpc({model:list.model,method:'read',args:[_.pluck(data,'id'),fieldNames],context:record.context,}).then(function(records){_.each(records,function(record){list_records[record.id].data=record;self._parseServerData(fieldNames,list,record);});return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));});defs.push(def);}
break;case'CREATE':var options={position:command.position};def=this._addX2ManyDefaultRecord(list,options).then(function(id){if(command.position==='bottom'&&list.orderedResIDs.length>=list.limit){list.tempLimitIncrement=(list.tempLimitIncrement||0)+1;list.limit+=1;}
if(command.data){return self._applyChange(id,command.data);}});defs.push(def);break;case'UPDATE':list._changes.push({operation:'UPDATE',id:command.id});if(command.data){defs.push(this._applyChange(command.id,command.data));}
break;case'FORGET':list._forceM2MUnlink=true;case'DELETE':var idsToRemove=command.ids;list._changes=_.reject(list._changes,function(change,index){var idInCommands=_.contains(command.ids,change.id);if(idInCommands&&change.operation==='ADD'){idsToRemove=_.without(idsToRemove,change.id);}
return idInCommands;});_.each(idsToRemove,function(id){var operation=list._forceM2MUnlink?'FORGET':'DELETE';list._changes.push({operation:operation,id:id});});break;case'REPLACE_WITH':list._changes=[];var newIds=_.difference(command.ids,list.res_ids);var removedIds=_.difference(list.res_ids,command.ids);var addDef,removedDef,values;if(newIds.length){values=_.map(newIds,function(id){return{id:id};});addDef=this._applyX2ManyChange(record,fieldName,{operation:'ADD_M2M',ids:values});}
if(removedIds.length){var listData=_.map(list.data,function(localId){return self.localData[localId];});removedDef=this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:_.map(removedIds,function(resID){if(resID in list._cache){return list._cache[resID];}
return _.findWhere(listData,{res_id:resID}).id;}),});}
return $.when(addDef,removedDef);}
return $.when.apply($,defs).then(function(){return self._readUngroupedList(list).then(function(){return self._fetchX2ManysBatched(list);});});},_applyX2ManyOperations:function(list,options){if(!list.static){return list;}
var self=this;list=_.extend({},list);list.res_ids=list.res_ids.slice(0);var changes=list._changes||[];if(options){var to=options.to===0?0:(options.to||changes.length);changes=changes.slice(options.from||0,to);}
_.each(changes,function(change){var relRecord;if(change.id){relRecord=self.localData[change.id];}
switch(change.operation){case'ADD':list.count++;var resID=relRecord?relRecord.res_id:change.resID;if(change.position==='top'&&(options?options.position!=='bottom':true)){list.res_ids.unshift(resID);}else{list.res_ids.push(resID);}
break;case'FORGET':case'DELETE':list.count--;list.res_ids=_.without(list.res_ids,relRecord.res_id);break;case'REMOVE_ALL':list.count=0;list.res_ids=[];break;case'UPDATE':break;}});this._setDataInRange(list);return list;},_buildOnchangeSpecs:function(record,viewType){var hasOnchange=false;var specs={};var fieldsInfo=record.fieldsInfo[viewType||record.viewType];generateSpecs(fieldsInfo,record.fields);function generateSpecs(fieldsInfo,fields,prefix){prefix=prefix||'';_.each(Object.keys(fieldsInfo),function(name){var field=fields[name];var fieldInfo=fieldsInfo[name];var key=prefix+name;specs[key]=(field.onChange)||"";if(field.onChange){hasOnchange=true;}
_.each(fieldInfo.views,function(view){generateSpecs(view.fieldsInfo[view.type],view.fields,key+'.');});});}
return hasOnchange?specs:false;},_evalModifiers:function(element,modifiers){var result={};var self=this;var evalContext;function evalModifier(mod){if(mod===undefined||mod===false||mod===true){return!!mod;}
evalContext=evalContext||self._getEvalContext(element);return new Domain(mod,evalContext).compute(evalContext);}
if('invisible'in modifiers){result.invisible=evalModifier(modifiers.invisible);}
if('column_invisible'in modifiers){result.column_invisible=evalModifier(modifiers.column_invisible);}
if('readonly'in modifiers){result.readonly=evalModifier(modifiers.readonly);}
if('required'in modifiers){result.required=evalModifier(modifiers.required);}
return result;},_fetchMany2OneGroup:function(groups){var ids=_.uniq(_.pluck(_.pluck(groups,'record'),'res_id'));return this._rpc({model:groups[0].record.model,method:'name_get',args:[ids],context:groups[0].context}).then(function(name_gets){_.each(groups,function(obj){var nameGet=_.find(name_gets,function(n){return n[0]===obj.record.res_id;});obj.record.data.display_name=nameGet[1];});});},_fetchNameGet:function(dataPoint){return this._rpc({model:dataPoint.model,method:'name_get',args:[dataPoint.res_id],context:dataPoint.getContext(),}).then(function(result){dataPoint.data.display_name=result[0][1];});},_fetchNameGets:function(list,fieldName){var self=this;var model;var records=[];var ids=[];list=this._applyX2ManyOperations(list);_.each(list.data,function(localId){var record=self.localData[localId];var data=record._changes||record.data;var many2oneId=data[fieldName];if(!many2oneId){return;}
var many2oneRecord=self.localData[many2oneId];records.push(many2oneRecord);ids.push(many2oneRecord.res_id);model=many2oneRecord.model;});if(!ids.length){return $.when();}
return this._rpc({model:model,method:'name_get',args:[_.uniq(ids)],context:list.context,}).then(function(name_gets){_.each(records,function(record){var nameGet=_.find(name_gets,function(nameGet){return nameGet[0]===record.data.id;});record.data.display_name=nameGet[1];});});},_fetchRecord:function(record,options){var self=this;options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);fieldNames=_.uniq(fieldNames.concat(['display_name']));return this._rpc({model:record.model,method:'read',args:[[record.res_id],fieldNames],context:_.extend({},record.getContext(),{bin_size:true}),}).then(function(result){if(result.length===0){return $.Deferred().reject();}
result=result[0];record.data=_.extend({},record.data,result);}).then(function(){self._parseServerData(fieldNames,record,record.data);}).then(function(){return $.when(self._fetchX2Manys(record,options),self._fetchReferences(record,options)).then(function(){return self._postprocess(record,options);});});},_fetchReference:function(record,fieldName){var self=this;var def;var value=record._changes&&record._changes[fieldName]||record.data[fieldName];var model=value&&value.split(',')[0];var resID=value&&parseInt(value.split(',')[1]);if(model&&model!=='False'&&resID){def=self._rpc({model:model,method:'name_get',args:[resID],context:record.getContext({fieldName:fieldName}),}).then(function(result){return self._makeDataPoint({data:{id:result[0][0],display_name:result[0][1],},modelName:model,parentID:record.id,});});}
return $.when(def);},_fetchReferences:function(record,options){var self=this;var defs=[];var fieldNames=options&&options.fieldNames||record.getFieldNames();_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='reference'){var def=self._fetchReference(record,fieldName).then(function(dataPoint){if(dataPoint){record.data[fieldName]=dataPoint.id;}});defs.push(def);}});return $.when.apply($,defs);},_fetchReferenceBatched:function(list,fieldName){var self=this;list=this._applyX2ManyOperations(list);var toFetch={};_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];var value=record.data[fieldName];if(value&&!self.localData[value]){var model=value.split(',')[0];var resID=value.split(',')[1];if(!(model in toFetch)){toFetch[model]={};}
if(toFetch[model][resID]){toFetch[model][resID].push(dataPoint);}else{toFetch[model][resID]=[dataPoint];}}});var defs=[];var def;_.each(toFetch,function(datapoints,model){var ids=_.map(Object.keys(datapoints),function(id){return parseInt(id);});var parent=datapoints[ids[0]][0];def=self._rpc({model:model,method:'name_get',args:[ids],context:self.localData[parent].getContext({fieldName:fieldName}),}).then(function(result){_.each(result,function(el){var parentIDs=datapoints[el[0]];_.each(parentIDs,function(parentID){var parent=self.localData[parentID];var referenceDp=self._makeDataPoint({data:{id:el[0],display_name:el[1],},modelName:model,parentID:parent,});parent.data[fieldName]=referenceDp.id;});});});defs.push(def);});return $.when.apply($,defs);},_fetchReferencesBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='reference'){defs.push(this._fetchReferenceBatched(list,fieldNames[i]));}}
return $.when.apply($,defs);},_fetchRelationalData:function(record){var self=this;var toBeFetched=[];_.each(record.getFieldNames(),function(name){var field=record.fields[name];if(field.type==='many2one'&&!record.fieldsInfo[record.viewType][name].__no_fetch){var localId=(record._changes&&record._changes[name])||record.data[name];var relatedRecord=self.localData[localId];if(!relatedRecord){return;}
toBeFetched.push({context:record.getContext({fieldName:name,viewType:record.viewType}),record:relatedRecord});}});var groups=_.groupBy(toBeFetched,function(elem){return[elem.record.model,JSON.stringify(elem.context)].join();});return $.when.apply($,_.map(groups,this._fetchMany2OneGroup.bind(this)));},_fetchSpecialData:function(record,options){var self=this;var specialFieldNames=[];var fieldNames=(options&&options.fieldNames)||record.getFieldNames();return $.when.apply($,_.map(fieldNames,function(name){var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][name]||{};var Widget=fieldInfo.Widget;if(Widget&&Widget.prototype.specialData){return self[Widget.prototype.specialData](record,name,fieldInfo).then(function(data){if(data===undefined){return;}
record.specialData[name]=data;specialFieldNames.push(name);});}})).then(function(){return specialFieldNames;});},_fetchSpecialMany2ones:function(record,fieldName,fieldInfo,fieldsToRead){var field=record.fields[fieldName];if(field.type!=="many2one"){return $.when();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});if(domain.length){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];if(localID){var element=this.localData[localID];domain=["|",["id","=",element.data.id]].concat(domain);}}
var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return $.when();}
var self=this;return this._rpc({model:field.relation,method:'search_read',fields:["id"].concat(fieldsToRead||[]),context:context,domain:domain,}).then(function(records){var ids=_.pluck(records,'id');return self._rpc({model:field.relation,method:'name_get',args:[ids],context:context,}).then(function(name_gets){_.each(records,function(rec){var name_get=_.find(name_gets,function(n){return n[0]===rec.id;});rec.display_name=name_get[1];});return records;});});},_fetchSpecialRelation:function(record,fieldName){var field=record.fields[fieldName];if(!_.contains(["many2one","many2many","one2many"],field.type)){return $.when();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return $.when();}
return this._rpc({model:field.relation,method:'name_search',args:["",domain],context:context});},_fetchSpecialReference:function(record,fieldName){var def;var field=record.fields[fieldName];if(field.type==='char'){def=this._fetchReference(record,fieldName);}
return $.when(def);},_fetchSpecialStatus:function(record,fieldName,fieldInfo){var foldField=fieldInfo.options.fold_field;var fieldsToRead=foldField?[foldField]:[];return this._fetchSpecialMany2ones(record,fieldName,fieldInfo,fieldsToRead).then(function(m2os){_.each(m2os,function(m2o){m2o.fold=foldField?m2o[foldField]:false;});return m2os;});},_fetchSpecialDomain:function(record,fieldName,fieldInfo){var context=record.getContext({fieldName:fieldName});var domainModel=fieldInfo.options.model;if(record.data.hasOwnProperty(domainModel)){domainModel=record._changes&&record._changes[domainModel]||record.data[domainModel];}
var domainValue=record._changes&&record._changes[fieldName]||record.data[fieldName]||[];var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domainModel:domainModel,domainValue:domainValue,});if(!hasChanged){return $.when();}else if(!domainModel){return $.when({model:domainModel,nbRecords:0,});}
var def=$.Deferred();var evalContext=this._getEvalContext(record);this._rpc({model:domainModel,method:'search_count',args:[Domain.prototype.stringToArray(domainValue,evalContext)],context:context}).then(_.identity,function(error,e){e.preventDefault();return false;}).always(function(nbRecords){def.resolve({model:domainModel,nbRecords:nbRecords,});});return def;},_fetchUngroupedList:function(list){var self=this;var def;if(list.static){def=this._readUngroupedList(list).then(function(){if(list.parentID&&self.isNew(list.parentID)){var many2ones=self._getMany2OneFieldNames(list);var defs=_.map(many2ones,function(name){return self._fetchNameGets(list,name);});return $.when.apply($,defs);}});}else{def=this._searchReadUngroupedList(list);}
return def.then(function(){return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));}).then(function(){return list;});},_fetchX2Manys:function(record,options){var self=this;var defs=[];options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);var viewType=options.viewType||record.viewType;_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){var fieldInfo=record.fieldsInfo[viewType][fieldName];var rawContext=fieldInfo&&fieldInfo.context;var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:(fieldInfo.fieldsInfo||{});var ids=record.data[fieldName]||[];var list=self._makeDataPoint({count:ids.length,context:record.context,fieldsInfo:fieldsInfo,fields:view?view.fields:fieldInfo.relatedFields,limit:fieldInfo.limit,modelName:field.relation,res_ids:ids,static:true,type:'list',orderedBy:fieldInfo.orderedBy,parentID:record.id,rawContext:rawContext,relationField:field.relation_field,viewType:view?view.type:fieldInfo.viewType,});if(record._changes&&record._changes[fieldName]){list._changes=self.localData[record._changes[fieldName]]._changes;record._changes[fieldName]=list.id;}
record.data[fieldName]=list.id;if(!fieldInfo.__no_fetch){var def=self._readUngroupedList(list).then(function(){return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));});defs.push(def);}}});return $.when.apply($,defs);},_fetchX2ManyBatched:function(list,fieldName){var self=this;var field=list.fields[fieldName];var fieldInfo=list.fieldsInfo[list.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;list=this._applyX2ManyOperations(list);this._sortList(list);var x2mRecords=[];var ids=[];_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];if(typeof record.data[fieldName]==='string'){return;}
x2mRecords.push(record);ids=_.unique(ids.concat(record.data[fieldName]||[]));var m2mList=self._makeDataPoint({fieldsInfo:fieldsInfo,fields:fields,modelName:field.relation,parentID:record.id,res_ids:record.data[fieldName],static:true,type:'list',viewType:viewType,});record.data[fieldName]=m2mList.id;});if(!ids.length||fieldInfo.__no_fetch){return $.when();}
var def;var fieldNames=_.keys(fieldInfo.relatedFields);if(fieldNames.length){def=this._rpc({model:field.relation,method:'read',args:[ids,fieldNames],context:list.getContext()||{},});}else{def=$.when(_.map(ids,function(id){return{id:id};}));}
return def.then(function(results){_.each(x2mRecords,function(record){var m2mList=self.localData[record.data[fieldName]];m2mList.data=[];_.each(m2mList.res_ids,function(res_id){var dataPoint=self._makeDataPoint({modelName:field.relation,data:_.findWhere(results,{id:res_id}),fields:fields,fieldsInfo:fieldsInfo,parentID:m2mList.id,viewType:viewType,});m2mList.data.push(dataPoint.id);m2mList._cache[res_id]=dataPoint.id;});});});},_fetchX2ManysBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManyBatched(list,fieldNames[i]));}}
return $.when.apply($,defs);},_generateChanges:function(record,options){options=options||{};var viewType=options.viewType||record.viewType;var changes;if('changesOnly'in options&&!options.changesOnly){changes=_.extend({},record.data,record._changes);}else{changes=_.extend({},record._changes);}
var withReadonly=options.withReadonly||false;var commands=this._generateX2ManyCommands(record,{changesOnly:'changesOnly'in options?options.changesOnly:true,withReadonly:withReadonly,});for(var fieldName in record.fields){if(!withReadonly&&fieldName in changes||fieldName in commands){var editionViewType=record._editionViewType[fieldName]||viewType;if(this._isFieldProtected(record,fieldName,editionViewType)){delete changes[fieldName];continue;}}
var type=record.fields[fieldName].type;var value;if(type==='one2many'||type==='many2many'){if(commands[fieldName]&&commands[fieldName].length){changes[fieldName]=commands[fieldName];}else{delete changes[fieldName];}}else if(type==='many2one'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].res_id:false;}else if(type==='reference'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].model+','+this.localData[value].res_id:false;}else if(type==='char'&&changes[fieldName]===''){changes[fieldName]=false;}else if(changes[fieldName]===null){changes[fieldName]=false;}}
return changes;},_generateOnChangeData:function(record,options){options=_.extend({},options||{},{withReadonly:true});var commands=this._generateX2ManyCommands(record,options);var data=_.extend(this.get(record.id,{raw:true}).data,commands);var hasDisplayName=_.some(record.fieldsInfo,function(fieldsInfo){return'display_name'in fieldsInfo;});if(!hasDisplayName){delete data.display_name;}
if(record.parentID){var parent=this.localData[record.parentID];if(parent.parentID&&parent.relationField){var parentRecord=this.localData[parent.parentID];data[parent.relationField]=this._generateOnChangeData(parentRecord);}}
return data;},_generateX2ManyCommands:function(record,options){var self=this;options=options||{};var fields=record.fields;if(options.fieldNames){fields=_.pick(fields,options.fieldNames);}
var commands={};var data=_.extend({},record.data,record._changes);var type;for(var fieldName in fields){type=fields[fieldName].type;if(type==='many2many'||type==='one2many'){if(!data[fieldName]){continue;}
commands[fieldName]=[];var list=this.localData[data[fieldName]];if(options.changesOnly&&(!list._changes||!list._changes.length)){continue;}
var oldResIDs=list.res_ids.slice(0);var relRecordAdded=[];var relRecordUpdated=[];_.each(list._changes,function(change){if(change.operation==='ADD'&&change.id){relRecordAdded.push(self.localData[change.id]);}else if(change.operation==='UPDATE'&&!self.isNew(change.id)){relRecordUpdated.push(self.localData[change.id]);}});list=this._applyX2ManyOperations(list);this._sortList(list);if(type==='many2many'||list._forceM2MLink){var relRecordCreated=_.filter(relRecordAdded,function(rec){return typeof rec.res_id==='string';});var realIDs=_.difference(list.res_ids,_.pluck(relRecordCreated,'res_id'));commands[fieldName].push(x2ManyCommands.replace_with(realIDs));_.each(relRecordCreated,function(relRecord){var changes=self._generateChanges(relRecord,options);commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));});_.each(relRecordUpdated,function(relRecord){var changes=self._generateChanges(relRecord,options);if(!_.isEmpty(changes)){var command=x2ManyCommands.update(relRecord.res_id,changes);commands[fieldName].push(command);}});}else if(type==='one2many'){var removedIds=_.difference(oldResIDs,list.res_ids);var addedIds=_.difference(list.res_ids,oldResIDs);var keptIds=_.intersection(oldResIDs,list.res_ids);var didChange=false;var changes,command,relRecord;for(var i=0;i<list.res_ids.length;i++){if(_.contains(keptIds,list.res_ids[i])){relRecord=_.findWhere(relRecordUpdated,{res_id:list.res_ids[i]});changes=relRecord?this._generateChanges(relRecord,options):{};if(!_.isEmpty(changes)){command=x2ManyCommands.update(relRecord.res_id,changes);didChange=true;}else{command=x2ManyCommands.link_to(list.res_ids[i]);}
commands[fieldName].push(command);}else if(_.contains(addedIds,list.res_ids[i])){relRecord=_.findWhere(relRecordAdded,{res_id:list.res_ids[i]});if(!relRecord){commands[fieldName].push(x2ManyCommands.link_to(list.res_ids[i]));continue;}
changes=this._generateChanges(relRecord,options);if(!this.isNew(relRecord.id)){commands[fieldName].push(x2ManyCommands.link_to(relRecord.res_id));delete changes.id;if(!_.isEmpty(changes)){commands[fieldName].push(x2ManyCommands.update(relRecord.res_id,changes));}}else{commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));}}}
if(options.changesOnly&&!didChange&&addedIds.length===0&&removedIds.length===0){commands[fieldName]=[];}
for(i=0;i<removedIds.length;i++){if(list._forceM2MUnlink){commands[fieldName].push(x2ManyCommands.forget(removedIds[i]));}else{commands[fieldName].push(x2ManyCommands.delete(removedIds[i]));}}}}}
return commands;},_getContext:function(element,options){options=options||{};var context=new Context(session.user_context);context.set_eval_context(this._getEvalContext(element));if(options.full||!(options.fieldName||options.additionalContext)){context.add(element.context);}
if(options.fieldName){var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.context){context.add(fieldInfo.context);}else{var fieldParams=element.fields[options.fieldName];if(fieldParams.context){context.add(fieldParams.context);}}}
if(options.additionalContext){context.add(options.additionalContext);}
if(element.rawContext){var rawContext=new Context(element.rawContext);var evalContext=this._getEvalContext(this.localData[element.parentID]);evalContext.id=evalContext.id||false;rawContext.set_eval_context(evalContext);context.add(rawContext);}
return context.eval();},_getDomain:function(element,options){if(options&&options.fieldName){if(element._domains[options.fieldName]){return Domain.prototype.stringToArray(element._domains[options.fieldName],this._getEvalContext(element,true));}
var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.domain){return Domain.prototype.stringToArray(fieldInfo.domain,this._getEvalContext(element,true));}
var fieldParams=element.fields[options.fieldName];if(fieldParams.domain){return Domain.prototype.stringToArray(fieldParams.domain,this._getEvalContext(element,true));}
return[];}
return Domain.prototype.stringToArray(element.domain,this._getEvalContext(element,true));},_getEvalContext:function(element,forDomain){var evalContext=element.type==='record'?this._getRecordEvalContext(element,forDomain):{};if(element.parentID){var parent=this.localData[element.parentID];if(parent.type==='list'&&parent.parentID){parent=this.localData[parent.parentID];}
if(parent.type==='record'){evalContext.parent=this._getRecordEvalContext(parent,forDomain);}}
return _.extend({active_id:evalContext.id||false,active_ids:evalContext.id?[evalContext.id]:[],active_model:element.model,current_date:moment().format('YYYY-MM-DD'),id:evalContext.id||false,},session.user_context,element.context,evalContext);},_getFieldNames:function(element,options){var fieldsInfo=element.fieldsInfo;var viewType=options&&options.viewType||element.viewType;return Object.keys(fieldsInfo&&fieldsInfo[viewType]||{});},_getMany2OneFieldNames:function(datapoint){var many2ones=[];_.each(datapoint.fields,function(field,name){if(field.type==='many2one'){many2ones.push(name);}});return many2ones;},_getRecordEvalContext:function(record,forDomain){var self=this;var relDataPoint;var context=_.extend({},record.data,record._changes);function _generateX2ManyCommands(fieldName){var commands=self._generateX2ManyCommands(record,{fieldNames:[fieldName]});return commands[fieldName];}
for(var fieldName in context){var field=record.fields[fieldName];if(context[fieldName]===null){context[fieldName]=false;}
if(!field||field.name==='id'){continue;}
if(field.type==='date'||field.type==='datetime'){if(context[fieldName]){context[fieldName]=JSON.parse(JSON.stringify(context[fieldName]));}
continue;}
if(field.type==='many2one'){relDataPoint=this.localData[context[fieldName]];context[fieldName]=relDataPoint?relDataPoint.res_id:false;continue;}
if(field.type==='one2many'||field.type==='many2many'){var ids;if(!context[fieldName]||_.isArray(context[fieldName])){ids=context[fieldName]?context[fieldName].slice(0):[];}else{relDataPoint=this._applyX2ManyOperations(this.localData[context[fieldName]]);ids=relDataPoint.res_ids.slice(0);}
if(!forDomain){ids.toJSON=_generateX2ManyCommands.bind(null,fieldName);}else if(field.type==='one2many'){ids=_.filter(ids,function(id){return typeof id!=='string';});}
context[fieldName]=ids;}}
return context;},_isFieldProtected:function(record,fieldName,viewType){var fieldInfo=record.fieldsInfo&&(record.fieldsInfo[viewType||record.viewType][fieldName]);if(fieldInfo){var rawModifiers=fieldInfo.modifiers||{};var modifiers=this._evalModifiers(record,rawModifiers);return modifiers.readonly&&!fieldInfo.force_save;}else{return false;}},_isFieldSet:function(value,fieldType){switch(fieldType){case'boolean':return true;case'one2many':case'many2many':return value.length>0;default:return value!==false;}},_isX2ManyValid:function(id){var self=this;var isValid=true;var element=this.localData[id];_.each(element._changes,function(command){if(command.operation==='DELETE'||command.operation==='FORGET'||command.operation==='REMOVE_ALL'){return;}
var recordData=self.get(command.id,{raw:true}).data;var record=self.localData[command.id];_.each(element.getFieldNames(),function(fieldName){var field=element.fields[fieldName];var fieldInfo=element.fieldsInfo[element.viewType][fieldName];var rawModifiers=fieldInfo.modifiers||{};var modifiers=self._evalModifiers(record,rawModifiers);if(modifiers.required&&!self._isFieldSet(recordData[fieldName],field.type)){isValid=false;}});});return isValid;},_load:function(dataPoint,options){if(options&&options.onlyGroups&&!(dataPoint.type==='list'&&dataPoint.groupedBy.length)){return $.when(dataPoint);}
if(dataPoint.type==='record'){return this._fetchRecord(dataPoint,options);}
if(dataPoint.type==='list'&&dataPoint.groupedBy.length){return this._readGroup(dataPoint,options);}
if(dataPoint.type==='list'&&!dataPoint.groupedBy.length){return this._fetchUngroupedList(dataPoint);}},_makeDataPoint:function(params){var type=params.type||('domain'in params&&'list')||'record';var res_id,value;var res_ids=params.res_ids||[];var data=params.data||(type==='record'?{}:[]);if(type==='record'){res_id=params.res_id||(params.data&&params.data.id);if(res_id){data.id=res_id;}else{res_id=_.uniqueId('virtual_');}}else{var isValueArray=params.value instanceof Array;res_id=isValueArray?params.value[0]:undefined;value=isValueArray?params.value[1]:params.value;}
var fields=_.extend({display_name:{type:'char'},id:{type:'integer'},},params.fields);var dataPoint={_cache:type==='list'?{}:undefined,_changes:null,_domains:{},_rawChanges:{},aggregateValues:params.aggregateValues||{},context:params.context,count:params.count||res_ids.length,data:data,domain:params.domain||[],fields:fields,fieldsInfo:params.fieldsInfo,groupedBy:params.groupedBy||[],id:_.uniqueId(params.modelName+'_'),isOpen:params.isOpen,limit:type==='record'?1:params.limit,loadMoreOffset:0,model:params.modelName,offset:params.offset||(type==='record'?_.indexOf(res_ids,res_id):0),openGroupByDefault:params.openGroupByDefault,orderedBy:params.orderedBy||[],orderedResIDs:params.orderedResIDs,parentID:params.parentID,rawContext:params.rawContext,ref:params.ref||res_id,relationField:params.relationField,res_id:res_id,res_ids:res_ids,specialData:{},_specialDataCache:{},static:params.static||false,type:type,value:value,viewType:params.viewType,};dataPoint._editionViewType={};dataPoint.evalModifiers=this._evalModifiers.bind(this,dataPoint);dataPoint.getContext=this._getContext.bind(this,dataPoint);dataPoint.getDomain=this._getDomain.bind(this,dataPoint);dataPoint.getFieldNames=this._getFieldNames.bind(this,dataPoint);this.localData[dataPoint.id]=dataPoint;return dataPoint;},_makeDefaultRecord:function(modelName,params){var self=this;var determineExtraFields=function(){var parentRecord=self.localData[params.parentID];var originView=parentRecord&&parentRecord.fieldsInfo;if(!originView||!originView[parentRecord.viewType])
return[];var fieldsFromOrigin=_.filter(Object.keys(originView[parentRecord.viewType]),function(fieldname){return params.fields[fieldname]!==undefined;});return fieldsFromOrigin;}
var fieldNames=Object.keys(params.fieldsInfo[params.viewType]);var fields_key=_.without(fieldNames,'__last_update');var extraFields=determineExtraFields();return this._rpc({model:modelName,method:'default_get',args:[fields_key],context:params.context,}).then(function(result){var record=self._makeDataPoint({modelName:modelName,fields:params.fields,fieldsInfo:params.fieldsInfo,context:params.context,parentID:params.parentID,res_ids:params.res_ids,viewType:params.viewType,});return self.applyDefaultValues(record.id,result,{fieldNames:_.union(fieldNames,extraFields)}).then(function(){var def=$.Deferred();self._performOnChange(record,fields_key).always(function(){if(record._warning){if(params.allowWarning){delete record._warning;}else{def.reject();}}
def.resolve();});return def;}).then(function(){return self._fetchRelationalData(record);}).then(function(){return self._postprocess(record);}).then(function(){self.save(record.id,{savePoint:true});return record.id;});});},_parseServerData:function(fieldNames,element,data){var self=this;_.each(fieldNames,function(fieldName){var field=element.fields[fieldName];var val=data[fieldName];if(field.type==='many2one'){if(val!==false){var r=self._makeDataPoint({modelName:field.relation,fields:{display_name:{type:'char'},id:{type:'integer'},},data:{display_name:val[1],id:val[0],},parentID:element.id,});data[fieldName]=r.id;}else{data[fieldName]=false;}}else{data[fieldName]=self._parseServerValue(field,val);}});},_performOnChange:function(record,fields,viewType){var self=this;var onchangeSpec=this._buildOnchangeSpecs(record,viewType);if(!onchangeSpec){return $.when();}
var idList=record.data.id?[record.data.id]:[];var options={full:true,};if(fields.length===1){fields=fields[0];options.fieldName=fields;}
var context=this._getContext(record,options);var currentData=this._generateOnChangeData(record,{changesOnly:false});return self._rpc({model:record.model,method:'onchange',args:[idList,currentData,fields,onchangeSpec,context],}).then(function(result){if(!record._changes){return;}
if(result.warning){self.trigger_up('warning',{message:result.warning.message,title:result.warning.title,type:'dialog',});record._warning=true;}
if(result.domain){record._domains=_.extend(record._domains,result.domain);}
return self._applyOnChange(result.value,record).then(function(){return result;});});},_postprocess:function(record,options){var self=this;var defs=[];_.each(record.getFieldNames(options),function(name){var field=record.fields[name];var fieldInfo=record.fieldsInfo[record.viewType][name]||{};var options=fieldInfo.options||{};if(options.always_reload){if(record.fields[name].type==='many2one'&&record.data[name]){var element=self.localData[record.data[name]];defs.push(self._rpc({model:field.relation,method:'name_get',args:[element.data.id],context:self._getContext(record,{fieldName:name}),}).then(function(result){element.data.display_name=result[0][1];}));}}});defs.push(this._fetchSpecialData(record,options));return $.when.apply($,defs).then(function(){return record;});},_processX2ManyCommands:function(record,fieldName,commands,options){var self=this;options=options||{};var defs=[];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[options.viewType||record.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var x2manyList=self._makeDataPoint({context:record.context,fieldsInfo:fieldsInfo,fields:fields,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,rawContext:fieldInfo&&fieldInfo.context,relationField:field.relation_field,res_ids:[],static:true,type:'list',viewType:viewType,});record._changes[fieldName]=x2manyList.id;x2manyList._changes=[];var many2ones={};var r;commands=commands||[];var isCommandList=commands.length&&_.isArray(commands[0]);if(!isCommandList){commands=[[6,false,commands]];}
_.each(commands,function(value){if(value[0]===0){r=self._makeDataPoint({modelName:x2manyList.model,context:x2manyList.context,fieldsInfo:fieldsInfo,fields:fields,parentID:x2manyList.id,viewType:viewType,});r._noAbandon=true;x2manyList._changes.push({operation:'ADD',id:r.id});x2manyList._cache[r.res_id]=r.id;_.each(r.getFieldNames(),function(fieldName){r.data[fieldName]=null;});r._changes=_.defaults(value[2],r.data);for(var fieldName in r._changes){if(!r._changes[fieldName]){continue;}
var isFieldInView=fieldName in r.fields;if(isFieldInView){var field=r.fields[fieldName];var fieldType=field.type;var rec;if(fieldType==='many2one'){rec=self._makeDataPoint({context:r.context,modelName:field.relation,data:{id:r._changes[fieldName]},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(fieldType==='reference'){var reference=r._changes[fieldName].split(',');rec=self._makeDataPoint({context:r.context,modelName:reference[0],data:{id:parseInt(reference[1])},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(_.contains(['one2many','many2many'],fieldType)){var x2mCommands=value[2][fieldName];defs.push(self._processX2ManyCommands(r,fieldName,x2mCommands));}else{r._changes[fieldName]=self._parseServerValue(field,r._changes[fieldName]);}}}}
if(value[0]===6){_.each(value[2],function(res_id){x2manyList._changes.push({operation:'ADD',resID:res_id});});var def=self._readUngroupedList(x2manyList).then(function(){return $.when(self._fetchX2ManysBatched(x2manyList),self._fetchReferencesBatched(x2manyList));});defs.push(def);}});_.each(_.keys(many2ones),function(name){defs.push(self._fetchNameGets(x2manyList,name));});return $.when.apply($,defs);},_readMissingFields:function(list,resIDs,fieldNames){var self=this;var missingIDs=[];for(var i=0,len=resIDs.length;i<len;i++){var resId=resIDs[i];var dataPointID=list._cache[resId];if(!dataPointID){missingIDs.push(resId);continue;}
var record=self.localData[dataPointID];var data=_.extend({},record.data,record._changes);if(_.difference(fieldNames,_.keys(data)).length){missingIDs.push(resId);}}
var def;if(missingIDs.length&&fieldNames.length){def=self._rpc({model:list.model,method:'read',args:[missingIDs,fieldNames],context:list.getContext(),});}else{def=$.when(_.map(missingIDs,function(id){return{id:id};}));}
return def.then(function(records){_.each(resIDs,function(id){var dataPoint;var data=_.findWhere(records,{id:id});if(id in list._cache){dataPoint=self.localData[list._cache[id]];if(data){self._parseServerData(fieldNames,dataPoint,data);_.extend(dataPoint.data,data);}}else{dataPoint=self._makeDataPoint({context:list.context,data:data,fieldsInfo:list.fieldsInfo,fields:list.fields,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);list._cache[id]=dataPoint.id;}
_.each(list._changes,function(change){if(change.operation==='ADD'&&!change.id&&change.resID===id){change.id=dataPoint.id;}});});return list;});},_readGroup:function(list,options){var self=this;var groupByField=list.groupedBy[0];var rawGroupBy=groupByField.split(':')[0];var fields=_.uniq(list.getFieldNames().concat(rawGroupBy));return this._rpc({model:list.model,method:'read_group',fields:fields,domain:list.domain,context:list.context,groupBy:list.groupedBy,orderBy:list.orderedBy,lazy:true,}).then(function(groups){var previousGroups=_.map(list.data,function(groupID){return self.localData[groupID];});list.data=[];list.count=0;var defs=[];_.each(groups,function(group){var aggregateValues={};_.each(group,function(value,key){if(_.contains(fields,key)&&key!==groupByField){aggregateValues[key]=value;}});var value=group[groupByField];if(list.fields[rawGroupBy].type==="selection"){var choice=_.find(list.fields[rawGroupBy].selection,function(c){return c[0]===value;});value=choice?choice[1]:false;}
var newGroup=self._makeDataPoint({modelName:list.model,count:group[rawGroupBy+'_count'],domain:group.__domain,context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,value:value,aggregateValues:aggregateValues,groupedBy:list.groupedBy.slice(1),orderedBy:list.orderedBy,orderedResIDs:list.orderedResIDs,limit:list.limit,openGroupByDefault:list.openGroupByDefault,parentID:list.id,type:'list',viewType:list.viewType,});var oldGroup=_.find(previousGroups,function(g){return g.res_id===newGroup.res_id&&g.value===newGroup.value;});if(oldGroup){delete self.localData[newGroup.id];var updatedProps=_.omit(newGroup,'limit','isOpen','offset','id');if(options&&options.onlyGroups||oldGroup.isOpen&&newGroup.groupedBy.length){delete updatedProps.data;}
_.extend(oldGroup,updatedProps);newGroup=oldGroup;}else if(!newGroup.openGroupByDefault){newGroup.isOpen=false;}else{newGroup.isOpen='__fold'in group?!group.__fold:true;}
list.data.push(newGroup.id);list.count+=newGroup.count;if(newGroup.isOpen&&newGroup.count>0){defs.push(self._load(newGroup,options));}});if(options&&options.keepEmptyGroups){var emptyGroupsIDs=_.difference(_.pluck(previousGroups,'id'),list.data);_.each(emptyGroupsIDs,function(groupID){list.data.push(groupID);var emptyGroup=self.localData[groupID];emptyGroup.aggregateValues={};});}
return $.when.apply($,defs).then(function(){if(!options||!options.onlyGroups){list.res_ids=_.flatten(_.map(arguments,function(group){return group?group.res_ids:[];}));}
return list;});});},_readUngroupedList:function(list){var self=this;var def=$.when();list=this._applyX2ManyOperations(list);if(list.res_ids.length>list.limit&&list.orderedBy.length){if(!list.orderedResIDs){var fieldNames=_.pluck(list.orderedBy,'name');def=this._readMissingFields(list,_.filter(list.res_ids,_.isNumber),fieldNames);}
def.then(function(){self._sortList(list);});}
return def.then(function(){var resIDs=[];var currentCount=list.count;var currentResIDs=list.res_ids;var effectiveLimit=(list.limit||0)-(list.tempLimitIncrement||0);var upperBound=effectiveLimit?Math.min(list.offset+effectiveLimit,currentCount):currentCount;var fieldNames=list.getFieldNames();for(var i=list.offset;i<upperBound;i++){var resId=currentResIDs[i];if(_.isNumber(resId)){resIDs.push(resId);}}
return self._readMissingFields(list,resIDs,fieldNames).then(function(){if(list.res_ids.length<=list.limit){self._sortList(list);}else{self._setDataInRange(list);}
return list;});});},_reload:function(id,options){options=options||{};var element=this.localData[id];if(element.type==='record'){if(!options.currentId&&(('currentId'in options)||this.isNew(id))){var params={context:element.context,fieldsInfo:element.fieldsInfo,fields:element.fields,viewType:element.viewType,};return this._makeDefaultRecord(element.model,params);}
if(!options.keepChanges){this.discardChanges(id,{rollback:false});}}else if(element._changes){delete element.tempLimitIncrement;_.each(element._changes,function(change){delete change.isNew;});}
if(options.context!==undefined){element.context=options.context;}
if(options.domain!==undefined){element.domain=options.domain;}
if(options.groupBy!==undefined){element.groupedBy=options.groupBy;}
if(options.limit!==undefined){element.limit=options.limit;}
if(options.offset!==undefined){this._setOffset(element.id,options.offset);}
if(options.loadMoreOffset!==undefined){element.loadMoreOffset=options.loadMoreOffset;}else{element.loadMoreOffset=0;}
if(options.currentId!==undefined){element.res_id=options.currentId;}
if(options.ids!==undefined){element.res_ids=options.ids;element.count=element.res_ids.length;}
if(element.type==='record'){element.offset=_.indexOf(element.res_ids,element.res_id);}
var loadOptions=_.pick(options,'fieldNames','viewType');return this._load(element,loadOptions).then(function(result){return result.id;});},_saveSpecialDataCache:function(record,fieldName,value){if(_.isEqual(record._specialDataCache[fieldName],value)){return false;}
record._specialDataCache[fieldName]=value;return true;},_searchReadUngroupedList:function(list){var self=this;var fieldNames=list.getFieldNames();return this._rpc({route:'/web/dataset/search_read',model:list.model,fields:fieldNames,context:list.getContext(),domain:list.domain||[],limit:list.limit,offset:list.loadMoreOffset+list.offset,orderBy:list.orderedBy,}).then(function(result){list.count=result.length;var ids=_.pluck(result.records,'id');var data=_.map(result.records,function(record){var dataPoint=self._makeDataPoint({context:list.context,data:record,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);return dataPoint.id;});if(list.loadMoreOffset){list.data=list.data.concat(data);list.res_ids=list.res_ids.concat(ids);}else{list.data=data;list.res_ids=ids;}
self._updateParentResIDs(list);return list;});},_setDataInRange:function(list){var idsInRange;if(list.limit){idsInRange=list.res_ids.slice(list.offset,list.offset+list.limit);}else{idsInRange=list.res_ids;}
list.data=[];_.each(idsInRange,function(id){if(list._cache[id]){list.data.push(list._cache[id]);}});if(list.limit){for(var i=list.offset+list.limit;i<list.res_ids.length;i++){var id=list.res_ids[i];var dataPointID=list._cache[id];if(_.findWhere(list._changes,{isNew:true,id:dataPointID})){list.data.push(dataPointID);}else{break;}}}},_setOffset:function(elementId,offset){var element=this.localData[elementId];element.offset=offset;if(element.type==='record'&&element.res_ids.length){element.res_id=element.res_ids[offset];}},_sortList:function(list){if(!list.static){return;}
var self=this;if(list.orderedResIDs){var orderedResIDs={};for(var k=0;k<list.orderedResIDs.length;k++){orderedResIDs[list.orderedResIDs[k]]=k;}
utils.stableSort(list.res_ids,function compareResIdIndexes(resId1,resId2){if(!(resId1 in orderedResIDs)&&!(resId2 in orderedResIDs)){return 0;}
if(!(resId1 in orderedResIDs)){return Infinity;}
if(!(resId2 in orderedResIDs)){return-Infinity;}
return orderedResIDs[resId1]-orderedResIDs[resId2];});}else if(list.orderedBy.length){var compareRecords=function(resId1,resId2,level){if(!level){level=0;}
if(list.orderedBy.length<level+1){return 0;}
var order=list.orderedBy[level];var record1ID=list._cache[resId1];var record2ID=list._cache[resId2];if(!record1ID&&!record2ID){return 0;}
if(!record1ID){return Infinity;}
if(!record2ID){return-Infinity;}
var r1=self.localData[record1ID];var r2=self.localData[record2ID];var data1=_.extend({},r1.data,r1._changes);var data2=_.extend({},r2.data,r2._changes);var orderData1=data1[order.name];var orderData2=data2[order.name];if(list.fields[order.name].type==='many2one'){orderData1=orderData1?self.localData[orderData1].data.display_name:"";orderData2=orderData2?self.localData[orderData2].data.display_name:"";}
if(orderData1<orderData2){return order.asc?-1:1;}
if(orderData1>orderData2){return order.asc?1:-1;}
return compareRecords(record1ID,record2ID,level+1);};utils.stableSort(list.res_ids,compareRecords);}
this._setDataInRange(list);},_updateParentResIDs:function(element){var self=this;if(element.parentID){var parent=this.localData[element.parentID];parent.res_ids=_.flatten(_.map(parent.data,function(dataPointID){return self.localData[dataPointID].res_ids;}));this._updateParentResIDs(parent);}},_visitChildren:function(element,fn){var self=this;fn(element);if(element.type==='record'){for(var fieldName in element.data){var field=element.fields[fieldName];if(!field){continue;}
if(_.contains(['one2many','many2one','many2many'],field.type)){var hasChange=element._changes&&fieldName in element._changes;var value=hasChange?element._changes[fieldName]:element.data[fieldName];var relationalElement=this.localData[value];if(relationalElement){self._visitChildren(relationalElement,fn);}}}}
if(element.type==='list'){element=this._applyX2ManyOperations(element);_.each(element.data,function(elemId){var elem=self.localData[elemId];self._visitChildren(elem,fn);});}},});return BasicModel;});;

/* /web/static/src/js/views/basic/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicView',function(require){"use strict";var AbstractView=require('web.AbstractView');var BasicController=require('web.BasicController');var BasicModel=require('web.BasicModel');var BasicView=AbstractView.extend({config:_.extend({},AbstractView.prototype.config,{Model:BasicModel,Controller:BasicController,}),viewType:undefined,init:function(viewInfo,params){this._super.apply(this,arguments);this.rendererParams.viewType=this.viewType;this.controllerParams.confirmOnDelete=true;this.controllerParams.archiveEnabled='active'in viewInfo.fields;this.controllerParams.hasButtons='action_buttons'in params?params.action_buttons:true;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.fields=viewInfo.fields;this.loadParams.context=params.context||{};this.loadParams.limit=parseInt(viewInfo.arch.attrs.limit,10)||params.limit;this.loadParams.viewType=this.viewType;this.loadParams.parentID=params.parentID;this.recordID=params.recordID;this.model=params.model;},_loadData:function(){if(this.recordID){var self=this;var record=this.model.get(this.recordID);var viewType=this.viewType;var viewFields=Object.keys(record.fieldsInfo[viewType]);var fieldNames=_.difference(viewFields,Object.keys(record.data));var fieldsInfo=record.fieldsInfo[viewType];_.each(viewFields,function(name){if(!_.contains(fieldNames,name)){var fieldType=record.fields[name].type;var fieldInfo=fieldsInfo[name];if(fieldInfo.Widget){var requiresSpecialData=fieldInfo.Widget.prototype.specialData;if(requiresSpecialData&&!(name in record.specialData)){fieldNames.push(name);return;}}
if((fieldType==='one2many'||fieldType==='many2many')){if(!('fieldsInfo'in record.data[name])){fieldNames.push(name);}else{var fieldViews=fieldInfo.views||fieldInfo.fieldsInfo||{};var fieldViewTypes=Object.keys(fieldViews);var recordViewTypes=Object.keys(record.data[name].fieldsInfo);if(_.difference(fieldViewTypes,recordViewTypes).length){fieldNames.push(name);}}}}});var def;if(fieldNames.length){def=this.model.applyRawChanges(record.id,viewType).then(function(){if(self.model.isNew(record.id)){return self.model.applyDefaultValues(record.id,{},{fieldNames:fieldNames,viewType:viewType,});}else{return self.model.reload(record.id,{fieldNames:fieldNames,keepChanges:true,viewType:viewType,});}});}
return $.when(def).then(function(){return record.id;});}
return this._super.apply(this,arguments);},});return BasicView;});;

/* /web/static/src/js/views/basic/basic_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var Pager=require('web.Pager');var _t=core._t;var BasicController=AbstractController.extend(FieldManagerMixin,{custom_events:_.extend({},AbstractController.prototype.custom_events,FieldManagerMixin.custom_events,{discard_changes:'_onDiscardChanges',reload:'_onReload',set_dirty:'_onSetDirty',sidebar_data_asked:'_onSidebarDataAsked',translate:'_onTranslate',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.archiveEnabled=params.archiveEnabled;this.confirmOnDelete=params.confirmOnDelete;this.hasButtons=params.hasButtons;FieldManagerMixin.init.call(this,this.model);this.handle=params.initialState.id;this.mode=params.mode||'readonly';},start:function(){this.$el.toggleClass('o_cannot_create',!this.activeActions.create);return this._super.apply(this,arguments).then(this._updateEnv.bind(this));},canBeDiscarded:function(recordID){if(!this.model.isDirty(recordID||this.handle)){return $.when(false);}
var message=_t("The record has been modified, your changes will be discarded. Do you want to proceed?");var def=$.Deferred();var dialog=Dialog.confirm(this,message,{title:_t("Warning"),confirm_callback:def.resolve.bind(def,true),cancel_callback:def.reject.bind(def),});dialog.on('closed',def,def.reject);return def;},canBeSaved:function(recordID){var fieldNames=this.renderer.canBeSaved(recordID||this.handle);if(fieldNames.length){this._notifyInvalidFields(fieldNames);return false;}
return true;},discardChanges:function(recordID,options){return this.mutex.exec(function(){}).then(this._discardChanges.bind(this,recordID||this.handle,options));},getSelectedIds:function(){return[];},renderPager:function($node,options){var data=this.model.get(this.handle,{raw:true});this.pager=new Pager(this,data.count,data.offset+1,data.limit,options);this.pager.on('pager_changed',this,function(newState){var self=this;this.pager.disable();var limitChanged=(data.limit!==newState.limit);this.reload({limit:newState.limit,offset:newState.current_min-1}).then(function(){if(!limitChanged){self.trigger_up('scrollTo',{offset:0});}}).then(this.pager.enable.bind(this.pager));});this.pager.appendTo($node);this._updatePager();},saveRecord:function(recordID,options){var self=this;return this.mutex.exec(this.renderer.commitChanges.bind(this.renderer,recordID||this.handle)).then(function(){return self.mutex.exec(self._saveRecord.bind(self,recordID,options));});},update:function(params,options){var self=this;this.mode=params.mode||this.mode;return this._super(params,options).then(function(){self._updateEnv();self._updatePager();});},_abandonRecord:function(recordID){recordID=recordID||this.handle;if(recordID===this.handle){this.trigger_up('switch_to_previous_view');}else{this.model.removeLine(recordID);}},_applyChanges:function(dataPointID,changes,event){var _super=FieldManagerMixin._applyChanges.bind(this);return this.mutex.exec(function(){return _super(dataPointID,changes,event);});},_callButtonAction:function(attrs,record){var self=this;var def=$.Deferred();var reload=function(){return self.isDestroyed()?$.when():self.reload();};record=record||this.model.get(this.handle);this.trigger_up('execute_action',{action_data:_.extend({},attrs,{context:record.getContext({additionalContext:attrs.context||{}}),}),env:{context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,},on_closed:function(reason){if(!_.isObject(reason)){reload(reason);}},on_fail:function(reason){reload().always(function(){def.reject(reason);});},on_success:def.resolve.bind(def),});return this.alive(def);},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.model.get(e.target.dataPointID),e,true);}
var state=this.model.get(this.handle);return this.renderer.confirmChange(state,id,fields,e);},_deleteRecords:function(ids){var self=this;function doIt(){return self.model.deleteRecords(ids,self.modelName).then(self._onDeletedRecords.bind(self,ids));}
if(this.confirmOnDelete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:doIt,});}else{doIt();}},_disableButtons:function(){if(this.$buttons){this.$buttons.find('button').attr('disabled',true);}},_discardChanges:function(recordID,options){var self=this;recordID=recordID||this.handle;return this.canBeDiscarded(recordID).then(function(needDiscard){if(options&&options.readonlyIfRealDiscard&&!needDiscard){return;}
self.model.discardChanges(recordID);if(self.model.canBeAbandoned(recordID)){self._abandonRecord(recordID);return;}
return self._confirmSave(recordID);});},_enableButtons:function(){if(this.$buttons){this.$buttons.find('button').removeAttr('disabled');}},_getSidebarEnv:function(){return{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,};},_notifyInvalidFields:function(invalidFields){var record=this.model.get(this.handle,{raw:true});var fields=record.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},_onDeletedRecords:function(ids){this.update({});},_saveRecord:function(recordID,options){recordID=recordID||this.handle;options=_.defaults(options||{},{stayInEdit:false,reload:true,savePoint:false,});if(this.canBeSaved(recordID)){var self=this;var saveDef=this.model.save(recordID,{reload:options.reload,savePoint:options.savePoint,viewType:options.viewType,});if(!options.stayInEdit){saveDef=saveDef.then(function(fieldNames){var def=fieldNames.length?self._confirmSave(recordID):self._setMode('readonly',recordID);return def.then(function(){return fieldNames;});});}
return saveDef;}else{return $.Deferred().reject();}},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){return this.update({mode:mode},{reload:false}).then(function(){core.bus.trigger('DOM_updated');});}
return $.when();},_updateEnv:function(){var env=this.model.get(this.handle,{env:true});if(this.sidebar){var sidebarEnv=this._getSidebarEnv();this.sidebar.updateEnv(sidebarEnv);}
this.trigger_up('env_updated',env);},_updatePager:function(){if(this.pager){var data=this.model.get(this.handle,{raw:true});this.pager.updateState({current_min:data.offset+1,size:data.count,});var isRecord=data.type==='record';var hasData=!!data.count;var isGrouped=data.groupedBy?!!data.groupedBy.length:false;var isNew=this.model.isNew(this.handle);var isPagerVisible=isRecord?!isNew:(hasData&&!isGrouped);this.pager.do_toggle(isPagerVisible);}},_onDiscardChanges:function(ev){var self=this;ev.stopPropagation();var recordID=ev.data.recordID;this._discardChanges(recordID).done(function(){self._confirmChange(recordID,[ev.data.fieldName],ev).always(ev.data.onSuccess);}).fail(ev.data.onFailure);},_onFieldChanged:function(ev){if(this.mode==='readonly'){ev.data.force_save=true;}
FieldManagerMixin._onFieldChanged.apply(this,arguments);},_onReload:function(event){event.stopPropagation();var data=event&&event.data||{};var handle=data.db_id;if(handle){this.model.reload(handle).then(this._confirmSave.bind(this,handle));}else{this.reload({fieldNames:data.fieldNames,keepChanges:data.keepChanges||false,});}},_onSetDirty:function(ev){ev.stopPropagation();this.model.setDirty(ev.data.dataPointID);},_onSidebarDataAsked:function(event){var sidebarEnv=this._getSidebarEnv();event.data.callback(sidebarEnv);},_onTranslate:function(event){event.stopPropagation();var record=this.model.get(event.data.id,{raw:true});this._rpc({route:'/web/dataset/call_button',params:{model:'ir.translation',method:'translate_fields',args:[record.model,record.res_id,event.data.fieldName,record.getContext()],}}).then(this.do_action.bind(this));},});return BasicController;});;

/* /web/static/src/js/views/basic/basic_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var BasicRenderer=AbstractRenderer.extend({custom_events:{navigation_move:'_onNavigationMove',},init:function(parent,state,params){this._super.apply(this,arguments);this.activeActions=params.activeActions;this.viewType=params.viewType;this.mode=params.mode||'readonly';this.widgets=[];},canBeSaved:function(recordID){var self=this;var invalidFields=[];_.each(this.allFieldWidgets[recordID],function(widget){var canBeSaved=self._canWidgetBeSaved(widget);if(!canBeSaved){invalidFields.push(widget.name);}
widget.$el.toggleClass('o_field_invalid',!canBeSaved);});return invalidFields;},commitChanges:function(recordID){var defs=_.map(this.allFieldWidgets[recordID],function(widget){return widget.commitChanges();});return $.when.apply($,defs);},confirmChange:function(state,id,fields,ev){this.state=state;var record=state.id===id?state:_.findWhere(state.data,{id:id});if(!record){return this._render().then(_.constant([]));}
_.invoke(this.widgets,'updateState',state);var defs=[];var resetWidgets=[];_.each(this.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);if(fieldChanged||widget.resetOnAnyFieldChange){defs.push(widget.reset(record,ev,fieldChanged));resetWidgets.push(widget);}});defs.push(this._updateAllModifiers(record));return $.when.apply($,defs).then(function(){return resetWidgets;});},focusField:function(id,fieldName,offset){this.editRecord(id);if(typeof offset==="number"){var field=_.findWhere(this.allFieldWidgets[id],{name:fieldName});dom.setSelectionRange(field.getFocusableElement().get(0),{start:offset,end:offset});}},_addFieldTooltip:function(widget,$node){$node=$node.length?$node:widget.$el;$node.tooltip({delay:{show:1000,hide:0},title:function(){return qweb.render('WidgetLabel.tooltip',{debug:config.debug,widget:widget,});}});},_activateFieldWidget:function(record,currentIndex,options){options=options||{};_.defaults(options,{inc:1,wrap:true});var recordWidgets=this.allFieldWidgets[record.id]||[];for(var i=0;i<recordWidgets.length;i++){var activated=recordWidgets[currentIndex].activate({event:options.event});if(activated){return currentIndex;}
currentIndex+=options.inc;if(currentIndex>=recordWidgets.length){if(options.wrap){currentIndex-=recordWidgets.length;}else{return-1;}}else if(currentIndex<0){if(options.wrap){currentIndex+=recordWidgets.length;}else{return-1;}}}
return-1;},_activateNextFieldWidget:function(record,currentIndex){currentIndex=(currentIndex+1)%(this.allFieldWidgets[record.id]||[]).length;return this._activateFieldWidget(record,currentIndex,{inc:1});},_activatePreviousFieldWidget:function(record,currentIndex){currentIndex=currentIndex?(currentIndex-1):((this.allFieldWidgets[record.id]||[]).length-1);return this._activateFieldWidget(record,currentIndex,{inc:-1});},_applyModifiers:function(modifiersData,record,element){var self=this;var modifiers=modifiersData.evaluatedModifiers[record.id]||{};if(element){_apply(element);}else{_.each(_.clone(modifiersData.elementsByRecord[record.id]),_apply);}
function _apply(element){if('readonly'in modifiers&&element.widget){var mode=modifiers.readonly?'readonly':modifiersData.baseModeByRecord[record.id];if(mode!==element.widget.mode){self._rerenderFieldWidget(element.widget,record,{keepBaseMode:true,mode:mode,});return;}}
element.$el.toggleClass("o_invisible_modifier",!!modifiers.invisible);element.$el.toggleClass("o_readonly_modifier",!!modifiers.readonly);element.$el.toggleClass("o_required_modifier",!!modifiers.required);if(element.callback){element.callback(element,modifiers,record);}}},_canWidgetBeSaved:function(widget){var modifiers=this._getEvaluatedModifiers(widget.__node,widget.record);return widget.isValid()&&(widget.isSet()||!modifiers.required);},_destroyFieldWidget:function(recordID,widget){var recordWidgets=this.allFieldWidgets[recordID];var index=recordWidgets.indexOf(widget);if(index>=0){recordWidgets.splice(index,1);}
this._unregisterModifiersElement(widget.__node,recordID,widget);widget.destroy();return index;},_getEvaluatedModifiers:function(node,record){var element=this._getModifiersData(node);if(!element){return{};}
return element.evaluatedModifiers[record.id]||{};},_getModifiersData:function(node){return _.findWhere(this.allModifiersData,{node:node});},_handleAttributes:function($el,node){if(node.attrs.class){$el.addClass(node.attrs.class);}
if(node.attrs.style){$el.attr('style',node.attrs.style);}},_hasContent:function(){return this.state.count!==0;},_postProcessField:function(widget,node){},_registerModifiers:function(node,record,element,options){options=options||{};var modifiersData=this._getModifiersData(node);if(!modifiersData){var modifiers=node.attrs.modifiers||{};modifiersData={node:node,modifiers:modifiers,evaluatedModifiers:{},elementsByRecord:{},baseModeByRecord:{},};if(!_.isEmpty(modifiers)){this.allModifiersData.push(modifiersData);}}
if(!modifiersData.baseModeByRecord[record.id]||!options.keepBaseMode){modifiersData.baseModeByRecord[record.id]=options.mode||this.mode;}
if(!modifiersData.evaluatedModifiers[record.id]){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);}
if(element){var newElement={};if(element instanceof jQuery){newElement.$el=element;}else{newElement.widget=element;newElement.$el=element.$el;}
if(options&&options.callback){newElement.callback=options.callback;}
if(!modifiersData.elementsByRecord[record.id]){modifiersData.elementsByRecord[record.id]=[];}
modifiersData.elementsByRecord[record.id].push(newElement);this._applyModifiers(modifiersData,record,newElement,options);}
return modifiersData.evaluatedModifiers[record.id];},_render:function(){var oldAllFieldWidgets=this.allFieldWidgets;this.allFieldWidgets={};this.allModifiersData=[];return this._renderView().then(function(){_.each(oldAllFieldWidgets,function(recordWidgets){_.each(recordWidgets,function(widget){widget.destroy();});});});},_renderFieldWidget:function(node,record,options){options=options||{};var fieldName=node.attrs.name;var mode=options.mode||this.mode;var modifiers=this._registerModifiers(node,record,null,options);var Widget=record.fieldsInfo[this.viewType][fieldName].Widget;var widget=new Widget(this,fieldName,record,{mode:modifiers.readonly?'readonly':mode,viewType:this.viewType,});if(this.allFieldWidgets[record.id]===undefined){this.allFieldWidgets[record.id]=[];}
this.allFieldWidgets[record.id].push(widget);widget.__node=node;var def=widget.__widgetRenderAndInsert(function(){});if(def.state()==='pending'){this.defs.push(def);}
var self=this;def.then(function(){self._registerModifiers(node,record,widget,{callback:function(element,modifiers,record){element.$el.toggleClass('o_field_empty',!!(record.data.id&&(modifiers.readonly||mode==='readonly')&&!element.widget.isSet()));},keepBaseMode:!!options.keepBaseMode,mode:mode,});self._postProcessField(widget,node);});return widget;},_renderNoContentHelper:function(){var $msg=$('<div>').addClass('oe_view_nocontent').html(this.noContentHelp);this.$el.html($msg);},_renderView:function(){return $.when();},_renderWidget:function(record,node){var Widget=widgetRegistry.get(node.attrs.name);var widget=new Widget(this,record,node);this.widgets.push(widget);var def=widget.__widgetRenderAndInsert(function(){});if(def.state()==='pending'){this.defs.push(def);}
this._handleAttributes(widget.$el,node);this._registerModifiers(node,record,widget);widget.$el.addClass('o_widget');return widget.$el;},_rerenderFieldWidget:function(widget,record,options){var newWidget=this._renderFieldWidget(widget.__node,record,options);widget.$el.replaceWith(newWidget.$el);var oldIndex=this._destroyFieldWidget(record.id,widget);var recordWidgets=this.allFieldWidgets[record.id];recordWidgets.splice(oldIndex,0,newWidget);recordWidgets.pop();return newWidget;},_unregisterModifiersElement:function(node,recordID,element){var modifiersData=this._getModifiersData(node);if(modifiersData){var elements=modifiersData.elementsByRecord[recordID];var index=_.findIndex(elements,function(oldElement){return oldElement.widget===element||oldElement.$el[0]===element[0];});if(index>=0){elements.splice(index,1);}}},_updateAllModifiers:function(record){var self=this;var defs=[];this.defs=defs;_.each(this.allModifiersData,function(modifiersData){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);self._applyModifiers(modifiersData,record);});delete this.defs;return $.when.apply($,defs);},_onNavigationMove:function(ev){},});return BasicRenderer;});;

/* /web/static/src/js/views/field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.FieldManagerMixin',function(require){"use strict";var BasicModel=require('web.BasicModel');var concurrency=require('web.concurrency');var FieldManagerMixin={custom_events:{field_changed:'_onFieldChanged',load:'_onLoad',mutexify:'_onMutexify',},init:function(model){this.model=model||new BasicModel(this);this.mutex=new concurrency.Mutex();},_applyChanges:function(dataPointID,changes,event){var self=this;var options=_.pick(event.data,'viewType','doNotSetDirty','notifyChange');return this.model.notifyChanges(dataPointID,changes,options).then(function(result){if(event.data.force_save){return self.model.save(dataPointID).then(function(){return self._confirmSave(dataPointID);});}else if(options.notifyChange!==false){return self._confirmChange(dataPointID,result,event);}});},_confirmChange:function(id,fields,event){return $.when();},_confirmSave:function(id){return $.when();},_onFieldChanged:function(event){event.stopPropagation();this._applyChanges(event.data.dataPointID,event.data.changes,event).done(event.data.onSuccess||function(){}).fail(event.data.onFailure||function(){});},_onLoad:function(event){var self=this;event.stopPropagation();var data=event.data;if(!data.on_success){return;}
var params={};if('limit'in data){params.limit=data.limit;}
if('offset'in data){params.offset=data.offset;}
this.model.reload(data.id,params).then(function(db_id){data.on_success(self.model.get(db_id));});},_onMutexify:function(ev){ev.stopPropagation();this.mutex.exec(ev.data.action);},};return FieldManagerMixin;});;

/* /web/static/src/js/views/standalone_field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.StandaloneFieldManagerMixin',function(require){"use strict";var FieldManagerMixin=require('web.FieldManagerMixin');var StandaloneFieldManagerMixin=_.extend({},FieldManagerMixin,{init:function(){FieldManagerMixin.init.apply(this,arguments);this.registeredWidgets={};},_confirmChange:function(id,fields,event){var result=FieldManagerMixin._confirmChange.apply(this,arguments);var record=this.model.get(id);_.each(this.registeredWidgets[id],function(widget,fieldName){if(_.contains(fields,fieldName)){widget.reset(record,event);}});return result;},_registerWidget:function(datapointID,fieldName,widget){if(!this.registeredWidgets[datapointID]){this.registeredWidgets[datapointID]={};}
this.registeredWidgets[datapointID][fieldName]=widget;},});return StandaloneFieldManagerMixin;});;

/* /web/static/src/js/views/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._view_registry',function(require){"use strict";var FormView=require('web.FormView');var GraphView=require('web.GraphView');var KanbanView=require('web.KanbanView');var ListView=require('web.ListView');var PivotView=require('web.PivotView');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');view_registry.add('form',FormView).add('list',ListView).add('kanban',KanbanView).add('graph',GraphView).add('pivot',PivotView).add('calendar',CalendarView);});;

/* /web/static/src/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_dialogs',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dom=require('web.dom');var ListController=require('web.ListController');var ListView=require('web.ListView');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var view_registry=require('web.view_registry');var _t=core._t;var ViewDialog=Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{push_state:'_onPushState',env_updated:function(event){event.stopPropagation();},}),init:function(parent,options){options=options||{};options.dialogClass=options.dialogClass||''+' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});this.dataset=new data.DataSet(this,this.res_model,this.context);},_onPushState:function(event){event.stopPropagation();},});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;this.res_id=options.res_id||null;this.on_saved=options.on_saved||(function(){});this.context=options.context;this.model=options.model;this.parentID=options.parentID;this.recordID=options.recordID;this.shouldSaveLocally=options.shouldSaveLocally;var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options||!options.buttons){options=options||{};options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-default o_form_button_cancel",close:true,click:function(){if(!readonly){self.form_view.model.discardChanges(self.form_view.handle,{rollback:self.shouldSaveLocally,});}},}];if(!readonly){options.buttons.unshift({text:_t("Save")+((multi_select)?" "+_t(" & Close"):""),classes:"btn-primary",click:function(){this._save().then(self.close.bind(self));}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){this._save().then(self.form_view.createRecord.bind(self.form_view,self.parentID));},});}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);var FormView=view_registry.get('form');var fields_view_def;if(this.options.fields_view){fields_view_def=$.when(this.options.fields_view);}else{fields_view_def=this.loadFieldView(this.dataset,this.options.view_id,'form');}
fields_view_def.then(function(viewInfo){if(self.recordID){self.model.addFieldsInfo(self.recordID,viewInfo);}
var formview=new FormView(viewInfo,{modelName:self.res_model,context:self.context,ids:self.res_id?[self.res_id]:[],currentId:self.res_id||undefined,index:0,mode:self.res_id&&self.options.readonly?'readonly':'edit',footer_to_buttons:true,default_buttons:false,model:self.model,parentID:self.parentID,recordID:self.recordID,});return formview.getController(self);}).then(function(formView){self.form_view=formView;var fragment=document.createDocumentFragment();if(self.recordID&&self.shouldSaveLocally){self.model.save(self.recordID,{savePoint:true});}
self.form_view.appendTo(fragment).then(function(){var $buttons=$('<div>');self.form_view.renderButtons($buttons);self.opened().always(function(){if($buttons.children().length){self.$footer.empty().append($buttons.contents());}
dom.append(self.$el,fragment,{callbacks:[{widget:self.form_view}],in_DOM:true,});});_super();});});return this;},_save:function(){var self=this;return this.form_view.saveRecord(this.form_view.handle,{stayInEdit:true,reload:false,savePoint:this.shouldSaveLocally,viewType:'form',}).then(function(changedFields){var record=self.form_view.model.get(self.form_view.handle);self.on_saved(record,!!changedFields.length);});},});var SelectCreateListController=ListController.extend({custom_events:_.extend({},ListController.prototype.custom_events,{open_record:function(event){var selectedRecord=this.model.get(event.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},}),});var SelectCreateDialog=ViewDialog.extend({custom_events:_.extend({},ViewDialog.prototype.custom_events,{select_record:function(event){if(!this.options.readonly){this.on_selected([event.data]);this.close();}},selection_changed:function(event){event.stopPropagation();this.$footer.find(".o_select_button").prop('disabled',!event.data.selection.length);},search:function(event){event.stopPropagation();var d=event.data;var searchData=this._process_search_data(d.domains,d.contexts,d.groupbys);this.list_controller.reload(searchData);},get_controller_context:'_onGetControllerContext',}),init:function(){this._super.apply(this,arguments);_.defaults(this.options,{initial_view:'search'});this.on_selected=this.options.on_selected||(function(){});this.initial_ids=this.options.initial_ids;},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var self=this;var user_context=this.getSession().user_context;var _super=this._super.bind(this);var context=pyeval.eval_domains_and_contexts({domains:[],contexts:[user_context,this.context]}).context;var search_defaults={};_.each(context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});this.loadViews(this.dataset.model,this.dataset.get_context(),[[false,'list'],[false,'search']],{}).then(this.setup.bind(this,search_defaults)).then(function(fragment){self.opened().then(function(){dom.append(self.$el,fragment,{callbacks:[{widget:self.list_controller}],in_DOM:true,});self.set_buttons(self.__buttons);});_super();});return this;},setup:function(search_defaults,fields_views){var self=this;var fragment=document.createDocumentFragment();var searchDef=$.Deferred();var $header=$('<div/>').addClass('o_modal_header').appendTo(fragment);var $pager=$('<div/>').addClass('o_pager').appendTo($header);var options={$buttons:$('<div/>').addClass('o_search_options').appendTo($header),search_defaults:search_defaults,};var searchview=new SearchView(this,this.dataset,fields_views.search,options);searchview.prependTo($header).done(function(){var d=searchview.build_search_data();if(self.initial_ids){d.domains.push([["id","in",self.initial_ids]]);self.initial_ids=undefined;}
var searchData=self._process_search_data(d.domains,d.contexts,d.groupbys);searchDef.resolve(searchData);});return $.when(searchDef).then(function(searchResult){var listView=new ListView(fields_views.list,_.extend({context:searchResult.context,domain:searchResult.domain,groupBy:searchResult.groupBy,modelName:self.dataset.model,hasSelectors:!self.options.disable_multiple_selection,readonly:true,},self.options.list_view_options));listView.setController(SelectCreateListController);return listView.getController(self);}).then(function(controller){self.list_controller=controller;self.__buttons=[{text:_t("Cancel"),classes:"btn-default o_form_button_cancel",close:true,}];if(!self.options.no_create){self.__buttons.unshift({text:_t("Create"),classes:"btn-primary",click:self.create_edit_record.bind(self)});}
if(!self.options.disable_multiple_selection){self.__buttons.unshift({text:_t("Select"),classes:"btn-primary o_select_button",disabled:true,close:true,click:function(){var records=self.list_controller.getSelectedRecords();var values=_.map(records,function(record){return{id:record.res_id,display_name:record.data.display_name,};});self.on_selected(values);},});}
return self.list_controller.appendTo(fragment);}).then(function(){searchview.toggle_visibility(true);self.list_controller.do_show();self.list_controller.renderPager($pager);return fragment;});},_process_search_data:function(domains,contexts,groupbys){var results=pyeval.eval_domains_and_contexts({domains:[this.domain].concat(domains),contexts:[this.context].concat(contexts),group_by_seq:groupbys||[],eval_context:this.getSession().user_context,});var context=_.omit(results.context,function(value,key){return key.indexOf('search_default_')===0;});return{context:context,domain:results.domain,groupBy:results.group_by,};},create_edit_record:function(){var self=this;var dialog=new FormViewDialog(this,_.extend({},this.options,{on_saved:function(record){var values=[{id:record.res_id,display_name:record.data.display_name,}];self.on_selected(values);},})).open();dialog.on('closed',this,this.close);return dialog;},_onGetControllerContext:function(ev){ev.stopPropagation();var context=this.list_controller.getContext();ev.data.callback(context);},});return{FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,};});;

/* /web/static/src/js/views/form/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var _t=core._t;var qweb=core.qweb;var FormRenderer=BasicRenderer.extend({className:"o_form_view",events:_.extend({},BasicRenderer.prototype.events,{'click .o_notification_box .oe_field_translate':'_onTranslate','click .oe_title, .o_inner_group':'_onClick',}),init:function(parent,state,params){this._super.apply(this,arguments);this.idsForLabels={};},autofocus:function(){if(this.mode==='readonly'){return;}
var focusWidget=this.defaultFocusField;if(!focusWidget||!focusWidget.isFocusable()){var widgets=this.allFieldWidgets[this.state.id];for(var i=0;i<(widgets?widgets.length:0);i++){var widget=widgets[i];if(widget.isFocusable()){focusWidget=widget;break;}}}
if(focusWidget){focusWidget.activate({noselect:true});}},canBeSaved:function(recordID){var self=this;var fieldNames=this._super.apply(this,arguments);var $labels=this.$('label');$labels.removeClass('o_field_invalid');_.each(fieldNames,function(fieldName){var idForLabel=self.idsForLabels[fieldName];if(idForLabel){$labels.filter('[for='+idForLabel+']').addClass('o_field_invalid');}});return fieldNames;},displayTranslationAlert:function(alertFields){this.$('.o_notification_box').remove();var $notification=$(qweb.render('notification-box',{type:'info'})).append(qweb.render('translation-alert',{fields:alertFields,lang:_t.database.parameters.name}));if(this.$('.o_form_statusbar').length){this.$('.o_form_statusbar').after($notification);}else{this.$el.prepend($notification);}},confirmChange:function(state,id,fields,e){var self=this;return this._super.apply(this,arguments).then(function(resetWidgets){_.each(resetWidgets,function(widget){self._setIDForLabel(widget,self.idsForLabels[widget.name]);});if(self.$('.o_field_invalid').length){self.canBeSaved(self.state.id);}
return resetWidgets;});},disableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').attr('disabled',true);},enableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').removeAttr('disabled');},getLocalState:function(){var state={};this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');var index=-1;$notebook.find('li').each(function(i){if($(this).hasClass('active')){index=i;}});state[name]=index;});return state;},setLocalState:function(state){this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');if(name in state){var $page=$notebook.find('> ul > li').eq(state[name]);if(!$page.hasClass('o_invisible_modifier')){$page.find('a[data-toggle="tab"]').click();}}});},updateState:function(state,params){this.mode=(params&&'mode'in params)?params.mode:this.mode;if(params.fieldNames){return this.confirmChange(state,state.id,params.fieldNames);}
return this._super.apply(this,arguments);},_addButtonTooltip:function(node,$button){var self=this;$button.tooltip({delay:{show:1000,hide:0},title:function(){return qweb.render('WidgetButton.tooltip',{debug:config.debug,state:self.state,node:node,});},});},_addOnClickAction:function($el,node){var self=this;$el.click(function(){self.trigger_up('button_clicked',{attrs:node.attrs,record:self.state,});});},_getIDForLabel:function(name){var idForLabel=this.idsForLabels[name];if(!idForLabel){idForLabel=_.uniqueId('o_field_input_');this.idsForLabels[name]=idForLabel;}
return idForLabel;},_postProcessField:function(widget,node){this._setIDForLabel(widget,this._getIDForLabel(node.attrs.name));this._handleAttributes(widget.$el,node);if(JSON.parse(node.attrs.default_focus||"0")){this.defaultFocusField=widget;}},_renderButtonBox:function(node){var self=this;var $result=$('<'+node.tag+'>',{'class':'o_not_full'});var buttons=_.map(node.children,function(child){if(child.tag==='button'){return self._renderStatButton(child);}else{return self._renderNode(child);}});var buttons_partition=_.partition(buttons,function($button){return $button.is('.o_invisible_modifier');});var invisible_buttons=buttons_partition[0];var visible_buttons=buttons_partition[1];var nb_buttons=[2,4,6,7][config.device.size_class];var unfolded_buttons=visible_buttons.slice(0,nb_buttons).concat(invisible_buttons);var folded_buttons=visible_buttons.slice(nb_buttons);if(folded_buttons.length===1){unfolded_buttons=buttons;folded_buttons=[];}
var full=(visible_buttons.length>nb_buttons);$result.toggleClass('o_full',full).toggleClass('o_not_full',!full);_.each(unfolded_buttons,function($button){$button.appendTo($result);});if(folded_buttons.length){$result.append($("<button>",{type:'button','class':"btn btn-sm oe_stat_button o_button_more dropdown-toggle",'data-toggle':"dropdown",text:_t("More"),}));var $ul=$("<ul>",{'class':"dropdown-menu o_dropdown_more",role:"menu"});_.each(folded_buttons,function($button){$('<li>').appendTo($ul).append($button);});$ul.appendTo($result);}
this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderGenericTag:function(node){var $result=$('<'+node.tag+'>',_.omit(node.attrs,'modifiers'));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderHeaderButton:function(node){var $button=$('<button>').text(node.attrs.string).addClass('btn btn-sm btn-default');this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.debug||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderHeaderButtons:function(node){var self=this;var $buttons=$('<div>',{class:'o_statusbar_buttons'});_.each(node.children,function(child){if(child.tag==='button'){$buttons.append(self._renderHeaderButton(child));}});return $buttons;},_renderInnerGroup:function(node){var self=this;var $result=$('<table/>',{class:'o_group o_inner_group'});this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);var col=parseInt(node.attrs.col,10)||2;if(node.attrs.string){var $sep=$('<tr><td colspan="'+col+'" style="width: 100%;"><div class="o_horizontal_separator">'+node.attrs.string+'</div></td></tr>');$result.append($sep);}
var rows=[];var $currentRow=$('<tr/>');var currentColspan=0;_.each(node.children,function(child){if(child.tag==='newline'){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=0;return;}
var colspan=parseInt(child.attrs.colspan,10);var isLabeledField=(child.tag==='field'&&child.attrs.nolabel!=='1');if(!colspan){if(isLabeledField){colspan=2;}else{colspan=1;}}
var finalColspan=colspan-(isLabeledField?1:0);currentColspan+=colspan;if(currentColspan>col){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=colspan;}
var $tds;if(child.tag==='field'){$tds=self._renderInnerGroupField(child);}else if(child.tag==='label'){$tds=self._renderInnerGroupLabel(child);}else{$tds=$('<td/>').append(self._renderNode(child));}
if(finalColspan>1){$tds.last().attr('colspan',finalColspan);}
$currentRow.append($tds);});rows.push($currentRow);_.each(rows,function($tr){var nonLabelColSize=100/(col-$tr.children('.o_td_label').length);_.each($tr.children(':not(.o_td_label)'),function(el){var $el=$(el);$el.css('width',((parseInt($el.attr('colspan'),10)||1)*nonLabelColSize)+'%');});$result.append($tr);});return $result;},_renderInnerGroupField:function(node){var widget=this._renderFieldWidget(node,this.state);var $tds=$('<td/>').append(widget.$el);if(node.attrs.nolabel!=='1'){var $labelTd=this._renderInnerGroupLabel(node);$tds=$labelTd.add($tds);}
return $tds;},_renderInnerGroupLabel:function(label){return $('<td/>',{class:'o_td_label'}).append(this._renderTagLabel(label));},_renderNode:function(node){var renderer=this['_renderTag'+_.str.capitalize(node.tag)];if(renderer){return renderer.call(this,node);}
if(node.tag==='div'&&node.attrs.name==='button_box'){return this._renderButtonBox(node);}
if(_.isString(node)){return node;}
return this._renderGenericTag(node);},_renderStatButton:function(node){var $button=$('<button>').addClass('btn btn-sm oe_stat_button');if(node.attrs.icon){$('<div>').addClass('fa fa-fw o_button_icon').addClass(node.attrs.icon).appendTo($button);}
if(node.attrs.string){$('<span>').text(node.attrs.string).appendTo($button);}
$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);return $button;},_renderTabHeader:function(page,page_id){var $a=$('<a>',{'data-toggle':'tab',disable_anchor:'true',href:'#'+page_id,role:'tab',text:page.attrs.string,});return $('<li>').append($a);},_renderTabPage:function(page,page_id){var $result=$('<div class="tab-pane" id="'+page_id+'">');$result.append(_.map(page.children,this._renderNode.bind(this)));return $result;},_renderTagButton:function(node){var $button=dom.renderButton({attrs:_.omit(node.attrs,'icon','string'),icon:node.attrs.icon,text:(node.attrs.string||'').replace(/_/g,''),});$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.debug||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderTagField:function(node){return this._renderFieldWidget(node,this.state).$el;},_renderTagForm:function(node){var $result=$('<div/>');if(node.attrs.class){$result.addClass(node.attrs.class);}
$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderTagGroup:function(node){var self=this;var isOuterGroup=_.some(node.children,function(child){return child.tag==='group';});if(!isOuterGroup){return this._renderInnerGroup(node);}
var $result=$('<div/>',{class:'o_group'});var colSize=Math.max(1,Math.round(12/(parseInt(node.attrs.col,10)||2)));if(node.attrs.string){var $sep=$('<div/>',{class:'o_horizontal_separator'}).text(node.attrs.string);$result.append($sep);}
$result.append(_.map(node.children,function(child){if(child.tag==='newline'){return $('<br/>');}
var $child=self._renderNode(child);$child.addClass('o_group_col_'+(colSize*(parseInt(child.attrs.colspan,10)||1)));return $child;}));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderTagHeader:function(node){var self=this;var $statusbar=$('<div>',{class:'o_form_statusbar'});$statusbar.append(this._renderHeaderButtons(node));_.each(node.children,function(child){if(child.tag==='field'){var widget=self._renderFieldWidget(child,self.state);$statusbar.append(widget.$el);}});this._handleAttributes($statusbar,node);this._registerModifiers(node,this.state,$statusbar);return $statusbar;},_renderTagLabel:function(node){var self=this;var text;var fieldName=node.tag==='label'?node.attrs.for:node.attrs.name;if('string'in node.attrs){text=node.attrs.string;}else if(fieldName){text=this.state.fields[fieldName].string;}else{return this._renderGenericTag(node);}
var $result=$('<label>',{class:'o_form_label',for:this._getIDForLabel(fieldName),text:text,});if(node.tag==='label'){this._handleAttributes($result,node);}
var modifiersOptions;if(fieldName){modifiersOptions={callback:function(element,modifiers,record){var widgets=self.allFieldWidgets[record.id];var widget=_.findWhere(widgets,{name:fieldName});if(!widget){return;}
element.$el.toggleClass('o_form_label_empty',!!(record.data.id&&(modifiers.readonly||self.mode==='readonly')&&!widget.isSet()));},};}
this._registerModifiers(node,this.state,$result,modifiersOptions);return $result;},_renderTagNotebook:function(node){var self=this;var $headers=$('<ul class="nav nav-tabs">');var $pages=$('<div class="tab-content nav nav-tabs">');var autofocusTab=-1;var renderedTabs=_.map(node.children,function(child,index){var pageID=_.uniqueId('notebook_page_');var $header=self._renderTabHeader(child,pageID);var $page=self._renderTabPage(child,pageID);if(autofocusTab===-1&&child.attrs.autofocus==='autofocus'){autofocusTab=index;}
self._handleAttributes($header,child);$headers.append($header);$pages.append($page);return{$header:$header,$page:$page,node:child,};});if(renderedTabs.length){var tabToFocus=renderedTabs[Math.max(0,autofocusTab)];tabToFocus.$header.addClass('active');tabToFocus.$page.addClass('active');}
_.each(renderedTabs,function(tab){self._registerModifiers(tab.node,self.state,tab.$header,{callback:function(element,modifiers){if(modifiers.invisible&&element.$el.hasClass('active')){element.$el.removeClass('active');tab.$page.removeClass('active');var $firstVisibleTab=$headers.find('li:not(.o_invisible_modifier):first()');$firstVisibleTab.addClass('active');$pages.find($firstVisibleTab.find('a').attr('href')).addClass('active');}},});});var $notebook=$('<div class="o_notebook">').data('name',node.attrs.name||'_default_').append($headers,$pages);this._registerModifiers(node,this.state,$notebook);this._handleAttributes($notebook,node);return $notebook;},_renderTagSeparator:function(node){var $separator=$('<div/>').addClass('o_horizontal_separator').text(node.attrs.string);this._handleAttributes($separator,node);this._registerModifiers(node,this.state,$separator);return $separator;},_renderTagSheet:function(node){this.has_sheet=true;var $sheet=$('<div>').addClass('o_form_sheet');$sheet.append(_.map(node.children,this._renderNode.bind(this)));return $sheet;},_renderTagWidget:function(node){return this._renderWidget(this.state,node);},_renderView:function(){var self=this;var defs=[];this.defs=defs;var $form=this._renderNode(this.arch).addClass(this.className);delete this.defs;return $.when.apply($,defs).then(function(){self._updateView($form.contents());},function(){$form.remove();});},_updateView:function($newContent){var self=this;this.$el.html($newContent);this.$el.toggleClass('o_form_nosheet',!this.has_sheet);if(this.has_sheet){this.$el.children().not('.oe_chatter').wrapAll($('<div/>',{class:'o_form_sheet_bg'}));}
this.$el.toggleClass('o_form_editable',this.mode==='edit');this.$el.toggleClass('o_form_readonly',this.mode==='readonly');_.each(this.allFieldWidgets[this.state.id],function(widget){var idForLabel=self.idsForLabels[widget.name];var $widgets=self.$('.o_field_widget[name='+widget.name+']');var $label=idForLabel?self.$('label[for='+idForLabel+']'):$();$label=$label.eq($widgets.index(widget.$el));if(config.debug||widget.attrs.help||widget.field.help){self._addFieldTooltip(widget,$label);}
if(widget.attrs.widget==='upgrade_boolean'){widget.renderWithLabel($label);}});},_setIDForLabel:function(widget,idForLabel){widget.getFocusableElement().attr('id',idForLabel);},_onClick:function(){if(this.mode==='readonly'){this.trigger_up('bounce_edit');}},_onNavigationMove:function(ev){ev.stopPropagation();var index;if(ev.data.direction==="next"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activateNextFieldWidget(this.state,index);}else if(ev.data.direction==="previous"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activatePreviousFieldWidget(this.state,index);}},_onTranslate:function(event){event.preventDefault();this.trigger_up('translate',{fieldName:event.target.name,id:this.state.id});},});return FormRenderer;});;

/* /web/static/src/js/views/form/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormController',function(require){"use strict";var BasicController=require('web.BasicController');var dialogs=require('web.view_dialogs');var core=require('web.core');var Dialog=require('web.Dialog');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var FormController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{bounce_edit:'_onBounceEdit',button_clicked:'_onButtonClicked',edited_list:'_onEditedList',open_one2many_record:'_onOpenOne2ManyRecord',open_record:'_onOpenRecord',toggle_column_order:'_onToggleColumnOrder',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionButtons=params.actionButtons;this.disableAutofocus=params.disableAutofocus;this.footerToButtons=params.footerToButtons;this.defaultButtons=params.defaultButtons;this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};},autofocus:function(){if(!this.disableAutofocus){this.renderer.autofocus();}},createRecord:function(parentID){var self=this;var record=this.model.get(this.handle,{raw:true});return this.model.load({context:record.getContext(),fields:record.fields,fieldsInfo:record.fieldsInfo,modelName:this.modelName,parentID:parentID,res_ids:record.res_ids,type:'record',viewType:'form',}).then(function(handle){self.handle=handle;self._updateEnv();return self._setMode('edit');});},getSelectedIds:function(){var env=this.model.get(this.handle,{env:true});return env.currentId?[env.currentId]:[];},getTitle:function(){return this.model.getName(this.handle);},on_attach_callback:function(){this._super.apply(this,arguments);this.autofocus();},renderButtons:function($node){var $footer=this.footerToButtons?this.$('footer'):null;var mustRenderFooterButtons=$footer&&$footer.length;if(!this.defaultButtons&&!mustRenderFooterButtons){return;}
this.$buttons=$('<div/>');if(mustRenderFooterButtons){this.$buttons.append($footer);}else{this.$buttons.append(qweb.render("FormView.buttons",{widget:this}));this.$buttons.on('click','.o_form_button_edit',this._onEdit.bind(this));this.$buttons.on('click','.o_form_button_create',this._onCreate.bind(this));this.$buttons.on('click','.o_form_button_save',this._onSave.bind(this));this.$buttons.on('click','.o_form_button_cancel',this._onDiscard.bind(this));this._updateButtons();}
this.$buttons.appendTo($node);},renderPager:function($node,options){options=_.extend({},options,{validate:this.canBeDiscarded.bind(this),});this._super($node,options);},renderSidebar:function($node){if(!this.sidebar&&this.hasSidebar){var otherItems=[];if(this.is_action_enabled('delete')){otherItems.push({label:_t('Delete'),callback:this._onDeleteRecord.bind(this),});}
if(this.is_action_enabled('create')&&this.is_action_enabled('duplicate')){otherItems.push({label:_t('Duplicate'),callback:this._onDuplicateRecord.bind(this),});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),viewType:'form',env:{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:otherItems}),});this.sidebar.appendTo($node);this._updateSidebar();}},saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(changedFields){self.set('title',self.getTitle());self._updateEnv();if(_t.database.multi_lang&&changedFields.length){var fields=self.renderer.state.fields;var data=self.renderer.state.data;var alertFields=[];for(var k=0;k<changedFields.length;k++){var field=fields[changedFields[k]];var fieldData=data[changedFields[k]];if(field.translate&&fieldData){alertFields.push(field);}}
if(alertFields.length){self.renderer.displayTranslationAlert(alertFields);}}
return changedFields;});},update:function(params,options){params=_.extend({viewType:'form'},params);return this._super(params,options);},_confirmSave:function(id){if(id===this.handle){if(this.mode==='readonly'){return this.reload();}else{return this._setMode('readonly');}}else{var record=this.model.get(this.handle);var containsChangedRecord=function(value){return _.isObject(value)&&(value.id===id||_.find(value.data,containsChangedRecord));};var changedFields=_.findKey(record.data,containsChangedRecord);return this.renderer.confirmChange(record,record.id,[changedFields]);}},_disableButtons:function(){this._super.apply(this,arguments);this.renderer.disableButtons();},_enableButtons:function(){this._super.apply(this,arguments);this.renderer.enableButtons();},_onDeletedRecords:function(){var state=this.model.get(this.handle,{raw:true});if(!state.res_ids.length){this.do_action('history_back');}else{this._super.apply(this,arguments);}},_pushState:function(state){state=state||{};var env=this.model.get(this.handle,{env:true});state.id=env.currentId;this._super(state);},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){this.model.unfreezeOrder(this.handle);}
return this._super.apply(this,arguments);},_update:function(){var title=this.getTitle();this.set('title',title);this._updateButtons();this._updateSidebar();return this._super.apply(this,arguments).then(this.autofocus.bind(this));},_updateButtons:function(){if(this.$buttons){if(this.footerToButtons){var $footer=this.$('footer');if($footer.length){this.$buttons.empty().append($footer);}}
var edit_mode=(this.mode==='edit');this.$buttons.find('.o_form_buttons_edit').toggleClass('o_hidden',!edit_mode);this.$buttons.find('.o_form_buttons_view').toggleClass('o_hidden',edit_mode);}},_updateSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.mode==='readonly');}},_onBounceEdit:function(){if(this.$buttons){this.$buttons.find('.o_form_button_edit').odooBounce();}},_onButtonClicked:function(event){event.stopPropagation();var self=this;var def;this._disableButtons();function saveAndExecuteAction(){return self.saveRecord(self.handle,{stayInEdit:true,}).then(function(){var record=self.model.get(event.data.record.id);return self._callButtonAction(attrs,record);});}
var attrs=event.data.attrs;if(attrs.confirm){var d=$.Deferred();Dialog.confirm(this,attrs.confirm,{confirm_callback:saveAndExecuteAction,}).on("closed",null,function(){d.resolve();});def=d.promise();}else if(attrs.special==='cancel'){def=this._callButtonAction(attrs,event.data.record);}else if(!attrs.special||attrs.special==='save'){def=saveAndExecuteAction();}
def.always(this._enableButtons.bind(this));},_onCreate:function(){this.createRecord();},_onDeleteRecord:function(){this._deleteRecords([this.handle]);},_onDiscard:function(){this._discardChanges();},_onDuplicateRecord:function(){var self=this;this.model.duplicateRecord(this.handle).then(function(handle){self.handle=handle;self._updateEnv();self._setMode('edit');});},_onEdit:function(){this._setMode('edit');},_onEditedList:function(ev){ev.stopPropagation();if(ev.data.id){this.model.save(ev.data.id,{savePoint:true});}
this.model.freezeOrder(ev.data.id);},_onOpenOne2ManyRecord:function(event){event.stopPropagation();var data=event.data;var record;if(data.id){record=this.model.get(data.id,{raw:true});}
new dialogs.FormViewDialog(this,{context:data.context,domain:data.domain,fields_view:data.fields_view,model:this.model,on_saved:data.on_saved,parentID:data.parentID,readonly:data.readonly,recordID:record&&record.id,res_id:record&&record.res_id,res_model:data.field.relation,shouldSaveLocally:true,title:(record?_t("Open: "):_t("Create "))+(event.target.string||data.field.string),}).open();},_onOpenRecord:function(event){event.stopPropagation();var self=this;var record=this.model.get(event.data.id,{raw:true});new dialogs.FormViewDialog(self,{context:event.data.context,fields_view:event.data.fields_view,on_saved:event.data.on_saved,readonly:event.data.readonly,res_id:record.res_id,res_model:record.model,title:_t("Open: ")+event.data.string,}).open();},_onSave:function(ev){ev.stopPropagation();this.saveRecord();},_onToggleColumnOrder:function(event){event.stopPropagation();var self=this;this.model.setSort(event.data.id,event.data.name).then(function(){var field=event.data.field;var state=self.model.get(self.handle);self.renderer.confirmChange(state,state.id,[field]);});},});return FormController;});;

/* /web/static/src/js/views/form/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var BasicView=require('web.BasicView');var Context=require('web.Context');var core=require('web.core');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _lt=core._lt;var FormView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Renderer:FormRenderer,Controller:FormController,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,searchable:false,viewType:'form',init:function(viewInfo,params){this._super.apply(this,arguments);var mode=params.mode||(params.currentId?'readonly':'edit');this.loadParams.type='record';this.controllerParams.disableAutofocus=params.disable_autofocus;this.controllerParams.hasSidebar=params.sidebar;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.footerToButtons=params.footer_to_buttons;if('action'in params&&'flags'in params.action){this.controllerParams.footerToButtons=params.action.flags.footer_to_buttons;}
var defaultButtons='default_buttons'in params?params.default_buttons:true;this.controllerParams.defaultButtons=defaultButtons;this.controllerParams.mode=mode;this.rendererParams.mode=mode;},getController:function(parent){return this._loadSubviews(parent).then(this._super.bind(this,parent));},});return FormView;});;

/* /web/static/src/js/views/graph/graph_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphModel',function(require){"use strict";var core=require('web.core');var AbstractModel=require('web.AbstractModel');var _t=core._t;return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.chart=null;},get:function(){return _.extend({},this.chart,{fields:this.fields});},load:function(params){var groupBys=params.context.graph_groupbys||params.groupBys;this.initialGroupBys=groupBys;this.fields=params.fields;this.modelName=params.modelName;this.chart={data:[],groupedBy:params.groupedBy.length?params.groupedBy:groupBys,measure:params.context.graph_measure||params.measure,mode:params.context.graph_mode||params.mode,domain:params.domain,context:params.context,};return this._loadGraph();},reload:function(handle,params){if('context'in params){this.chart.context=params.context;this.chart.groupedBy=params.context.graph_groupbys||this.chart.groupedBy;this.chart.measure=params.context.graph_measure||this.chart.measure;this.chart.mode=params.context.graph_mode||this.chart.mode;}
if('domain'in params){this.chart.domain=params.domain;}
if('groupBy'in params){this.chart.groupedBy=params.groupBy.length?params.groupBy:this.initialGroupBys;}
if('measure'in params){this.chart.measure=params.measure;}
if('mode'in params){this.chart.mode=params.mode;return $.when();}
return this._loadGraph();},_loadGraph:function(){var groupedBy=this.chart.groupedBy;var fields=_.map(groupedBy,function(groupBy){return groupBy.split(':')[0];});if(this.chart.measure!=='__count__'){fields=fields.concat(this.chart.measure);}
return this._rpc({model:this.modelName,method:'read_group',context:this.chart.context,domain:this.chart.domain,fields:fields,groupBy:groupedBy,lazy:false,}).then(this._processData.bind(this));},_processData:function(raw_data){var self=this;var is_count=this.chart.measure==='__count__';var data_pt,labels;this.chart.data=[];for(var i=0;i<raw_data.length;i++){data_pt=raw_data[i];labels=_.map(this.chart.groupedBy,function(field){return self._sanitizeValue(data_pt[field],field);});this.chart.data.push({value:is_count?data_pt.__count||data_pt[this.chart.groupedBy[0]+'_count']:data_pt[this.chart.measure],labels:labels});}},_sanitizeValue:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return value[1];if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},});});;

/* /web/static/src/js/views/graph/graph_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var qweb=core.qweb;var GraphController=AbstractController.extend({className:'o_graph',init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.measures=params.measures;},destroy:function(){if(this.$buttons){this.$buttons.find('button').off().tooltip('destroy');}
this._super.apply(this,arguments);},getContext:function(){var state=this.model.get();return{graph_measure:state.measure,graph_mode:state.mode,graph_groupbys:state.groupedBy,};},renderButtons:function($node){if($node){var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(qweb.render('GraphView.buttons',context));this.$measureList=this.$buttons.find('.o_graph_measures_list');this.$buttons.find('button').tooltip();this.$buttons.click(this._onButtonClick.bind(this));this._updateButtons();this.$buttons.appendTo($node);}},_setMode:function(mode){this.update({mode:mode});this._updateButtons();},_setMeasure:function(measure){var self=this;this.update({measure:measure}).then(function(){self._updateButtons();});},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get();this.$buttons.find('.o_graph_button').removeClass('active');this.$buttons.find('.o_graph_button[data-mode="'+state.mode+'"]').addClass('active');this.$measureList.find('li').each(function(index,li){$(li).toggleClass('selected',$(li).data('field')===state.measure);});},_onButtonClick:function(event){var $target=$(event.target);if($target.hasClass('o_graph_button')){this._setMode($target.data('mode'));}else if($target.parents('.o_graph_measures_list').length){event.preventDefault();event.stopPropagation();var parent=$target.parent();var field=parent.data('field');this._setMeasure(field);}},});return GraphController;});;

/* /web/static/src/js/views/graph/graph_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var field_utils=require('web.field_utils');var _t=core._t;var qweb=core.qweb;var CHART_TYPES=['pie','bar','line'];var MAX_LEGEND_LENGTH=25*(1+config.device.size_class);return AbstractRenderer.extend({className:"o_graph_svg_container",init:function(parent,state,params){this._super.apply(this,arguments);this.stacked=params.stacked;this.$el.css({minWidth:'100px',minHeight:'100px'});},destroy:function(){nv.utils.offWindowResize(this.to_remove);this._super();},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;this._render();},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},_render:function(){if(this.to_remove){nv.utils.offWindowResize(this.to_remove);}
if(!_.contains(CHART_TYPES,this.state.mode)){this.$el.empty();this.trigger_up('warning',{title:_t('Invalid mode for chart'),message:_t('Cannot render chart with mode : ')+this.state.mode});}else if(!this.state.data.length){this.$el.empty();this.$el.append(qweb.render('GraphView.error',{title:_t("No data to display"),description:_t("No data available for this chart. "+"Try to add some records, or make sure that "+"there is no active filter in the search bar."),}));}else if(this.isInDOM){this._renderGraph();}
return this._super.apply(this,arguments);},_renderBarChart:function(){var self=this;var data,values;var measure=this.state.fields[this.state.measure].string;if(this.state.groupedBy.length===0){data=[{values:[{x:measure,y:this.state.data[0].value}],key:measure}];}
if(this.state.groupedBy.length===1){values=this.state.data.map(function(datapt){return{x:datapt.labels,y:datapt.value};});data=[{values:values,key:measure,}];}
if(this.state.groupedBy.length>1){var xlabels=[],series=[],label,serie,value;values={};for(var i=0;i<this.state.data.length;i++){label=this.state.data[i].labels[0];serie=this.state.data[i].labels[1];value=this.state.data[i].value;if((!xlabels.length)||(xlabels[xlabels.length-1]!==label)){xlabels.push(label);}
series.push(this.state.data[i].labels[1]);if(!(serie in values)){values[serie]={};}
values[serie][label]=this.state.data[i].value;}
series=_.uniq(series);data=[];var current_serie,j;for(i=0;i<series.length;i++){current_serie={values:[],key:series[i]};for(j=0;j<xlabels.length;j++){current_serie.values.push({x:xlabels[j],y:values[series[i]][xlabels[j]]||0,});}
data.push(current_serie);}}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.multiBarChart();chart.options({margin:{left:80,bottom:100,top:80,right:0},delay:100,transition:10,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,rightAlignYAxis:false,stacked:this.stacked,reduceXTicks:false,rotateLabels:-20,showControls:(this.state.groupedBy.length>1)});chart.yAxis.tickFormat(function(d){var measure_field=self.state.fields[self.measure];return field_utils.format.float(d,{digits:measure_field&&measure_field.digits||[69,2],});});chart(svg);return chart;},_renderPieChart:function(){var data=[];var all_negative=true;var some_negative=false;var all_zero=true;this.state.data.forEach(function(datapt){all_negative=all_negative&&(datapt.value<0);some_negative=some_negative||(datapt.value<0);all_zero=all_zero&&(datapt.value===0);});if(some_negative&&!all_negative){this.$el.append(qweb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));return;}
if(all_zero){this.$el.append(qweb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));return;}
if(this.state.groupedBy.length){data=this.state.data.map(function(datapt){return{x:datapt.labels.join("/"),y:datapt.value};});}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(100);var legend_right=config.device.size_class>config.device.SIZES.XS;var chart=nv.models.pieChart().labelType('percent');chart.options({delay:250,showLegend:legend_right||_.size(data)<=MAX_LEGEND_LENGTH,legendPosition:legend_right?'right':'top',transition:100,color:d3.scale.category10().range(),});chart(svg);return chart;},_renderLineChart:function(){if(this.state.data.length<2){this.$el.append(qweb.render('GraphView.error',{title:_t("Not enough data points"),description:"You need at least two data points to display a line chart."}));return;}
var self=this;var data=[];var tickValues;var tickFormat;var measure=this.state.fields[this.state.measure].string;if(this.state.groupedBy.length===1){var values=this.state.data.map(function(datapt,index){return{x:index,y:datapt.value};});data=[{values:values,key:measure,}];tickValues=this.state.data.map(function(d,i){return i;});tickFormat=function(d){return self.state.data[d].labels;};}
if(this.state.groupedBy.length>1){data=[];var data_dict={};var tick=0;var tickLabels=[];var serie,tickLabel;var identity=function(p){return p;};tickValues=[];for(var i=0;i<this.state.data.length;i++){if(this.state.data[i].labels[0]!==tickLabel){tickLabel=this.state.data[i].labels[0];tickValues.push(tick);tickLabels.push(tickLabel);tick++;}
serie=this.state.data[i].labels[1];if(!data_dict[serie]){data_dict[serie]={values:[],key:serie,};}
data_dict[serie].values.push({x:tick-1,y:this.state.data[i].value,});data=_.map(data_dict,identity);}
tickFormat=function(d){return tickLabels[d];};}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.lineChart();chart.options({margin:{left:80,bottom:100,top:80,right:0},useInteractiveGuideline:true,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,});chart.xAxis.tickValues(tickValues).tickFormat(tickFormat);chart.yAxis.tickFormat(function(d){return field_utils.format.float(d,{digits:self.state.fields[self.state.measure]&&self.state.fields[self.state.measure].digits||[69,2],});});chart(svg);return chart;},_renderGraph:function(){this.$el.empty();var chart=this['_render'+_.str.capitalize(this.state.mode)+'Chart']();if(chart&&chart.tooltip.chartContainer){this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);chart.tooltip.chartContainer(this.el);}},});});;

/* /web/static/src/js/views/graph/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GraphModel=require('web.GraphModel');var Controller=require('web.GraphController');var GraphRenderer=require('web.GraphRenderer');var _t=core._t;var _lt=core._lt;var GraphView=AbstractView.extend({display_name:_lt('Graph'),icon:'fa-bar-chart',cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],config:{Model:GraphModel,Controller:Controller,Renderer:GraphRenderer,},init:function(viewInfo){this._super.apply(this,arguments);var measure;var groupBys=[];viewInfo.fields=_.defaults({__count__:{string:_t("Count"),type:"integer"}},viewInfo.fields);viewInfo.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.type==='measure'){measure=name;}else{groupBys.push(name);}});var measures={__count__:{string:_t("Count"),type:"integer"}};_.each(viewInfo.fields,function(field,name){if(name!=='id'&&field.store===true){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){measures[name]=field;}}});this.controllerParams.measures=measures;this.rendererParams.stacked=viewInfo.arch.attrs.stacked!=="False";this.loadParams.mode=viewInfo.arch.attrs.type||'bar';this.loadParams.measure=measure||'__count__';this.loadParams.groupBys=groupBys||[];this.loadParams.fields=viewInfo.fields;},});return GraphView;});;

/* /web/static/src/js/views/kanban/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumn',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var kanban_quick_create=require('web.kanban_quick_create');var KanbanRecord=require('web.KanbanRecord');var view_dialogs=require('web.view_dialogs');var Widget=require('web.Widget');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var _t=core._t;var QWeb=core.qweb;var RecordQuickCreate=kanban_quick_create.RecordQuickCreate;var KanbanColumn=Widget.extend({template:'KanbanView.Group',custom_events:{cancel_quick_create:'_onCancelQuickCreate',quick_create_add_record:'_onQuickCreateAddRecord',tweak_column:'_onTweakColumn',tweak_column_records:'_onTweakColumnRecords',},events:{'click .o_column_edit':'_onEditColumn','click .o_column_delete':'_onDeleteColumn','click .o_column_archive':'_onArchiveRecords','click .o_column_unarchive':'_onUnarchiveRecords','click .o_kanban_quick_add':'_onAddQuickCreate','click .o_kanban_load_more':'_onLoadMore','click .o_kanban_toggle_fold':'_onToggleFold',},init:function(parent,data,options,recordOptions){this._super(parent);this.db_id=data.id;this.data_records=data.data;this.data=data;var value=data.value;this.id=data.res_id;this.folded=!data.isOpen;this.has_active_field='active'in data.fields;this.fields=data.fields;this.records=[];this.modelName=data.model;this.quick_create=options.quick_create;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.draggable=options.draggable;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.relation=options.relation;this.offset=0;this.remaining=data.count-this.data_records.length;if(options.hasProgressBar){this.barOptions={columnID:this.db_id,progressBarStates:options.progressBarStates,};}
this.record_options=_.clone(recordOptions);if(options.grouped_by_m2o){this.title=value?value:_t('Undefined');}else{this.title=value===undefined?_t('Undefined'):value;}
if(options.group_by_tooltip){this.tooltipInfo=_.map(options.group_by_tooltip,function(help,field){return(data.tooltipData&&data.tooltipData[field]&&"<div>"+help+"<br>"+data.tooltipData[field]+"</div>")||'';}).join('');}else{this.tooltipInfo="";}},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){this._addRecord(this.data_records[i]);}
this.$header.find('.o_kanban_header_title').tooltip();if(!config.device.isMobile){this.$el.sortable({connectWith:'.o_kanban_group',containment:this.draggable?false:'parent',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',helper:'clone',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');},out:function(){self.$el.removeClass('o_kanban_hover');},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);record.$el.removeAttr('style');if(index>=0){if($.contains(self.$el[0],record.$el[0])){self.trigger_up('kanban_column_resequence',{ids:self._getIDs()});}}else{ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record,ids:self._getIDs()});}}});}
this.$el.click(function(event){if(self.folded){self._onToggleFold(event);}});if(this.barOptions){this.$el.addClass('o_kanban_has_progressbar');this.progressBar=new KanbanColumnProgressBar(this,this.barOptions,this.data);defs.push(this.progressBar.appendTo(this.$header));}
var title=this.folded?this.title+' ('+this.data.count+')':this.title;this.$header.find('.o_column_title').text(title);this.$el.toggleClass('o_column_folded',this.folded&&!config.device.isMobile);var tooltip=this.data.count+_t(' records');tooltip='<p>'+tooltip+'</p>'+this.tooltipInfo;this.$header.find('.o_kanban_header_title').tooltip({html:true}).attr('data-original-title',tooltip);if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}));}
return $.when.apply($,defs);},addQuickCreate:function(){if(this.folded){this.trigger_up('column_toggle_fold',{openQuickCreate:true,});return;}
if(this.quickCreateWidget){return;}
var width=this.records.length?this.records[0].$el.innerWidth():this.$el.width()-8;this.quickCreateWidget=new RecordQuickCreate(this,width);this.quickCreateWidget.insertAfter(this.$header);},isEmpty:function(){return!this.records.length;},_addRecord:function(recordState,options){var record=new KanbanRecord(this,recordState,this.record_options);this.records.push(record);if(options&&options.position==='before'){record.insertAfter(this.quickCreateWidget?this.quickCreateWidget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){record.insertBefore($load_more);}else{record.appendTo(this.$el);}}},_cancelQuickCreate:function(){this.quickCreateWidget.destroy();this.quickCreateWidget=undefined;},_getIDs:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},_onAddQuickCreate:function(){this.addQuickCreate();},_onArchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:true});},_onCancelQuickCreate:function(){this._cancelQuickCreate();},_onDeleteColumn:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete'),},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},_onEditColumn:function(event){event.preventDefault();new view_dialogs.FormViewDialog(this,{res_model:this.relation,res_id:this.id,title:_t("Edit Column"),on_saved:this.trigger_up.bind(this,'reload'),}).open();},_onLoadMore:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},_onQuickCreateAddRecord:function(event){this.trigger_up('quick_create_record',event.data);},_onToggleFold:function(event){event.preventDefault();this.trigger_up('column_toggle_fold');},_onTweakColumn:function(ev){ev.data.callback(this.$el);},_onTweakColumnRecords:function(ev){_.each(this.records,function(record){ev.data.callback(record.$el,record.state.data);});},_onUnarchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:false});},});return KanbanColumn;});;

/* /web/static/src/js/views/kanban/kanban_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_quick_create',function(require){"use strict";var Widget=require('web.Widget');var AbstractQuickCreate=Widget.extend({events:{'click .o_kanban_add':'_onAddClicked','click .o_kanban_cancel':'_onCancelClicked','keydown':'_onKeydown','keypress input':'_onKeypress','mousedown .o_kanban_add':'_onMousedown','mousedown .o_kanban_cancel':'_onMousedown','focusout':'_onFocusOut',},_add:function(options){var value=this.$input.val();this.$input.val('');if(/^\s*$/.test(value)){return;}
this._notifyAdd(value,options);this.$input.focus();},_cancel:function(){},_notifyAdd:function(name,options){},_onAddClicked:function(event){event.stopPropagation();this._add();},_onCancelClicked:function(){this._cancel();},_onFocusOut:function(ev){if(!this.$input.val()){this._cancel();}},_onKeydown:function(event){if(event.keyCode===27){this._cancel();}},_onKeypress:function(event){if(event.keyCode===13){this._add();}},_onMousedown:function(event){event.preventDefault();},});var RecordQuickCreate=AbstractQuickCreate.extend({template:"KanbanView.QuickCreate",events:_.extend({},AbstractQuickCreate.prototype.events,{'click .o_kanban_edit':'_onEditClicked','mousedown .o_kanban_edit':'_onMousedown',}),init:function(parent,options){this._super.apply(this,arguments);this.width=options.width;this.defaultName=options.defaultName;},start:function(){this.$el.css({width:this.width});this.$input=this.$('input');this._addDefaultName();this.$input.focus();return this._super.apply(this,arguments);},_addDefaultName:function(){if(this.defaultName){this.$input.val(this.defaultName);}},_cancel:function(){this.trigger_up('cancel_quick_create');},_notifyAdd:function(value,options){this.trigger_up('quick_create_add_record',{value:value,openRecord:options&&options.openRecord||false,});},_onAddClicked:function(){this._super.apply(this,arguments);this._addDefaultName();},_onEditClicked:function(event){event.stopPropagation();this._add({openRecord:true});},});var ColumnQuickCreate=AbstractQuickCreate.extend({template:'KanbanView.ColumnQuickCreate',events:_.extend({},AbstractQuickCreate.prototype.events,{'click':'toggleFold','click input':'_onInputClicked','focusout':'_onFocusout',}),init:function(){this._super.apply(this,arguments);this.folded=true;},start:function(){this.$header=this.$('.o_column_header');this.$quick_create=this.$('.o_kanban_quick_create');this.$input=this.$('input');return this._super.apply(this,arguments);},toggleFold:function(){this.folded=!this.folded;this._update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},_cancel:function(){if(!this.folded){this.folded=true;this.$input.val('');this._update();}},_notifyAdd:function(value){this.trigger_up('quick_create_add_column',{value:value});},_update:function(){this.$header.toggle(this.folded);this.$quick_create.toggle(!this.folded);},_onFocusout:function(){var hasFocus=this.$(':focus').length>0;if(hasFocus){return;}
this.folded=true;this.$input.val('');this._update();},_onInputClicked:function(event){event.stopPropagation();},});return{RecordQuickCreate:RecordQuickCreate,ColumnQuickCreate:ColumnQuickCreate,};});;

/* /web/static/src/js/views/kanban/kanban_column_progressbar.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumnProgressBar',function(require){'use strict';var Widget=require('web.Widget');var session=require('web.session');var utils=require('web.utils');var KanbanColumnProgressBar=Widget.extend({template:'KanbanView.ColumnProgressBar',events:{'click .o_kanban_counter_progress':'_onProgressBarParentClick','click .progress-bar':'_onProgressBarClick',},ANIMATE:true,init:function(parent,options,columnState){this._super.apply(this,arguments);this.columnID=options.columnID;this.columnState=columnState;this.fieldName=columnState.progressBarValues.field;this.colors=columnState.progressBarValues.colors;this.sumField=columnState.progressBarValues.sum_field;var state=options.progressBarStates[this.columnID];if(state){this.groupCount=state.groupCount;this.subgroupCounts=state.subgroupCounts;this.totalCounterValue=state.totalCounterValue;this.activeFilter=state.activeFilter;}
var sumFieldInfo=this.sumField&&columnState.fieldsInfo.kanban[this.sumField];var currencyField=sumFieldInfo&&sumFieldInfo.options&&sumFieldInfo.options.currency_field;if(currencyField&&columnState.data.length){this.currency=session.currencies[columnState.data[0].data[currencyField].res_id];}},start:function(){var self=this;this.$bars={};_.each(this.colors,function(val,key){self.$bars[val]=self.$('.bg-'+val+'-full');});this.$counter=this.$('.o_kanban_counter_side');this.$number=this.$counter.find('b');if(this.currency){var $currency=$('<span/>',{text:this.currency.symbol,});if(this.currency.position==='before'){$currency.prependTo(this.$counter);}else{$currency.appendTo(this.$counter);}}
return this._super.apply(this,arguments).then(function(){var subgroupCounts={};_.each(self.colors,function(val,key){var subgroupCount=self.columnState.progressBarValues.counts[key]||0;if(self.activeFilter===key&&subgroupCount===0){self.activeFilter=false;}
subgroupCounts[key]=subgroupCount;});self.groupCount=self.columnState.count;self.subgroupCounts=subgroupCounts;self.prevTotalCounterValue=self.totalCounterValue;self.totalCounterValue=self.sumField?(self.columnState.aggregateValues[self.sumField]||0):self.columnState.count;self._notifyState();self._render();});},_render:function(){var self=this;this.trigger_up('tweak_column',{callback:function($el){$el.removeClass('o_kanban_group_show');_.each(self.colors,function(val,key){$el.removeClass('o_kanban_group_show_'+val);});if(self.activeFilter){$el.addClass('o_kanban_group_show o_kanban_group_show_'+self.colors[self.activeFilter]);}},});this.trigger_up('tweak_column_records',{callback:function($el,recordData){var categoryValue=recordData[self.fieldName];_.each(self.colors,function(val,key){$el.removeClass('oe_kanban_card_'+val);});if(self.colors[categoryValue]){$el.addClass('oe_kanban_card_'+self.colors[categoryValue]);}},});var barNumber=0;var barMinWidth=6;_.each(self.colors,function(val,key){var $bar=self.$bars[val];var count=self.subgroupCounts&&self.subgroupCounts[key]||0;if(!$bar){return;}
$bar.attr('data-original-title',count+' '+key);$bar.tooltip({delay:'0',trigger:'hover',placement:'top'});$bar.toggleClass('active progress-bar-striped',key===self.activeFilter);$bar.removeClass('o_bar_has_records transition-off');window.getComputedStyle($bar[0]).getPropertyValue('width');if(count>0){$bar.addClass('o_bar_has_records');var maxWidth=100-barMinWidth*barNumber;self.$('.progress-bar.o_bar_has_records').css('max-width',maxWidth+'%');$bar.css('width',(count*100/self.groupCount)+'%');barNumber++;}else{$bar.css('width','');}});this.$('.progress-bar.o_bar_has_records').css('min-width',barMinWidth+'%');var start=this.prevTotalCounterValue;var end=this.totalCounterValue;var animationClass=start>999?'o_kanban_grow':'o_kanban_grow_huge';if(start!==undefined&&end>start&&this.ANIMATE){$({currentValue:start}).animate({currentValue:end},{duration:1000,start:function(){self.$counter.addClass(animationClass);},step:function(){self.$number.html(_getCounterHTML(this.currentValue));},complete:function(){self.$number.html(_getCounterHTML(this.currentValue));self.$counter.removeClass(animationClass);},});}else{this.$number.html(_getCounterHTML(end));}
function _getCounterHTML(value){return utils.human_number(value,0,3);}},_notifyState:function(){this.trigger_up('set_progress_bar_state',{columnID:this.columnID,values:{groupCount:this.groupCount,subgroupCounts:this.subgroupCounts,totalCounterValue:this.totalCounterValue,activeFilter:this.activeFilter,},});},_onProgressBarClick:function(ev){this.$clickedBar=$(ev.currentTarget);var filter=this.$clickedBar.data('filter');this.activeFilter=(this.activeFilter===filter?false:filter);this._notifyState();this._render();},_onProgressBarParentClick:function(ev){if(ev.target!==ev.currentTarget){return;}
this.activeFilter=false;this._notifyState();this._render();},});return KanbanColumnProgressBar;});;

/* /web/static/src/js/views/kanban/kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var KanbanModel=BasicModel.extend({addRecordToGroup:function(groupID,resId){var self=this;var group=this.localData[groupID];var new_record=this._makeDataPoint({res_id:resId,modelName:group.model,fields:group.fields,fieldsInfo:group.fieldsInfo,viewType:group.viewType,parentID:groupID,});return this._fetchRecord(new_record).then(function(result){group.data.unshift(new_record.id);group.res_ids.unshift(resId);group.count++;self.localData[group.parentID].count++;self._updateParentResIDs(group);return result.id;});},createGroup:function(name,parentID){var self=this;var parent=this.localData[parentID];var groupBy=parent.groupedBy[0];var groupByField=parent.fields[groupBy];if(!groupByField||groupByField.type!=='many2one'){return $.Deferred().reject();}
return this._rpc({model:groupByField.relation,method:'name_create',args:[name],context:parent.context,}).then(function(result){var newGroup=self._makeDataPoint({modelName:parent.model,context:parent.context,domain:parent.domain.concat([[groupBy,"=",result[0]]]),fields:parent.fields,fieldsInfo:parent.fieldsInfo,isOpen:true,limit:parent.limit,parentID:parent.id,openGroupByDefault:true,orderedBy:parent.orderedBy,value:result,viewType:parent.viewType,});if(parent.progressBar){newGroup.progressBarValues=_.extend({counts:{},},parent.progressBar);}
parent.data.push(newGroup.id);return newGroup.id;});},get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp&&dp.tooltipData){result.tooltipData=$.extend(true,{},dp.tooltipData);}
if(dp&&dp.progressBarValues){result.progressBarValues=$.extend(true,{},dp.progressBarValues);}
return result;},getColumn:function(id){var element=this.localData[id];if(element){return this.get(element.parentID);}
return null;},load:function(params){this.defaultGroupedBy=params.groupBy;params.groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.defaultGroupedBy;return this._super(params);},loadColumnRecords:function(groupID){var dataPoint=this.localData[groupID];dataPoint.isOpen=true;return this.reload(groupID);},loadMore:function(groupID){var group=this.localData[groupID];var offset=group.loadMoreOffset+group.limit;return this.reload(group.id,{loadMoreOffset:offset,});},moveRecord:function(recordID,groupID,parentID){var self=this;var parent=this.localData[parentID];var new_group=this.localData[groupID];var changes={};var groupedFieldName=parent.groupedBy[0];var groupedField=parent.fields[groupedFieldName];if(groupedField.type==='many2one'){changes[groupedFieldName]={id:new_group.res_id,display_name:new_group.value,};}else if(groupedField.type==='selection'){var value=_.findWhere(groupedField.selection,{1:new_group.value});changes[groupedFieldName]=value&&value[0]||false;}else{changes[groupedFieldName]=new_group.value;}
var record=self.localData[recordID];var resID=record.res_id;var old_group;for(var i=0;i<parent.data.length;i++){old_group=self.localData[parent.data[i]];var index=_.indexOf(old_group.data,recordID);if(index>=0){old_group.data.splice(index,1);old_group.count--;old_group.res_ids=_.without(old_group.res_ids,resID);self._updateParentResIDs(old_group);break;}}
new_group.data.push(recordID);new_group.res_ids.push(resID);new_group.count++;return this.notifyChanges(recordID,changes).then(function(){return self.save(recordID);}).then(function(){record.parentID=new_group.id;return[old_group.id,new_group.id];});},reload:function(id,options){if(options&&options.groupBy&&!options.groupBy.length){options.groupBy=this.defaultGroupedBy;}
var def=this._super(id,options);if(options&&options.loadMoreOffset){return def;}
return this._reloadProgressBarGroupFromRecord(id,def);},save:function(recordID){var def=this._super.apply(this,arguments);return this._reloadProgressBarGroupFromRecord(recordID,def);},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);if(params.progressBar){dataPoint.progressBar=params.progressBar;}
return dataPoint;},_load:function(dataPoint,options){if(dataPoint.progressBar){return this._readProgressBarGroup(dataPoint,options);}
return this._super.apply(this,arguments);},_readGroup:function(list){var self=this;if(list.groupedBy.length>1){list.groupedBy=[list.groupedBy[0]];}
return this._super.apply(this,arguments).then(function(result){return self._readTooltipFields(list).then(_.constant(result));});},_readProgressBarGroup:function(list,options){var self=this;var groupsDef=this._readGroup(list,options);var progressBarDef=this._rpc({model:list.model,method:'read_progress_bar',kwargs:{domain:list.domain,group_by:list.groupedBy[0],progress_bar:list.progressBar,context:list.context,},});return $.when(groupsDef,progressBarDef).then(function(a,data){_.each(list.data,function(groupID){var group=self.localData[groupID];group.progressBarValues=_.extend({counts:data[group.value]||{},},list.progressBar);});return list;});},_readTooltipFields:function(list){var self=this;var groupedByField=list.fields[list.groupedBy[0].split(':')[0]];if(groupedByField.type!=='many2one'){return $.when();}
var groupIds=_.reduce(list.data,function(groupIds,id){var res_id=self.get(id,{raw:true}).res_id;if(res_id){groupIds.push(res_id);}
return groupIds;},[]);var tooltipFields=[];var groupedByFieldInfo=list.fieldsInfo.kanban[list.groupedBy[0]];if(groupedByFieldInfo&&groupedByFieldInfo.options){tooltipFields=Object.keys(groupedByFieldInfo.options.group_by_tooltip||{});}
if(groupIds.length&&tooltipFields.length){var fieldNames=_.union(['display_name'],tooltipFields);return this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,fieldNames],context:list.context,}).then(function(result){_.each(list.data,function(id){var dp=self.localData[id];dp.tooltipData=_.findWhere(result,{id:dp.res_id});});});}
return $.when();},_reloadProgressBarGroupFromRecord:function(recordID,def){var element=this.localData[recordID];if(element.type==='list'&&!element.parentID){return def;}
var self=this;while(element){if(element.progressBar){return def.then(function(data){return self._load(element,{keepEmptyGroups:true,onlyGroups:true,}).then(function(){return data;});});}
element=this.localData[element.parentID];}
return def;},});return KanbanModel;});;

/* /web/static/src/js/views/kanban/kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanController',function(require){"use strict";var BasicController=require('web.BasicController');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var view_dialogs=require('web.view_dialogs');var _t=core._t;var qweb=core.qweb;var KanbanController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{quick_create_add_column:'_onAddColumn',quick_create_record:'_onQuickCreateRecord',resequence_columns:'_onResequenceColumn',button_clicked:'_onButtonClicked',kanban_record_delete:'_onRecordDelete',kanban_record_update:'_onUpdateRecord',kanban_column_delete:'_onDeleteColumn',kanban_column_add_record:'_onAddRecordToColumn',kanban_column_resequence:'_onColumnResequence',kanban_column_archive_records:'_onArchiveRecords',kanban_load_more:'_onLoadMore',kanban_load_records:'_onLoadColumnRecords',column_toggle_fold:'_onToggleColumn',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.on_create=params.on_create;this.hasButtons=params.hasButtons;this.createColumnEnabled=this._isCreateColumnEnabled();},renderButtons:function($node){if(this.hasButtons&&this.is_action_enabled('create')){this.$buttons=$(qweb.render('KanbanView.buttons',{widget:this}));this.$buttons.on('click','button.o-kanban-button-new',this._onButtonNew.bind(this));this._updateButtons();this.$buttons.appendTo($node);}},update:function(){this.createColumnEnabled=this._isCreateColumnEnabled();return this._super.apply(this,arguments);},_confirmSave:function(id){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;if(grouped){var columnState=this.model.getColumn(id);return this.renderer.updateColumn(columnState.id,columnState);}
return this.renderer.updateRecord(this.model.get(id));},_isCreateColumnEnabled:function(){var groupCreate=this.is_action_enabled('group_create');if(!groupCreate){return false;}
var state=this.model.get(this.handle,{raw:true});var groupByField=state.fields[state.groupedBy[0]];var groupedByM2o=groupByField&&(groupByField.type==='many2one');return groupedByM2o;},_resequenceColumns:function(ids){var state=this.model.get(this.handle,{raw:true});var model=state.fields[state.groupedBy[0]].relation;return this.model.resequence(model,ids,this.handle);},_resequenceRecords:function(column_id,ids){var self=this;return this.model.resequence(this.modelName,ids,column_id).then(function(){self._updateEnv();});},_updateButtons:function(){if(this.$buttons){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;var createMuted=grouped&&data.data.length===0&&this.createColumnEnabled;this.$buttons.find('.o-kanban-button-new').toggleClass('btn-primary',!createMuted).toggleClass('btn-default',createMuted);}},_onAddColumn:function(event){var self=this;this.model.createGroup(event.data.value,this.handle).then(function(){var state=self.model.get(self.handle,{raw:true});var ids=_.pluck(state.data,'res_id').filter(_.isNumber);return self._resequenceColumns(ids);}).then(function(){return self.update({},{reload:false});}).then(function(){self._updateButtons();self.renderer.quickCreateToggleFold();});},_onAddRecordToColumn:function(event){var self=this;var record=event.data.record;var column=event.target;this.alive(this.model.moveRecord(record.db_id,column.db_id,this.handle)).then(function(column_db_ids){return self._resequenceRecords(column.db_id,event.data.ids).then(function(){_.each(column_db_ids,function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});});}).fail(this.reload.bind(this));},_onArchiveRecords:function(event){var self=this;var active_value=!event.data.archive;var column=event.target;var record_ids=_.pluck(column.records,'db_id');if(record_ids.length){this.model.toggleActive(record_ids,active_value,column.db_id).then(function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);self._updateEnv();});}},_onButtonClicked:function(event){event.stopPropagation();var self=this;var attrs=event.data.attrs;var record=event.data.record;if(attrs.context){attrs.context=new Context(attrs.context).set_eval_context({active_id:record.res_id,active_ids:[record.res_id],active_model:record.model,});}
this.trigger_up('execute_action',{action_data:attrs,env:{context:record.getContext(),currentID:record.res_id,model:record.model,resIDs:record.res_ids,},on_closed:function(){var recordModel=self.model.localData[record.id];var group=self.model.localData[recordModel.parentID];var parent=self.model.localData[group.parentID];self.model.reload(record.id).then(function(db_id){var data=self.model.get(db_id);var kanban_record=event.target;kanban_record.update(data);var domain=(parent?parent.domain:group.domain)||[];var domInData=_.every(domain,function(d){return d[0]in data.data;});var activeInDomain=_.pluck(domain,0).indexOf('active')!==-1;var activeInData='active'in data.data;if(domInData&&!activeInDomain&&activeInData){domain=domain.concat([['active','=',true]]);}else if(!domInData&&!activeInDomain&&activeInData){domain=[['active','=',true]];}
try{var visible=new Domain(domain).compute(data.evalContext);}catch(e){return;}
if(!visible){kanban_record.destroy();}});},});},_onButtonNew:function(){var state=this.model.get(this.handle,{raw:true});var hasColumns=state.groupedBy.length>0&&state.data.length>0;if(hasColumns&&this.on_create==='quick_create'){this.renderer.addQuickCreate();}else if(this.on_create&&this.on_create!=='quick_create'){this.do_action(this.on_create,{on_close:this.reload.bind(this),additional_context:state.context,});}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onColumnResequence:function(event){this._resequenceRecords(event.target.db_id,event.data.ids);},_onDeleteColumn:function(event){var self=this;var column=event.target;var state=this.model.get(this.handle,{raw:true});var relatedModelName=state.fields[state.groupedBy[0]].relation;this.model.deleteRecords([column.db_id],relatedModelName).done(function(){if(column.isEmpty()){self.renderer.removeWidget(column);self._updateButtons();}else{self.reload();}});},_onLoadColumnRecords:function(event){var self=this;this.model.loadColumnRecords(event.data.columnID).then(function(dbID){var data=self.model.get(dbID);self.renderer.updateColumn(dbID,data);self._updateEnv();if(event.data.onSuccess){event.data.onSuccess();}});},_onLoadMore:function(event){var self=this;var column=event.target;this.model.loadMore(column.db_id).then(function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);self._updateEnv();});},_onQuickCreateRecord:function(event){var self=this;var column=event.target;var name=event.data.value;var state=this.model.get(this.handle,{raw:true});var columnState=this.model.get(column.db_id,{raw:true});var context=columnState.getContext();context['default_'+state.groupedBy[0]]=columnState.res_id;this._rpc({model:state.model,method:'name_create',args:[name],context:context,}).then(add_record).fail(function(error,event){event.preventDefault();new view_dialogs.FormViewDialog(self,{res_model:state.model,context:_.extend({default_name:name},context),title:_t("Create"),disable_multiple_selection:true,on_saved:function(record){add_record([record.res_id]);},}).open();});function add_record(records){return self.model.addRecordToGroup(columnState.id,records[0]).then(function(db_id){self._updateEnv();var columnState=self.model.getColumn(db_id);return self.renderer.updateColumn(columnState.id,columnState,{openQuickCreate:true}).then(function(){if(event.data.openRecord){self.trigger_up('open_record',{id:db_id,mode:'edit'});}});});}},_onRecordDelete:function(event){this._deleteRecords([event.data.id]);},_onResequenceColumn:function(event){var self=this;this._resequenceColumns(event.data.ids).then(function(){self._updateEnv();});},_onToggleColumn:function(event){var self=this;var column=event.target;this.model.toggleGroup(column.db_id).then(function(db_id){var data=self.model.get(db_id);var options={openQuickCreate:!!event.data.openQuickCreate,};self.renderer.updateColumn(db_id,data,options);self._updateEnv();});},_onUpdateRecord:function(ev){var changes=_.clone(ev.data);ev.data.force_save=true;this._applyChanges(ev.target.db_id,changes,ev);},});return KanbanController;});;

/* /web/static/src/js/views/kanban/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRecord',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var field_utils=require('web.field_utils');var utils=require('web.utils');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var _t=core._t;var QWeb=core.qweb;var NB_KANBAN_RECORD_COLORS=12;var KanbanRecord=Widget.extend({events:{'click .oe_kanban_action':'_onKanbanActionClicked','click .o_kanban_manage_toggle_button':'_onManageTogglerClicked',},init:function(parent,state,options){this._super(parent);this.fields=state.fields;this.fieldsInfo=state.fieldsInfo.kanban;this.modelName=state.model;this.options=options;this.editable=options.editable;this.deletable=options.deletable;this.read_only_mode=options.read_only_mode;this.qweb=options.qweb;this.subWidgets={};this._setState(state);this._onKanbanActionClicked=_.debounce(this._onKanbanActionClicked,300,true);},start:function(){return this._super.apply(this,arguments).then(this._render.bind(this));},update:function(state){_.invoke(_.pluck(this.subWidgets,'$el'),'detach');this._setState(state);this._render();},_attachTooltip:function(){var self=this;this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({'html':true,'title':self.qweb.render(tooltip,self.qweb_context)});}});},_computeDomain:function(d){return new Domain(d).compute(this.state.evalContext);},_getColorClassname:function(variable){var color=this._getColorID(variable);return'oe_kanban_color_'+color;},_getColorID:function(variable){if(typeof variable==='number'){return Math.round(variable)%NB_KANBAN_RECORD_COLORS;}
if(typeof variable==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%NB_KANBAN_RECORD_COLORS;}
return 0;},_getImageURL:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!utils.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{if(_.isArray(id)){id=id[0];}
if(!id){id=undefined;}
if(options.preview_image)
field=options.preview_image;var unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');var session=this.getSession();url=session.url('/web/image',{model:model,field:field,id:id,unique:unique});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},_openRecord:function(){var editMode=this.$el.hasClass('oe_kanban_global_click_edit');this.trigger_up('open_record',{id:this.db_id,mode:editMode?'edit':'readonly',});},_processFields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field_name=$field.attr("name");var field_widget=$field.attr("widget");if(field_widget||self.fields[field_name].type==='many2many'){var widget=self.subWidgets[field_name];if(!widget){var Widget=self.fieldsInfo[field_name].Widget;if(Widget){widget=self._processWidget($field,field_name,Widget);self.subWidgets[field_name]=widget;}else if(core.debug){$field.replaceWith($('<span>',{text:_.str.sprintf(_t('[No widget %s]'),field_widget),}));}}else{widget.reset(self.state);$field.replaceWith(widget.$el);}}else{self._processField($field,field_name);}});},_processField:function($field,field_name){var field=this.fields[field_name];var value=this.recordData[field_name];var options={data:this.recordData};var formatted_value=field_utils.format[field.type](value,field,options);var $result=$('<span>',{text:formatted_value,});$field.replaceWith($result);this._setFieldDisplay($result,field_name);return $result;},_processWidget:function($field,field_name,Widget){var attrs=Object.create(null);_.each(this.fieldsInfo[field_name],function(value,key){if(_.str.startsWith(key,'t-att-')){key=key.slice(6);value=$field.attr(key);}
attrs[key]=value;});var options=_.extend({},this.options,{attrs:attrs});var widget=new Widget(this,field_name,this.state,options);widget.replace($field);this._setFieldDisplay(widget.$el,field_name);return widget;},_processWidgets:function(){var self=this;this.$("widget").each(function(){var $field=$(this);var Widget=widgetRegistry.get($field.attr('name'));var widget=new Widget(self,self.state);var def=widget.__widgetRenderAndInsert(function(){});if(def.state()==='pending'){self.defs.push(def);}
widget.$el.addClass('o_widget');$field.replaceWith(widget.$el);});},_render:function(){this.replaceElement(this.qweb.render('kanban-box',this.qweb_context));this.$el.addClass('o_kanban_record');this.$el.data('record',this);if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this._onGlobalClick.bind(this));}
this._processFields();this._processWidgets();this._setupColor();this._setupColorPicker();this._attachTooltip();this.$('span.o_tag').tooltip({delay:{'show':50}});},_setFieldDisplay:function($el,fieldName){if(this.fieldsInfo[fieldName].display==='right'){$el.addClass('pull-right');}else if(this.fieldsInfo[fieldName].display==='full'){$el.addClass('o_text_block');}
if(this.fieldsInfo[fieldName].bold){$el.addClass('o_text_bold');}},_setState:function(recordState){this.state=recordState;this.id=recordState.res_id;this.db_id=recordState.id;this.recordData=recordState.data;this.record=this._transformRecord(recordState.data);this.qweb_context={kanban_image:this._getImageURL.bind(this),kanban_color:this._getColorClassname.bind(this),kanban_getcolor:this._getColorID.bind(this),kanban_compute_domain:this._computeDomain.bind(this),read_only_mode:this.read_only_mode,record:this.record,user_context:this.getSession().user_context,widget:this,};},_setupColor:function(){var color_field=this.$el.attr('color');if(color_field&&color_field in this.fields){var colorClass=this._getColorClassname(this.recordData[color_field]);this.$el.addClass(colorClass);}},_setupColorPicker:function(){var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker'));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_transformRecord:function(recordData){var self=this;var new_record={};_.each(this.state.getFieldNames(),function(name){var value=recordData[name];var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=value.toDate();}else if(r.type==='one2many'||r.type==='many2many'){r.raw_value=value.count?value.res_ids:[];}else if(r.type==='many2one'){r.raw_value=value&&value.res_id||false;}else{r.raw_value=value;}
if(r.type){var formatter=field_utils.format[r.type];r.value=formatter(value,self.fields[name],recordData,self.state);}else{r.value=value;}
new_record[name]=r;});return new_record;},_updateRecord:function(data){this.trigger_up('kanban_record_update',data);},_onColorChanged:function(event){event.preventDefault();var data={};var color_field=$(event.delegateTarget).data('field')||'color';data[color_field]=$(event.currentTarget).data('color');this.trigger_up('kanban_record_update',data);},_onGlobalClick:function(event){if($(event.target).parents('.o_dropdown_kanban').length){return;}
var trigger=true;var elem=event.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem===event.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=="tooltip");if(ischild){children.push(elem);if(test_event){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this._openRecord();}},_onKanbanActionClicked:function(event){event.preventDefault();var $action=$(event.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('open_record',{id:this.db_id,mode:'edit'});break;case'open':this.trigger_up('open_record',{id:this.db_id});break;case'delete':this.trigger_up('kanban_record_delete',{id:this.db_id,record:this});break;case'action':case'object':this.trigger_up('button_clicked',{attrs:$action.data(),record:this.state,});break;default:this.do_warn("Kanban: no action for type : "+type);}},_onManageTogglerClicked:function(event){event.preventDefault();this.$el.toggleClass('o_dropdown_open');var colorClass=this._getColorClassname(this.recordData.color||0);this.$('.o_kanban_manage_button_section').toggleClass(colorClass);},});return KanbanRecord;});;

/* /web/static/src/js/views/kanban/kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRecord=require('web.KanbanRecord');var quick_create=require('web.kanban_quick_create');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var ColumnQuickCreate=quick_create.ColumnQuickCreate;var qweb=core.qweb;function findInNode(node,predicate){if(predicate(node)){return node;}
if(!node.children){return undefined;}
for(var i=0;i<node.children.length;i++){if(findInNode(node.children[i],predicate)){return node.children[i];}}}
function qwebAddIf(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transformQwebTemplate(node,fields){if(node.tag&&node.attrs.modifiers){var modifiers=node.attrs.modifiers||{};if(modifiers.invisible){qwebAddIf(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!==-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag==='a'&&node.attrs['data-type']!=="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transformQwebTemplate(node.children[i],fields);}}}
var KanbanRenderer=BasicRenderer.extend({className:'o_kanban_view',custom_events:_.extend({},BasicRenderer.prototype.custom_events||{},{'set_progress_bar_state':'_onSetProgressBarState',}),init:function(parent,state,params){this._super.apply(this,arguments);this.widgets=[];this.qweb=new QWeb(session.debug,{_s:session.origin},false);var templates=findInNode(this.arch,function(n){return n.tag==='templates';});transformQwebTemplate(templates,state.fields);this.qweb.add_template(utils.json_node_to_xml(templates));this.recordOptions=_.extend({},params.record_options,{qweb:this.qweb,viewType:'kanban',});this.columnOptions=_.extend({},params.column_options,{qweb:this.qweb});if(this.columnOptions.hasProgressBar){this.columnOptions.progressBarStates={};}
this._setState(state);},addQuickCreate:function(){this.widgets[0].addQuickCreate();},quickCreateToggleFold:function(){this.quickCreate.toggleFold();},removeWidget:function(widget){this.widgets.splice(this.widgets.indexOf(widget),1);widget.destroy();},updateColumn:function(localID,columnState,options){var newColumn=new KanbanColumn(this,columnState,this.columnOptions,this.recordOptions);var index=_.findIndex(this.widgets,{db_id:localID});var column=this.widgets[index];this.widgets[index]=newColumn;return newColumn.insertAfter(column.$el).then(function(){if(options&&options.openQuickCreate){newColumn.addQuickCreate();}
column.destroy();});},updateRecord:function(recordState){var isGrouped=!!this.state.groupedBy.length;var record;if(isGrouped){_.each(this.widgets,function(widget){record=record||_.findWhere(widget.records,{db_id:recordState.id,});});}else{record=_.findWhere(this.widgets,{db_id:recordState.id});}
if(record){record.update(recordState);}},updateState:function(state){this._setState(state);return this._super.apply(this,arguments);},_hasContent:function(){return this._super.apply(this,arguments)||this.createColumnEnabled||(this.state.groupedBy.length&&this.state.data.length);},_renderGhostDivs:function(fragment,nbDivs){for(var $ghost,i=0;i<nbDivs;i++){$ghost=$('<div>').addClass('o_kanban_record o_kanban_ghost');$ghost.appendTo(fragment);}},_renderGrouped:function(fragment){var self=this;_.each(this.state.data,function(group){var column=new KanbanColumn(self,group,self.columnOptions,self.recordOptions);if(!group.value){column.prependTo(fragment);self.widgets.unshift(column);}else{column.appendTo(fragment);self.widgets.push(column);}});if(this.$el.sortable('instance')!==undefined){this.$el.sortable('destroy');}
if(this.groupedByM2O){this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header_title',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){if(_.isNumber($(u).data('id'))){ids.push($(u).data('id'));}});self.trigger_up('resequence_columns',{ids:ids});},});if(this.createColumnEnabled){this.quickCreate=new ColumnQuickCreate(this);this.quickCreate.appendTo(fragment);}}},_renderUngrouped:function(fragment){var self=this;_.each(this.state.data,function(record){var kanbanRecord=new KanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);kanbanRecord.appendTo(fragment);});this._renderGhostDivs(fragment,6);},_renderView:function(){var oldWidgets=this.widgets;this.widgets=[];this.$el.empty();var displayNoContentHelper=!this._hasContent()&&!!this.noContentHelp;this.$el.toggleClass('o_kanban_nocontent',displayNoContentHelper);if(displayNoContentHelper){this._renderNoContentHelper();}else{var isGrouped=!!this.state.groupedBy.length;this.$el.toggleClass('o_kanban_grouped',isGrouped);this.$el.toggleClass('o_kanban_ungrouped',!isGrouped);var fragment=document.createDocumentFragment();if(isGrouped){this._renderGrouped(fragment);}else{this._renderUngrouped(fragment);}
this.$el.append(fragment);}
return this._super.apply(this,arguments).then(_.invoke.bind(_,oldWidgets,'destroy'));},_setState:function(state){this.state=state;var groupByFieldAttrs=state.fields[state.groupedBy[0]];var groupByFieldInfo=state.fieldsInfo.kanban[state.groupedBy[0]];var draggable=true;if(groupByFieldAttrs){if(groupByFieldAttrs.type==="date"||groupByFieldAttrs.type==="datetime"){draggable=false;}else if(groupByFieldAttrs.readonly!==undefined){draggable=!(groupByFieldAttrs.readonly);}}
if(groupByFieldInfo){if(draggable&&groupByFieldInfo.readonly!==undefined){draggable=!(groupByFieldInfo.readonly);}}
this.groupedByM2O=groupByFieldAttrs&&(groupByFieldAttrs.type==='many2one');var grouped_by_field=this.groupedByM2O&&groupByFieldAttrs.relation;var groupByTooltip=groupByFieldInfo&&groupByFieldInfo.options.group_by_tooltip;this.columnOptions=_.extend(this.columnOptions,{draggable:draggable,group_by_tooltip:groupByTooltip,grouped_by_m2o:this.groupedByM2O,relation:grouped_by_field,});this.createColumnEnabled=this.groupedByM2O&&this.columnOptions.group_creatable;},_onSetProgressBarState:function(ev){if(!this.columnOptions.progressBarStates[ev.data.columnID]){this.columnOptions.progressBarStates[ev.data.columnID]={};}
_.extend(this.columnOptions.progressBarStates[ev.data.columnID],ev.data.values);},});return KanbanRenderer;});;

/* /web/static/src/js/views/kanban/kanban_renderer_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRendererMobile',function(require){"use strict";var config=require('web.config');var core=require('web.core');var KanbanRenderer=require('web.KanbanRenderer');var _t=core._t;var qweb=core.qweb;if(!config.device.isMobile){return;}
KanbanRenderer.include({events:_.extend({},KanbanRenderer.prototype.events,{'click .o_kanban_mobile_tab':'_onMobileTabClicked',}),ANIMATE:true,init:function(){this._super.apply(this,arguments);this.activeColumnIndex=0;},addQuickCreate:function(){this.widgets[this.activeColumnIndex].addQuickCreate();},updateColumn:function(localID){var self=this;var index=_.findIndex(this.widgets,{db_id:localID});var $column=this.widgets[index].$el;var left=$column.css('left');var scrollTop=$column.scrollTop();return this._super.apply(this,arguments).then(function(){$column=self.widgets[index].$el;$column.css({left:left});$column.scrollTop(scrollTop);self._enableSwipe();});},_enableSwipe:function(){var self=this;var currentColumn=this.widgets[this.activeColumnIndex];currentColumn.$el.swipe({swipeLeft:function(){self._moveToGroup(self.activeColumnIndex+1,self.ANIMATE);},swipeRight:function(){self._moveToGroup(self.activeColumnIndex-1,self.ANIMATE);}});},_moveToGroup:function(moveToIndex,animate){var self=this;if(moveToIndex<0||moveToIndex>=this.widgets.length){return $.when();}
var def=$.Deferred();this.activeColumnIndex=moveToIndex;var column=this.widgets[this.activeColumnIndex];this.trigger_up('kanban_load_records',{columnID:column.db_id,onSuccess:function(){var updateFunc=animate?'animate':'css';self.$('.o_kanban_mobile_tab').removeClass('o_current');_.each(self.widgets,function(column,index){var columnID=column.id||column.db_id;var $column=self.$('.o_kanban_group[data-id="'+columnID+'"]');var $tab=self.$('.o_kanban_mobile_tab[data-id="'+columnID+'"]');if(index===moveToIndex-1){$column[updateFunc]({left:'-100%'});$tab[updateFunc]({left:'0%'});}else if(index===moveToIndex+1){$column[updateFunc]({left:'100%'});$tab[updateFunc]({left:'100%'});}else if(index===moveToIndex){$column[updateFunc]({left:'0%'});$tab[updateFunc]({left:'50%'});$tab.addClass('o_current');}else if(index<moveToIndex){$column.css({left:'-100%'});$tab[updateFunc]({left:'-100%'});}else if(index>moveToIndex){$column.css({left:'100%'});$tab[updateFunc]({left:'200%'});}});def.resolve();},});return def;},_renderGrouped:function(fragment){var data=[];_.each(this.state.data,function(group){if(!group.value){group=_.extend({},group,{value:_t('Undefined')});data.unshift(group);}
else{data.push(group);}});var $tabs=$(qweb.render('KanbanView.MobileTabs',{data:data,}));$tabs.appendTo(fragment);return this._super.apply(this,arguments);},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.state.groupedBy.length){return self._moveToGroup(self.activeColumnIndex);}});},_onMobileTabClicked:function(event){this._moveToGroup($(event.currentTarget).index(),true);},});});;

/* /web/static/src/js/views/kanban/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var config=require('web.config');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanController=require('web.KanbanController');var utils=require('web.utils');var _lt=core._lt;var KanbanView=BasicView.extend({accesskey:"k",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,config:{Model:KanbanModel,Controller:KanbanController,Renderer:KanbanRenderer,},jsLibs:[],viewType:'kanban',init:function(viewInfo,params){this._super.apply(this,arguments);var arch=viewInfo.arch;this.loadParams.limit=this.loadParams.limit||40;this.loadParams.openGroupByDefault=config.device.isMobile?false:true;this.loadParams.type='list';this.loadParams.groupBy=arch.attrs.default_group_by?[arch.attrs.default_group_by]:(params.groupBy||[]);var progressBar;utils.traverse(arch,function(n){var isProgressBar=(n.tag==='progressbar');if(isProgressBar){progressBar=_.clone(n.attrs);progressBar.colors=JSON.parse(progressBar.colors);progressBar.sum_field=progressBar.sum_field||false;}
return!isProgressBar;});if(progressBar){this.loadParams.progressBar=progressBar;}
var activeActions=this.controllerParams.activeActions;activeActions=_.extend(activeActions,{group_create:arch.attrs.group_create?JSON.parse(arch.attrs.group_create):true,group_edit:arch.attrs.group_edit?JSON.parse(arch.attrs.group_edit):true,group_delete:arch.attrs.group_delete?JSON.parse(arch.attrs.group_delete):true,});this.rendererParams.column_options={editable:activeActions.group_edit,deletable:activeActions.group_delete,group_creatable:activeActions.group_create&&!config.device.isMobile,quick_create:params.isQuickCreateEnabled||this._isQuickCreateEnabled(viewInfo),hasProgressBar:!!progressBar,};this.rendererParams.record_options={editable:activeActions.edit,deletable:activeActions.delete,read_only_mode:params.readOnlyMode,};this.controllerParams.on_create=arch.attrs.on_create;this.controllerParams.readOnlyMode=false;this.controllerParams.hasButtons=true;if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}},_isQuickCreateEnabled:function(viewInfo){var groupBy=this.loadParams.groupBy[0];groupBy=groupBy!==undefined?groupBy.split(':')[0]:undefined;if(groupBy!==undefined&&!_.contains(['char','boolean','many2one'],viewInfo.fields[groupBy].type)){return false;}
if(!this.controllerParams.activeActions.create){return false;}
if(viewInfo.arch.attrs.quick_create!==undefined){return JSON.parse(viewInfo.arch.attrs.quick_create);}
return true;},});return KanbanView;});;

/* /web/static/src/js/views/list/list_editable_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.EditableListRenderer',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var ListRenderer=require('web.ListRenderer');var utils=require('web.utils');var _t=core._t;ListRenderer.include({custom_events:_.extend({},ListRenderer.prototype.custom_events,{navigation_move:'_onNavigationMove',}),events:_.extend({},ListRenderer.prototype.events,{'click tbody td.o_data_cell':'_onCellClick','click tbody tr:not(.o_data_row)':'_onEmptyRowClick','click tfoot':'_onFooterClick','click tr .o_list_record_delete':'_onTrashIconClick','click .o_field_x2many_list_row_add a':'_onAddRecord',}),init:function(parent,state,params){this._super.apply(this,arguments);this.addCreateLine=params.addCreateLine;this.addTrashIcon=params.addTrashIcon;this.currentRow=null;this.currentFieldIndex=null;},start:function(){if(this.editable){this.$el.css({height:'100%'});core.bus.on('click',this,this._onWindowClicked.bind(this));}
return this._super();},canBeSaved:function(recordID){if((recordID||this.state.id)===this.state.id){recordID=this.getEditableRecordID();if(recordID===null){return[];}}
return this._super(recordID);},confirmChange:function(state,id){var self=this;return this._super.apply(this,arguments).then(function(widgets){if(widgets.length){var rowIndex=_.findIndex(state.data,function(r){return r.id===id;});var $row=self.$('.o_data_row:nth('+rowIndex+')');self._setDecorationClasses(state.data[rowIndex],$row);self._updateFooter();}
return widgets;});},confirmUpdate:function(state,id,fields,ev){var self=this;var currentRowID,currentWidget,focusedElement,selectionRange;if(self.currentRow!==null){currentRowID=this.state.data[this.currentRow].id;currentWidget=this.allFieldWidgets[currentRowID][this.currentFieldIndex];focusedElement=currentWidget.getFocusableElement().get(0);if(currentWidget.formatType!=='boolean'){selectionRange=dom.getSelectionRange(focusedElement);}}
var oldData=this.state.data;this.state=state;return this.confirmChange(state,id,fields,ev).then(function(){var record=_.findWhere(state.data,{id:id});if(!record){return;}
var oldRowIndex=_.findIndex(oldData,{id:id});var $row=self.$('.o_data_row:nth('+oldRowIndex+')');$row.nextAll('.o_data_row').remove();$row.prevAll().remove();_.each(oldData,function(rec){if(rec.id!==id){self._destroyFieldWidgets(rec.id);}});var newRowIndex=_.findIndex(state.data,{id:id});var $lastRow=$row;_.each(state.data,function(record,index){if(index===newRowIndex){return;}
var $newRow=self._renderRow(record);if(index<newRowIndex){$newRow.insertBefore($row);}else{$newRow.insertAfter($lastRow);$lastRow=$newRow;}});if(self.currentRow!==null){self.currentRow=newRowIndex;return self._selectCell(newRowIndex,self.currentFieldIndex,{force:true}).then(function(){currentRowID=self.state.data[newRowIndex].id;currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];focusedElement=currentWidget.getFocusableElement().get(0);if(selectionRange){dom.setSelectionRange(focusedElement,selectionRange);}});}});},editRecord:function(recordID){var rowIndex=_.findIndex(this.state.data,{id:recordID});this._selectCell(rowIndex,0);},getEditableRecordID:function(){if(this.currentRow!==null){return this.state.data[this.currentRow].id;}
return null;},removeLine:function(state,recordID){var self=this;var rowIndex=_.findIndex(this.state.data,{id:recordID});this.state=state;if(rowIndex===-1){return;}
if(rowIndex===this.currentRow){this.currentRow=null;}
var $row=this.$('.o_data_row:nth('+rowIndex+')');if(this.state.count>=4){$row.remove();}else{$row.replaceWith(this._renderEmptyRow());}
this._destroyFieldWidgets(recordID);},setRowMode:function(recordID,mode){var self=this;var record;var rowIndex;if(this.state.groupedBy.length){rowIndex=-1;var count=0;utils.traverse_records(this.state,function(r){if(r.id===recordID){record=r;rowIndex=count;}
count++;});}else{rowIndex=_.findIndex(this.state.data,{id:recordID});record=this.state.data[rowIndex];}
if(rowIndex<0){return $.when();}
var editMode=(mode==='edit');this.currentRow=editMode?rowIndex:null;var $row=this.$('.o_data_row:nth('+rowIndex+')');var $tds=$row.children('.o_data_cell');var oldWidgets=_.clone(this.allFieldWidgets[record.id]);if(editMode){$tds.each(function(){var $td=$(this);$td.css({width:$td.outerWidth()});});}
var options={renderInvisible:editMode,renderWidgets:editMode,};options.mode=editMode?'edit':'readonly';var defs=[];this.defs=defs;_.each(this.columns,function(node,colIndex){var $td=$tds.eq(colIndex);var $newTd=self._renderBodyCell(record,node,colIndex,options);if($td.hasClass('o_list_button')){self._unregisterModifiersElement(node,recordID,$td.children());}
if(editMode){$td.empty().append($newTd.contents());}else{self._unregisterModifiersElement(node,recordID,$td);$td.replaceWith($newTd);}});delete this.defs;_.each(oldWidgets,this._destroyFieldWidget.bind(this,recordID));$row.toggleClass('o_selected_row',editMode);return $.when.apply($,defs);},unselectRow:function(){if(this.currentRow===null){return $.when();}
var record=this.state.data[this.currentRow];var recordWidgets=this.allFieldWidgets[record.id];toggleWidgets(true);var def=$.Deferred();this.trigger_up('save_line',{recordID:record.id,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});return def.fail(toggleWidgets.bind(null,false));function toggleWidgets(disabled){_.each(recordWidgets,function(widget){var $el=widget.getFocusableElement();$el.prop('disabled',disabled);});}},_destroyFieldWidgets:function(recordID){if(recordID in this.allFieldWidgets){var widgetsToDestroy=this.allFieldWidgets[recordID].slice();_.each(widgetsToDestroy,this._destroyFieldWidget.bind(this,recordID));delete this.allFieldWidgets[recordID];}},_getNumberOfCols:function(){var n=this._super();if(this.addTrashIcon){n++;}
return n;},_isEditable:function(){return!this.state.groupedBy.length&&this.editable;},_moveToPreviousLine:function(){if(this.currentRow>0){this._selectCell(this.currentRow-1,this.columns.length-1);}else{this.unselectRow().then(this.trigger_up.bind(this,'add_record'));}},_moveToNextLine:function(){var record=this.state.data[this.currentRow];var fieldNames=this.canBeSaved(record.id);if(fieldNames.length){return;}
if(this.currentRow<this.state.data.length-1){this._selectCell(this.currentRow+1,0);}else{var self=this;this.unselectRow().then(function(){self.trigger_up('add_record',{onFail:self._selectCell.bind(self,0,0,{}),});});}},_render:function(){this.currentRow=null;this.currentFieldIndex=null;return this._super.apply(this,arguments);},_renderBody:function(){var $body=this._super();if(this.hasHandle){$body.sortable({axis:'y',items:'> tr.o_data_row',helper:'clone',handle:'.o_row_handle',stop:this._resequence.bind(this),});}
return $body;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(this.addTrashIcon){var $icon=$('<button>',{class:'fa fa-trash-o o_list_record_delete_btn',name:'delete','aria-label':_t('Delete row ')+(index+1)});var $td=$('<td>',{class:'o_list_record_delete'}).append($icon);$row.append($td);}
return $row;},_renderRows:function(){var $rows=this._super();if(this.addCreateLine){var $a=$('<a href="#">').text(_t("Add an item"));var $td=$('<td>').attr('colspan',this._getNumberOfCols()).addClass('o_field_x2many_list_row_add').append($a);var $tr=$('<tr>').append($td);$rows.push($tr);}
return $rows;},_renderView:function(){var self=this;this.currentRow=null;return this._super.apply(this,arguments).then(function(){if(self._isEditable()){self.$('table').addClass('o_editable_list');}});},_resequence:function(event,ui){var self=this;var movedRecordID=ui.item.data('id');var rows=this.state.data;var row=_.findWhere(rows,{id:movedRecordID});var index0=rows.indexOf(row);var index1=ui.item.index();var lower=Math.min(index0,index1);var upper=Math.max(index0,index1)+1;var order=_.findWhere(self.state.orderedBy,{name:self.handleField});var asc=!order||order.asc;var reorderAll=false;var sequence=(asc?-1:1)*Infinity;_.each(rows,function(row,index){if((index<lower||index>=upper)&&((asc&&sequence>=row.data[self.handleField])||(!asc&&sequence<=row.data[self.handleField]))){reorderAll=true;}
sequence=row.data[self.handleField];});if(reorderAll){rows=_.without(rows,row);rows.splice(index1,0,row);}else{rows=rows.slice(lower,upper);rows=_.without(rows,row);if(index0>index1){rows.unshift(row);}else{rows.push(row);}}
var sequences=_.pluck(_.pluck(rows,'data'),self.handleField);var rowIDs=_.pluck(rows,'id');if(!asc){rowIDs.reverse();}
this.unselectRow().then(function(){self.trigger_up('resequence',{rowIDs:rowIDs,offset:_.min(sequences),handleField:self.handleField,});});},_selectCell:function(rowIndex,fieldIndex,options){options=options||{};if(!options.force&&rowIndex===this.currentRow&&fieldIndex===this.currentFieldIndex){return $.when();}
var wrap=options.wrap===undefined?true:options.wrap;var self=this;return this._selectRow(rowIndex).then(function(){var record=self.state.data[rowIndex];if(fieldIndex>=(self.allFieldWidgets[record.id]||[]).length){return $.Deferred().reject();}
var oldFieldIndex=self.currentFieldIndex;self.currentFieldIndex=fieldIndex;fieldIndex=self._activateFieldWidget(record,fieldIndex,{inc:1,wrap:wrap,event:options&&options.event,});if(fieldIndex<0){self.currentFieldIndex=oldFieldIndex;return $.Deferred().reject();}
self.currentFieldIndex=fieldIndex;});},_selectRow:function(rowIndex){if(rowIndex===this.currentRow){return $.when();}
var self=this;return this.unselectRow().then(function(){if(self.state.data.length<=rowIndex){return $.Deferred().reject();}
var def=$.Deferred();self.trigger_up('edit_line',{index:rowIndex,onSuccess:def.resolve.bind(def),});return def;});},_onAddRecord:function(event){event.preventDefault();event.stopPropagation();var self=this;this.unselectRow().then(function(){self.trigger_up('add_record');});},_onCellClick:function(event){if(!this._isEditable()||$(event.target).prop('special_click')){return;}
var $td=$(event.currentTarget);var $tr=$td.parent();var rowIndex=this.$('.o_data_row').index($tr);var fieldIndex=Math.max($tr.find('.o_data_cell').not('.o_list_button').index($td),0);this._selectCell(rowIndex,fieldIndex,{event:event});},_onEmptyRowClick:function(){this.unselectRow();},_onFooterClick:function(){this.unselectRow();},_onNavigationMove:function(ev){ev.stopPropagation();switch(ev.data.direction){case'up':if(this.currentRow>0){this._selectCell(this.currentRow-1,this.currentFieldIndex);}
break;case'right':if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1);}
break;case'down':if(this.currentRow<this.state.data.length-1){this._selectCell(this.currentRow+1,this.currentFieldIndex);}
break;case'left':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1);}
break;case'previous':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1,{wrap:false}).fail(this._moveToPreviousLine.bind(this));}else{this._moveToPreviousLine();}
break;case'next':if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1,{wrap:false}).fail(this._moveToNextLine.bind(this));}else{this._moveToNextLine();}
break;case'next_line':this._moveToNextLine();break;case'cancel':ev.data.originalEvent.stopPropagation();this.trigger_up('discard_changes',{recordID:ev.target.dataPointID,});break;}},_onRowClicked:function(){if(!this._isEditable()){this._super.apply(this,arguments);}},_onSortColumn:function(){if(this.currentRow===null){this._super.apply(this,arguments);}},_onTrashIconClick:function(event){event.stopPropagation();var $row=$(event.target).closest('tr')
var id=$row.data('id');if($row.hasClass('o_selected_row')){this.trigger_up('list_record_delete',{id:id});}else{var self=this;this.unselectRow().then(function(){self.trigger_up('list_record_delete',{id:id});});}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if(this.currentRow===null){return;}
if($(event.target).parents('.ui-autocomplete').length){return;}
var $clickModal=$(event.target).closest('.modal');if($clickModal.length){var $listModal=this.$el.closest('.modal');if($clickModal.prop('id')!==$listModal.prop('id')){return;}}
if(!document.contains(event.target)){return;}
if(this.el.contains(event.target)&&this.el!==event.target){return;}
this.unselectRow();},});});;

/* /web/static/src/js/views/list/list_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var field_utils=require('web.field_utils');var Pager=require('web.Pager');var utils=require('web.utils');var _t=core._t;var DECORATIONS=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var FIELD_CLASSES={float:'o_list_number',integer:'o_list_number',monetary:'o_list_number',text:'o_list_text',};var ListRenderer=BasicRenderer.extend({events:{'click tbody tr':'_onRowClicked','click tbody .o_list_record_selector':'_onSelectRecord','click thead th.o_column_sortable':'_onSortColumn','click .o_group_header':'_onToggleGroup','click thead .o_list_record_selector input':'_onToggleSelection',},init:function(parent,state,params){this._super.apply(this,arguments);this.hasHandle=false;this.handleField='sequence';this._processColumns(params.columnInvisibleFields||{});this.rowDecorations=_.chain(this.arch.attrs).pick(function(value,key){return DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();this.hasSelectors=params.hasSelectors;this.selection=params.selectedRecords||[];this.pagers=[];this.editable=params.editable;},updateState:function(state,params){this._processColumns(params.columnInvisibleFields||{});if(params.selectedRecords){this.selection=params.selectedRecords;}
return this._super.apply(this,arguments);},_computeAggregates:function(){var self=this;var data=[];if(this.selection.length){utils.traverse_records(this.state,function(record){if(_.contains(self.selection,record.id)){data.push(record);}});}else{data=this.state.data;}
_.each(this.columns,this._computeColumnAggregates.bind(this,data));},_computeColumnAggregates:function(data,column){var attrs=column.attrs;var field=this.state.fields[attrs.name];if(!field){return;}
var type=field.type;if(type!=='integer'&&type!=='float'&&type!=='monetary'){return;}
var func=(attrs.sum&&'sum')||(attrs.avg&&'avg')||(attrs.max&&'max')||(attrs.min&&'min');if(func){var count=0;var aggregateValue=(func==='max')?-Infinity:(func==='min')?Infinity:0;_.each(data,function(d){count+=1;var value=(d.type==='record')?d.data[attrs.name]:d.aggregateValues[attrs.name];if(func==='avg'){aggregateValue+=value;}else if(func==='sum'){aggregateValue+=value;}else if(func==='max'){aggregateValue=Math.max(aggregateValue,value);}else if(func==='min'){aggregateValue=Math.min(aggregateValue,value);}});if(func==='avg'){aggregateValue=count?aggregateValue/count:aggregateValue;}
column.aggregate={help:attrs[func],value:aggregateValue,};}},_getNumberOfCols:function(){var n=this.columns.length;return this.hasSelectors?n+1:n;},_processColumns:function(columnInvisibleFields){var self=this;self.hasHandle=false;self.handleField=null;this.columns=_.reject(this.arch.children,function(c){var reject=c.attrs.modifiers.column_invisible;if(c.attrs.name in columnInvisibleFields){reject=columnInvisibleFields[c.attrs.name];}
if(!reject&&c.attrs.widget==='handle'){self.handleField=c.attrs.name;}
return reject;});},_renderAggregateCells:function(aggregateValues){var self=this;return _.map(this.columns,function(column){var $cell=$('<td>');if(column.attrs.name in aggregateValues){var field=self.state.fields[column.attrs.name];var value=aggregateValues[column.attrs.name].value;var help=aggregateValues[column.attrs.name].help;var formatFunc=field_utils.format[column.attrs.widget];if(!formatFunc){formatFunc=field_utils.format[field.type];}
var formattedValue=formatFunc(value,field,{escape:true});$cell.addClass('o_list_number').attr('title',help).html(formattedValue);}
return $cell;});},_renderBody:function(){var $rows=this._renderRows();while($rows.length<4){$rows.push(this._renderEmptyRow());}
return $('<tbody>').append($rows);},_renderBodyCell:function(record,node,colIndex,options){var tdClassName='o_data_cell';if(node.tag==='button'){tdClassName+=' o_list_button';}else if(node.tag==='field'){var typeClass=FIELD_CLASSES[this.state.fields[node.attrs.name].type];if(typeClass){tdClassName+=(' '+typeClass);}
if(node.attrs.widget){tdClassName+=(' o_'+node.attrs.widget+'_cell');}}
var $td=$('<td>',{class:tdClassName});var modifiers=this._registerModifiers(node,record,$td,_.pick(options,'mode'));if(modifiers.invisible&&!(options&&options.renderInvisible)){return $td;}
if(node.tag==='button'){return $td.append(this._renderButton(record,node));}else if(node.tag==='widget'){return $td.append(this._renderWidget(record,node));}
if(node.attrs.widget||(options&&options.renderWidgets)){var widget=this._renderFieldWidget(node,record,_.pick(options,'mode'));this._handleAttributes(widget.$el,node);return $td.append(widget.$el);}
var name=node.attrs.name;var field=this.state.fields[name];var value=record.data[name];var formattedValue=field_utils.format[field.type](value,field,{data:record.data,escape:true,isPassword:'password'in node.attrs,});this._handleAttributes($td,node);return $td.html(formattedValue);},_renderButton:function(record,node){var $button=$('<button>',{type:'button',title:node.attrs.string,});if(node.attrs.icon){$button.addClass('o_icon_button');$button.append($('<i>',{class:'fa '+node.attrs.icon}));}else{$button.text(node.attrs.string);}
this._handleAttributes($button,node);this._registerModifiers(node,record,$button);if(record.res_id){var self=this;$button.on("click",function(e){e.stopPropagation();self.trigger_up('button_clicked',{attrs:node.attrs,record:record,});});}else{if(node.attrs.options.warn){var self=this;$button.on("click",function(e){e.stopPropagation();self.do_warn(_t("Warning"),_t('Please click on the "save" button first'));});}else{$button.prop('disabled',true);}}
return $button;},_renderEmptyRow:function(){var $td=$('<td>&nbsp;</td>').attr('colspan',this._getNumberOfCols());return $('<tr>').append($td);},_renderFooter:function(isGrouped){var aggregates={};_.each(this.columns,function(column){if('aggregate'in column){aggregates[column.attrs.name]=column.aggregate;}});var $cells=this._renderAggregateCells(aggregates);if(isGrouped){$cells.unshift($('<td>'));}
if(this.hasSelectors){$cells.unshift($('<td>'));}
return $('<tfoot>').append($('<tr>').append($cells));},_renderGroupPager:function(group){var pager=new Pager(this,group.count,group.offset+1,group.limit);pager.on('pager_changed',this,function(newState){var self=this;pager.disable();this.trigger_up('load',{id:group.id,limit:newState.limit,offset:newState.current_min-1,on_success:function(reloadedGroup){_.extend(group,reloadedGroup);self._renderView();},on_fail:pager.enable.bind(pager),});});this.pagers.push(pager);var fragment=document.createDocumentFragment();pager.appendTo(fragment);return pager.$el;},_renderGroupRow:function(group,groupLevel){var aggregateValues=_.mapObject(group.aggregateValues,function(value){return{value:value};});var $cells=this._renderAggregateCells(aggregateValues);if(this.hasSelectors){$cells.unshift($('<td>'));}
var name=group.value===undefined?_t('Undefined'):group.value;var groupBy=this.state.groupedBy[groupLevel];if(group.fields[groupBy.split(':')[0]].type!=='boolean'){name=name||_t('Undefined');}
var $th=$('<th>').addClass('o_group_name').text(name+' ('+group.count+')');var $arrow=$('<span>').css('padding-left',(groupLevel*20)+'px').css('padding-right','5px').addClass('fa');if(group.count>0){$arrow.toggleClass('fa-caret-right',!group.isOpen).toggleClass('fa-caret-down',group.isOpen);}
$th.prepend($arrow);if(group.isOpen&&!group.groupedBy.length&&(group.count>group.data.length)){var $pager=this._renderGroupPager(group);var $lastCell=$cells[$cells.length-1];$lastCell.addClass('o_group_pager').append($pager);}
return $('<tr>').addClass('o_group_header').toggleClass('o_group_open',group.isOpen).toggleClass('o_group_has_content',group.count>0).data('group',group).append($th).append($cells);},_renderGroups:function(data,groupLevel){var self=this;groupLevel=groupLevel||0;var result=[];var $tbody=$('<tbody>');_.each(data,function(group){if(!$tbody){$tbody=$('<tbody>');}
$tbody.append(self._renderGroupRow(group,groupLevel));if(group.data.length){result.push($tbody);if(group.groupedBy.length){result=result.concat(self._renderGroups(group.data,groupLevel+1));}else{var $records=_.map(group.data,function(record){return self._renderRow(record).prepend($('<td>'));});result.push($('<tbody>').append($records));}
$tbody=null;}});if($tbody){result.push($tbody);}
return result;},_renderHeader:function(isGrouped){var $tr=$('<tr>').append(_.map(this.columns,this._renderHeaderCell.bind(this)));if(this.hasSelectors){$tr.prepend(this._renderSelector('th'));}
if(isGrouped){$tr.prepend($('<th>').html('&nbsp;'));}
return $('<thead>').append($tr);},_renderHeaderCell:function(node){var name=node.attrs.name;var order=this.state.orderedBy;var isNodeSorted=order[0]&&order[0].name===name;var field=this.state.fields[name];var $th=$('<th>');if(!field){return $th;}
var description;if(node.attrs.widget){description=this.state.fieldsInfo.list[name].Widget.prototype.description;}
if(description===undefined){description=node.attrs.string||field.string;}
$th.text(description).data('name',name).toggleClass('o-sort-down',isNodeSorted?!order[0].asc:false).toggleClass('o-sort-up',isNodeSorted?order[0].asc:false).addClass(field.sortable&&'o_column_sortable');if(field.type==='float'||field.type==='integer'||field.type==='monetary'){$th.css({textAlign:'right'});}
if(config.debug){var fieldDescr={field:field,name:name,string:description||name,record:this.state,attrs:node.attrs,};this._addFieldTooltip(fieldDescr,$th);}
return $th;},_renderRow:function(record){var self=this;this.defs=[];var $cells=_.map(this.columns,function(node,index){return self._renderBodyCell(record,node,index,{mode:'readonly'});});delete this.defs;var $tr=$('<tr/>',{class:'o_data_row'}).data('id',record.id).append($cells);if(this.hasSelectors){$tr.prepend(this._renderSelector('td'));}
this._setDecorationClasses(record,$tr);return $tr;},_renderRows:function(){return _.map(this.state.data,this._renderRow.bind(this));},_renderSelector:function(tag){var $content=dom.renderCheckbox();return $('<'+tag+' width="1">').addClass('o_list_record_selector').append($content);},_renderView:function(){var self=this;this.$el.removeClass('table-responsive').empty();_.invoke(this.pagers,'destroy');this.pagers=[];if(!this._hasContent()&&this.noContentHelp){this._renderNoContentHelper();return this._super();}
var $table=$('<table>').addClass('o_list_view table table-condensed table-striped');this.$el.addClass('table-responsive').append($table);var is_grouped=!!this.state.groupedBy.length;this._computeAggregates();$table.toggleClass('o_list_view_grouped',is_grouped);$table.toggleClass('o_list_view_ungrouped',!is_grouped);this.hasHandle=this.state.orderedBy.length===0||this.state.orderedBy[0].name===this.handleField;if(is_grouped){$table.append(this._renderHeader(true)).append(this._renderGroups(this.state.data)).append(this._renderFooter(true));}else{$table.append(this._renderHeader()).append(this._renderBody()).append(this._renderFooter());}
if(this.selection.length){var $checked_rows=this.$('tr').filter(function(index,el){return _.contains(self.selection,$(el).data('id'));});$checked_rows.find('.o_list_record_selector input').prop('checked',true);}
return this._super();},_setDecorationClasses:function(record,$tr){_.each(this.rowDecorations,function(expr,decoration){var cssClass=decoration.replace('decoration','text');$tr.toggleClass(cssClass,py.PY_isTrue(py.evaluate(expr,record.evalContext)));});},_updateFooter:function(){this._computeAggregates();this.$('tfoot').replaceWith(this._renderFooter(!!this.state.groupedBy.length));},_updateSelection:function(){var $selectedRows=this.$('tbody .o_list_record_selector input:checked').closest('tr');this.selection=_.map($selectedRows,function(row){return $(row).data('id');});this.trigger_up('selection_changed',{selection:this.selection});this._updateFooter();},_onRowClicked:function(event){if(!$(event.target).prop('special_click')){var id=$(event.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:event.target});}}},_onSelectRecord:function(event){event.stopPropagation();this._updateSelection();if(!$(event.currentTarget).find('input').prop('checked')){this.$('thead .o_list_record_selector input').prop('checked',false);}},_onSortColumn:function(event){var name=$(event.currentTarget).data('name');this.trigger_up('toggle_column_order',{id:this.state.id,name:name});},_onToggleGroup:function(event){var group=$(event.currentTarget).data('group');if(group.count){this.trigger_up('toggle_group',{group:group});}},_onToggleSelection:function(event){var checked=$(event.currentTarget).prop('checked')||false;this.$('tbody .o_list_record_selector input').prop('checked',checked);this._updateSelection();},});return ListRenderer;});;

/* /web/static/src/js/views/list/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var ListRenderer=require('web.ListRenderer');var ListController=require('web.ListController');var _lt=core._lt;var ListView=BasicView.extend({accesskey:"l",display_name:_lt('List'),icon:'fa-list-ul',config:_.extend({},BasicView.prototype.config,{Renderer:ListRenderer,Controller:ListController,}),viewType:'list',init:function(viewInfo,params){this._super.apply(this,arguments);var selectedRecords=[];var arch=viewInfo.arch;var mode=arch.attrs.editable&&!params.readonly?"edit":"readonly";this.controllerParams.editable=arch.attrs.editable;this.controllerParams.hasSidebar=params.sidebar;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.noLeaf=!!this.loadParams.context.group_by_no_leaf;this.controllerParams.mode=mode;this.controllerParams.selectedRecords=selectedRecords;this.rendererParams.arch=arch;this.rendererParams.hasSelectors='hasSelectors'in params?params.hasSelectors:true;this.rendererParams.editable=params.readonly?false:arch.attrs.editable;this.rendererParams.selectedRecords=selectedRecords;this.loadParams.limit=this.loadParams.limit||80;this.loadParams.type='list';},});return ListView;});;

/* /web/static/src/js/views/list/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListController',function(require){"use strict";var core=require('web.core');var BasicController=require('web.BasicController');var DataExport=require('web.DataExport');var pyeval=require('web.pyeval');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var ListController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{add_record:'_onAddRecord',button_clicked:'_onButtonClicked',edit_line:'_onEditLine',save_line:'_onSaveLine',resequence:'_onResequence',selection_changed:'_onSelectionChanged',toggle_column_order:'_onToggleColumnOrder',toggle_group:'_onToggleGroup',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};this.editable=params.editable;this.noLeaf=params.noLeaf;this.selectedRecords=params.selectedRecords||[];},getActiveDomain:function(){var self=this;if(this.$('thead .o_list_record_selector input').prop('checked')){var searchView=this.getParent().searchview;var searchData=searchView.build_search_data();var userContext=this.getSession().user_context;var results=pyeval.eval_domains_and_contexts({domains:searchData.domains,contexts:[userContext].concat(searchData.contexts),group_by_seq:searchData.groupbys||[]});var record=self.model.get(self.handle,{raw:true});return $.when(record.getDomain().concat(results.domain||[]));}else{return $.Deferred().resolve();}},getSelectedIds:function(){return _.map(this.getSelectedRecords(),function(record){return record.res_id;});},getSelectedRecords:function(){var self=this;return _.map(this.selectedRecords,function(db_id){return self.model.get(db_id,{raw:true});});},renderButtons:function($node){if(!this.noLeaf&&this.hasButtons){this.$buttons=$(qweb.render('ListView.buttons',{widget:this}));this.$buttons.on('click','.o_list_button_add',this._onCreateRecord.bind(this));this.$buttons.on('click','.o_list_button_discard',this._onDiscard.bind(this));this.$buttons.appendTo($node);}},renderSidebar:function($node){if(this.hasSidebar&&!this.sidebar){var other=[{label:_t("Export"),callback:this._onExportData.bind(this)}];if(this.archiveEnabled){other.push({label:_t("Archive"),callback:this._onToggleArchiveState.bind(this,true)});other.push({label:_t("Unarchive"),callback:this._onToggleArchiveState.bind(this,false)});}
if(this.is_action_enabled('delete')){other.push({label:_t('Delete'),callback:this._onDeleteSelectedRecords.bind(this)});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),env:{context:this.model.get(this.handle,{raw:true}).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:other}),});this.sidebar.appendTo($node);this._toggleSidebar();}},update:function(params,options){var self=this;if(options&&options.keepSelection){var res_ids=this.model.get(this.handle).res_ids;this.selectedRecords=_.filter(this.selectedRecords,function(id){return _.contains(res_ids,self.model.get(id).res_id);});}else{this.selectedRecords=[];}
params.selectedRecords=this.selectedRecords;return this._super.apply(this,arguments);},_abandonRecord:function(recordID){this._super.apply(this,arguments);if((recordID||this.handle)!==this.handle){var state=this.model.get(this.handle);this.renderer.removeLine(state,recordID);this._updatePager();}},_addRecord:function(){var self=this;this._disableButtons();return this.renderer.unselectRow().then(function(){return self.model.addDefaultRecord(self.handle,{position:self.editable,});}).then(function(recordID){var state=self.model.get(self.handle);self.renderer.updateState(state,{});self.renderer.editRecord(recordID);self._updatePager();}).always(this._enableButtons.bind(this));},_archive:function(ids,archive){if(ids.length===0){return $.when();}
return this.model.toggleActive(ids,!archive,this.handle).then(this.update.bind(this,{},{reload:false}));},_confirmSave:function(id){var state=this.model.get(this.handle);return this.renderer.updateState(state,{noRender:true}).then(this._setMode.bind(this,'readonly',id));},_discardChanges:function(recordID){if((recordID||this.handle)===this.handle){recordID=this.renderer.getEditableRecordID();if(recordID===null){return $.when();}}
var self=this;return this._super(recordID).then(function(){self._updateButtons('readonly');});},_getSidebarEnv:function(){var env=this._super.apply(this,arguments);var record=this.model.get(this.handle);return _.extend(env,{domain:record.getDomain()});},_setMode:function(mode,recordID){if((recordID||this.handle)!==this.handle){this._updateButtons(mode);return this.renderer.setRowMode(recordID,mode);}else{return this._super.apply(this,arguments);}},_toggleSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.selectedRecords.length>0);}},_update:function(){this._toggleSidebar();return this._super.apply(this,arguments);},_updateButtons:function(mode){if(this.$buttons){this.$buttons.toggleClass('o-editing',mode==='edit');}},_onAddRecord:function(event){event.stopPropagation();if(this.activeActions.create){this._addRecord();}else if(event.data.onFail){event.data.onFail();}},_onButtonClicked:function(event){event.stopPropagation();this._callButtonAction(event.data.attrs,event.data.record);},_onCreateRecord:function(event){event.stopPropagation();var state=this.model.get(this.handle,{raw:true});if(this.editable&&!state.groupedBy.length){this._addRecord();}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onDeleteSelectedRecords:function(){this._deleteRecords(this.selectedRecords);},_onDiscard:function(ev){ev.stopPropagation();this._discardChanges();},_onEditLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){var record=self.model.get(self.handle);var editedRecord=record.data[ev.data.index];self._setMode('edit',editedRecord.id).done(ev.data.onSuccess);},});},_onExportData:function(){var record=this.model.get(this.handle);new DataExport(this,record).open();},_onSaveLine:function(ev){var recordID=ev.data.recordID;this.saveRecord(recordID).done(ev.data.onSuccess).fail(ev.data.onFailure);},_onResequence:function(event){var self=this;this.trigger_up('mutexify',{action:function(){var state=self.model.get(self.handle);var resIDs=_.map(event.data.rowIDs,function(rowID){return _.findWhere(state.data,{id:rowID}).res_id;});var options={offset:event.data.offset,field:event.data.handleField,};return self.model.resequence(self.modelName,resIDs,self.handle,options).then(function(){self._updateEnv();state=self.model.get(self.handle);return self.renderer.updateState(state,{noRender:true});});},});},_onSelectionChanged:function(event){this.selectedRecords=event.data.selection;this._toggleSidebar();},_onSidebarDataAsked:function(event){var env=this._getSidebarEnv();event.data.callback(env);},_onToggleArchiveState:function(archive){this._archive(this.selectedRecords,archive);},_onToggleColumnOrder:function(event){event.stopPropagation();var data=this.model.get(this.handle);if(!data.groupedBy){this.pager.updateState({current_min:1});}
var self=this;this.model.setSort(data.id,event.data.name).then(function(){self.update({});});},_onToggleGroup:function(event){this.model.toggleGroup(event.data.group.id).then(this.update.bind(this,{},{keepSelection:true,reload:false}));},});return ListController;});;

/* /web/static/src/js/views/pivot/pivot_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var PivotModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.numbering={};this.data=null;this._loadDataDropPrevious=new concurrency.DropPrevious();},closeHeader:function(headerID){var header=this.data.headers[headerID];header.expanded=false;header.children=[];var newGroupbyLength=this._getHeaderDepth(header.root)-1;header.root.groupbys.splice(newGroupbyLength);},expandAll:function(){return this._loadData();},expandHeader:function(header,field){var self=this;var other_root=header.root.other_root;var other_groupbys=header.root.other_root.groupbys;var fields=[].concat(field,other_groupbys,this.data.measures);var groupbys=[];for(var i=0;i<=other_groupbys.length;i++){groupbys.push([field].concat(other_groupbys.slice(0,i)));}
return $.when.apply(null,groupbys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:header.domain.length?header.domain:self.data.domain,fields:_.map(fields,function(field){return field.split(':')[0];}),groupBy:groupBy,lazy:false,});})).then(function(){var data=Array.prototype.slice.call(arguments);var datapt,attrs,j,l,row,col,cell_value,groupBys;for(i=0;i<data.length;i++){for(j=0;j<data[i].length;j++){datapt=data[i][j];groupBys=[field].concat(other_groupbys.slice(0,i));attrs={value:self._getValue(datapt,groupBys),domain:datapt.__domain||[],length:datapt.__count,};if(i===0){row=self._makeHeader(attrs.value,attrs.domain,header.root,0,1,header);}else{row=self._getHeader(attrs.value,header.root,0,1,header);}
col=self._getHeader(attrs.value,other_root,1,i+1);if(!col){continue;}
for(cell_value={},l=0;l<self.data.measures.length;l++){cell_value[self.data.measures[l]]=datapt[self.data.measures[l]];}
if(!self.data.cells[row.id]){self.data.cells[row.id]=[];}
self.data.cells[row.id][col.id]=cell_value;}}
if(!_.contains(header.root.groupbys,field)){header.root.groupbys.push(field);}});},exportData:function(){var measureNbr=this.data.measures.length;var headers=this._computeHeaders();var measureRow=measureNbr>=1?_.last(headers):[];var rows=this._computeRows();var i,j,value;headers[0].splice(0,1);for(i=0;i<measureRow.length;i++){measureRow[i].measure=this.fields[measureRow[i].measure].string;}
for(i=0,j,value;i<rows.length;i++){for(j=0;j<rows[i].values.length;j++){value=rows[i].values[j];rows[i].values[j]={is_bold:(i===0)||((this.data.main_col.width>1)&&(j>=rows[i].values.length-measureNbr)),value:(value===undefined)?"":value,};}}
return{headers:_.initial(headers),measure_row:measureRow,rows:rows,nbr_measures:measureNbr,};},flip:function(){var temp=this.data.main_col;this.data.main_col=this.data.main_row;this.data.main_row=temp;temp=this.data.groupedBy;this.data.groupedBy=this.data.colGroupBys;this.data.colGroupBys=temp;},get:function(options){var isRaw=options&&options.raw;if(!this.data.has_data){return{has_data:false};}
return{colGroupBys:this.data.main_col.groupbys,context:this.data.context,domain:this.data.domain,fields:this.fields,headers:!isRaw&&this._computeHeaders(),has_data:true,mainColWidth:this.data.main_col.width,measures:this.data.measures,rows:!isRaw&&this._computeRows(),rowGroupBys:this.data.main_row.groupbys,sortedColumn:this.data.sorted_column,};},getHeader:function(id){return this.data.headers[id];},load:function(params){this.initialDomain=params.domain;this.initialRowGroupBys=params.context.pivot_row_groupby||params.rowGroupBys;this.fields=params.fields;this.modelName=params.modelName;this.data={domain:params.domain,context:_.extend({},session.user_context,params.context),groupedBy:params.groupedBy,colGroupBys:params.context.pivot_column_groupby||params.colGroupBys,measures:this._processMeasures(params.context.pivot_measures)||params.measures,sorted_column:{},};this.defaultGroupedBy=params.groupedBy;return this._loadData();},reload:function(handle,params){var self=this;if('context'in params){this.data.context=params.context;this.data.colGroupBys=params.context.pivot_column_groupby||this.data.colGroupBys;this.data.groupedBy=params.context.pivot_row_groupby||this.data.groupedBy;this.data.measures=this._processMeasures(params.context.pivot_measures)||this.data.measures;this.defaultGroupedBy=this.data.groupedBy.length?this.data.groupedBy:this.defaultGroupedBy;}
if('domain'in params){this.data.domain=params.domain;}else{this.data.domain=this.initialDomain;}
if('groupBy'in params){this.data.groupedBy=params.groupBy.length?params.groupBy:this.defaultGroupedBy;}
if(!this.data.has_data){return this._loadData();}
var old_row_root=this.data.main_row.root;var old_col_root=this.data.main_col.root;return this._loadData().then(function(){var new_groupby_length;if(!('groupBy'in params)&&!('pivot_row_groupby'in(params.context||{}))){self._updateTree(old_row_root,self.data.main_row.root);new_groupby_length=self._getHeaderDepth(self.data.main_row.root)-1;self.data.main_row.groupbys=old_row_root.groupbys.slice(0,new_groupby_length);}
self._updateTree(old_col_root,self.data.main_col.root);new_groupby_length=self._getHeaderDepth(self.data.main_col.root)-1;self.data.main_row.groupbys=old_row_root.groupbys.slice(0,new_groupby_length);});},sortRows:function(col_id,measure,descending){var cells=this.data.cells;this._traverseTree(this.data.main_row.root,function(header){header.children.sort(compare);});this.data.sorted_column={id:col_id,measure:measure,order:descending?'desc':'asc',};function _getValue(id1,id2){if((id1 in cells)&&(id2 in cells[id1])){return cells[id1][id2];}
if(id2 in cells)return cells[id2][id1];}
function compare(row1,row2){var values1=_getValue(row1.id,col_id),values2=_getValue(row2.id,col_id),value1=values1?values1[measure]:0,value2=values2?values2[measure]:0;return descending?value1-value2:value2-value1;}},toggleMeasure:function(field){if(_.contains(this.data.measures,field)){this.data.measures=_.without(this.data.measures,field);return $.when();}else{this.data.measures.push(field);}
return this._loadData();},_computeHeaders:function(){var self=this;var main_col_dims=this._getHeaderDim(this.data.main_col.root);var depth=main_col_dims.depth;var width=main_col_dims.width;var nbr_measures=this.data.measures.length;var result=[[{width:1,height:depth+1}]];var col_ids=[];this.data.main_col.width=width;this._traverseTree(this.data.main_col.root,function(header){var index=header.path.length-1;var cell={width:self._getHeaderWidth(header)*nbr_measures,height:header.expanded?1:depth-index,title:header.path[header.path.length-1],id:header.id,expanded:header.expanded,};if(!header.expanded)col_ids.push(header.id);if(result[index])result[index].push(cell);else result[index]=[cell];});col_ids.push(this.data.main_col.root.id);this.data.main_col.width=width;if(width>1){var total_cell={width:nbr_measures,height:depth,title:""};if(nbr_measures===1){total_cell.total=true;}
result[0].push(total_cell);}
var nbr_cols=width===1?nbr_measures:(width+1)*nbr_measures;for(var i=0,measure_row=[],measure;i<nbr_cols;i++){measure=this.data.measures[i%nbr_measures];measure_row.push({measure:measure,is_bold:(width>1)&&(i>=nbr_measures*width),id:col_ids[Math.floor(i/nbr_measures)],});}
result.push(measure_row);return result;},_computeRows:function(){var self=this;var aggregates,i;var result=[];this._traverseTree(this.data.main_row.root,function(header){var values=[],col_ids=[];result.push({id:header.id,col_ids:col_ids,indent:header.path.length-1,title:header.path[header.path.length-1],expanded:header.expanded,values:values,});self._traverseTree(self.data.main_col.root,add_cells,header.id,values,col_ids);if(self.data.main_col.width>1){aggregates=self._getCellValue(header.id,self.data.main_col.root.id);for(i=0;i<self.data.measures.length;i++){values.push(aggregates&&aggregates[self.data.measures[i]]);}
col_ids.push(self.data.main_col.root.id);}});return result;function add_cells(col_hdr,row_id,values,col_ids){if(col_hdr.expanded)return;col_ids.push(col_hdr.id);aggregates=self._getCellValue(row_id,col_hdr.id);for(i=0;i<self.data.measures.length;i++){values.push(aggregates&&aggregates[self.data.measures[i]]);}}},_findPathInTree:function(root,path){var i,l=root.path.length;if(l===path.length){return(root.path[l-1]===path[l-1])?root:null;}
for(i=0;i<root.children.length;i++){if(root.children[i].path[l]===path[l]){return this._findPathInTree(root.children[i],path);}}
return null;},_getCellValue:function(id1,id2){if((id1 in this.data.cells)&&(id2 in this.data.cells[id1])){return this.data.cells[id1][id2];}
if(id2 in this.data.cells)return this.data.cells[id2][id1];},_getHeader:function(value,root,i,j,parent){var path;var total=_t("Total");if(parent){path=parent.path.concat(value.slice(i,j));}else{path=[total].concat(value.slice(i,j));}
return this._findPathInTree(root,path);},_getHeaderDepth:function(header){var depth=1;this._traverseTree(header,function(hdr){depth=Math.max(depth,hdr.path.length);});return depth;},_getHeaderDim:function(header){var depth=1;var width=0;this._traverseTree(header,function(hdr){depth=Math.max(depth,hdr.path.length);if(!hdr.expanded)width++;});return{width:width,depth:depth};},_getHeaderWidth:function(header){var self=this;if(!header.children.length)return 1;if(!header.expanded)return 1;return header.children.reduce(function(s,c){return s+self._getHeaderWidth(c);},0);},_getNumberedValue:function(value,field){var id=value[0];var name=value[1];this.numbering[field]=this.numbering[field]||{};this.numbering[field][name]=this.numbering[field][name]||{};var numbers=this.numbering[field][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},_getValue:function(datapt,fields){var result=[];var value;for(var i=0;i<fields.length;i++){value=this._sanitizeValue(datapt[fields[i]],fields[i]);result.push(value);}
return result;},_loadData:function(){var self=this;var groupBys=[];var rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;var colGroupBys=this.data.colGroupBys;var fields=[].concat(rowGroupBys,colGroupBys,this.data.measures);for(var i=0;i<rowGroupBys.length+1;i++){for(var j=0;j<colGroupBys.length+1;j++){groupBys.push(rowGroupBys.slice(0,i).concat(colGroupBys.slice(0,j)));}}
return this._loadDataDropPrevious.add($.when.apply(null,groupBys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:self.data.domain,fields:_.map(fields,function(field){return field.split(':')[0];}),groupBy:groupBy,lazy:false,});}))).then(function(){var data=Array.prototype.slice.call(arguments);if(data[0][0].__count===0){self.data.has_data=false;}
self._prepareData(data);});},_makeHeader:function(value,domain,root,i,j,parent_header){var total=_t("Total");var title=value.length?value[value.length-1]:total;var path,parent;if(parent_header){path=parent_header.path.concat(title);parent=parent_header;}else{path=[total].concat(value.slice(i,j-1));parent=value.length?this._findPathInTree(root,path):null;}
var header={id:utils.generateID(),expanded:false,domain:domain||[],children:[],path:value.length?parent.path.concat(title):[title]};this.data.headers[header.id]=header;header.root=root||header;if(parent){parent.children.push(header);parent.expanded=true;}
return header;},_prepareData:function(data){var self=this;_.extend(self.data,{main_row:{},main_col:{},headers:{},cells:[],});var index=0;var rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;var colGroupBys=this.data.colGroupBys;var datapt,row,col,attrs,cell_value;var main_row_header,main_col_header;var groupBys;var m;for(var i=0;i<rowGroupBys.length+1;i++){for(var j=0;j<colGroupBys.length+1;j++){for(var k=0;k<data[index].length;k++){datapt=data[index][k];groupBys=rowGroupBys.slice(0,i).concat(colGroupBys.slice(0,j));attrs={value:self._getValue(datapt,groupBys),domain:datapt.__domain||[],length:datapt.__count,};if(j===0){row=this._makeHeader(attrs.value,attrs.domain,main_row_header,0,i);}else{row=this._getHeader(attrs.value,main_row_header,0,i);}
if(i===0){col=this._makeHeader(attrs.value,attrs.domain,main_col_header,i,i+j);}else{col=this._getHeader(attrs.value,main_col_header,i,i+j);}
if(i+j===0){this.data.has_data=attrs.length>0;main_row_header=row;main_col_header=col;}
if(!this.data.cells[row.id])this.data.cells[row.id]=[];for(cell_value={},m=0;m<this.data.measures.length;m++){cell_value[this.data.measures[m]]=datapt[this.data.measures[m]];}
this.data.cells[row.id][col.id]=cell_value;}
index++;}}
this.data.main_row.groupbys=rowGroupBys;this.data.main_col.groupbys=colGroupBys;main_row_header.other_root=main_col_header;main_col_header.other_root=main_row_header;main_row_header.groupbys=rowGroupBys;main_col_header.groupbys=colGroupBys;this.data.main_row.root=main_row_header;this.data.main_col.root=main_col_header;},_processMeasures:function(measures){if(measures){return _.map(measures,function(measure){return measure==='__count__'?'__count':measure;});}},_sanitizeValue:function(value,field){if(value===false){return _t("Undefined");}
if(value instanceof Array){return this._getNumberedValue(value,field);}
if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},_traverseTree:function(root,f,arg1,arg2,arg3){f(root,arg1,arg2,arg3);if(!root.expanded)return;for(var i=0;i<root.children.length;i++){this._traverseTree(root.children[i],f,arg1,arg2,arg3);}},_updateTree:function(old_tree,new_tree){if(!old_tree.expanded){new_tree.expanded=false;new_tree.children=[];return;}
var tree,j,old_title,new_title;for(var i=0;i<new_tree.children.length;i++){tree=undefined;new_title=new_tree.children[i].path[new_tree.children[i].path.length-1];for(j=0;j<old_tree.children.length;j++){old_title=old_tree.children[j].path[old_tree.children[j].path.length-1];if(old_title===new_title){tree=old_tree.children[j];break;}}
if(tree){this._updateTree(tree,new_tree.children[i]);}else{new_tree.children[i].expanded=false;new_tree.children[i].children=[];}}},});return PivotModel;});;

/* /web/static/src/js/views/pivot/pivot_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var QWeb=core.qweb;var PivotController=AbstractController.extend({template:'PivotView',events:{'click .o_pivot_header_cell_opened':'_onOpenHeaderClick','click .o_pivot_header_cell_closed':'_onClosedHeaderClick','click .o_pivot_field_menu a':'_onFieldMenuSelection','click td':'_onCellClick','click .o_pivot_measure_row':'_onMeasureRowClick',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.measures=params.measures;this.groupableFields=params.groupableFields;this.title=params.title;this.enableLinking=params.enableLinking;this.views=params.views;this.lastHeaderSelected=null;},start:function(){this.$el.toggleClass('o_enable_linking',this.enableLinking);this.$fieldSelection=this.$('.o_field_selection');core.bus.on('click',this,function(){this.$fieldSelection.empty();});return this._super();},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},getContext:function(){var state=this.model.get();return{pivot_measures:state.measures,pivot_column_groupby:state.colGroupBys,pivot_row_groupby:state.rowGroupBys,};},renderButtons:function($node){if($node){var context={measures:_.pairs(_.omit(this.measures,'__count'))};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this._onButtonClick.bind(this));this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);this._updateButtons();}},_downloadTable:function(){var table=this.model.exportData();if(table.measure_row.length+1>256){crash_manager.show_message(_t("For Excel compatibility, data cannot be exported if there are more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));framework.unblockUI();return;}
framework.blockUI();table.title=this.title;session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager)});},_renderFieldSelection:function(top,left){var state=this.model.get({raw:true});var groupedFields=state.rowGroupBys.concat(state.colGroupBys).map(function(f){return f.split(':')[0];});var fields=_.chain(this.groupableFields).pairs().sortBy(function(f){return f[1].string;}).map(function(f){return[f[0],f[1],_.contains(groupedFields,f[0])];}).value();this.$fieldSelection.html(QWeb.render('PivotView.FieldSelection',{fields:fields}));this.$fieldSelection.find('ul').first().css({top:top,left:left}).show();},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var self=this;var state=this.model.get({raw:true});_.each(this.measures,function(measure,name){var isSelected=_.contains(state.measures,name);self.$buttons.find('li[data-field="'+name+'"]').toggleClass('selected',isSelected);});},_onButtonClick:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_flip_button')){this.model.flip();this.update({},{reload:false});}
if($target.hasClass('o_pivot_expand_button')){this.model.expandAll().then(this.update.bind(this,{},{reload:false}));}
if($target.parents('.o_pivot_measures_list').length){var parent=$target.parent();var field=parent.data('field');event.preventDefault();event.stopPropagation();this.model.toggleMeasure(field).then(this.update.bind(this,{},{reload:false}));}
if($target.hasClass('o_pivot_download')){this._downloadTable();}},_onCellClick:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_header_cell_closed')||$target.hasClass('o_pivot_header_cell_opened')||$target.hasClass('o_empty')||!this.enableLinking){return;}
var state=this.model.get(this.handle);var colDomain=this.model.getHeader($target.data('col_id')).domain;var rowDomain=this.model.getHeader($target.data('id')).domain;var context=_.omit(state.context,function(val,key){return key==='group_by'||_.str.startsWith(key,'search_default_');});this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,view_type:'list',view_mode:'list',target:'current',context:context,domain:state.domain.concat(rowDomain,colDomain),});},_onClosedHeaderClick:function(event){var $target=$(event.target);var id=$target.data('id');var header=this.model.getHeader(id);var groupbys=header.root.groupbys;if(header.path.length-1<groupbys.length){this.model.expandHeader(header,groupbys[header.path.length-1]).then(this.update.bind(this,{},{reload:false}));}else{this.lastHeaderSelected=id;var position=$target.position();var top=position.top+$target.height();var left=position.left+event.offsetX;this._renderFieldSelection(top,left);event.stopPropagation();}},_onFieldMenuSelection:function(event){event.preventDefault();var $target=$(event.target);if($target.parent().hasClass('disabled')){event.stopPropagation();return;}
var field=$target.parent().data('field');var interval=$target.data('interval');var header=this.model.getHeader(this.lastHeaderSelected);if(interval){field=field+':'+interval;}
this.model.expandHeader(header,field).then(this.update.bind(this,{},{reload:false}));},_onMeasureRowClick:function(event){var $target=$(event.target);var col_id=$target.data('id');var measure=$target.data('measure');var isAscending=$target.hasClass('o_pivot_measure_row_sorted_asc');this.model.sortRows(col_id,measure,isAscending);this.update({},{reload:false});},_onOpenHeaderClick:function(event){event.preventDefault();event.stopImmediatePropagation();var headerID=$(event.target).data('id');this.model.closeHeader(headerID);this.update({},{reload:false});},});return PivotController;});;

/* /web/static/src/js/views/pivot/pivot_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var core=require('web.core');var field_utils=require('web.field_utils');var QWeb=core.qweb;var PivotRenderer=AbstractRenderer.extend({tagName:'table',className:'table-hover table-condensed table-bordered',events:_.extend({},AbstractRenderer.prototype.events,{'hover td':'_onTdHover',}),init:function(parent,state,params){this._super.apply(this,arguments);this.fieldWidgets=params.widgets||{};},_hasContent:function(){return this.state.has_data&&this.state.measures.length;},_render:function(){if(!this._hasContent()){this.replaceElement(QWeb.render('PivotView.nodata'));return this._super.apply(this,arguments);}
if(!this.$el.is('table')){this.renderElement();}
var $fragment=$(document.createDocumentFragment());var $table=$('<table>').appendTo($fragment);var $thead=$('<thead>').appendTo($table);var $tbody=$('<tbody>').appendTo($table);var nbr_measures=this.state.measures.length;var nbrCols=(this.state.mainColWidth===1)?nbr_measures:(this.state.mainColWidth+1)*nbr_measures;for(var i=0;i<nbrCols+1;i++){$table.prepend($('<col>'));}
this._renderHeaders($thead,this.state.headers);this._renderRows($tbody,this.state.rows);$table.find('.o_pivot_header_cell_opened,.o_pivot_header_cell_closed').tooltip();this.$el.html($table.contents());return this._super.apply(this,arguments);},_renderHeaders:function($thead,headers){var self=this;var i,j,cell,$row,$cell;var groupbyLabels=_.map(this.state.colGroupBys,function(gb){return self.state.fields[gb.split(':')[0]].string;});for(i=0;i<headers.length;i++){$row=$('<tr>');for(j=0;j<headers[i].length;j++){cell=headers[i][j];$cell=$('<th>').text(cell.title).attr('rowspan',cell.height).attr('colspan',cell.width);if(i>0){$cell.attr('title',groupbyLabels[i-1]);}
if(cell.expanded!==undefined){$cell.addClass(cell.expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');$cell.data('id',cell.id);}
if(cell.measure){$cell.addClass('o_pivot_measure_row text-muted').text(this.state.fields[cell.measure].string);$cell.data('id',cell.id).data('measure',cell.measure);if(cell.id===this.state.sortedColumn.id&&cell.measure===this.state.sortedColumn.measure){$cell.addClass('o_pivot_measure_row_sorted_'+this.state.sortedColumn.order);}}
$row.append($cell);$cell.toggleClass('hidden-xs',(cell.expanded!==undefined)||(cell.measure!==undefined&&j<headers[i].length-this.state.measures.length));if(cell.height>1){$cell.css('padding',0);}}
$thead.append($row);}},_renderRows:function($tbody,rows){var self=this;var i,j,value,measure,name,$row,$cell,$header;var nbrMeasures=this.state.measures.length;var length=rows[0].values.length;var shouldDisplayTotal=this.state.mainColWidth>1;var groupbyLabels=_.map(this.state.rowGroupBys,function(gb){return self.state.fields[gb.split(':')[0]].string;});var measureTypes=this.state.measures.map(function(name){return self.state.fields[name].type;});for(i=0;i<rows.length;i++){$row=$('<tr>');$header=$('<td>').text(rows[i].title).data('id',rows[i].id).css('padding-left',(5+rows[i].indent*30)+'px').addClass(rows[i].expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');if(rows[i].indent>0)$header.attr('title',groupbyLabels[rows[i].indent-1]);$header.appendTo($row);for(j=0;j<length;j++){value=rows[i].values[j];if(value!==undefined){name=this.state.measures[j%nbrMeasures];measure=this.state.fields[name];var formatter=this.fieldWidgets[name]||measureTypes[j%nbrMeasures];value=field_utils.format[formatter](value,measure);}
$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbrMeasures)]).toggleClass('o_empty',!value).text(value).addClass('o_pivot_cell_value text-right');if(((j>=length-this.state.measures.length)&&shouldDisplayTotal)||i===0){$cell.css('font-weight','bold');}
$row.append($cell);$cell.toggleClass('hidden-xs',j<length-nbrMeasures);}
$tbody.append($row);}},_onTdHover:function(event){var $td=$(event.target);$td.closest('table').find('col:eq('+$td.index()+')').toggleClass('hover');}});return PivotRenderer;});;

/* /web/static/src/js/views/pivot/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var PivotModel=require('web.PivotModel');var PivotController=require('web.PivotController');var PivotRenderer=require('web.PivotRenderer');var _t=core._t;var _lt=core._lt;var GROUPABLE_TYPES=['many2one','char','boolean','selection','date','datetime'];var PivotView=AbstractView.extend({display_name:_lt('Pivot'),icon:'fa-table',config:{Model:PivotModel,Controller:PivotController,Renderer:PivotRenderer,},init:function(viewInfo,params){this._super.apply(this,arguments);var arch=viewInfo.arch;var fields=_.extend({__count:{string:_t("Count"),type:"integer"}},viewInfo.fields);var activeMeasures=[];var colGroupBys=[];var rowGroupBys=[];var measures={};var groupableFields={};var widgets={};_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(_.contains(['integer','float','monetary'],field.type)){measures[name]=field;}
if(_.contains(GROUPABLE_TYPES,field.type)){groupableFields[name]=field;}}});measures.__count={string:_t("Count"),type:"integer"};arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.widget){widgets[name]=field.attrs.widget;}
if(field.type==='measure'&&!(field.name in measures)){measures[field.name]=field;}
if(field.attrs.type==='measure'||'operator'in field.attrs){activeMeasures.push(name);}
if(field.attrs.type==='col'){colGroupBys.push(name);}
if(field.attrs.type==='row'){rowGroupBys.push(name);}});if((!activeMeasures.length)||arch.attrs.display_quantity){activeMeasures.push('__count');}
this.loadParams.measures=activeMeasures;this.loadParams.colGroupBys=colGroupBys;this.loadParams.rowGroupBys=rowGroupBys;this.loadParams.fields=fields;this.rendererParams.widgets=widgets;this.controllerParams.title=params.title||arch.attrs.string||_t("Untitled");this.controllerParams.enableLinking=!arch.attrs.disable_linking;this.controllerParams.measures=measures;this.controllerParams.groupableFields=groupableFields;this.controllerParams.views=[_findView(params.action&&params.action.views,'list'),_findView(params.action&&params.action.views,'form'),];function _findView(views,viewType){return _.find(views,function(view){return view[1]===viewType;})||[false,viewType];}},});return PivotView;});;

/* /web/static/src/js/views/calendar/calendar_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarController',function(require){"use strict";var AbstractController=require('web.AbstractController');var QuickCreate=require('web.CalendarQuickCreate');var dialogs=require('web.view_dialogs');var Dialog=require('web.Dialog');var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var CalendarController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{quickCreate:'_onQuickCreate',openCreate:'_onOpenCreate',openEvent:'_onOpenEvent',dropRecord:'_onDropRecord',updateRecord:'_onUpdateRecord',changeDate:'_onChangeDate',changeFilter:'_onChangeFilter',toggleFullWidth:'_onToggleFullWidth',viewUpdated:'_onViewUpdated',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.current_start=null;this.displayName=params.displayName;this.quickAddPop=params.quickAddPop;this.disableQuickCreate=params.disableQuickCreate;this.eventOpenPopup=params.eventOpenPopup;this.formViewId=params.formViewId;this.readonlyFormViewId=params.readonlyFormViewId;this.mapping=params.mapping;this.context=params.context;this.quickCreating=false;},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render("CalendarView.buttons",{'widget':this}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.trigger_up('switch_view',{view_type:'form'});});_.each(['prev','today','next'],function(action){self.$buttons.on('click','.o_calendar_button_'+action,function(){self.model[action]();self.reload();});});_.each(['day','week','month'],function(scale){self.$buttons.on('click','.o_calendar_button_'+scale,function(){self.model.setScale(scale);self.reload();});});this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},_updateRecord:function(record){return this.model.updateRecord(record).then(this.reload.bind(this));},_onChangeDate:function(event){var modelData=this.model.get();if(modelData.target_date.format('YYYY-MM-DD')===event.data.date.format('YYYY-MM-DD')){switch(modelData.scale){case'month':this.model.setScale('week');break;case'week':this.model.setScale('day');break;case'day':this.model.setScale('month');break;}}else if(modelData.target_date.week()===event.data.date.week()){this.model.setScale('day');}else{this.model.setScale('week');}
this.model.setDate(event.data.date);this.reload();},_onChangeFilter:function(event){if(this.model.changeFilter(event.data)&&!event.data.no_reload){this.reload();}},_onDropRecord:function(event){this._updateRecord(event.data);},_onQuickCreate:function(event){var self=this;if(this.quickCreating){return;}
this.quickCreating=true;this.model.createRecord(event).then(function(){self.quick.destroy();self.quick=null;self.reload();}).fail(function(error,errorEvent){errorEvent.preventDefault();event.data.options.disableQuickCreate=true;event.data.data.on_save=self.quick.destroy.bind(self.quick);self._onOpenCreate(event.data);}).always(function(){self.quickCreating=false;});},_onOpenCreate:function(event){var self=this;if(this.model.get().scale==="month"){event.data.allDay=true;}
var data=this.model.calendarEventToRecord(event.data);var context=_.extend({},this.context,event.options&&event.options.context);context.default_name=data.name||null;context['default_'+this.mapping.date_start]=data[this.mapping.date_start]||null;if(this.mapping.date_stop){context['default_'+this.mapping.date_stop]=data[this.mapping.date_stop]||null;}
if(this.mapping.date_delay){context['default_'+this.mapping.date_delay]=data[this.mapping.date_delay]||null;}
if(this.mapping.all_day){context['default_'+this.mapping.all_day]=data[this.mapping.all_day]||null;}
for(var k in context){if(context[k]&&context[k]._isAMomentObject){context[k]=context[k].clone().utc().format('YYYY-MM-DD HH:mm:ss');}}
var options=_.extend({},this.options,event.options,{context:context});if(this.quick!=null){this.quick.destroy();this.quick=null;}
if(!options.disableQuickCreate&&!event.data.disableQuickCreate&&this.quickAddPop){this.quick=new QuickCreate(this,true,options,data,event.data);this.quick.open();this.quick.focus();return;}
var title=_t("Create");if(this.renderer.arch.attrs.string){title+=': '+this.renderer.arch.attrs.string;}
if(this.eventOpenPopup){new dialogs.FormViewDialog(self,{res_model:this.modelName,context:context,title:title,disable_multiple_selection:true,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},}).open();}else{this.do_action({type:'ir.actions.act_window',res_model:this.modelName,views:[[this.formViewId||false,'form']],target:'current',context:context,});}},_onOpenEvent:function(event){var self=this;var id=event.data._id;id=id&&parseInt(id).toString()===id?parseInt(id):id;if(!this.eventOpenPopup){this._rpc({model:self.modelName,method:'get_formview_id',args:[[id],event.context||self.context],}).then(function(viewId){self.do_action({type:'ir.actions.act_window',res_id:id,res_model:self.modelName,views:[[viewId||false,'form']],target:'current',context:event.context||self.context,});});return;}
var open_dialog=function(readonly){var options={res_model:self.modelName,res_id:id||null,context:event.context||self.context,readonly:readonly,title:_t("Open: ")+event.data.title,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},};if(readonly){if(self.readonlyFormViewId){options.view_id=parseInt(self.readonlyFormViewId);}
options.buttons=[{text:_t("Edit"),classes:'btn-primary',close:true,click:function(){open_dialog(false);}},{text:_t("Delete"),click:function(){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:function(){self.model.deleteRecords([id],self.modelName).then(function(){self.dialog.destroy();self.reload();});}});},},{text:_t("Close"),close:true}];}else if(self.formViewId){options.view_id=parseInt(self.formViewId);}
self.dialog=new dialogs.FormViewDialog(self,options).open();};open_dialog(true);},_onToggleFullWidth:function(){this.model.toggleFullWidth();this.reload();},_onUpdateRecord:function(event){this._updateRecord(event.data);},_onViewUpdated:function(event){this.mode=event.data.mode;if(this.$buttons){this.$buttons.find('.active').removeClass('active');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');}
var subtitle=(this.mode==='week'?_t('Week '):'')+event.data.title;this.set({title:this.displayName+' ('+subtitle+')'});},});return CalendarController;});;

/* /web/static/src/js/views/calendar/calendar_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var Context=require('web.Context');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var time=require('web.time');var _t=core._t;var scales=['day','week','month'];function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.end_date=null;},calendarEventToRecord:function(event){var data={'name':event.title};var start=event.start.clone();var end=event.end&&event.end.clone();if(event.allDay||(end&&end.diff(start)%86400000===0)){event.allDay=true;}
if(!end||end.diff(start)<0){if(event.allDay){end=start.clone();}else{end=start.clone().add(2,'h');}}else if(event.allDay){end.add(-1,'days');}
if(event.allDay){if(!this.mapping.all_day){if(event.r_start){start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).utc();end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).utc();}else{start.hours(7).add(-this.getSession().getTZOffset(start),'minutes');end.hours(19).add(-this.getSession().getTZOffset(end),'minutes');}}}else{start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}
if(this.mapping.all_day){if(event.record){data[this.mapping.all_day]=(this.scale!=='month'&&event.allDay)||event.record[this.mapping.all_day]&&end.diff(start)<10||false;}else{data[this.mapping.all_day]=event.allDay;}}
data[this.mapping.date_start]=start;if(this.mapping.date_stop){data[this.mapping.date_stop]=end;}
if(this.mapping.date_delay){data[this.mapping.date_delay]=(end.diff(start)<=0?end.endOf('day').diff(start):end.diff(start))/1000/3600;}
return data;},changeFilter:function(filter){var Filter=this.data.filters[filter.fieldName];if(filter.value==='all'){Filter.all=filter.active;}
var f=_.find(Filter.filters,function(f){return f.value===filter.value;});if(f){if(f.active!==filter.active){f.active=filter.active;}else{return false;}}else if(filter.active){Filter.filters.push({value:filter.value,active:true,});}
return true;},createRecord:function(event){var data=this.calendarEventToRecord(event.data.data);for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
return this._rpc({model:this.modelName,method:'create',args:[data],context:event.data.options.context,});},deleteRecords:function(ids,model){return this._rpc({model:model,method:'unlink',args:[ids],context:session.user_context,});},get:function(){return _.extend({},this.data,{fields:this.fields});},load:function(params){var self=this;this.modelName=params.modelName;this.fields=params.fields;this.fieldNames=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.mapping=params.mapping;this.mode=params.mode;this.scales=params.scales;this.editable=params.editable;this.creatable=params.creatable;this.eventLimit=params.eventLimit;this.fieldColor=params.fieldColor;if(!this.preload_def){this.preload_def=$.Deferred();$.when(this._rpc({model:this.modelName,method:'check_access_rights',args:["write",false]}),this._rpc({model:this.modelName,method:'check_access_rights',args:["create",false]})).then(function(write,create){self.write_right=write;self.create_right=create;self.preload_def.resolve();});}
this.data={domain:params.domain,context:params.context,filters:params.filters,};this.setDate(params.initialDate);this.setScale(params.mode);_.each(this.data.filters,function(filter){if(filter.avatar_field&&!filter.avatar_model){filter.avatar_model=self.modelName;}});return this.preload_def.then(this._loadCalendar.bind(this));},next:function(){this.setDate(this.data.target_date.clone().add(1,this.data.scale));},prev:function(){this.setDate(this.data.target_date.clone().add(-1,this.data.scale));},reload:function(_handle,params){if(params.domain){this.data.domain=params.domain;}
return this._loadCalendar();},setDate:function(start){this.data.highlight_date=this.data.target_date=start.clone();this.data.start_date=this.data.end_date=start;this.data.start_date.utc().add(this.getSession().getTZOffset(this.data.start_date),'minutes');switch(this.data.scale){case'month':this.data.start_date=this.data.start_date.clone().startOf('month').startOf('week');this.data.end_date=this.data.start_date.clone().add(5,'week').endOf('week');break;case'week':this.data.start_date=this.data.start_date.clone().startOf('week');this.data.end_date=this.data.end_date.clone().endOf('week');break;default:this.data.start_date=this.data.start_date.clone().startOf('day');this.data.end_date=this.data.end_date.clone().endOf('day');}},setScale:function(scale){if(!_.contains(scales,scale)){scale="week";}
this.data.scale=scale;this.setDate(this.data.target_date);},today:function(){this.setDate(moment(new Date()));},toggleFullWidth:function(){var fullWidth=this.call('local_storage','getItem','calendar_fullWidth')!=='true';this.call('local_storage','setItem','calendar_fullWidth',fullWidth);},updateRecord:function(record){var data=_.omit(this.calendarEventToRecord(record),'name');for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
var context=new Context(this.data.context,{from_ui:true});return this._rpc({model:this.modelName,method:'write',args:[[record.id],data],context:context});},_getFilterDomain:function(){var authorizedValues={};var avoidValues={};_.each(this.data.filters,function(filter){if(filter.all)return;_.each(filter.filters,function(f){if(filter.write_model){if(!authorizedValues[filter.fieldName])
authorizedValues[filter.fieldName]=[];if(f.active){authorizedValues[filter.fieldName].push(f.value);}}else{if(!avoidValues[filter.fieldName])
avoidValues[filter.fieldName]=[];if(!f.active){avoidValues[filter.fieldName].push(f.value);}}});});var domain=[];for(var field in authorizedValues){domain.push([field,'in',authorizedValues[field]]);}
for(var field in avoidValues){domain.push([field,'not in',avoidValues[field]]);}
return domain;},_getFullCalendarOptions:function(){return{defaultView:(this.mode==="month")?"month":((this.mode==="week")?"agendaWeek":((this.mode==="day")?"agendaDay":"agendaWeek")),header:false,selectable:this.creatable&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,navLinks:false,eventLimit:this.eventLimit,snapMinutes:15,longPressDelay:500,eventResizableFromStart:true,weekNumbers:true,weekNumberTitle:_t("W"),allDayText:_t("All day"),views:{week:{columnFormat:'ddd '+time.getLangDateFormat(),titleFormat:time.getLangTimeFormat(),}},monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:moment()._locale._week.dow,slotLabelFormat:_t.database.parameters.time_format.search("%H")!=-1?'H:mm':'h(:mm)a',};},_getRangeDomain:function(){var domain=[[this.mapping.date_start,'<=',dateToServer(this.data.end_date)]];if(this.mapping.date_stop){domain.push([this.mapping.date_stop,'>=',dateToServer(this.data.start_date)]);}else if(!this.mapping.date_delay){domain.push([this.mapping.date_start,'>=',dateToServer(this.data.start_date)]);}
return domain;},_loadCalendar:function(){var self=this;this.data.fullWidth=this.call('local_storage','getItem','calendar_fullWidth')==='true';this.data.fc_options=this._getFullCalendarOptions();var defs=_.map(this.data.filters,this._loadFilter.bind(this));return $.when.apply($,defs).then(function(){return self._rpc({model:self.modelName,method:'search_read',context:self.data.context,fields:self.fieldNames,domain:self.data.domain.concat(self._getRangeDomain()).concat(self._getFilterDomain())}).then(function(events){self._parseServerData(events);self.data.data=_.map(events,self._recordToCalendarEvent.bind(self));return $.when(self._loadColors(self.data,self.data.data),self._loadRecordsToFilters(self.data,self.data.data));});});},_loadColors:function(element,events){if(this.fieldColor){var fieldName=this.fieldColor;_.each(events,function(event){var value=event.record[fieldName];event.color_index=_.isArray(value)?value[0]:value;});this.model_color=this.fields[fieldName].relation||element.model;}
return $.Deferred().resolve();},_loadFilter:function(filter){if(!filter.write_model){return;}
var field=this.fields[filter.fieldName];return this._rpc({model:filter.write_model,method:'search_read',domain:[["user_id","=",session.uid]],fields:[filter.write_field],}).then(function(res){var records=_.map(res,function(record){var _value=record[filter.write_field];var value=_.isArray(_value)?_value[0]:_value;var f=_.find(filter.filters,function(f){return f.value===value;});var formater=fieldUtils.format[_.contains(['many2many','one2many'],field.type)?'many2one':field.type];return{'id':record.id,'value':value,'label':formater(_value,field),'active':!f||f.active,};});records.sort(function(f1,f2){return _.string.naturalCmp(f2.label,f1.label);});if(field.relation==='res.partner'||field.relation==='res.users'){var value=field.relation==='res.partner'?session.partner_id:session.uid;var me=_.find(records,function(record){return record.value===value;});if(me){records.splice(records.indexOf(me),1);}else{var f=_.find(filter.filters,function(f){return f.value===value;});me={'value':value,'label':session.name+_t(" [Me]"),'active':!f||f.active,};}
records.unshift(me);}
records.push({'value':'all','label':field.relation==='res.partner'||field.relation==='res.users'?_t("Everybody's calendars"):_t("Everything"),'active':filter.all,});filter.filters=records;});},_loadRecordsToFilters:function(element,events){var self=this;var new_filters={};var to_read={};_.each(this.data.filters,function(filter,fieldName){var field=self.fields[fieldName];new_filters[fieldName]=filter;if(filter.write_model){if(field.relation===self.model_color){_.each(filter.filters,function(f){f.color_index=f.value;});}
return;}
_.each(filter.filters,function(filter){filter.display=!filter.active;});var fs=[];var undefined_fs=[];_.each(events,function(event){var data=event.record[fieldName];if(!_.contains(['many2many','one2many'],field.type)){data=[data];}else{to_read[field.relation]=(to_read[field.relation]||[]).concat(data);}
_.each(data,function(_value){var value=_.isArray(_value)?_value[0]:_value;var f={'color_index':self.model_color===(field.relation||element.model)?value:false,'value':value,'label':fieldUtils.format[field.type](_value,field)||_t("Undefined"),'avatar_model':field.relation||element.model,};value?fs.push(f):undefined_fs.push(f);});});_.each(_.union(fs,undefined_fs),function(f){var f1=_.findWhere(filter.filters,f);if(f1){f1.display=true;}else{f.display=f.active=true;filter.filters.push(f);}});});var defs=[];_.each(to_read,function(ids,model){defs.push(self._rpc({model:model,method:'name_get',args:[_.uniq(ids)],}).then(function(res){to_read[model]=_.object(res);}));});return $.when.apply($,defs).then(function(){_.each(self.data.filters,function(filter){if(filter.write_model){return;}
if(filter.filters.length&&(filter.filters[0].avatar_model in to_read)){_.each(filter.filters,function(f){f.label=to_read[f.avatar_model][f.value];});}});});},_parseServerData:function(data){var self=this;_.each(data,function(event){_.each(self.fieldNames,function(fieldName){event[fieldName]=self._parseServerValue(self.fields[fieldName],event[fieldName]);});});},_recordToCalendarEvent:function(evt){var date_start;var date_stop;var date_delay=evt[this.mapping.date_delay]||1.0,all_day=this.fields[this.mapping.date_start].type==='date'||this.mapping.all_day&&evt[this.mapping.all_day]||false,the_title='',attendees=[];if(!all_day){date_start=evt[this.mapping.date_start].clone();date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone():null;}else{date_start=evt[this.mapping.date_start].clone().startOf('day');date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone().startOf('day'):null;}
if(!date_stop&&date_delay){date_stop=date_start.clone().add(date_delay,'hours');}
if(!all_day){date_start.add(this.getSession().getTZOffset(date_start),'minutes');date_stop.add(this.getSession().getTZOffset(date_stop),'minutes');}
if(this.mapping.all_day&&evt[this.mapping.all_day]){date_stop.add(1,'days');}
var r={'record':evt,'start':date_start,'end':date_stop,'r_start':date_start,'r_end':date_stop,'title':the_title,'allDay':all_day,'id':evt.id,'attendees':attendees,};if(this.mapping.all_day&&evt[this.mapping.all_day]){}else if(this.data.scale==='month'&&this.fields[this.mapping.date_start].type!=='date'){date_stop.add(1,'days');r.reset_allday=r.allDay;r.allDay=true;r.start=date_start.format('YYYY-MM-DD');r.end=date_stop.startOf('day').format('YYYY-MM-DD');}
return r;},});});;

/* /web/static/src/js/views/calendar/calendar_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarQuickCreate',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({events:_.extend({},Dialog.events,{'keyup input':'_onkeyup',}),init:function(parent,buttons,options,dataTemplate,dataCalendar){this._buttons=buttons||false;this.options=options;this.dataTemplate=dataTemplate||{};this.dataCalendar=dataCalendar;var self=this;this._super(parent,{title:this._getTitle(),size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self._quickAdd(dataCalendar)){self.focus();}}},{text:_t("Edit"),click:function(){dataCalendar.disableQuickCreate=true;dataCalendar.title=self.$('input').val().trim();dataCalendar.on_save=self.destroy.bind(self);self.trigger_up('openCreate',dataCalendar);}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widget:this})});},focus:function(){this.$('input').focus();},_getTitle:function(){var parent=this.getParent();if(_.isUndefined(parent)){return _t("Create");}
var title=(_.isUndefined(parent.field_widget))?(parent.title||parent.string||parent.name):(parent.field_widget.string||parent.field_widget.name||'');return _t("Create: ")+title;},_quickAdd:function(dataCalendar){dataCalendar=$.extend({},this.dataTemplate,dataCalendar);var val=this.$('input').val().trim();dataCalendar.title=val;return(val)?this.trigger_up('quickCreate',{data:dataCalendar,options:this.options}):false;},_onkeyup:function(event){if(this._flagEnter){return;}
if(event.keyCode===$.ui.keyCode.ENTER){this._flagEnter=true;if(!this._quickAdd(this.dataCalendar)){this._flagEnter=false;}}else if(event.keyCode===$.ui.keyCode.ESCAPE&&this._buttons){this.close();}},});return QuickCreate;});;

/* /web/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var relational_fields=require('web.relational_fields');var FieldManagerMixin=require('web.FieldManagerMixin');var field_utils=require('web.field_utils');var session=require('web.session');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var utils=require('web.utils');var core=require('web.core');var QWeb=require('web.QWeb');var _t=core._t;var qweb=core.qweb;var scales={day:'agendaDay',week:'agendaWeek',month:'month'};var SidebarFilterM2O=relational_fields.FieldMany2One.extend({_getSearchBlacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids||[]);},});var SidebarFilter=Widget.extend(FieldManagerMixin,{template:'CalendarView.sidebar.filter',custom_events:_.extend({},FieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),init:function(parent,options){this._super.apply(this,arguments);FieldManagerMixin.init.call(this);this.title=options.title;this.fields=options.fields;this.fieldName=options.fieldName;this.write_model=options.write_model;this.write_field=options.write_field;this.avatar_field=options.avatar_field;this.avatar_model=options.avatar_model;this.filters=options.filters;this.label=options.label;this.getColor=options.getColor;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.write_model||this.write_field){var def=this.model.makeRecord(this.write_model,[{name:this.write_field,relation:this.fields[this.fieldName].relation,type:'many2one',}]).then(function(recordID){self.many2one=new SidebarFilterM2O(self,self.write_field,self.model.get(recordID),{mode:'edit',can_create:false,});});defs.push(def);}
return $.when.apply($,defs);},start:function(){this._super();if(this.many2one){this.many2one.appendTo(this.$el);this.many2one.filter_ids=_.without(_.pluck(this.filters,'value'),'all');}
this.$el.on('click','.o_remove',this._onFilterRemove.bind(this));this.$el.on('click','.o_checkbox input',this._onFilterActive.bind(this));},_onFieldChanged:function(event){var self=this;event.stopPropagation();var value=event.data.changes[this.write_field].id;this._rpc({model:this.write_model,method:'create',args:[{'user_id':session.uid,'partner_id':value,}],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'value':value,'active':true,});});},_onFilterActive:function(e){var $input=$(e.currentTarget);this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':$input.closest('.o_calendar_filter_item').data('value'),'active':$input.prop('checked'),});},_onFilterRemove:function(e){var self=this;var $filter=$(e.currentTarget).closest('.o_calendar_filter_item');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self._rpc({model:self.write_model,method:'unlink',args:[[$filter.data('id')]],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'id':$filter.data('id'),'active':false,'value':$filter.data('value'),});});},});},});return AbstractRenderer.extend({template:"CalendarView",events:_.extend({},AbstractRenderer.prototype.events,{'click .o_calendar_sidebar_toggler':'_onToggleSidebar',}),init:function(parent,state,params){this._super.apply(this,arguments);this.displayFields=params.displayFields;this.model=params.model;this.filters=[];this.color_map={};if(params.eventTemplate){this.qweb=new QWeb(session.debug,{_s:session.origin});this.qweb.add_template(utils.json_node_to_xml(params.eventTemplate));}},start:function(){this._initSidebar();this._initCalendar();return this._super();},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');$('#ui-datepicker-div:empty').remove();}
this._super.apply(this,arguments);},getAvatars:function(record,fieldName,imageField){var field=this.state.fields[fieldName];if(!record[fieldName]){return[];}
if(field.type==='one2many'||field.type==='many2many'){return _.map(record[fieldName],function(id){return'<img src="/web/image/'+field.relation+'/'+id+'/'+imageField+'" />';});}else if(field.type==='many2one'){return['<img src="/web/image/'+field.relation+'/'+record[fieldName][0]+'/'+imageField+'" />'];}else{var value=this._format(record,fieldName);var color=this.getColor(value);if(isNaN(color)){return['<span class="o_avatar_square" style="background-color:'+color+';"/>'];}
else{return['<span class="o_avatar_square o_calendar_color_'+color+'"/>'];}}},getColor:function(key){if(!key){return;}
if(this.color_map[key]){return this.color_map[key];}
if(typeof key==='string'&&key.match(/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i)){return this.color_map[key]=key;}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},getLocalState:function(){var $fcScroller=this.$calendar.find('.fc-scroller');return{scrollPosition:$fcScroller.scrollTop(),};},setLocalState:function(localState){if(localState.scrollPosition){var $fcScroller=this.$calendar.find('.fc-scroller');$fcScroller.scrollTop(localState.scrollPosition);}},_eventRender:function(event){var qweb_context={event:event,record:event.record,widget:this,read_only_mode:this.read_only_mode,user_context:session.user_context,format:this._format.bind(this),fields:this.state.fields};this.qweb_context=qweb_context;if(_.isEmpty(qweb_context.record)){return'';}else{return(this.qweb||qweb).render("calendar-box",qweb_context);}},_format:function(record,fieldName){var field=this.state.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){return field_utils.format[field.type]({data:record[fieldName]},field);}else{return field_utils.format[field.type](record[fieldName],field,{forceString:true});}},_initCalendar:function(){var self=this;this.$calendar=this.$(".o_calendar_widget");var fc_options=$.extend({},this.state.fc_options,{eventDrop:function(event){self.trigger_up('dropRecord',event);},eventResize:function(event){self.trigger_up('updateRecord',event);},eventClick:function(event){self.trigger_up('openEvent',event);self.$calendar.fullCalendar('unselect');},select:function(target_date,end_date,event,_js_event,_view){var data={'start':target_date,'end':end_date};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',data);self.$calendar.fullCalendar('unselect');},eventRender:function(event,element){var $render=$(self._eventRender(event));event.title=$render.find('.o_field_type_char:first').text();element.find('.fc-content').html($render.html());element.addClass($render.attr('class'));var display_hour='';if(!event.allDay){var start=event.r_start||event.start;var end=event.r_end||event.end;var timeFormat=_t.database.parameters.time_format.search("%H")!=-1?'HH:mm':'h:mma';display_hour=start.format(timeFormat)+' - '+end.format(timeFormat);if(display_hour==='00:00 - 00:00'){display_hour=_t('All day');}}
element.find('.fc-content .fc-time').text(display_hour);},eventAfterAllRender:function(){$(window).trigger('resize');},viewRender:function(view){var mode=view.name==='month'?'month':(view.name==='agendaWeek'?'week':'day');var title=mode==='week'?view.intervalStart.week():view.title;self.trigger_up('viewUpdated',{mode:mode,title:title,});},height:'parent',unselectAuto:false,});this.$calendar.fullCalendar(fc_options);},_initCalendarMini:function(){var self=this;this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({'onSelect':function(datum,obj){self.trigger_up('changeDate',{date:moment(new Date(+obj.currentYear,+obj.currentMonth,+obj.currentDay))});},'dayNamesMin':this.state.fc_options.dayNamesShort,'monthNames':this.state.fc_options.monthNamesShort,'firstDay':this.state.fc_options.firstDay,});},_initSidebar:function(){this.$sidebar=this.$('.o_calendar_sidebar');this.$sidebar_container=this.$(".o_calendar_sidebar_container");this._initCalendarMini();},_render:function(){var $calendar=this.$calendar;var $fc_view=$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();var scrollTop=this.$calendar.find('.fc-scroller').scrollTop();$fc_view.scrollLeft(0);$calendar.fullCalendar('unselect');if(scales[this.state.scale]!==$calendar.data('fullCalendar').getView().type){$calendar.fullCalendar('changeView',scales[this.state.scale]);}
if(this.target_date!==this.state.target_date.toString()){$calendar.fullCalendar('gotoDate',moment(this.state.target_date));this.target_date=this.state.target_date.toString();}
this.$small_calendar.datepicker("setDate",this.state.highlight_date.toDate()).find('.o_selected_range').removeClass('o_color o_selected_range');var $a;switch(this.state.scale){case'month':$a=this.$small_calendar.find('td a');break;case'week':$a=this.$small_calendar.find('tr:has(.ui-state-active) a');break;case'day':$a=this.$small_calendar.find('a.ui-state-active');break;}
$a.addClass('o_selected_range');setTimeout(function(){$a.not('.ui-state-active').addClass('o_color');});$fc_view.scrollLeft(scrollPosition);var fullWidth=this.state.fullWidth;this.$('.o_calendar_sidebar_toggler').toggleClass('fa-close',!fullWidth).toggleClass('fa-chevron-left',fullWidth).attr('title',!fullWidth?_('Close Sidebar'):_('Open Sidebar'));this.$sidebar_container.toggleClass('o_sidebar_hidden',fullWidth);this.$sidebar.toggleClass('o_hidden',fullWidth);this._renderFilters();this.$calendar.appendTo('body');if(scrollTop){this.$calendar.fullCalendar('reinitView');}else{this.$calendar.fullCalendar('render');}
this._renderEvents();this.$calendar.prependTo(this.$('.o_calendar_view'));return this._super.apply(this,arguments);},_renderEvents:function(){this.$calendar.fullCalendar('removeEvents');this.$calendar.fullCalendar('addEventSource',this.state.data);},_renderFilters:function(){var self=this;_.each(this.filters||(this.filters=[]),function(filter){filter.destroy();});if(this.state.fullWidth){return;}
_.each(this.state.filters,function(options){if(!_.find(options.filters,function(f){return f.display==null||f.display;})){return;}
options.getColor=self.getColor.bind(self);options.fields=self.state.fields;var filter=new SidebarFilter(self,options);filter.appendTo(self.$sidebar);self.filters.push(filter);});},_onToggleSidebar:function(){this.trigger_up('toggleFullWidth');},});});;

/* /web/static/src/js/views/calendar/calendar_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarView',function(require){"use strict";var AbstractView=require('web.AbstractView');var CalendarModel=require('web.CalendarModel');var CalendarController=require('web.CalendarController');var CalendarRenderer=require('web.CalendarRenderer');var core=require('web.core');var utils=require('web.utils');var _lt=core._lt;var fieldsToGather=["date_start","date_delay","date_stop","all_day",];var CalendarView=AbstractView.extend({display_name:_lt('Calendar'),icon:'fa-calendar',jsLibs:['/web/static/lib/fullcalendar/js/fullcalendar.js'],cssLibs:['/web/static/lib/fullcalendar/css/fullcalendar.css'],config:{Model:CalendarModel,Controller:CalendarController,Renderer:CalendarRenderer,},init:function(viewInfo,params){this._super.apply(this,arguments);var arch=viewInfo.arch;var fields=viewInfo.fields;var attrs=arch.attrs;if(!attrs.date_start){throw new Error(_lt("Calendar view has not defined 'date_start' attribute."));}
var mapping={};var fieldNames=fields.display_name?['display_name']:[];var displayFields={};_.each(fieldsToGather,function(field){if(arch.attrs[field]){var fieldName=attrs[field];mapping[field]=fieldName;fieldNames.push(fieldName);}});var filters={};var eventLimit=attrs.event_limit!==null&&(isNaN(+attrs.event_limit)?_.str.toBool(attrs.event_limit):+attrs.event_limit);var modelFilters=[];_.each(arch.children,function(child){if(child.tag!=='field')return;var fieldName=child.attrs.name;fieldNames.push(fieldName);if(!child.attrs.invisible){displayFields[fieldName]=child.attrs;if(params.sidebar===false)return;if(child.attrs.avatar_field){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].avatar_field=child.attrs.avatar_field;filters[fieldName].avatar_model=fields[fieldName].relation;}
if(child.attrs.write_model){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].write_model=child.attrs.write_model;filters[fieldName].write_field=child.attrs.write_field;modelFilters.push(fields[fieldName].relation);}}});if(attrs.color){var fieldName=attrs.color;fieldNames.push(fieldName);filters[fieldName]={'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};if(fields[fieldName].relation){if(['res.users','res.partner'].indexOf(fields[fieldName].relation)!==-1){filters[fieldName].avatar_field='image_small';}
filters[fieldName].avatar_model=fields[fieldName].relation;}}
if(_.isEmpty(displayFields)){displayFields=fields.display_name?{'display_name':{}}:[];}
this.controllerParams.quickAddPop=(!('quick_add'in attrs)||utils.toBoolElse(attrs.quick_add+'',true));this.controllerParams.disableQuickCreate=params.disable_quick_create||!this.controllerParams.quickAddPop;this.controllerParams.formViewId=attrs.form_view_id?parseInt(attrs.form_view_id,10):false;if(!this.controllerParams.formViewId&&params.action){var formViewDescr=_.find(params.action.views,function(v){return v[1]==='form';});if(formViewDescr){this.controllerParams.formViewId=formViewDescr[0];}}
this.controllerParams.readonlyFormViewId=!attrs.readonly_form_view_id||!utils.toBoolElse(attrs.readonly_form_view_id,true)?false:attrs.readonly_form_view_id;this.controllerParams.eventOpenPopup=utils.toBoolElse(attrs.event_open_popup||'',false);this.controllerParams.mapping=mapping;this.controllerParams.context=params.context||{};this.controllerParams.displayName=params.action&&params.action.name;this.rendererParams.displayFields=displayFields;this.rendererParams.eventTemplate=_.findWhere(arch.children,{'tag':'templates'});this.rendererParams.model=viewInfo.model;this.loadParams.fieldNames=_.uniq(fieldNames);this.loadParams.mapping=mapping;this.loadParams.fields=fields;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.editable=!fields[mapping.date_start].readonly;this.loadParams.creatable=true;this.loadParams.eventLimit=eventLimit;this.loadParams.fieldColor=attrs.color;this.loadParams.filters=filters;this.loadParams.mode=attrs.mode;this.loadParams.initialDate=moment(params.initialDate||new Date());},});return CalendarView;});;

/* /web/static/src/js/report/qwebactionmanager.js defined in bundle 'web.assets_backend' */
odoo.define('report.report',function(require){'use strict';var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var _t=core._t;var _lt=core._lt;var wkhtmltopdf_state;var WKHTMLTOPDF_MESSAGES={'install':_lt('Unable to find Wkhtmltopdf on this \nsystem. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">\nwkhtmltopdf.org</a>'),'workers':_lt('You need to start OpenERP with at least two \nworkers to print a pdf version of the reports.'),'upgrade':_lt('You should upgrade your version of\nWkhtmltopdf to at least 0.12.0 in order to get a correct display of headers and footers as well as\nsupport for table-breaking between pages.<br><br><a href="http://wkhtmltopdf.org/" \ntarget="_blank">wkhtmltopdf.org</a>'),'broken':_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>')};var trigger_download=function(session,response,c,action,options){return session.get_file({url:'/report/download',data:{data:JSON.stringify(response)},complete:framework.unblockUI,error:c.rpc_error.bind(c),success:function(){if(action&&options&&!action.dialog){options.on_close();}},});};var make_report_url=function(action){var report_urls={'qweb-html':'/report/html/'+action.report_name,'qweb-pdf':'/report/pdf/'+action.report_name,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var active_ids_path='/'+action.context.active_ids.join(',');report_urls=_.mapObject(report_urls,function(value,key){return value+=active_ids_path;});}}else{var serialized_options_path='?options='+encodeURIComponent(JSON.stringify(action.data));serialized_options_path+='&context='+encodeURIComponent(JSON.stringify(action.context));report_urls=_.mapObject(report_urls,function(value,key){return value+=serialized_options_path;});}
return report_urls;};ActionManager.include({ir_actions_report:function(action,options){var self=this;action=_.clone(action);var report_urls=make_report_url(action);if(action.report_type==='qweb-html'){var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});return this.do_action('report.client_action',client_action_options);}else if(action.report_type==='qweb-pdf'){framework.blockUI();(wkhtmltopdf_state=wkhtmltopdf_state||this._rpc({route:'/report/check_wkhtmltopdf'})).then(function(state){if(WKHTMLTOPDF_MESSAGES[state]){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){var response;var c=crash_manager;var treated_actions=[];var current_action=action;do{report_urls=make_report_url(current_action);response=[report_urls['qweb-pdf'],action.report_type,];var success=trigger_download(self.getSession(),response,c,current_action,options);if(!success){self.do_warn(_t('Warning'),_t('A popup window with your report was blocked.  You may need to change your browser settings to allow popup windows for this page.'),true);}
treated_actions.push(current_action);current_action=current_action.next_report_to_generate;}while(current_action&&!_.contains(treated_actions,current_action));return;}else{var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});framework.unblockUI();return self.do_action('report.client_action',client_action_options);}});}else{self.do_warn(_t('Error'),_t('Non qweb reports are not anymore supported.'),true);return;}}});});;

/* /web/static/src/js/report/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /web/static/src/js/report/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var core=require('web.core');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var Widget=require('web.Widget');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report.editor:save_ok','report.editor:discard_ok','report:do_action',];var ReportAction=Widget.extend(ControlPanelMixin,{template:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this.title=options.display_name||options.name;this.edit_mode_available=false;this.in_edit_mode=false;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.set('title',this.title);this.iframe=this.$('iframe')[0];return $.when(this._super.apply(this,arguments),session.is_bound).then(function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));self.$buttons.on('click','.o_report_edit',self.on_click_edit);self.$buttons.on('click','.o_report_print',self.on_click_print);self.$buttons.on('click','.o_report_save',self.on_click_save);self.$buttons.on('click','.o_report_discard',self.on_click_discard);self._update_control_panel();self.iframe.src=self.report_url;self.iframe.onload=function(){self._on_iframe_loaded();};});},do_show:function(){this._update_control_panel();return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);},on_detach_callback:function(){$(window).off('message',this.on_message_received);},_on_iframe_loaded:function(){var editable=$(this.iframe).contents().find('html').data('editable');if(editable===1){this.edit_mode_available=true;this._update_control_panel();}},_update_control_panel:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,},});this._update_control_panel_buttons();},_update_control_panel_buttons:function(){this.$buttons.filter('div.o_report_edit_mode').toggle(this.in_edit_mode);this.$buttons.filter('div.o_report_no_edit_mode').toggle(!this.in_edit_mode);this.$buttons.filter('div.o_edit_mode_available').toggle(core.debug&&this.edit_mode_available&&!this.in_edit_mode);},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report.editor:save_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report.editor:discard_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_edit:function(){if(this.report_url.indexOf('?')===-1){this.iframe.src=this.report_url+'?enable_editor=1';}else{this.iframe.src=this.report_url+'&enable_editor=1';}
this.in_edit_mode=true;this._update_control_panel_buttons();},on_click_discard:function(){this._post_message('report.editor:ask_discard');},on_click_save:function(){this._post_message('report.editor:ask_save');},on_click_print:function(){var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import_action.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var session=require('web.session');var time=require('web.time');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
var DataImport=Widget.extend(ControlPanelMixin,{template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],parse_opts:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.session=session;action.display_name=_t('Import a File');this.do_not_change_match=false;},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();return $.when(this._super(),self.create_model().done(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.renderButtons();var status={breadcrumbs:self.action_manager.get_breadcrumbs(),cp_content:{$buttons:self.$buttons},};self.update_control_panel(status);}));},create_model:function(){return this._rpc({model:'base_import.import',method:'create',args:[{res_model:this.res_model}],kwargs:{context:session.user_context},});},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},setup_float_format_picker:function(){var sug_query=function(q){var suggestions=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});};this.$('input.oe_import_float_thousand_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});this.$('input.oe_import_float_decimal_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Dot")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts).each(function(opt){if(opt.name==='date_format'||opt.name==='datetime_format'){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());}
else{options[opt.name]=self.$('input.oe_import_'+opt.name).val();}});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;return options;},onfile_loaded:function(){var file=this.$('.oe_import_file')[0].files[0];this.$('.oe_import_file_show').val(file!==undefined&&file.name||'');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').val('');this.$('.oe_import_datetime_format').val('');this.$el.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$el.find('.oe_import_toggle').toggle(import_toggle);jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this._rpc({model:'base_import.import',method:'parse_preview',args:[this.id,this.import_options()],kwargs:{context:session.user_context},}).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.o_import_import').removeClass('btn-primary');this.$buttons.filter('.o_import_validate').addClass('btn-primary');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
this.$('.oe_import_date_format').val(time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_float_thousand_separator').val(result.options.float_thousand_separator).change();this.$('.oe_import_float_decimal_separator').val(result.options.float_decimal_separator).change();if(result.debug===false){this.$('.oe_import_tracking').hide();this.$('.oe_import_deferparentstore').hide();}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'});});},generate_fields_completion:function(root,index){var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
var defer_parent_store='defer_parent_store'in kwargs?kwargs.defer_parent_store:!!this.$('#oe_import_deferparentstore').prop('checked')
delete kwargs.tracking_disable;delete kwargs.defer_parent_store;kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable,defer_parent_store_computation:defer_parent_store});return this._rpc({model:'base_import.import',method:'do',args:[this.id,fields,this.import_options()],kwargs:kwargs,}).fail(function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.arguments&&error.data.arguments[1]||error.message,}]);});},onvalidate:function(){return this.call_import({dryrun:true,tracking_disable:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$buttons.filter('.o_import_import').toggleClass('btn-primary',no_messages);this.$buttons.filter('.o_import_import').toggleClass('btn-default',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-primary',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-default',no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('');},}));},});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]});return{DataImport:DataImport,};});;

/* /base_import/static/src/js/import_buttons.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import_buttons',function(require){"use strict";var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var ListController=require('web.ListController');var ListView=require('web.ListView');var ImportViewMixin={init:function(viewInfo,params){var importEnabled='import_enabled'in params?params.import_enabled:true;this.controllerParams.importEnabled=importEnabled;},};var ImportControllerMixin={init:function(parent,model,renderer,params){this.importEnabled=params.importEnabled;},_bindImport:function(){if(!this.$buttons){return;}
var self=this;this.$buttons.on('click','.o_button_import',function(){var state=self.model.get(self.handle,{raw:true});self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.modelName,context:state.getContext(),}},{on_reverse_breadcrumb:self.reload.bind(self),});});}};ListView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});ListController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});KanbanView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});KanbanController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});});;

/* /iap/static/src/js/iap_credit.js defined in bundle 'web.assets_backend' */
odoo.define('iap.redirect_odoo_credit_widget',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Widget=require('web.Widget');var QWeb=core.qweb;var IapOdooCreditRedirect=Widget.extend({template:'iap.redirect_to_odoo_credit',events:{"click .redirect_confirm":"odoo_redirect",},init:function(parent,action){this._super(parent,action);this.url=action.params.url;},odoo_redirect:function(){window.open(this.url,'_blank');this.do_action({type:'ir.actions.act_window_close'});},});core.action_registry.add('iap_odoo_credit_redirect',IapOdooCreditRedirect);});;

/* /iap/static/src/js/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('iap.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var CrashManager=require('web.CrashManager');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;CrashManager.include({rpc_error:function(error){if(error.data.name==="odoo.addons.iap.models.iap.InsufficientCreditError"){var error_data=JSON.parse(error.data.message);ajax.jsonRpc('call_kw','call',{model:'iap.account',method:'get_credits_url',args:[],kwargs:{base_url:error_data.base_url,service_name:error_data.service_name,credit:error_data.credit,}}).then(function(url){var content=$(QWeb.render('iap.redirect_to_odoo_credit',{data:error_data,}))
if(error_data.body){content.css('padding',0);}
new Dialog(this,{size:'large',title:error_data.title||_t("Insufficient Balance"),$content:content,buttons:[{text:_t('Buy credits at Odoo'),classes:"btn-primary",click:function(){window.open(url,'_blank');},close:true},{text:_t("Cancel"),close:true}],}).open();});}else{this._super.apply(this,arguments);}},});});;

/* /iap/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('iap.Dashboard',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dashboard=require('web_settings_dashboard');var _t=core._t;var QWeb=core.qweb;Dashboard.Dashboard.include({load_apps:function(data){var _super=this._super.bind(this);return ajax.jsonRpc('call_kw','call',{model:'iap.account',method:'get_account_url',args:[],kwargs:{},}).then(function(url){data.apps.url=url;return _super(data);});},});});;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var DiagramModel=AbstractModel.extend({get:function(){return $.extend(true,{},{labels:this.labels,nodes:this.datanodes,edges:this.edges,node_model:this.node_model,parent_field:this.parent_field,res_id:this.res_id,connector_model:this.connector_model,connectors:this.connectors,});},load:function(params){this.modelName=params.modelName;this.res_id=params.res_id;this.node_model=params.node_model;this.connector_model=params.connector_model;this.connectors=params.connectors;this.nodes=params.nodes;this.visible_nodes=params.visible_nodes;this.invisible_nodes=params.invisible_nodes;this.node_fields_string=params.node_fields_string;this.connector_fields_string=params.connector_fields_string;this.labels=params.labels;return this._fetchDiagramInfo();},reload:function(){return this._fetchDiagramInfo();},_fetchDiagramInfo:function(){var self=this;return this._rpc({route:'/web_diagram/diagram/get_diagram_info',params:{id:this.res_id,model:this.modelName,node:this.node_model,connector:this.connector_model,src_node:this.connectors.attrs.source,des_node:this.connectors.attrs.destination,label:this.connectors.attrs.label||false,bgcolor:this.nodes.attrs.bgcolor,shape:this.nodes.attrs.shape,visible_nodes:this.visible_nodes,invisible_nodes:this.invisible_nodes,node_fields_string:this.node_fields_string,connector_fields_string:this.connector_fields_string,},}).then(function(data){self.datanodes=data.nodes;self.edges=data.conn;self.parent_field=data.parent_field;});},});return DiagramModel;});;

/* /web_diagram/static/src/js/diagram_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var view_dialogs=require('web.view_dialogs');var _t=core._t;var QWeb=core.qweb;var FormViewDialog=view_dialogs.FormViewDialog;var DiagramController=AbstractController.extend({className:'o_diagram_view',custom_events:{add_edge:'_onAddEdge',edit_edge:'_onEditEdge',edit_node:'_onEditNode',remove_edge:'_onRemoveEdge',remove_node:'_onRemoveNode',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.domain=params.domain||[];this.context=params.context;this.ids=params.ids;this.currentId=params.currentId;},renderButtons:function($node){this.$buttons=$(QWeb.render("DiagramView.buttons",{widget:this}));this.$buttons.on('click','.o_diagram_new_button',this._addNode.bind(this));this.$buttons.appendTo($node);},_addNode:function(){var state=this.model.get();var pop=new FormViewDialog(this,{res_model:state.node_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Activity')),disable_multiple_selection:true,on_saved:this.reload.bind(this),}).open();pop.opened().then(function(){var changes={};changes[state.parent_field]={id:state.res_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});},_onAddEdge:function(event){var self=this;var state=this.model.get();var pop=new FormViewDialog(self,{res_model:state.connector_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Transition')),disable_multiple_selection:true,}).open();pop.opened().then(function(){var changes={};changes[state.connectors.attrs.source]={id:event.data.source_id};changes[state.connectors.attrs.destination]={id:event.data.dest_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});pop.on('closed',this,this.reload.bind(this));},_onEditEdge:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.connector_model,res_id:parseInt(event.data.id,10),context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Transition')),on_saved:this.reload.bind(this),}).open();},_onEditNode:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.node_model,res_id:event.data.id,context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Activity')),on_saved:this.reload.bind(this),}).open();},_onRemoveEdge:function(event){var self=this;Dialog.confirm(this,(_t("Are you sure you want to remove this transition?")),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.connector_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self));},});},_onRemoveNode:function(event){var self=this;var msg=_t("Are you sure you want to remove this node ? This will remove its connected transitions as well.");Dialog.confirm(this,(msg),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.node_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self));},});},});return DiagramController;});;

/* /web_diagram/static/src/js/diagram_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var DiagramRenderer=AbstractRenderer.extend({template:'DiagramView',start:function(){var $header=this.$el.filter('.o_diagram_header');_.each(this.state.labels,function(label){$header.append($('<span>').html(label));});this.$diagram_container=this.$el.filter('.o_diagram');return this._super.apply(this,arguments);},_render:function(){var self=this;var nodes=this.state.nodes;var edges=this.state.edges;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};this.$diagram_container.empty();var $div=$('<div>').css({position:'absolute',top:-10000,right:-10000}).appendTo($('body'));var r=new Raphael($div[0],'100%','100%');var graph=new CuteGraph(r,style,this.$diagram_container[0]);_.each(nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});$div.contents().appendTo(this.$diagram_container);$div.remove();CuteNode.double_click_callback=function(cutenode){self.trigger_up('edit_node',{id:cutenode.id});};CuteNode.destruction_callback=function(cutenode){self.trigger_up('remove_node',{id:cutenode.id});return $.Deferred().reject();};CuteEdge.double_click_callback=function(cuteedge){self.trigger_up('edit_edge',{id:cuteedge.id});};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.trigger_up('add_edge',{source_id:cuteedge.get_start().id,dest_id:cuteedge.get_end().id,});};CuteEdge.destruction_callback=function(cuteedge){self.trigger_up('remove_edge',{id:cuteedge.id});return $.Deferred().reject();};return this._super.apply(this,arguments);},});return DiagramRenderer;});;

/* /web_diagram/static/src/js/diagram_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var DiagramModel=require('web_diagram.DiagramModel');var DiagramRenderer=require('web_diagram.DiagramRenderer');var DiagramController=require('web_diagram.DiagramController');var _lt=core._lt;var DiagramView=BasicView.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',multi_record:false,searchable:false,jsLibs:[['/web_diagram/static/lib/js/jquery.mousewheel.js','/web_diagram/static/lib/js/raphael.js',]],config:{Model:DiagramModel,Renderer:DiagramRenderer,Controller:DiagramController,},init:function(viewInfo,params){this._super.apply(this,arguments);var self=this;var arch=viewInfo.arch;function toTitleCase(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}
var nodes=arch.children[0];var connectors=arch.children[1];var node_model=nodes.attrs.object;var connector_model=connectors.attrs.object;var labels=_.map(_.where(arch.children,{tag:'label'}),function(label){return label.attrs.string;});var invisible_nodes=[];var visible_nodes=[];var node_fields_string=[];_.each(nodes.children,function(child){if(child.attrs.invisible==='1')
invisible_nodes.push(child.attrs.name);else{var fieldString=self.fields[child.attrs.name].string||toTitleCase(child.attrs.name);visible_nodes.push(child.attrs.name);node_fields_string.push(fieldString);}});var connector_fields_string=_.map(connectors.children,function(conn){return self.fields[conn.attrs.name].string||toTitleCase(conn.attrs.name);});this.loadParams=_.extend({},this.loadParams,{currentId:params.currentId,nodes:nodes,labels:labels,invisible_nodes:invisible_nodes,visible_nodes:visible_nodes,node_fields_string:node_fields_string,node_model:node_model,connectors:connectors,connector_model:connector_model,connector_fields_string:connector_fields_string,});this.controllerParams=_.extend({},this.controllerParams,{domain:params.domain,context:params.context,ids:params.ids,currentId:params.currentId,});},getController:function(){var oldDefine=window.define;delete window.define;return this._super.apply(this,arguments).then(function(view){window.define=oldDefine;return view;});},});return DiagramView;});;

/* /web_diagram/static/src/js/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.view_registry',function(require){"use strict";var view_registry=require('web.view_registry');var DiagramView=require('web_diagram.DiagramView');view_registry.add('diagram',DiagramView);});;

/* /web_editor/static/src/js/backend/fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.backend',function(require){'use strict';var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var config=require('web.config');var core=require('web.core');var session=require('web.session');var field_registry=require('web.field_registry');var SummernoteManager=require('web_editor.rte.summernote');var transcoder=require('web_editor.transcoder');var TranslatableFieldMixin=basic_fields.TranslatableFieldMixin;var QWeb=core.qweb;var _t=core._t;var FieldTextHtmlSimple=basic_fields.DebouncedField.extend(TranslatableFieldMixin,{className:'oe_form_field oe_form_field_html_text',supportedFieldTypes:['html'],start:function(){new SummernoteManager(this);return this._super.apply(this,arguments);},commitChanges:function(){if(config.debug&&this.mode==='edit'){var layoutInfo=this.$textarea.data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this._getValue()!==this.value){this._isDirty=true;}
this._super.apply(this,arguments);},isSet:function(){return this.value&&this.value!=="<p><br/></p>"&&this.value.match(/\S/);},reset:function(record,event){this._reset(record,event);if(!event||event.target!==this){if(this.mode==='edit'){this.$content.html(this._textToHtml(this.value));}else{this._renderReadonly();}}
return $.when();},_getAttachmentsDomain:function(){var domain=['|',['id','in',_.pluck(this.attachments,'id')]];var attachedDocumentDomain=['&',['res_model','=',this.model],['res_id','=',this.res_id|0]];if(!this.res_id){attachedDocumentDomain.unshift('&');attachedDocumentDomain.push(['create_uid','=',session.uid]);}
if(this.recordData.res_model||this.recordData.model){var relatedDomain=['&',['res_model','=',this.recordData.res_model||this.recordData.model],['res_id','=',this.recordData.res_id|0]];if(!this.recordData.res_id){relatedDomain.unshift('&');relatedDomain.push(['create_uid','=',session.uid]);}
domain=domain.concat(['|'],attachedDocumentDomain,relatedDomain);}else{domain=domain.concat(attachedDocumentDomain);}
return domain;},_getSummernoteConfig:function(){var summernoteConfig={model:this.model,id:this.res_id,focus:false,height:180,toolbar:[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',this.nodeOptions['no-attachment']?['link']:['link','picture']],['history',['undo','redo']]],prettifyHtml:false,styleWithSpan:false,inlinemedia:['p'],lang:"odoo",onChange:this._doDebouncedAction.bind(this),disableDragAndDrop:!!this.nodeOptions['no-attachment'],};var fieldNameAttachment=_.chain(this.recordData).pairs().find(function(value){return _.isObject(value[1])&&value[1].model==="ir.attachment";}).first().value();if(fieldNameAttachment){this.fieldNameAttachment=fieldNameAttachment;this.attachments=[];summernoteConfig.onUpload=this._onUpload.bind(this);}
summernoteConfig.getMediaDomain=this._getAttachmentsDomain.bind(this);if(config.debug){summernoteConfig.toolbar.splice(7,0,['view',['codeview']]);}
return summernoteConfig;},_getValue:function(){if(this.nodeOptions['style-inline']){transcoder.attachmentThumbnailToLinkImg(this.$content);transcoder.fontToImg(this.$content);transcoder.classToStyle(this.$content);}
return this.$content.html();},_onUpload:function(attachments){var self=this;attachments=_.filter(attachments,function(attachment){return!_.findWhere(self.attachments,{id:attachment.id});});if(!attachments.length){return;}
this.attachments=this.attachments.concat(attachments);this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:_.object([this.fieldNameAttachment],[{operation:'ADD_M2M',ids:attachments}])});},_renderEdit:function(){this.$textarea=$('<textarea>');this.$textarea.appendTo(this.$el);this.$textarea.summernote(this._getSummernoteConfig());this.$content=this.$('.note-editable:first');this.$content.html(this._textToHtml(this.value));var mouseupEvent=$.Event('mouseup',{'setStyleInfoFromEditable':true});this.$content.trigger(mouseupEvent);if(this.nodeOptions['style-inline']){transcoder.styleToClass(this.$content);transcoder.imgToFont(this.$content);transcoder.linkImgToAttachmentThumbnail(this.$content);}
var history=this.$content.data('NoteHistory');if(history){history.reset();}
this.$('.note-toolbar').append(this._renderTranslateButton());},_renderReadonly:function(){var self=this;this.$el.empty();if(this.nodeOptions['style-inline']){var $iframe=$('<iframe class="o_readonly"/>');$iframe.on('load',function(){self.$content=$($iframe.contents()[0]).find("body");self.$content.html(self._textToHtml(self.value));self._resize();});$iframe.appendTo(this.$el);}else{this.$content=$('<div class="o_readonly"/>');this.$content.html(this._textToHtml(this.value));this.$content.appendTo(this.$el);}},_resize:function(){var height=this.$content[0]?this.$content[0].scrollHeight:0;this.$('iframe').css('height',Math.max(30,Math.min(height,500))+'px');},_textToHtml:function(text){var value=text||"";try{$(text)[0].innerHTML;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate&&this.res_id){return $(QWeb.render('web_editor.FieldTextHtml.button.translate',{widget:this})).on('click',this._onTranslate.bind(this));}
return $();},});var FieldTextHtml=AbstractField.extend({template:'web_editor.FieldTextHtml',supportedFieldTypes:['html'],start:function(){var self=this;this.editorLoadedDeferred=$.Deferred();this.contentLoadedDeferred=$.Deferred();this.callback=_.uniqueId('FieldTextHtml_');window.odoo[this.callback+"_editor"]=function(EditorBar){setTimeout(function(){self.on_editor_loaded(EditorBar);},0);};window.odoo[this.callback+"_content"]=function(){self.on_content_loaded();};window.odoo[this.callback+"_updown"]=null;window.odoo[this.callback+"_downup"]=function(){self.resize();};this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.$iframe.css('min-height','calc(100vh - 360px)');this.resize=function resize(){if(self.mode==='edit'){if($("body").hasClass("o_field_widgetTextHtml_fullscreen")){self.$iframe.css('height',(document.body.clientHeight-self.$iframe.offset().top)+'px');}else{self.$iframe.css("height",(self.$body.find("#oe_snippets").length?500:300)+"px");}}};$(window).on('resize',this.resize);this.old_initialize_content();var def=this._super.apply(this,arguments);return def;},getDatarecord:function(){return this.recordData;},get_url:function(_attr){var src=this.nodeOptions.editor_url||"/mass_mailing/field/email_template";var k;var datarecord=this.getDatarecord();var attr={'model':this.model,'field':this.name,'res_id':datarecord.id||'','callback':this.callback};_attr=_attr||{};if(this.nodeOptions['style-inline']){attr.inline_mode=1;}
if(this.nodeOptions.snippets){attr.snippets=this.nodeOptions.snippets;}
if(this.nodeOptions.template){attr.template=this.nodeOptions.template;}
if(this.mode==="edit"){attr.enable_editor=1;}
if(session.debug){attr.debug=session.debug;}
for(k in _attr){attr[k]=_attr[k];}
if(src.indexOf('?')===-1){src+="?";}
for(k in attr){if(attr[k]!==null){src+="&"+k+"="+(_.isBoolean(attr[k])?+attr[k]:attr[k]);}}
src+="&datarecord="+encodeURIComponent(JSON.stringify(datarecord));return src;},old_initialize_content:function(){this.$el.closest('.modal-body').css('max-height','none');this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.editor=false;window.odoo[this.callback+"_updown"]=null;this.$iframe.attr("src",this.get_url());},on_content_loaded:function(){var self=this;this.document=this.$iframe.contents()[0];this.$body=$("body",this.document);this.$content=this.$body.find("#editable_area");this.render();this.add_button();this.contentLoadedDeferred.resolve();setTimeout(self.resize,0);},on_editor_loaded:function(EditorBar){var self=this;this.editor=EditorBar;if(this.value&&window.odoo[self.callback+"_updown"]&&!(this.$content.html()||"").length){this.render();}
this.editorLoadedDeferred.resolve();setTimeout(function(){setTimeout(self.resize,0);},0);},add_button:function(){var self=this;var $to=this.$body.find("#web_editor-top-edit, #wrapwrap").first();$(QWeb.render('web_editor.FieldTextHtml.fullscreen')).appendTo($to).on('click','.o_fullscreen',function(){$("body").toggleClass("o_field_widgetTextHtml_fullscreen");var full=$("body").hasClass("o_field_widgetTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);$(window).trigger("resize");});this.$body.on('click','[data-action="cancel"]',function(event){event.preventDefault();self.old_initialize_content();});},render:function(){var value=(this.value||"").replace(/^<p[^>]*>(\s*|<br\/?>)<\/p>$/,'');if(!this.$content){return;}
if(this.mode==="edit"){if(window.odoo[this.callback+"_updown"]){this.resize();}}else{this.$content.html(value);if(this.$iframe[0].contentWindow){this.$iframe.css("height",(this.$body.height()+20)+"px");}}},has_no_value:function(){return this.value===false||!this.$content.html()||!this.$content.html().match(/\S/);},destroy:function(){$(window).off('resize',this.resize);delete window.odoo[this.callback+"_editor"];delete window.odoo[this.callback+"_content"];delete window.odoo[this.callback+"_updown"];delete window.odoo[this.callback+"_downup"];},commitChanges:function(){var self=this;var result=this._super.bind(this,arguments);if(this.mode==='readonly'){return;}
return $.when(this.contentLoadedDeferred,this.editorLoadedDeferred,result).then(function(){if(config.debug&&self.editor.rte){var layoutInfo=self.editor.rte.editable().data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
var $ancestors=self.$iframe.filter(':not(:visible)').parentsUntil(':visible').addBack();var ancestorsStyle=[];_.each($ancestors,function(el){var $el=$(el);ancestorsStyle.unshift($el.attr('style')||null);$el.css({display:'initial',visibility:'hidden',height:1});});self.editor.snippetsMenu&&self.editor.snippetsMenu.cleanForSave();_.each($ancestors,function(el){var $el=$(el);$el.attr('style',ancestorsStyle.pop());});self._setValue(self.$content.html());});},});field_registry.add('html',FieldTextHtmlSimple).add('html_frame',FieldTextHtml);return{FieldTextHtmlSimple:FieldTextHtmlSimple,FieldTextHtml:FieldTextHtml,};});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var field_registry=require('web.field_registry');var utils=require('web.utils');var GaugeWidget=AbstractField.extend({className:"oe_gauge",cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],_render:function(){var max_value=this.nodeOptions.max_value||100;if(this.nodeOptions.max_field){max_value=this.recordData[this.nodeOptions.max_field];}
var label=this.nodeOptions.label||"";if(this.nodeOptions.label_field){label=this.recordData[this.nodeOptions.label_field];}
var title=this.nodeOptions.title||this.field.string;var val=this.value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1].value:val;var gauge_value=value;if(this.nodeOptions.gauge_value_field){gauge_value=this.recordData[this.nodeOptions.gauge_value_field];}
var degree=Math.PI/180,width=200,height=150,outerRadius=Math.min(width,height)*0.5,innerRadius=outerRadius*0.7,fontSize=height/7;this.$el.empty().attr('style',this.nodeOptions.style+';position:relative; display:inline-block;');var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius).startAngle(-90*degree);var svg=d3.select(this.$el[0]).append("svg").attr("width",'100%').attr("height",'100%').attr('viewBox','0 0 '+width+' '+height).attr('preserveAspectRatio','xMinYMin').append("g").attr("transform","translate("+(width/2)+","+(height-(width-height)/2-12)+")");function addText(text,fontSize,dx,dy){return svg.append("text").attr("text-anchor","middle").style("font-size",fontSize+'px').attr("dy",dy).attr("dx",dx).text(text);}
addText(title,16,0,-outerRadius-16).style("font-weight",'bold');addText(utils.human_number(value,1),fontSize,0,-2).style("font-weight",'bold');addText(0,8,-(outerRadius+innerRadius)/2,12);addText(label,8,0,12);addText(utils.human_number(max_value,1),8,(outerRadius+innerRadius)/2,12);svg.append("path").datum({endAngle:Math.PI/2}).style("fill","#ddd").attr("d",arc);var foreground=svg.append("path").datum({endAngle:0}).style("fill","hsl(0,80%,50%)").attr("d",arc);var ratio=max_value?value/max_value:0;var hue=Math.round(ratio*120);foreground.transition().style("fill","hsl("+hue+",80%,50%)").duration(1500).call(arcTween,(ratio-0.5)*Math.PI);function arcTween(transition,newAngle){transition.attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,newAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}},});field_registry.add("gauge",GaugeWidget);return GaugeWidget;});;

/* /web_planner/static/src/js/web_planner_backend.js defined in bundle 'web.assets_backend' */
odoo.define('web.planner',function(require){"use strict";var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var planner=require('web.planner.common');var session=require('web.session');var PlannerLauncher=planner.PlannerLauncher.extend({start:function(){core.bus.on("change_menu_section",this,this.on_menu_clicked);return $.when(this._super.apply(this,arguments),this._loadPlannerDef);},_fetch_planner_data:function(){var planner_by_menu=this.planner_by_menu={};return this._rpc({model:'web.planner',method:'search_read',kwargs:{context:session.user_context},}).then(function(records){_.each(records,function(planner){planner.data=$.parseJSON(planner.data)||{};planner_by_menu[planner.menu_id[0]]=planner;});});},on_menu_clicked:function(menu_id){if(this.planner_by_menu[menu_id]){this._setup_for_planner(this.planner_by_menu[menu_id]);}else{this.do_hide();}},_update_parent_progress_bar:function(percent){this._super.apply(this,arguments);this.do_show();},});if(session.is_system){SystrayMenu.Items.push(PlannerLauncher);}
return{PlannerLauncher:PlannerLauncher,};});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_tour.DebugManager',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager');var Dialog=require("web.Dialog");var tour=require('web_tour.tour');function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){this._rpc({model:'web_tour.tour',method:'consume',args:[active_tours],}).then(function(){window.location.reload();});}},start_tour:function(){var dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('WebClient.DebugManager.ToursDialog',{tours:tour.tours}),});dialog.opened().then(function(){dialog.$('.o_start_tour').on('click',function(e){e.preventDefault();tour.run($(e.target).data('name'));});});dialog.open();},});});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var rpc=require('web.rpc');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;if(!this.nomenclature_id){return;}
var id=this.nomenclature_id[0];rpc.query({model:'barcode.nomenclature',method:'read',args:[[id],['name','rule_ids','upc_ean_conv']],}).then(function(nomenclatures){self.nomenclature=nomenclatures[0];var args=[[['barcode_nomenclature_id','=',self.nomenclature.id]],['name','sequence','type','encoding','pattern','alias'],];return rpc.query({model:'barcode.rule',method:'search_read',args:args,});}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean='0'+ean;}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var core=require('web.core');var mixins=require('web.mixins');var session=require('web.session');function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:session.max_time_between_keys_in_ms||55,inputTimeOut:800,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));var isMobile=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);this.isChromeMobile=isMobile&&navigator.userAgent.match(/Chrome/i);if(this.isChromeMobile){this.$barcodeInput=$('<input/>',{name:'barcode',type:'text',css:{'position':'fixed','top':'50%','transform':'translateY(-50%)','z-index':'-1',},});this.$barcodeInput.attr('autocomplete','off');}
this.__blurBarcodeInput=_.debounce(this._blurBarcodeInput,this.inputTimeOut);},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};new_event=$.Event('keypress',params);new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;$(old_event.target).trigger(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||e.key==="Backspace"||e.key==="Delete"||e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key==="Unidentified"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if((this.element_is_editable(e.target)&&!$(e.target).data('enableBarcode'))&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},_listenBarcodeScanner:function(e){if(!$('input:text:focus, textarea:focus, [contenteditable]:focus').length){$('body').append(this.$barcodeInput);this.$barcodeInput.focus();}
if(this.$barcodeInput.is(":focus")){clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this._handleBarcodeValue(e);}else{this.timeout=setTimeout(this._handleBarcodeValue.bind(this,e),this.max_time_between_keys_in_ms);}
this.__blurBarcodeInput();}},_handleBarcodeValue:function(e){var barcodeValue=this.$barcodeInput.val();if(barcodeValue.match(this.regexp)){core.bus.trigger('barcode_scanned',barcodeValue,$(e.target).parent()[0]);this._blurBarcodeInput();}},_blurBarcodeInput:function(){if(this.$barcodeInput){this.$barcodeInput.val('').blur();}},start:function(prevent_key_repeat){if(this.isChromeMobile){$('body').on("keydown",this._listenBarcodeScanner.bind(this));}else{$('body').bind("keypress",this.__handler);}
if(prevent_key_repeat===true){$('body').bind("keydown",this.__keydown_handler);$('body').bind('keyup',this.__keyup_handler);}},stop:function(){$('body').unbind("keypress",this.__handler);$('body').unbind("keydown",this.__keydown_handler);$('body').unbind('keyup',this.__keyup_handler);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FormView',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _t=core._t;FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{activeBarcode:'_barcodeActivated',}),init:function(){this._super.apply(this,arguments);this.activeBarcode={form_view:{commands:{'O-CMD.EDIT':this._barcodeEdit.bind(this),'O-CMD.DISCARD':this._barcodeDiscard.bind(this),'O-CMD.SAVE':this._barcodeSave.bind(this),'O-CMD.PREV':this._barcodePagerPrevious.bind(this),'O-CMD.NEXT':this._barcodePagerNext.bind(this),'O-CMD.PAGER-FIRST':this._barcodePagerFirst.bind(this),'O-CMD.PAGER-LAST':this._barcodePagerLast.bind(this),},},};this.barcodeMutex=new concurrency.Mutex();this._barcodeStartListening();},destroy:function(){this._barcodeStopListening();this._super();},_barcodeAddX2MQuantity:function(barcode,activeBarcode){if(this.mode==='readonly'){this.do_warn(_t('Error : Document not editable'),_t('To modify this document, please first start edition.'));return new $.Deferred().reject();}
var record=this.model.get(this.handle);var candidate=this._getBarCodeRecord(record,barcode,activeBarcode);if(candidate){return this._barcodeSelectedCandidate(candidate,record,barcode,activeBarcode);}else{return this._barcodeWithoutCandidate(record,barcode,activeBarcode);}},_barcodeDiscard:function(){return this.discardChanges();},_barcodeEdit:function(){return this._setMode('edit');},_barcodePagerFirst:function(){var self=this;return this.mutex.exec(function(){}).then(function(){self.pager.updateState({current_min:1,},{notifyChange:true});});},_barcodePagerLast:function(){var self=this;return this.mutex.exec(function(){}).then(function(){var state=self.model.get(self.handle,{raw:true});self.pager.updateState({current_min:state.count,},{notifyChange:true});});},_barcodePagerNext:function(){return this.mutex.exec(function(){}).then(this.pager.next.bind(this.pager));},_barcodePagerPrevious:function(){return this.mutex.exec(function(){}).then(this.pager.previous.bind(this.pager));},_barcodeRecordFilter:function(candidate,barcode,activeBarcode){return candidate.data.product_barcode===barcode;},_barcodeSave:function(){return this.saveRecord();},_barcodeSelectedCandidate:function(candidate,record,barcode,activeBarcode,quantity){var changes={};var candidateChanges={};candidateChanges[activeBarcode.quantity]=quantity?quantity:candidate.data[activeBarcode.quantity]+1;changes[activeBarcode.fieldName]={operation:'UPDATE',id:candidate.id,data:candidateChanges,};return this.model.notifyChanges(this.handle,changes,{notifyChange:activeBarcode.notifyChange});},_barcodeStartListening:function(){core.bus.on('barcode_scanned',this,this._barcodeScanned);core.bus.on('keypress',this,this._quantityListener);},_barcodeStopListening:function(){core.bus.off('barcode_scanned',this,this._barcodeScanned);core.bus.off('keypress',this,this._quantityListener);},_barcodeWithoutCandidate:function(record,barcode,activeBarcode){var changes={};changes[activeBarcode.name]=barcode;return this.model.notifyChanges(record.id,changes);},_getBarCodeRecord:function(record,barcode,activeBarcode){var self=this;if(!activeBarcode.fieldName||!record.data[activeBarcode.fieldName]){return;}
return _.find(record.data[activeBarcode.fieldName].data,function(record){return self._barcodeRecordFilter(record,barcode,activeBarcode);});},_barcodeActivated:function(event){event.stopPropagation();var name=event.data.name;this.activeBarcode[name]={name:name,handle:this.handle,target:event.target,widget:event.target.attrs&&event.target.attrs.widget,setQuantityWithKeypress:!!event.data.setQuantityWithKeypress,fieldName:event.data.fieldName,notifyChange:(event.data.notifyChange!==undefined)?event.data.notifyChange:true,quantity:event.data.quantity,commands:event.data.commands||{},candidate:this.activeBarcode[name]&&this.activeBarcode[name].handle===this.handle?this.activeBarcode[name].candidate:null,};this.disableAutofocus=true;},_barcodeActiveScanned:function(method,barcode,activeBarcode){var self=this;var methodDef;var def=new $.Deferred();if(typeof method==='string'){methodDef=this[method](barcode,activeBarcode);}else{methodDef=method.call(this,barcode,activeBarcode);}
methodDef.done(function(){var record=self.model.get(self.handle);var candidate=self._getBarCodeRecord(record,barcode,activeBarcode);activeBarcode.candidate=candidate;}).always(function(){def.resolve();});return def;},_barcodeScanned:function(barcode,target){var self=this;return this.barcodeMutex.exec(function(){var prefixed=_.any(BarcodeEvents.ReservedBarcodePrefixes,function(reserved){return barcode.indexOf(reserved)===0;});var hasCommand=false;var defs=[];if(!$.contains(target,self.el)){return;}
for(var k in self.activeBarcode){var activeBarcode=self.activeBarcode[k];var methods=self.activeBarcode[k].commands;var method=prefixed?methods[barcode]:methods.barcode;if(method){if(prefixed){hasCommand=true;}
defs.push(self._barcodeActiveScanned(method,barcode,activeBarcode));}}
if(prefixed&&!hasCommand){self.do_warn(_t('Error : Barcode command is undefined'),barcode);}
return self.alive($.when.apply($,defs)).then(function(){if(!prefixed){self.current_barcode=barcode;self.update({},{reload:false});}});});},_quantityListener:function(event){var character=String.fromCharCode(event.which);if(!$.contains(event.target,this.el)){return;}
if(!$(event.target).is('body, .modal')||!/[0-9]/.test(character)){return;}
var barcodeInfos=_.filter(this.activeBarcode,'setQuantityWithKeypress');if(!barcodeInfos.length){return;}
if(!_.compact(_.pluck(barcodeInfos,'candidate')).length){return this.do_warn(_t('Error : No last scanned barcode'),_t('To set the quantity please scan a barcode first.'));}
for(var k in this.activeBarcode){if(this.activeBarcode[k].candidate){this._quantityOpenDialog(character,this.activeBarcode[k]);}}},_quantityOpenDialog:function(character,activeBarcode){var self=this;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=self.model.get(self.handle);return self._barcodeSelectedCandidate(activeBarcode.candidate,record,self.current_barcode,activeBarcode,parseFloat(new_qty)).then(function(){self.update({},{reload:false});});}},{text:_t('Discard'),close:true}],$content:$content,});this.dialog.opened().then(function(){var $input=self.dialog.$('.o_set_qty_input').focus().val(character);var $selectBtn=self.dialog.$footer.find('.btn-primary');$input.on('keypress',function(event){if(event.which===13){event.preventDefault();$input.off();$selectBtn.click();}});});this.dialog.open();},});FormRenderer.include({_barcodeButtonHandler:function($button,node){var commands={};commands.barcode=function(){return $.when();};commands['O-BTN.'+node.attrs.barcode_trigger]=function(){if(!$button.hasClass('o_invisible_modifier')){$button.click();}
return $.when();};this.trigger_up('activeBarcode',{name:node.attrs.name,commands:commands});},_renderHeaderButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderStatButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderTagButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;}});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');});;

/* /barcodes/static/src/js/barcode_field.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.field',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var FieldFloatScannable=basicFields.FieldFloat.extend({events:_.extend({},basicFields.FieldFloat.prototype.events,{'keypress':'_onKeypress',}),_renderEdit:function(){var self=this;$.when(this._super()).then(function(){self.$input.data('enableBarcode',true);});},_onKeypress:function(e){if(e.dispatched_by_barcode_reader!==true){e.preventDefault();return;}
var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);$(e.target).trigger('input');},});var FormViewBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.trigger_up('activeBarcode',{name:this.name,commands:{barcode:'_barcodeAddX2MQuantity',}});},});fieldRegistry.add('field_float_scannable',FieldFloatScannable);fieldRegistry.add('barcode_handler',FormViewBarcodeHandler);return{FieldFloatScannable:FieldFloatScannable,FormViewBarcodeHandler:FormViewBarcodeHandler,};});;

/* /bus/static/src/js/bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.bus',function(require){"use strict";var local_storage=require('web.local_storage');var session=require('web.session');var Widget=require('web.Widget');var bus={};var PARTNERS_PRESENCE_CHECK_PERIOD=30000;var TAB_HEARTBEAT_PERIOD=10000;var MASTER_TAB_HEARTBEAT_PERIOD=1500;bus.ERROR_DELAY=10000;bus.Bus=Widget.extend({init:function(){var self=this;this._super();this.options={};this.activated=false;this.bus_id=_.uniqueId('bus');this.channels=[];this.last=0;this.stop=false;this.is_master=true;this.last_presence=new Date().getTime();this.last_partners_presence_check=this.last_presence;this.set("window_focus",true);this.on("change:window_focus",this,function(){if(this.get("window_focus")){this.trigger('window_focus',this.is_master);}});$(window).on("focus."+this.bus_id,_.bind(this.focus_change,this,true));$(window).on("blur."+this.bus_id,_.bind(this.focus_change,this,false));$(window).on("unload."+this.bus_id,_.bind(this.focus_change,this,false));_.each('click,keydown,keyup'.split(','),function(evtype){$(window).on(evtype+"."+self.bus_id,function(){self.last_presence=new Date().getTime();});});},destroy:function(){var self=this;$(window).off("focus."+this.bus_id);$(window).off("blur."+this.bus_id);$(window).off("unload."+this.bus_id);_.each('click,keydown,keyup'.split(','),function(evtype){$(window).off(evtype+"."+self.bus_id);});},start_polling:function(){if(!this.activated){this.poll();this.stop=false;}},stop_polling:function(){this.activated=false;this.stop=true;this.channels=[];},poll:function(){var self=this;self.activated=true;var now=new Date().getTime();var options=_.extend({},this.options,{bus_inactivity:now-this.get_last_presence(),});if(this.last_partners_presence_check+PARTNERS_PRESENCE_CHECK_PERIOD>now){options=_.omit(options,'bus_presence_partner_ids');}else{this.last_partners_presence_check=now;}
var data={channels:self.channels,last:self.last,options:options};session.rpc('poll.php',data,{shadow:true,timeout:60000}).then(function(result){self.on_notification(result);if(!self.stop){self.poll();}},function(unused,e){e.preventDefault();setTimeout(_.bind(self.poll,self),bus.ERROR_DELAY+(Math.floor((Math.random()*20)+1)*1000));});},on_notification:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self.last){self.last=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);},add_channel:function(channel){this.channels.push(channel);this.channels=_.uniq(this.channels);},delete_channel:function(channel){this.channels=_.without(this.channels,channel);},focus_change:function(focus){this.set("window_focus",focus);},is_odoo_focused:function(){return this.get("window_focus");},get_last_presence:function(){return this.last_presence;},update_option:function(key,value){this.options[key]=value;},delete_option:function(key){if(_.contains(_.keys(this.options),key)){delete this.options[key];}},});var CrossTabBus=bus.Bus.extend({init:function(){this._super.apply(this,arguments);this.is_master=false;this.is_registered=false;if(parseInt(getItem('bus.last_ts',0))+50000<new Date().getTime()){setItem('bus.last',-1);}
on("storage",this.on_storage.bind(this));},start_polling:function(){var self=this;if(!this.is_registered){this.is_registered=true;tab_manager.register_tab(function(){self.is_master=true;self.start_polling();},function(){self.is_master=false;self.stop_polling();},function(){var hb_period=this.is_master?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD;if(self.last_presence+hb_period>new Date().getTime()){setItem('bus.last_presence',self.last_presence);}});if(this.is_master){setItem('bus.channels',this.channels);setItem('bus.options',this.options);}else{this.channels=getItem('bus.channels',this.channels);this.options=getItem('bus.options',this.options);}
return;}
if(this.is_master){this._super.apply(this,arguments);}},on_notification:function(notifications){if(this.is_master){var last=getItem('bus.last',-1);var max_id=Math.max(last,0);var new_notifications=_.filter(notifications,function(notif){max_id=Math.max(max_id,notif.id);return notif.id<0||notif.id>last;});this.last=max_id;if(new_notifications.length){setItem('bus.last',max_id);setItem('bus.last_ts',new Date().getTime());setItem('bus.notification',new_notifications);this._super(new_notifications);}}else{this._super.apply(this,arguments);}},on_storage:function(e){var value=e.newValue;if(e.key==='bus.notification'){var notifs=JSON.parse(value);this.on_notification(notifs);}
if(e.key==='bus.channels'){this.channels=JSON.parse(value);}
if(e.key==='bus.options'){this.options=JSON.parse(value);}
if(e.key==='bus.focus'){this.set('window_focus',JSON.parse(value));}},add_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},delete_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},get_last_presence:function(){return getItem('bus.last_presence')||new Date().getTime();},update_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},delete_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},focus_change:function(focus){this._super.apply(this,arguments);setItem('bus.focus',focus);},});function on(type,listener){if(window.addEventListener){window.addEventListener(type,listener);}else{window.attachEvent('on'+type,listener);}}
function getItem(key,defaultValue){var val=local_storage.getItem(key);return val?JSON.parse(val):defaultValue;}
function setItem(key,value){local_storage.setItem(key,JSON.stringify(value));}
var tab_manager={peersKey:'bus.peers',masterKey:'bus.master',heartbeatKey:'bus.heartbeat',isMaster:false,id:new Date().getTime()+':'+(Math.random()*1000000000|0),register_tab:function(is_master_callback,is_no_longer_master,on_heartbeat_callback){this.is_master_callback=is_master_callback;this.is_no_longer_master=is_no_longer_master||function(){};this.on_heartbeat_callback=on_heartbeat_callback||function(){};var peers=getItem(tab_manager.peersKey,{});peers[tab_manager.id]=new Date().getTime();setItem(tab_manager.peersKey,peers);on('unload',function(){var peers=getItem(tab_manager.peersKey,{});delete peers[tab_manager.id];setItem(tab_manager.peersKey,peers);if(tab_manager.isMaster){local_storage.removeItem(tab_manager.masterKey);}});if(!local_storage.getItem(tab_manager.masterKey)){tab_manager.start_election();}
on('storage',function(e){if(!e){e=window.event;}
if(e.key!==tab_manager.masterKey){return;}
if(e.newValue===null){tab_manager.start_election();}});tab_manager.heartbeat();},heartbeat:function(){var current=new Date().getTime();var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;var peers=getItem(tab_manager.peersKey,{});if((parseInt(heartbeatValue)+5000)<current){tab_manager.start_election();}
if(tab_manager.isMaster){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+15000>current){cleanedPeers[peerName]=peers[peerName];}}
if(!tab_manager.is_last_heartbeat_mine()){tab_manager.isMaster=false;tab_manager.last_heartbeat=0;peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);tab_manager.is_no_longer_master();}else{tab_manager.last_heartbeat=current;local_storage.setItem(tab_manager.heartbeatKey,current);setItem(tab_manager.peersKey,cleanedPeers);}}else{peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);}
this.on_heartbeat_callback();setTimeout(function(){tab_manager.heartbeat();},tab_manager.isMaster?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD);},is_last_heartbeat_mine:function(){var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;return(parseInt(heartbeatValue)===tab_manager.last_heartbeat);},start_election:function(){if(tab_manager.isMaster){return;}
var peers=getItem(tab_manager.peersKey,{});var now=new Date().getTime();var newMaster;for(var peerName in peers){if(peers[peerName]+15000<now){continue;}
newMaster=peerName;break;}
if(newMaster===tab_manager.id){setItem(tab_manager.masterKey,tab_manager.id);tab_manager.last_heartbeat=new Date().getTime();setItem(tab_manager.heartbeatKey,tab_manager.last_heartbeat);tab_manager.isMaster=true;tab_manager.is_master_callback();delete peers[newMaster];setItem(tab_manager.peersKey,peers);}},};if(typeof Storage!=="undefined"){bus.bus=new CrossTabBus();}else{bus.bus=new bus.Bus();}
return bus;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var form_common=require('web.view_dialogs');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var M2MTags=relational_fields.FieldMany2ManyTags;var _t=core._t;BasicModel.include({_fetchSpecialMany2ManyTagsEmail:function(record,fieldName){var self=this;var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];var list=this._applyX2ManyOperations(this.localData[localID]);var invalidPartnerIds=[];_.each(list.data,function(id){var record=self.localData[id];if(!record.data.email){invalidPartnerIds.push(record);}});var def;if(invalidPartnerIds.length){var changes={operation:'DELETE',ids:_.pluck(invalidPartnerIds,'id')};def=this._applyX2ManyChange(record,fieldName,changes);}
return $.when(def).then(function(){list=self._applyX2ManyOperations(self.localData[localID]);if(list.res_ids.length){def=self._rpc({model:list.model,method:'name_get',args:[list.res_ids],context:record.getContext({fieldName:fieldName}),});}
return $.when(def).then(function(names){return $.when({invalidPartnerIds:_.pluck(invalidPartnerIds,'res_id'),partnerNames:_.object(names),});});});},});var FieldMany2ManyTagsEmail=M2MTags.extend({fieldsToFetch:_.extend({},M2MTags.prototype.fieldsToFetch,{email:{type:'char'},}),specialData:"_fetchSpecialMany2ManyTagsEmail",_checkEmailPopup:function(){var self=this;var popupDefs=[];var validPartners=[];_.each(this.record.specialData[this.name].invalidPartnerIds,function(resID){var def=$.Deferred();popupDefs.push(def);var pop=new form_common.FormViewDialog(self,{res_model:self.field.relation,res_id:resID,context:self.record.context,title:_t("Please complete customer's informations and email"),on_saved:function(record){if(record.data.email){validPartners.push(record.res_id);}},}).open();pop.on('closed',self,function(){def.resolve();});});return $.when.apply($,popupDefs).then(function(){validPartners=_.uniq(validPartners);if(validPartners.length){var values=_.map(validPartners,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}});},_render:function(){var self=this;var def=$.Deferred();var _super=this._super.bind(this);if(this.record.specialData[this.name].invalidPartnerIds.length){def=this._checkEmailPopup();}else{def.resolve();}
return def.then(function(){return _super.apply(self,arguments);});},_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);var partnerNames=this.record.specialData[this.name].partnerNames;_.each(result.elements,function(partner){partner.display_name=partnerNames[partner.id];});return result;},});field_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_client_action',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ChatThread=require('mail.ChatThread');var composer=require('mail.composer');var utils=require('mail.utils');var config=require('web.config');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dom=require('web.dom');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var PartnerInviteDialog=Dialog.extend({dialog_title:_t('Invite people'),template:"mail.PartnerInviteDialog",init:function(parent,title,channel_id){this.channel_id=channel_id;this._super(parent,{title:title,size:"medium",buttons:[{text:_t("Invite"),close:true,classes:"btn-primary",click:this._addChannel.bind(this),}],});},start:function(){this.$input=this.$('.o_mail_chat_partner_invite_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:function(item){var status=QWeb.render('mail.chat.UserStatus',{status:item.im_status});return $('<span>').text(item.text).prepend(status);},query:function(query){chat_manager.search_partner(query.term,20).then(function(partners){query.callback({results:_.map(partners,function(partner){return _.extend(partner,{text:partner.label});}),});});}});return this._super.apply(this,arguments);},_addChannel:function(){var self=this;var data=this.$input.select2('data');if(data.length>=1){return this._rpc({model:'mail.channel',method:'channel_invite',args:[this.channel_id],kwargs:{partner_ids:_.pluck(data,'id')},}).then(function(){var names=_.escape(_.pluck(data,'text').join(', '));var notification=_.str.sprintf(_t('You added <b>%s</b> to the conversation.'),names);self.do_notify(_t('New people'),notification);delete chat_manager.get_channel(self.channel_id).members_deferred;});}},});var ChatAction=Widget.extend(ControlPanelMixin,{template:'mail.client_action',custom_events:{search:'_onSearch',},events:{'blur .o_mail_add_channel input':'_onAddChannelBlur','click .o_mail_annoying_notification_bar .fa-close':'_onCloseNotificationBar','click .o_mail_chat_channel_item':'_onChannelClicked','click .o_mail_open_channels':'_onPublicChannelsClick','click .o_mail_partner_unpin':'_onUnpinChannel','click .o_mail_request_permission':'_onRequestNotificationPermission','click .o_mail_sidebar_title .o_add':'_onAddChannel','keydown':'_onKeydown',},init:function(parent,action,options){this._super.apply(this,arguments);this.action_manager=parent;this.dataset=new data.DataSetSearch(this,'mail.message');this.domain=[];this.action=action;this.options=options||{};this.channels_scrolltop={};this.throttledUpdateChannels=_.throttle(this._updateChannels.bind(this),100,{leading:false});this.notification_bar=(window.Notification&&window.Notification.permission==="default");this.selected_message=null;this.composerStates={};this.defaultChannelID=this.options.active_id||this.action.context.active_id||this.action.params.default_active_id||'channel_inbox';},willStart:function(){var self=this;var view_id=this.action&&this.action.search_view_id&&this.action.search_view_id[0];var def=this.loadFieldView(this.dataset,view_id,'search').then(function(fields_view){self.fields_view=fields_view;});return $.when(this._super(),chat_manager.is_ready,def);},start:function(){var self=this;var default_channel=chat_manager.get_channel(this.defaultChannelID)||chat_manager.get_channel('channel_inbox');this.basic_composer=new composer.BasicComposer(this,{mention_partners_restricted:true});this.extended_composer=new composer.ExtendedComposer(this,{mention_partners_restricted:true});this.basic_composer.on('post_message',this,this._onPostMessage);this.basic_composer.on('input_focused',this,this._onComposerFocused);this.extended_composer.on('post_message',this,this._onPostMessage);this.extended_composer.on('input_focused',this,this._onComposerFocused);var defs=[];defs.push(this._renderButtons());defs.push(this._renderThread());defs.push(this.basic_composer.appendTo(this.$('.o_mail_chat_content')));defs.push(this.extended_composer.appendTo(this.$('.o_mail_chat_content')));defs.push(this._renderSearchView());return $.when.apply($,defs).then(this._setChannel.bind(this,default_channel)).then(this._updateChannels.bind(this)).then(function(){self._startListening();self.thread.$el.on("scroll",null,_.debounce(function(){if(self.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(self.channel);}},100));});},do_show:function(){this._super.apply(this,arguments);this._updateControlPanel();this.action_manager.do_push_state({action:this.action.id,active_id:this.channel.id,});},destroy:function(){if(this.$buttons){this.$buttons.off().destroy();}
this._super.apply(this,arguments);},on_attach_callback:function(){chat_manager.bus.trigger('client_action_open',true);if(this.channel){this.thread.scroll_to({offset:this.channels_scrolltop[this.channel.id]});}},on_detach_callback:function(){chat_manager.bus.trigger('client_action_open',false);this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();},_fetchAndRenderThread:function(){var self=this;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(result){self.thread.render(result,self._getThreadRenderingOptions(result));self._updateButtonStatus(result.length===0);});},_getThreadRenderingOptions:function(messages){if(_.isUndefined(this.messages_separator_position)){if(!this.unread_counter){this.messages_separator_position=false;}else{var msg=chat_manager.get_last_seen_message(this.channel);this.messages_separator_position=msg?msg.id:'top';}}
return{channel_id:this.channel.id,display_load_more:!chat_manager.all_history_loaded(this.channel,this.domain),display_needactions:this.channel.display_needactions,messages_separator_position:this.messages_separator_position,squash_close_messages:this.channel.type!=='static'&&!this.channel.mass_mailing,display_empty_channel:!messages.length&&!this.domain.length,display_no_match:!messages.length&&this.domain.length,display_subject:this.channel.mass_mailing||this.channel.id==="channel_inbox",display_email_icon:false,display_reply_icon:true,};},_loadMoreMessages:function(){var self=this;var oldest_msg_id=this.$('.o_thread_message').first().data('messageId');var oldest_msg_selector='.o_thread_message[data-message-id="'+oldest_msg_id+'"]';var offset=-dom.getPosition(document.querySelector(oldest_msg_selector)).top;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain,load_more:true}).then(function(result){if(self.messages_separator_position==='top'){self.messages_separator_position=undefined;}
self.thread.render(result,self._getThreadRenderingOptions(result));offset+=dom.getPosition(document.querySelector(oldest_msg_selector)).top;self.thread.scroll_to({offset:offset});});},_prepareAddChannelInput:function($input,type){var self=this;if(type==='public'){$input.autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);self._searchChannel(self.last_search_val).done(function(result){result.push({'label':_.str.sprintf('<strong>'+_t("Create %s")+'</strong>','<em>"#'+self.last_search_val+'"</em>'),'value':'_create',});response(result);});},select:function(event,ui){if(self.last_search_val){if(ui.item.value==='_create'){chat_manager.create_channel(self.last_search_val,"public");}else{chat_manager.join_channel(ui.item.id);}}},focus:function(event){event.preventDefault();},html:true,});}else if(type==='private'){$input.on('keyup',this,function(event){var name=_.escape($(event.target).val());if(event.which===$.ui.keyCode.ENTER&&name){chat_manager.create_channel(name,"private");}});}else if(type==='dm'){$input.autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);chat_manager.search_partner(self.last_search_val,10).done(response);},select:function(event,ui){var partner_id=ui.item.id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(dm){self._setChannel(dm);}else{chat_manager.create_channel(partner_id,"dm");}
$(this).val('');return false;},focus:function(event){event.preventDefault();},});}},_renderButtons:function(){this.$buttons=$(QWeb.render("mail.chat.ControlButtons",{debug:session.debug}));this.$buttons.find('button').css({display:"inline-block"});this.$buttons.on('click','.o_mail_chat_button_invite',this._onInviteButtonClicked.bind(this));this.$buttons.on('click','.o_mail_chat_button_unsubscribe',this._onUnsubscribeButtonClicked.bind(this));this.$buttons.on('click','.o_mail_chat_button_settings',this._onSettingsButtonClicked.bind(this));this.$buttons.on('click','.o_mail_chat_button_mark_read',this._onMarkAllReadClicked.bind(this));this.$buttons.on('click','.o_mail_chat_button_unstar_all',this._onUnstarAllClicked.bind(this));},_renderSearchView:function(){var self=this;var options={$buttons:$("<div>"),action:this.action,disable_groupby:true,};this.searchview=new SearchView(this,this.dataset,this.fields_view,options);return this.searchview.appendTo($("<div>")).then(function(){self.$searchview_buttons=self.searchview.$buttons.contents();self.searchview.do_search();});},_renderSidebar:function(options){return $(QWeb.render("mail.chat.Sidebar",options));},_renderSnackbar:function(template,context,timeout){if(this.$snackbar){this.$snackbar.remove();}
timeout=timeout||20000;this.$snackbar=$(QWeb.render(template,context));this.$('.o_mail_chat_content').append(this.$snackbar);var $snackbar=this.$snackbar;setTimeout(function(){$snackbar.fadeOut();},timeout);},_renderThread:function(){this.thread=new ChatThread(this,{display_help:true});this.thread.on('redirect',this,function(res_model,res_id){chat_manager.redirect(res_model,res_id,this._setChannel.bind(this));});this.thread.on('redirect_to_channel',this,function(channel_id){chat_manager.join_channel(channel_id).then(this._setChannel.bind(this));});this.thread.on('load_more_messages',this,this._loadMoreMessages);this.thread.on('mark_as_read',this,function(message_id){chat_manager.mark_as_read([message_id]);});this.thread.on('toggle_star_status',this,function(message_id){chat_manager.toggle_star_status(message_id);});this.thread.on('select_message',this,this._selectMessage);this.thread.on('unselect_message',this,this._unselectMessage);return this.thread.appendTo(this.$('.o_mail_chat_content'));},_restoreChannelState:function(){var $new_messages_separator=this.$('.o_thread_new_messages_separator');if($new_messages_separator.length){this.thread.$el.scrollTo($new_messages_separator);}else{var new_channel_scrolltop=this.channels_scrolltop[this.channel.id];this.thread.scroll_to({offset:new_channel_scrolltop});}
this._restoreComposerState(this.channel);},_restoreComposerState:function(channel){if(channel.type==='static'){return;}
var composer=channel.mass_mailing?this.extended_composer:this.basic_composer;var composerState=this.composerStates[channel.uuid];if(composerState){composer.setState(composerState);}},_searchChannel:function(search_val){return this._rpc({model:'mail.channel',method:'channel_search_to_join',args:[search_val]}).then(function(result){var values=[];_.each(result,function(channel){var escaped_name=_.escape(channel.name);values.push(_.extend(channel,{'value':escaped_name,'label':escaped_name,}));});return values;});},_selectMessage:function(message_id){this.$el.addClass('o_mail_selection_mode');var message=chat_manager.get_message(message_id);this.selected_message=message;var subject="Re: "+message.record_name;this.extended_composer.set_subject(subject);if(this.channel.type!=='static'){this.basic_composer.do_hide();}
this.extended_composer.do_show();this.thread.scroll_to({id:message_id,duration:200,only_if_necessary:true});this.extended_composer.focus('body');},_setChannel:function(channel){var self=this;this._storeChannelState();this.channel=channel;this.messages_separator_position=undefined;this.unread_counter=this.channel.unread_counter;this.last_seen_message_id=this.channel.last_seen_message_id;if(this.$snackbar){this.$snackbar.remove();}
this.action.context.active_id=channel.id;this.action.context.active_ids=[channel.id];return this._fetchAndRenderThread().then(function(){if(channel.type!=='static'){chat_manager.mark_channel_as_seen(channel);}
self._restoreChannelState();self.set("title",'#'+channel.name);self._updateControlPanel();self._updateControlPanelButtons(channel);self._unselectMessage();self.action_manager.do_push_state({action:self.action.id,active_id:self.channel.id,});});},_startListening:function(){chat_manager.bus.on('open_channel',this,this._setChannel);chat_manager.bus.on('new_message',this,this._onNewMessage);chat_manager.bus.on('update_message',this,this._onMessageUpdated);chat_manager.bus.on('new_channel',this,this._onNewChannel);chat_manager.bus.on('anyone_listening',this,function(channel,query){query.is_displayed=query.is_displayed||(channel.id===this.channel.id&&this.thread.is_at_bottom());});chat_manager.bus.on('unsubscribe_from_channel',this,this._onChannelLeft);chat_manager.bus.on('update_needaction',this,this.throttledUpdateChannels);chat_manager.bus.on('update_starred',this,this.throttledUpdateChannels);chat_manager.bus.on('update_channel_unread_counter',this,this.throttledUpdateChannels);chat_manager.bus.on('update_dm_presence',this,this.throttledUpdateChannels);chat_manager.bus.on('activity_updated',this,this.throttledUpdateChannels);},_storeChannelState:function(){if(this.channel){this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();this._storeComposerState(this.channel);}},_storeComposerState:function(channel){if(channel.type==='static'){return;}
var composer=channel.mass_mailing?this.extended_composer:this.basic_composer;this.composerStates[channel.uuid]=composer.getState();composer.clear_composer();},_unselectMessage:function(){this.basic_composer.do_toggle(this.channel.type!=='static'&&!this.channel.mass_mailing);this.extended_composer.do_toggle(this.channel.type!=='static'&&this.channel.mass_mailing);if(!config.device.touch){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;composer.focus();}
this.$el.removeClass('o_mail_selection_mode');this.thread.unselect();this.selected_message=null;},_updateChannels:function(){var self=this;var $sidebar=this._renderSidebar({active_channel_id:this.channel?this.channel.id:undefined,channels:chat_manager.get_channels(),needaction_counter:chat_manager.get_needaction_counter(),starred_counter:chat_manager.get_starred_counter(),});this.$(".o_mail_chat_sidebar").html($sidebar.contents());_.each(['dm','public','private'],function(type){var $input=self.$('.o_mail_add_channel[data-type='+type+'] input');self._prepareAddChannelInput($input,type);});},_updateButtonStatus:function(disabled,type){if(this.channel.id==="channel_inbox"){this.$buttons.find('.o_mail_chat_button_mark_read').toggleClass('disabled',disabled);if(disabled&&type==='mark_as_read'){this.trigger_up('show_effect',{message:_t('Congratulations, your inbox is empty!'),type:'rainbow_man',});}}
if(this.channel.id==="channel_starred"){this.$buttons.find('.o_mail_chat_button_unstar_all').toggleClass('disabled',disabled);}},_updateControlPanel:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,$searchview:this.searchview.$el,$searchview_buttons:this.$searchview_buttons,},searchview:this.searchview,});},_updateControlPanelButtons:function(channel){this.$buttons.find('.o_mail_chat_button_unsubscribe').toggle(channel.type!=="dm"&&channel.type!=='static'&&!channel.group_based_subscription);this.$buttons.find('.o_mail_chat_button_invite, .o_mail_chat_button_settings').toggle(channel.type!=="dm"&&channel.type!=='static');this.$buttons.find('.o_mail_chat_button_mark_read').toggle(channel.id==="channel_inbox").removeClass("o_hidden");this.$buttons.find('.o_mail_chat_button_unstar_all').toggle(channel.id==="channel_starred").removeClass("o_hidden");this.$('.o_mail_chat_channel_item').removeClass('o_active').filter('[data-channel-id='+channel.id+']').removeClass('o_unread_message').addClass('o_active');},_onAddChannel:function(event){event.preventDefault();var type=$(event.target).data("type");this.$('.o_mail_add_channel[data-type='+type+']').show().find("input").focus();},_onAddChannelBlur:function(){this.$('.o_mail_add_channel').hide();},_onChannelClicked:function(event){event.preventDefault();var channel_id=$(event.currentTarget).data('channel-id');this._setChannel(chat_manager.get_channel(channel_id));},_onChannelLeft:function(channel_id){if(this.channel.id===channel_id){this._setChannel(chat_manager.get_channel("channel_inbox"));}
this._updateChannels();delete this.channels_scrolltop[channel_id];},_onComposerFocused:function(){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;var commands=chat_manager.get_commands(this.channel);var partners=chat_manager.get_mention_partner_suggestions(this.channel);composer.mention_set_enabled_commands(commands);composer.mention_set_prefetched_partners(partners);},_onMarkAllReadClicked:function(){chat_manager.mark_all_as_read(this.channel,this.domain);},_onMessageUpdated:function(message,type){var self=this;var current_channel_id=this.channel.id;if((current_channel_id==="channel_starred"&&!message.is_starred)||(current_channel_id==="channel_inbox"&&!message.is_needaction)){chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(messages){var options=self._getThreadRenderingOptions(messages);self.thread.remove_message_and_render(message.id,messages,options).then(function(){self._updateButtonStatus(messages.length===0,type);});});}else if(_.contains(message.channel_ids,current_channel_id)){this._fetchAndRenderThread();}},_onNewChannel:function(channel){this._updateChannels();if(channel.autoswitch){this._setChannel(channel);}},_onNewMessage:function(message){var self=this;if(_.contains(message.channel_ids,this.channel.id)){if(this.channel.type!=='static'&&this.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(this.channel);}
var should_scroll=this.thread.is_at_bottom();this._fetchAndRenderThread().then(function(){if(should_scroll){self.thread.scroll_to({id:message.id});}});}
this._updateChannels();this.channels_scrolltop=_.omit(this.channels_scrolltop,message.channel_ids);},_onPostMessage:function(message){var self=this;var options=this.selected_message?{}:{channel_id:this.channel.id};if(this.selected_message){message.subtype=this.selected_message.is_note?'mail.mt_note':'mail.mt_comment';message.subtype_id=false;message.message_type='comment';message.content_subtype='html';options.model=this.selected_message.model;options.res_id=this.selected_message.res_id;}
chat_manager.post_message(message,options).then(function(){if(self.selected_message){self._renderSnackbar('mail.chat.MessageSentSnackbar',{record_name:self.selected_message.record_name},5000);self._unselectMessage();}else{self.thread.scroll_to();}}).fail(function(){});},_onPublicChannelsClick:function(){this.do_action({name:_t('Public Channels'),type:'ir.actions.act_window',res_model:"mail.channel",views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},_onCloseNotificationBar:function(){this.$(".o_mail_annoying_notification_bar").slideUp();},_onInviteButtonClicked:function(){var title=_.str.sprintf(_t('Invite people to #%s'),this.channel.name);new PartnerInviteDialog(this,title,this.channel.id).open();},_onKeydown:function(event){if(event.which===$.ui.keyCode.ESCAPE&&this.selected_message){this._unselectMessage();}},_onRequestNotificationPermission:function(event){var self=this;event.preventDefault();this.$(".o_mail_annoying_notification_bar").slideUp();var def=window.Notification&&window.Notification.requestPermission();if(def){def.then(function(value){if(value!=='granted'){utils.send_notification(self,_t('Permission denied'),_t('Odoo will not have the permission to send native notifications on this device.'));}else{utils.send_notification(self,_t('Permission granted'),_t('Odoo has now the permission to send you native notifications on this device.'));}});}},_onSearch:function(event){var session=this.getSession();var result=pyeval.eval_domains_and_contexts({domains:event.data.domains,contexts:[session.user_context],});this.domain=result.domain;if(this.channel){this._fetchAndRenderThread();}},_onSettingsButtonClicked:function(){this.do_action({type:'ir.actions.act_window',res_model:"mail.channel",res_id:this.channel.id,views:[[false,'form']],target:'current'});},_onUnpinChannel:function(event){event.stopPropagation();var channel_id=$(event.target).data("channel-id");chat_manager.unsubscribe(chat_manager.get_channel(channel_id));},_onUnstarAllClicked:function(){chat_manager.unstar_all();},_onUnsubscribeButtonClicked:function(){chat_manager.unsubscribe(this.channel);},});core.action_registry.add('mail.chat.instant_messaging',ChatAction);return ChatAction;});;

/* /mail/static/src/js/client_action_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_client_action_mobile',function(require){"use strict";var ChatAction=require('mail.chat_client_action');var chat_manager=require('mail.chat_manager');var config=require('web.config');var core=require('web.core');var session=require('web.session');var QWeb=core.qweb;if(!config.device.isMobile){return;}
ChatAction.include({template:'mail.client_action_mobile',need_control_panel:false,events:_.extend(ChatAction.prototype.events,{'click .o_mail_mobile_tab':'_onMobileTabClicked','click .o_channel_inbox_item':'_onMobileInboxButtonClicked','click .o_mail_channel_preview':'_onMobileChannelClicked',}),init:function(){this._super.apply(this,arguments);this.currentState=this.defaultChannelID;},start:function(){this.$mainContent=this.$('.o_mail_chat_content');return this._super.apply(this,arguments).then(this._updateControlPanel.bind(this));},on_attach_callback:function(){if(this.channel&&this._isInInboxTab()){this.thread.scroll_to({offset:this.channels_scrolltop[this.channel.id]});}},on_detach_callback:function(){if(this._isInInboxTab()){this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();}},_isInInboxTab:function(){return _.contains(['channel_inbox','channel_starred'],this.currentState);},_renderButtons:function(){var self=this;this._super.apply(this,arguments);_.each(['dm','public','private'],function(type){var selector='.o_mail_chat_button_'+type;self.$buttons.on('click',selector,self._onAddChannel.bind(self));});},_restoreChannelState:function(){if(this._isInInboxTab()){this._super.apply(this,arguments);}},_selectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').addClass('o_hidden');},_setChannel:function(channel){if(channel.type!=='static'){chat_manager.detach_channel(channel);}else{this._super.apply(this,arguments);}},_storeChannelState:function(){if(this.channel&&this._isInInboxTab()){this._super.apply(this,arguments);}},_toggleSearchView:function(){this.searchviewDisplayed=!this.searchviewDisplayed;this.searchview.$el.toggleClass('o_hidden',!this.searchviewDisplayed);this.$buttons.toggleClass('o_hidden',this.searchviewDisplayed);},_unselectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').removeClass('o_hidden');},_updateChannels:function(){return this._updateContent(this.currentState);},_updateContent:function(type){var self=this;var inInbox=type==='channel_inbox'||type==='channel_starred';if(!inInbox&&this._isInInboxTab()){this._storeChannelState();}
var previouslyInInbox=this._isInInboxTab();this.currentState=type;var def;if(inInbox){def=this._fetchAndRenderThread();}else{var channels=_.where(chat_manager.get_channels(),{type:type});def=chat_manager.get_channels_preview(channels);}
return $.when(def).then(function(channelsPreview){if(inInbox){if(!previouslyInInbox){self.$('.o_mail_chat_tab_pane').remove();self.$mainContent.append(self.thread.$el);self.$mainContent.append(self.extended_composer.$el);}
self._restoreChannelState();}else{self.thread.$el.detach();self.extended_composer.$el.detach();var $content=$(QWeb.render("mail.chat.MobileTabPane",{channels:channelsPreview,get_message_body_preview:chat_manager.get_message_body_preview,moment:moment,partner_id:session.partner_id,type:type,widget:self,}));self._prepareAddChannelInput($content.find('.o_mail_add_channel input'),type);self.$mainContent.html($content);}
self.$buttons.find('button').addClass('o_hidden');self.$buttons.find('.o_mail_chat_button_'+type).removeClass('o_hidden');self.$buttons.find('.o_mail_chat_button_mark_read').toggleClass('o_hidden',type!=='channel_inbox');self.$buttons.find('.o_mail_chat_button_unstar_all').toggleClass('o_hidden',type!=='channel_starred');self.$('.o_enable_searchview').toggleClass('o_hidden',!inInbox);if(!inInbox&&self.searchviewDisplayed){self._toggleSearchView();}
if(inInbox){self.$('.o_mail_chat_mobile_inbox_buttons').removeClass('o_hidden');self.$('.o_channel_inbox_item').removeClass('btn-primary').addClass('btn-default');self.$('.o_channel_inbox_item[data-type='+type+']').removeClass('btn-default').addClass('btn-primary');}else{self.$('.o_mail_chat_mobile_inbox_buttons').addClass('o_hidden');}
self.$('.o_mail_mobile_tab').removeClass('active');type=type==='channel_starred'?'channel_inbox':type;self.$('.o_mail_mobile_tab[data-type='+type+']').addClass('active');});},_updateControlPanel:function(){this.$buttons.appendTo(this.$('.o_mail_chat_mobile_control_panel'));this.searchview.$el.appendTo(this.$('.o_mail_chat_mobile_control_panel'));var $enable_searchview=$('<button/>',{type:'button'}).addClass('o_enable_searchview btn fa fa-search').on('click',this._toggleSearchView.bind(this));$enable_searchview.insertAfter(this.searchview.$el);},_onAddChannel:function(){this.$('.o_mail_add_channel').show().find('input').focus();},_onMobileInboxButtonClicked:function(event){this._setChannel(chat_manager.get_channel($(event.currentTarget).data('type')));this._updateContent(this.channel.id);},_onMobileTabClicked:function(event){var type=$(event.currentTarget).data('type');if(type==='channel_inbox'){this._setChannel(chat_manager.get_channel('channel_inbox'));}
this._updateContent(type);},_onMobileChannelClicked:function(event){var channelId=$(event.currentTarget).data("channel_id");chat_manager.detach_channel(chat_manager.get_channel(channelId));},});});;

/* /mail/static/src/js/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatWindow',function(require){"use strict";var ChatThread=require('mail.ChatThread');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var HEIGHT_OPEN='400px';var HEIGHT_FOLDED='34px';return Widget.extend({template:"mail.ChatWindow",custom_events:{escape_pressed:'_onEscapePressed',document_viewer_closed:'_onDocumentViewerClose',},events:{'click .o_chat_composer':'_onComposerClick',"click .o_mail_thread":"_onChatWindowClicked","keydown .o_chat_composer":"on_keydown","keypress .o_chat_composer":"on_keypress","click .o_chat_window_close":"on_click_close","click .o_chat_title":"on_click_fold",},init:function(parent,channel_id,title,is_folded,unread_msgs,options){this._super(parent);this.title=title;this.channel_id=channel_id;this.folded=is_folded;this.options=_.defaults(options||{},{autofocus:true,display_stars:true,display_reply_icon:false,display_email_icon:false,placeholder:_t("Say something"),input_less:false,});this.status=this.options.status;this.unread_msgs=unread_msgs||0;this.is_hidden=false;this.isMobile=config.device.isMobile;},start:function(){this.$input=this.$('.o_composer_text_field');this.$header=this.$('.o_chat_header');this.thread=new ChatThread(this,{channel_id:this.channel_id,display_needactions:false,display_stars:this.options.display_stars,});this.thread.on('toggle_star_status',null,this.trigger.bind(this,'toggle_star_status'));this.thread.on('redirect_to_channel',null,this.trigger.bind(this,'redirect_to_channel'));this.thread.on('redirect',null,this.trigger.bind(this,'redirect'));if(this.folded){this.$el.css('height',HEIGHT_FOLDED);}else if(this.options.autofocus){this.focus_input();}
if(!config.device.isMobile){this.$el.css('margin-right',$.position.scrollbarWidth());}
var def=this.thread.replace(this.$('.o_chat_content'));return $.when(this._super(),def);},render:function(messages){this.update_unread(this.unread_msgs);this.thread.render(messages,{display_load_more:false});},update_unread:function(counter){this.unread_msgs=counter;this.render_header();},update_status:function(status){this.status=status;this.render_header();},render_header:function(){this.$header.html(QWeb.render('mail.ChatWindowHeaderContent',{status:this.status,title:this.title,unread_counter:this.unread_msgs,widget:this,}));},fold:function(){this.$el.animate({height:this.folded?HEIGHT_FOLDED:HEIGHT_OPEN},200);},toggle_fold:function(fold){this.folded=_.isBoolean(fold)?fold:!this.folded;if(!this.folded){this.thread.scroll_to();this.focus_input();}
this.fold();},focus_input:function(){if(config.device.touch&&config.device.size_class<=config.device.SIZES.SM){return;}
this.$input.focus();},do_show:function(){this.is_hidden=false;this._super.apply(this,arguments);},do_hide:function(){this.is_hidden=true;this._super.apply(this,arguments);},do_toggle:function(display){this.is_hidden=_.isBoolean(display)?!display:!this.is_hidden;this._super.apply(this,arguments);},on_keypress:function(event){event.stopPropagation();},on_keydown:function(event){event.stopPropagation();if(event.which===13){var content=_.str.trim(this.$input.val());var message={content:content,attachment_ids:[],partner_ids:[],};this.$input.val('');if(content){this.trigger('post_message',message,this.channel_id);}}},on_click_close:function(event){event.stopPropagation();event.preventDefault();this.trigger("close_chat_session");},on_click_fold:function(){if(config.device.size_class!==config.device.SIZES.XS){this.toggle_fold();this.trigger("fold_channel",this.channel_id,this.folded);}},_onChatWindowClicked:function(){var selectObj=window.getSelection();if(selectObj.anchorOffset===selectObj.focusOffset){this.$input.focus();}},_onComposerClick:function(ev){if($(ev.target).closest('a, button').length){return;}
this.focus_input();},_onDocumentViewerClose:function(ev){this.focus_input();},_onEscapePressed:function(){if(!this.folded){this.trigger("close_chat_session");}},});});;

/* /mail/static/src/js/extended_chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ExtendedChatWindow',function(require){"use strict";var core=require('web.core');var chat_manager=require('mail.chat_manager');var ChatWindow=require('mail.ChatWindow');var composer=require('mail.composer');return ChatWindow.extend({template:"mail.ExtendedChatWindow",events:_.extend({},ChatWindow.prototype.events,{"click .o_chat_window_expand":"on_click_expand",}),start:function(){var self=this;var def;if(self.options.thread_less){this.$el.addClass('o_thread_less');this.$('.o_chat_search_input input').autocomplete({source:function(request,response){chat_manager.search_partner(request.term,10).done(response);},select:function(event,ui){self.trigger('open_dm_session',ui.item.id);},}).focus();}else if(!self.options.input_less){var basic_composer=new composer.BasicComposer(self,{mention_partners_restricted:true,isMini:true});basic_composer.on('post_message',self,function(message){this.trigger('post_message',message,this.channel_id);});basic_composer.once('input_focused',self,function(){var channel=chat_manager.get_channel(this.channel_id);var commands=chat_manager.get_commands(channel);var partners=chat_manager.get_mention_partner_suggestions(channel);basic_composer.mention_set_enabled_commands(commands);basic_composer.mention_set_prefetched_partners(partners);});def=basic_composer.replace(self.$('.o_chat_composer'));}
return $.when(this._super(),def);},on_keydown:function(event){event.stopPropagation();},on_reverse_breadcrumb:function(){chat_manager.bus.trigger('client_action_open',false);},on_click_expand:_.debounce(function(event){event.preventDefault();this.do_action('mail.mail_channel_action_client_chat',{clear_breadcrumbs:false,active_id:this.channel_id,on_reverse_breadcrumb:this.on_reverse_breadcrumb});},1000,true),});});;

/* /mail/static/src/js/document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DocumentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var SCROLL_ZOOM_STEP=0.1;var ZOOM_STEP=0.5;var DocumentViewer=Widget.extend({template:"DocumentViewer",events:{'click .o_download_btn':'_onDownload','click .o_viewer_img':'_onImageClicked','click .o_viewer_video':'_onVideoClicked','click .move_next':'_onNext','click .move_previous':'_onPrevious','click .o_rotate':'_onRotate','click .o_zoom_in':'_onZoomIn','click .o_zoom_out':'_onZoomOut','click .o_close_btn, .o_viewer_img_wrapper':'_onClose','click .o_print_btn':'_onPrint','DOMMouseScroll .o_viewer_content':'_onScroll','mousewheel .o_viewer_content':'_onScroll','keydown':'_onKeydown','keyup':'_onKeyUp','mousedown .o_viewer_img':'_onStartDrag','mousemove .o_viewer_content':'_onDrag','mouseup .o_viewer_content':'_onEndDrag'},init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.attachment=_.filter(attachments,function(attachment){var match=attachment.mimetype.match("(image|video|application/pdf)");if(match){attachment.type=match[1];return true;}});this.activeAttachment=_.findWhere(attachments,{id:activeAttachmentID});this._reset();},start:function(){this.$el.modal('show');this.$el.on('hidden.bs.modal',_.bind(this._onDestroy,this));this.$('.o_viewer_img').load(_.bind(this._onImageLoaded,this));return this._super.apply(this,arguments);},_next:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=(index+1)%this.attachment.length;this.activeAttachment=this.attachment[index];this._updateContent();},_previous:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=index===0?this.attachment.length-1:index-1;this.activeAttachment=this.attachment[index];this._updateContent();},_reset:function(){this.scale=1;this.dragStartX=this.dragstopX=0;this.dragStartY=this.dragstopY=0;},_updateContent:function(){this.$('.o_viewer_content').html(QWeb.render('DocumentViewer.Content',{widget:this}));this.$('.o_viewer_img').load(_.bind(this._onImageLoaded,this));this._reset();},_getTransform:function(scale,angle){return'scale3d('+scale+', '+scale+', 1) rotate('+angle+'deg)'},_rotate:function(angle){this._reset();var new_angle=(this.angle||0)+angle;this.$('.o_viewer_img').css('transform',this._getTransform(this.scale,new_angle));this.$('.o_viewer_img').css('max-width',new_angle%180!==0?$(document).height():'100%');this.$('.o_viewer_img').css('max-height',new_angle%180!==0?$(document).width():'100%');this.angle=new_angle;},_zoom:function(scale){if(scale>0.5){this.$('.o_viewer_img').css('transform',this._getTransform(scale,this.angle||0));this.scale=scale;}},_onClose:function(e){e.preventDefault();this.$el.modal('hide');this.trigger_up('document_viewer_closed');},_onDestroy:function(){if(this.isDestroyed()){return;}
this.$el.modal('hide');this.$el.remove();},_onDownload:function(e){e.preventDefault();window.location='/web/content/'+this.activeAttachment.id+'?download=true';},_onDrag:function(e){e.preventDefault();if(this.enableDrag){var $image=this.$('.o_viewer_img');var $zoomer=this.$('.o_viewer_zoomer');var top=$image.prop('offsetHeight')*this.scale>$zoomer.height()?e.clientY-this.dragStartY:0;var left=$image.prop('offsetWidth')*this.scale>$zoomer.width()?e.clientX-this.dragStartX:0;$zoomer.css("transform","translate3d("+left+"px, "+top+"px, 0)");}},_onEndDrag:function(e){e.preventDefault();if(this.enableDrag){this.enableDrag=false;this.dragstopX=e.clientX-this.dragStartX;this.dragstopY=e.clientY-this.dragStartY;}},_onImageClicked:function(e){e.stopPropagation();},_onImageLoaded:function(){this.$('.o_loading_img').hide();},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.RIGHT:e.preventDefault();this._next();break;case $.ui.keyCode.LEFT:e.preventDefault();this._previous();break;}},_onKeyUp:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._onClose(e);break;}},_onNext:function(e){e.preventDefault();this._next();},_onPrevious:function(e){e.preventDefault();this._previous();},_onPrint:function(e){e.preventDefault();var src=this.$('.o_viewer_img').prop('src');var script=QWeb.render('PrintImage',{src:src});var printWindow=window.open('about:blank',"_new");printWindow.document.open();printWindow.document.write(script);printWindow.document.close();},_onScroll:function(e){var scale;if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){scale=this.scale+SCROLL_ZOOM_STEP;this._zoom(scale);}else{scale=this.scale-SCROLL_ZOOM_STEP;this._zoom(scale);}},_onStartDrag:function(e){e.preventDefault();this.enableDrag=true;this.dragStartX=e.clientX-(this.dragstopX||0);this.dragStartY=e.clientY-(this.dragstopY||0);},_onVideoClicked:function(e){e.stopPropagation();var videoElement=e.target;if(videoElement.paused){videoElement.play();}else{videoElement.pause();}},_onRotate:function(e){e.preventDefault();this._rotate(90);},_onZoomIn:function(e){e.preventDefault();var scale=this.scale+ZOOM_STEP;this._zoom(scale);},_onZoomOut:function(e){e.preventDefault();var scale=this.scale-ZOOM_STEP;this._zoom(scale);},});return DocumentViewer;});;

/* /mail/static/src/js/composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer',function(require){"use strict";var chat_mixin=require('mail.chat_mixin');var DocumentViewer=require('mail.DocumentViewer');var utils=require('mail.utils');var config=require('web.config');var core=require('web.core');var data=require('web.data');var dom=require('web.dom');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var NON_BREAKING_SPACE='\u00a0';var MENTION_PARTNER_DELIMITER='@';var MENTION_CHANNEL_DELIMITER='#';var MENTION_CANNED_RESPONSE_DELIMITER=':';var MENTION_COMMAND_DELIMITER='/';var MentionManager=Widget.extend({className:'dropup o_composer_mention_dropdown',events:{"mouseover .o_mention_proposition":"on_hover_mention_proposition","click .o_mention_proposition":"on_click_mention_item",},init:function(parent,options){this._super.apply(this,arguments);this.composer=parent;this.options=_.extend({},options,{min_length:0,});this.open=false;this.listeners=[];this.set('mention_suggestions',[]);this.on('change:mention_suggestions',this,this._render_suggestions);},on_hover_mention_proposition:function(event){var $elem=$(event.currentTarget);this.$('.o_mention_proposition').removeClass('active');$elem.addClass('active');},on_click_mention_item:function(event){event.preventDefault();var text_input=this.composer.$input.val();var id=$(event.currentTarget).data('id');var selected_suggestion=_.find(_.flatten(this.get('mention_suggestions')),function(s){return s.id===id;});var substitution=selected_suggestion.substitution;if(!substitution){selected_suggestion.name=selected_suggestion.name.replace(/ /g,NON_BREAKING_SPACE);substitution=this.active_listener.delimiter+selected_suggestion.name;}
var get_mention_index=function(matches,cursor_position){for(var i=0;i<matches.length;i++){if(cursor_position<=matches[i].index){return i;}}
return i;};if(this.active_listener.selection.length){var matches=this._get_match(text_input,this.active_listener);var index=get_mention_index(matches,this._get_selection_positions().start);this.active_listener.selection.splice(index,0,selected_suggestion);}else{this.active_listener.selection.push(selected_suggestion);}
var cursor_position=this._get_selection_positions().start;var text_left=text_input.substring(0,cursor_position-(this.mention_word.length+1));var text_right=text_input.substring(cursor_position,text_input.length);var text_input_new=text_left+substitution+' '+text_right;this.composer.$input.val(text_input_new);this._set_cursor_position(text_left.length+substitution.length+2);this.set('mention_suggestions',[]);this.composer.focus();},register:function(listener){this.listeners.push(_.defaults(listener,{model:'',redirect_classname:'',selection:[],}));},is_open:function(){return this.open;},get_listener_selection:function(delimiter){var listener=_.findWhere(this.listeners,{delimiter:delimiter});if(listener){var input_mentions=this.composer.$input.val().match(new RegExp(delimiter+'[^ ]+(?= |&nbsp;)','g'));return this._validate_selection(listener.selection,input_mentions);}
return[];},get_listener_selections:function(){var selections={};_.each(this.listeners,function(listener){selections[listener.delimiter]=listener.selection;});return selections;},detect_delimiter:function(){var self=this;var text_val=this.composer.$input.val();var cursor_position=this._get_selection_positions().start;var left_string=text_val.substring(0,cursor_position);function validate_keyword(delimiter,beginning_only){var delimiter_position=left_string.lastIndexOf(delimiter)-1;if(beginning_only&&delimiter_position>0){return false;}
var search_str=text_val.substring(delimiter_position,cursor_position);var pattern="(^"+delimiter+"|(^\\s"+delimiter+"))";var regex_start=new RegExp(pattern,"g");search_str=search_str.replace(/^\s\s*|^[\n\r]/g,'');if(regex_start.test(search_str)&&search_str.length>self.options.min_length){search_str=search_str.replace(pattern,'');return search_str.indexOf(' ')<0&&!/[\r\n]/.test(search_str)?search_str.replace(delimiter,''):false;}
return false;}
this.active_listener=undefined;for(var i=0;i<this.listeners.length;i++){var listener=this.listeners[i];this.mention_word=validate_keyword(listener.delimiter,listener.beginning_only);if(this.mention_word!==false){this.active_listener=listener;break;}}
if(this.active_listener){var mention_word=this.mention_word;$.when(this.active_listener.fetch_callback(mention_word)).then(function(suggestions){if(mention_word===self.mention_word){self.set('mention_suggestions',suggestions);}});}else{this.set('mention_suggestions',[]);}},generate_links:function(s){var self=this;var base_href=session.url("/web");var mention_link="<a href='%s' class='%s' data-oe-id='%s' data-oe-model='%s' target='_blank'>%s%s</a>";_.each(this.listeners,function(listener){if(!listener.generate_links){return;}
var selection=listener.selection;if(selection.length){var matches=self._get_match(s,listener);var substrings=[];var start_index=0;for(var i=0;i<matches.length;i++){var match=matches[i];var end_index=match.index+match[0].length;var selection_id=self.get_selection_id(match,selection);var match_name=match[0].substring(1).replace(new RegExp(NON_BREAKING_SPACE,'g'),' ');var href=base_href+_.str.sprintf("#model=%s&id=%s",listener.model,selection_id);var processed_text=_.str.sprintf(mention_link,href,listener.redirect_classname,selection_id,listener.model,listener.delimiter,match_name);var subtext=s.substring(start_index,end_index).replace(match[0],processed_text);substrings.push(subtext);start_index=end_index;}
substrings.push(s.substring(start_index,s.length));s=substrings.join('');}});return s;},get_selection_id:function(match,selection){return _.findWhere(selection,{'name':match[0].slice(1)}).id;},reset_suggestions:function(){this.set('mention_suggestions',[]);},reset_selections:function(){_.each(this.listeners,function(listener){listener.selection=[];});},_get_match:function(input_text,listener){var names=_.pluck(listener.selection,'name');var escaped_names=_.map(names,function(str){return"("+_.str.escapeRegExp(listener.delimiter+str)+")(?= |&nbsp;)";});var regex_str=escaped_names.join('|');var result=[];if(regex_str.length){var myRegexp=new RegExp(regex_str,'g');var match=myRegexp.exec(input_text);while(match!==null){result.push(match);match=myRegexp.exec(input_text);}}
return result;},_propositionNavigation:function(keycode){var $active=this.$('.o_mention_proposition.active');if(keycode===$.ui.keyCode.ENTER){$active.click();}else{var $to;if(keycode===$.ui.keyCode.DOWN){$to=$active.nextAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.UP){$to=$active.prevAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.TAB){$to=$active.nextAll('.o_mention_proposition').first();if(!$to.length){$to=$active.prevAll('.o_mention_proposition').last();}}
if($to&&$to.length){$active.removeClass('active');$to.addClass('active');}}},_render_suggestions:function(){var suggestions=[];if(_.find(this.get('mention_suggestions'),_.isArray)){var insert_divider=false;_.each(this.get('mention_suggestions'),function(suggestion_group){if(suggestion_group.length>0){if(insert_divider){suggestions.push({divider:true});}
suggestions=suggestions.concat(suggestion_group);insert_divider=true;}});}else{suggestions=this.get('mention_suggestions');}
if(suggestions.length){this.$el.html(QWeb.render(this.active_listener.suggestion_template,{suggestions:suggestions,}));this.$el.addClass('open').find('ul').css("max-width",this.composer.$input.width()).find('.o_mention_proposition').first().addClass('active');this.open=true;}else{this.$el.removeClass('open');this.$el.empty();this.open=false;}},_validate_selection:function(selection,input_mentions){var validated_selection=[];_.each(input_mentions,function(mention){var validated_mention=_.findWhere(selection,{name:mention.slice(1)});if(validated_mention){validated_selection.push(validated_mention);}});return validated_selection;},_get_selection_positions:function(){var el=this.composer.$input.get(0);return el?dom.getSelectionRange(el):{start:0,end:0};},_set_cursor_position:function(pos){this.composer.$input.each(function(index,elem){dom.setSelectionRange(elem,{start:pos,end:pos});});},});var BasicComposer=Widget.extend(chat_mixin,{template:"mail.ChatComposer",events:{"keydown .o_composer_input textarea":"on_keydown","keyup .o_composer_input":"on_keyup","change input.o_input_file":"on_attachment_change","click .o_composer_button_send":"send_message","click .o_composer_button_add_attachment":"on_click_add_attachment","click .o_attachment_delete":"on_attachment_delete","click .o_attachment_download":"_onAttachmentDownload","click .o_attachment_view":"_onAttachmentView",'click .o_composer_button_emoji':'_onEmojiButtonClick','focusout .o_composer_button_emoji':'_onEmojiButtonFocusout','focus .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageFocus','click .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageClick',},MENTION_THROTTLE:200,init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{commands_enabled:true,context:{},input_baseline:18,input_max_height:150,input_min_height:28,mention_fetch_limit:8,mention_partners_restricted:false,send_text:_t('Send'),default_body:'',default_mention_selections:{},isMobile:config.device.isMobile});this.context=this.options.context;this.AttachmentDataSet=new data.DataSetSearch(this,'ir.attachment',this.context);this.fileupload_id=_.uniqueId('o_chat_fileupload');this.set('attachment_ids',[]);this.mention_manager=new MentionManager(this);this.mention_manager.register({delimiter:MENTION_PARTNER_DELIMITER,fetch_callback:this.mention_fetch_partners.bind(this),generate_links:true,model:'res.partner',redirect_classname:'o_mail_redirect',selection:this.options.default_mention_selections[MENTION_PARTNER_DELIMITER],suggestion_template:'mail.MentionPartnerSuggestions',});this.mention_manager.register({delimiter:MENTION_CHANNEL_DELIMITER,fetch_callback:this.mention_fetch_channels.bind(this),generate_links:true,model:'mail.channel',redirect_classname:'o_channel_redirect',selection:this.options.default_mention_selections[MENTION_CHANNEL_DELIMITER],suggestion_template:'mail.MentionChannelSuggestions',});this.mention_manager.register({delimiter:MENTION_CANNED_RESPONSE_DELIMITER,fetch_callback:this.mention_get_canned_responses.bind(this),selection:this.options.default_mention_selections[MENTION_CANNED_RESPONSE_DELIMITER],suggestion_template:'mail.MentionCannedResponseSuggestions',});if(this.options.commands_enabled){this.mention_manager.register({beginning_only:true,delimiter:MENTION_COMMAND_DELIMITER,fetch_callback:this.mention_get_commands.bind(this),selection:this.options.default_mention_selections[MENTION_COMMAND_DELIMITER],suggestion_template:'mail.MentionCommandSuggestions',});}
this.isMini=options.isMini;this.avatarURL=session.uid>0?session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid,}):'/web/static/src/img/user_menu_avatar.png';},start:function(){var self=this;this.$attachment_button=this.$(".o_composer_button_add_attachment");this.$attachments_list=this.$('.o_composer_attachments_list');this.$input=this.$('.o_composer_input textarea');this.$input.focus(function(){self.trigger('input_focused');});this.$input.val(this.options.default_body);dom.autoresize(this.$input,{parent:this,min_height:this.options.input_min_height});$(window).on(this.fileupload_id,this.on_attachment_loaded);this.on("change:attachment_ids",this,this.render_attachments);this.mention_manager.prependTo(this.$('.o_composer'));return this._super();},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},preprocess_message:function(){var value=_.escape(this.$input.val()).replace(/\n|\r/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');var commands=this.options.commands_enabled?this.mention_manager.get_listener_selection('/'):[];return $.when({content:this.mention_manager.generate_links(value),attachment_ids:_.pluck(this.get('attachment_ids'),'id'),partner_ids:_.uniq(_.pluck(this.mention_manager.get_listener_selection('@'),'id')),command:commands.length>0?commands[0].name:undefined,});},send_message:function(){if(this.is_empty()||!this.do_check_attachment_upload()){return;}
clearTimeout(this.canned_timeout);var self=this;this.preprocess_message().then(function(message){self.trigger('post_message',message);self.clear_composer_on_send();self.$input.focus();});},clear_composer:function(){this.$input.val('');this.mention_manager.reset_selections();this.set('attachment_ids',[]);},clear_composer_on_send:function(){this.clear_composer();},getState:function(){return{attachments:this.get('attachment_ids'),text:this.$input.val(),};},on_click_add_attachment:function(){this.$('input.o_input_file').click();this.$input.focus();this.ignoreEscape=true;},setState:function(state){this.set('attachment_ids',state.attachments);this.$input.val(state.text);},should_send:function(event){return!event.shiftKey;},on_keydown:function(event){switch(event.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this.mention_manager.is_open()){event.preventDefault();}
break;case $.ui.keyCode.ENTER:if(this.mention_manager.is_open()){event.preventDefault();}else{var send_message=event.ctrlKey||this.should_send(event);if(send_message){event.preventDefault();this.send_message();}}
break;}},on_keyup:function(event){switch(event.which){case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:break;case $.ui.keyCode.ESCAPE:if(this.mention_manager.is_open()){event.stopPropagation();this.mention_manager.reset_suggestions();}else if(this.ignoreEscape){this.ignoreEscape=false;}else{this.trigger_up("escape_pressed");}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this.mention_manager.is_open()){this.mention_manager._propositionNavigation(event.which);}
break;default:this.mention_manager.detect_delimiter();}},on_attachment_change:function(event){var self=this,files=event.target.files,attachments=self.get('attachment_ids');_.each(files,function(file){var attachment=_.findWhere(attachments,{name:file.name});if(attachment){self.AttachmentDataSet.unlink([attachment.id]);attachments=_.without(attachments,attachment);}});this.$('form.o_form_binary_form').submit();this.$attachment_button.prop('disabled',true);var upload_attachments=_.map(files,function(file){return{'id':0,'name':file.name,'filename':file.name,'url':'','upload':true,'mimetype':'',};});attachments=attachments.concat(upload_attachments);this.set('attachment_ids',attachments);},on_attachment_loaded:function(event){var self=this,attachments=this.get('attachment_ids'),files=Array.prototype.slice.call(arguments,1);_.each(files,function(file){if(file.error||!file.id){this.do_warn(file.error);attachments=_.filter(attachments,function(attachment){return!attachment.upload;});}else{var attachment=_.findWhere(attachments,{filename:file.filename,upload:true});if(attachment){attachments=_.without(attachments,attachment);attachments.push({'id':file.id,'name':file.name||file.filename,'filename':file.filename,'mimetype':file.mimetype,'url':session.url('/web/content',{'id':file.id,download:true}),});}}}.bind(this));this.set('attachment_ids',attachments);this.$attachment_button.prop('disabled',false);},on_attachment_delete:function(event){event.stopPropagation();var self=this;var attachment_id=$(event.target).data("id");if(attachment_id){var attachments=[];_.each(this.get('attachment_ids'),function(attachment){if(attachment_id!==attachment.id){attachments.push(attachment);}else{self.AttachmentDataSet.unlink([attachment_id]);}});this.set('attachment_ids',attachments);this.$('input.o_input_file').val('');}},do_check_attachment_upload:function(){if(_.find(this.get('attachment_ids'),function(file){return file.upload;})){this.do_warn(_t("Uploading error"),_t("Please, wait while the file is uploading."));return false;}
return true;},render_attachments:function(){this.$attachments_list.html(QWeb.render('mail.ChatComposer.Attachments',{attachments:this.get('attachment_ids'),}));},mention_fetch_throttled:function(model,method,kwargs){var self=this;var def=$.Deferred();clearTimeout(this.mention_fetch_timer);this.mention_fetch_timer=setTimeout(function(){return self._rpc({model:model,method:method,kwargs:kwargs}).then(function(results){def.resolve(results);});},this.MENTION_THROTTLE);return def;},mention_fetch_channels:function(search){return this.mention_fetch_throttled('mail.channel','get_mention_suggestions',{limit:this.options.mention_fetch_limit,search:search,}).then(function(suggestions){return _.partition(suggestions,function(suggestion){return _.contains(['public','groups'],suggestion.public);});});},mention_fetch_partners:function(search){var self=this;return $.when(this.mention_prefetched_partners).then(function(prefetched_partners){var suggestions=[];var limit=self.options.mention_fetch_limit;var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');_.each(prefetched_partners,function(partners){if(limit>0){var filtered_partners=_.filter(partners,function(partner){return partner.email&&search_regexp.test(partner.email)||partner.name&&search_regexp.test(utils.unaccent(partner.name));});if(filtered_partners.length){suggestions.push(filtered_partners.slice(0,limit));limit-=filtered_partners.length;}}});if(!suggestions.length&&!self.options.mention_partners_restricted){suggestions=self.mention_fetch_throttled('res.partner','get_mention_suggestions',{limit:limit,search:search,});}
return suggestions;});},mention_get_canned_responses:function(search){var self=this;var def=$.Deferred();clearTimeout(this.canned_timeout);this.canned_timeout=setTimeout(function(){var canned_responses=self._getCannedResponses();var matches=fuzzy.filter(utils.unaccent(search),_.pluck(canned_responses,'source'));var indexes=_.pluck(matches.slice(0,self.options.mention_fetch_limit),'index');def.resolve(_.map(indexes,function(i){return canned_responses[i];}));},500);return def;},mention_get_commands:function(search){var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');return _.filter(this.mention_commands,function(command){return search_regexp.test(command.name);}).slice(0,this.options.mention_fetch_limit);},mention_set_prefetched_partners:function(prefetched_partners){this.mention_prefetched_partners=prefetched_partners;},mention_set_enabled_commands:function(commands){this.mention_commands=commands;},mention_get_listener_selections:function(){return this.mention_manager.get_listener_selections();},is_empty:function(){return!this.$input.val().trim()&&!this.$('.o_attachments').children().length;},focus:function(){this.$input.focus();},_hideEmojis:function(){this.$emojisContainer.remove();},_onAttachmentDownload:function(event){event.stopPropagation();},_onAttachmentView:function(event){event.stopPropagation();var activeAttachmentID=$(event.currentTarget).data('id');var attachments=this.get('attachment_ids');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onEmojiButtonClick:function(){if(!this.$emojisContainer){this.$emojisContainer=$(QWeb.render('mail.ChatComposer.emojis',{emojis:this._getEmojis(),}));}
if(this.$emojisContainer.parent().length){this._hideEmojis();}else{this.$emojisContainer.appendTo(this.$('.o_composer'));}},_onEmojiButtonFocusout:function(){if(this.$emojisContainer){this._hideEmojisTimeout=setTimeout(this._hideEmojis.bind(this),0);}},_onEmojiImageFocus:function(){clearTimeout(this._hideEmojisTimeout);},_onEmojiImageClick:function(ev){this.$input.val(this.$input.val()+" "+$(ev.currentTarget).data('emoji')+" ");this.$input.focus();this._hideEmojis();},});var ExtendedComposer=BasicComposer.extend({init:function(parent,options){options=_.defaults(options||{},{input_min_height:120,});this._super(parent,options);this.extended=true;},start:function(){this.$subject_input=this.$(".o_composer_subject input");return this._super.apply(this,arguments);},preprocess_message:function(){var self=this;return this._super().then(function(message){var subject=self.$subject_input.val();self.$subject_input.val("");message.subject=subject;return message;});},clear_composer:function(){this._super.apply(this,arguments);this.$subject_input.val('');},getState:function(){var state=this._super.apply(this,arguments);state.subject=this.$subject_input.val();return state;},should_send:function(){return false;},focus:function(target){if(target==='body'){this.$input.focus();}else{this.$subject_input.focus();}},set_subject:function(subject){this.$('.o_composer_subject input').val(subject);},setState:function(state){this._super.apply(this,arguments);this.set_subject(state.subject);},});return{BasicComposer:BasicComposer,ExtendedComposer:ExtendedComposer,};});;

/* /mail/static/src/js/chat_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_manager',function(require){"use strict";var bus=require('bus.bus').bus;var utils=require('mail.utils');var config=require('web.config');var Bus=require('web.Bus');var core=require('web.core');var session=require('web.session');var time=require('web.time');var web_client=require('web.web_client');var Class=require('web.Class');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var _t=core._t;var _lt=core._lt;var LIMIT=25;var preview_msg_max_size=350;var ODOOBOT_ID="ODOOBOT";var messages=[];var channels=[];var channels_preview_def;var channel_defs={};var chat_unread_counter=0;var unread_conversation_counter=0;var emojis=[];var emoji_substitutions={};var emoji_unicodes={};var needaction_counter=0;var starred_counter=0;var mention_partner_suggestions=[];var canned_responses=[];var commands=[];var discuss_menu_id;var global_unread_counter=0;var pinned_dm_partners=[];var client_action_open=false;bus.on("window_focus",null,function(){global_unread_counter=0;web_client.set_title_part("_chat");});function notify_incoming_message(msg,options){if(bus.is_odoo_focused()&&options.is_displayed){return;}
var title=_t('New message');if(msg.author_id[1]){title=_.escape(msg.author_id[1]);}
var content=utils.parse_and_transform(msg.body,utils.strip_html).substr(0,preview_msg_max_size);if(!bus.is_odoo_focused()){global_unread_counter++;var tab_title=_.str.sprintf(_t("%d Messages"),global_unread_counter);web_client.set_title_part("_chat",tab_title);}
utils.send_notification(web_client,title,content);}
function add_message(data,options){options=options||{};var msg=_.findWhere(messages,{id:data.id});if(!msg){msg=chat_manager.make_message(data);messages.splice(_.sortedIndex(messages,msg,'id'),0,msg);_.each(msg.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){if(!channel.last_message||msg.id>channel.last_message.id){channel.last_message=msg;}
add_to_cache(msg,[]);if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
if(channel.hidden){channel.hidden=false;chat_manager.bus.trigger('new_channel',channel);}
if(channel.type!=='static'&&!msg.is_author&&!msg.is_system_notification){if(options.increment_unread){update_channel_unread_counter(channel,channel.unread_counter+1);}
if(channel.is_chat&&options.show_notification){if(!client_action_open&&!config.device.isMobile){chat_manager.bus.trigger('open_chat',channel,{passively:true});}
var query={is_displayed:false};chat_manager.bus.trigger('anyone_listening',channel,query);notify_incoming_message(msg,query);}}}});if(!options.silent){chat_manager.bus.trigger('new_message',msg);}}else if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
return msg;}
function make_message(data){var msg={id:data.id,author_id:data.author_id,body:data.body||"",date:moment(time.str_to_datetime(data.date)),message_type:data.message_type,subtype_description:data.subtype_description,is_author:data.author_id&&data.author_id[0]===session.partner_id,is_note:data.is_note,is_system_notification:(data.message_type==='notification'&&data.model==='mail.channel')||data.info==='transient_message',attachment_ids:data.attachment_ids||[],subject:data.subject,email_from:data.email_from,customer_email_status:data.customer_email_status,customer_email_data:data.customer_email_data,record_name:data.record_name,tracking_value_ids:data.tracking_value_ids,channel_ids:data.channel_ids,model:data.model,res_id:data.res_id,url:session.url("/mail/view?message_id="+data.id),module_icon:data.module_icon,};_.each(_.keys(emoji_substitutions),function(key){var escaped_key=String(key).replace(/([.*+?=^!:${}()|[\]\/\\])/g,'\\$1');var regexp=new RegExp("(?:^|\\s|<[a-z]*>)("+escaped_key+")(?=\\s|$|</[a-z]*>)","g");var msg_bak=msg.body;msg.body=msg.body.replace(regexp,' <span class="o_mail_emoji">'+emoji_substitutions[key]+'</span> ');if(_.str.count(msg.body,'o_mail_emoji')>200){msg.body=msg_bak;}});function property_descr(channel){return{enumerable:true,get:function(){return _.contains(msg.channel_ids,channel);},set:function(bool){if(bool){add_channel_to_message(msg,channel);}else{msg.channel_ids=_.without(msg.channel_ids,channel);}}};}
Object.defineProperties(msg,{is_starred:property_descr("channel_starred"),is_needaction:property_descr("channel_inbox"),});if(_.contains(data.needaction_partner_ids,session.partner_id)){msg.is_needaction=true;}
if(_.contains(data.starred_partner_ids,session.partner_id)){msg.is_starred=true;}
if(msg.model==='mail.channel'){var real_channels=_.without(msg.channel_ids,'channel_inbox','channel_starred');var origin=real_channels.length===1?real_channels[0]:undefined;var channel=origin&&chat_manager.get_channel(origin);if(channel){msg.origin_id=origin;msg.origin_name=channel.name;}}
if((!msg.author_id||!msg.author_id[0])&&msg.email_from){msg.mailto=msg.email_from;}else{msg.displayed_author=(msg.author_id===ODOOBOT_ID)&&"OdooBot"||msg.author_id&&msg.author_id[1]||msg.email_from||_t('Anonymous');}
msg.author_redirect=!msg.is_author&&msg.author_id!==ODOOBOT_ID;if(msg.author_id===ODOOBOT_ID){msg.avatar_src="/mail/static/src/img/odoo_o.png";}else if(msg.author_id&&msg.author_id[0]){msg.avatar_src="/web/image/res.partner/"+msg.author_id[0]+"/image_small";}else if(msg.message_type==='email'){msg.avatar_src="/mail/static/src/img/email_icon.png";}else{msg.avatar_src="/mail/static/src/img/smiley/avatar.jpg";}
msg.body=utils.parse_and_transform(msg.body,utils.add_link);_.each(msg.attachment_ids,function(a){a.url='/web/content/'+a.id+'?download=true';});if(msg.tracking_value_ids&&msg.tracking_value_ids.length){_.each(msg.tracking_value_ids,function(f){if(f.field_type==='datetime'){var format='LLL';if(f.old_value){f.old_value=moment.utc(f.old_value).local().format(format);}
if(f.new_value){f.new_value=moment.utc(f.new_value).local().format(format);}}else if(f.field_type==='date'){var format='LL';if(f.old_value){f.old_value=moment(f.old_value).local().format(format);}
if(f.new_value){f.new_value=moment(f.new_value).local().format(format);}}});}
return msg;}
function add_channel_to_message(message,channel_id){message.channel_ids.push(channel_id);message.channel_ids=_.uniq(message.channel_ids);}
function add_channel(data,options){options=typeof options==="object"?options:{};var channel=chat_manager.get_channel(data.id);if(channel){if(channel.is_folded!==(data.state==="folded")){channel.is_folded=(data.state==="folded");chat_manager.bus.trigger("channel_toggle_fold",channel);}}else{channel=chat_manager.make_channel(data,options);channels.push(channel);if(data.last_message){channel.last_message=add_message(data.last_message);}
channels=_.sortBy(channels,function(channel){return _.isString(channel.name)?channel.name.toLowerCase():''});if(!options.silent){chat_manager.bus.trigger("new_channel",channel);}
if(channel.is_detached){chat_manager.bus.trigger("open_chat",channel);}}
return channel;}
function make_channel(data,options){var channel={id:data.id,name:data.name,server_type:data.channel_type,type:data.type||data.channel_type,all_history_loaded:false,uuid:data.uuid,is_detached:data.is_minimized,is_folded:data.state==="folded",autoswitch:'autoswitch'in options?options.autoswitch:true,hidden:options.hidden,display_needactions:options.display_needactions,mass_mailing:data.mass_mailing,group_based_subscription:data.group_based_subscription,needaction_counter:data.message_needaction_counter||0,unread_counter:0,last_seen_message_id:data.seen_message_id,cache:{'[]':{all_history_loaded:false,loaded:false,messages:[],}},};if(channel.type==="channel"){channel.type=data.public!=="private"?"public":"private";}
if(_.size(data.direct_partner)>0){channel.type="dm";channel.name=data.direct_partner[0].name;channel.direct_partner_id=data.direct_partner[0].id;channel.status=data.direct_partner[0].im_status;pinned_dm_partners.push(channel.direct_partner_id);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}else if('anonymous_name'in data){channel.name=data.anonymous_name;}
if(data.last_message_date){channel.last_message_date=moment(time.str_to_datetime(data.last_message_date));}
channel.is_chat=!channel.type.match(/^(public|private|static)$/);if(data.message_unread_counter){update_channel_unread_counter(channel,data.message_unread_counter);}
return channel;}
function remove_channel(channel){if(!channel){return;}
if(channel.type==='dm'){var index=pinned_dm_partners.indexOf(channel.direct_partner_id);if(index>-1){pinned_dm_partners.splice(index,1);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}}
channels=_.without(channels,channel);delete channel_defs[channel.id];}
function get_channel_cache(channel,domain){var stringified_domain=JSON.stringify(domain||[]);if(!channel.cache[stringified_domain]){channel.cache[stringified_domain]={all_history_loaded:false,loaded:false,messages:[],};}
return channel.cache[stringified_domain];}
function invalidate_caches(channel_ids){_.each(channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.cache={'[]':channel.cache['[]']};}});}
function add_to_cache(message,domain){_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){var channel_cache=get_channel_cache(channel,domain);var index=_.sortedIndex(channel_cache.messages,message,'id');if(channel_cache.messages[index]!==message){channel_cache.messages.splice(index,0,message);}}});}
function remove_message_from_channel(channel_id,message){message.channel_ids=_.without(message.channel_ids,channel_id);var channel=_.findWhere(channels,{id:channel_id});_.each(channel.cache,function(cache){cache.messages=_.without(cache.messages,message);});}
function update_channel_unread_counter(channel,counter){if(channel.unread_counter>0&&counter===0){unread_conversation_counter=Math.max(0,unread_conversation_counter-1);}else if(channel.unread_counter===0&&counter>0){unread_conversation_counter++;}
if(channel.is_chat){chat_unread_counter=Math.max(0,chat_unread_counter-channel.unread_counter+counter);}
channel.unread_counter=counter;chat_manager.bus.trigger("update_channel_unread_counter",channel);}
function on_notification(notifications){var unsubscribed_notif=_.find(notifications,function(notif){return notif[1].info==="unsubscribe";});if(unsubscribed_notif){notifications=_.reject(notifications,function(notif){return notif[0][1]==="mail.channel"&&notif[0][2]===unsubscribed_notif[1].id;});}
_.each(notifications,function(notification){var model=notification[0][1];if(model==='ir.needaction'){on_needaction_notification(notification[1]);}else if(model==='mail.channel'){on_channel_notification(notification[1]);}else if(model==='res.partner'){on_partner_notification(notification[1]);}else if(model==='bus.presence'){on_presence_notification(notification[1]);}});}
function on_needaction_notification(message){message=add_message(message,{channel_id:'channel_inbox',show_notification:true,increment_unread:true,});invalidate_caches(message.channel_ids);if(message.channel_ids.length!==0){needaction_counter++;}
_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter++;}});chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_notification(message){var def;var channel_already_in_cache=true;if(message.channel_ids.length===1){channel_already_in_cache=!!chat_manager.get_channel(message.channel_ids[0]);def=chat_manager.join_channel(message.channel_ids[0],{autoswitch:false});}else{def=$.when();}
def.then(function(){add_message(message,{show_notification:true,increment_unread:channel_already_in_cache});invalidate_caches(message.channel_ids);});}
function on_partner_notification(data){if(data.info==="unsubscribe"){var channel=chat_manager.get_channel(data.id);if(channel){var msg;if(_.contains(['public','private'],channel.type)){msg=_.str.sprintf(_t('You unsubscribed from <b>%s</b>.'),channel.name);}else{msg=_.str.sprintf(_t('You unpinned your conversation with <b>%s</b>.'),channel.name);}
remove_channel(channel);chat_manager.bus.trigger("unsubscribe_from_channel",data.id);web_client.do_notify(_t("Unsubscribed"),msg);}}else if(data.type==='toggle_star'){on_toggle_star_notification(data);}else if(data.type==='mark_as_read'){on_mark_as_read_notification(data);}else if(data.type==='mark_as_unread'){on_mark_as_unread_notification(data);}else if(data.info==='channel_seen'){on_channel_seen_notification(data);}else if(data.info==='transient_message'){on_transient_message_notification(data);}else if(data.type==='activity_updated'){onActivityUpdateNodification(data);}else{on_chat_session_notification(data);}}
function on_toggle_star_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);message.is_starred=data.starred;if(!message.is_starred){remove_message_from_channel("channel_starred",message);starred_counter--;}else{add_to_cache(message,[]);var channel_starred=chat_manager.get_channel('channel_starred');channel_starred.cache=_.pick(channel_starred.cache,"[]");starred_counter++;}
chat_manager.bus.trigger('update_message',message);}});chat_manager.bus.trigger('update_starred',starred_counter);}
function on_mark_as_read_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);remove_message_from_channel("channel_inbox",message);chat_manager.bus.trigger('update_message',message,data.type);}});if(data.channel_ids){_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter=Math.max(channel.needaction_counter-data.message_ids.length,0);}});}else{_.each(channels,function(channel){channel.needaction_counter=0;});}
needaction_counter=Math.max(needaction_counter-data.message_ids.length,0);chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_mark_as_unread_notification(data){_.each(data.message_ids,function(message_id){var message=_.findWhere(messages,{id:message_id});if(message){invalidate_caches(message.channel_ids);add_channel_to_message(message,'channel_inbox');add_to_cache(message,[]);}});var channel_inbox=chat_manager.get_channel('channel_inbox');channel_inbox.cache=_.pick(channel_inbox.cache,"[]");_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter+=data.message_ids.length;}});needaction_counter+=data.message_ids.length;chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_seen_notification(data){var channel=chat_manager.get_channel(data.id);if(channel){channel.last_seen_message_id=data.last_message_id;if(channel.unread_counter){update_channel_unread_counter(channel,0);}}}
function on_chat_session_notification(chat_session){var channel;if((chat_session.channel_type==="channel")&&(chat_session.state==="open")){add_channel(chat_session,{autoswitch:false});if(!chat_session.is_minimized&&chat_session.info!=='creation'){web_client.do_notify(_t("Invitation"),_t("You have been invited to: ")+chat_session.name);}}
if((chat_session.state==="open")||(chat_session.state==="folded")){channel=chat_session.is_minimized&&chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=true;channel.is_folded=(chat_session.state==="folded");chat_manager.bus.trigger("open_chat",channel);}}else if(chat_session.state==="closed"){channel=chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=false;chat_manager.bus.trigger("close_chat",channel,{keep_open_if_unread:true});}}}
function on_presence_notification(data){var dm=chat_manager.get_dm_from_partner_id(data.id);if(dm){dm.status=data.im_status;chat_manager.bus.trigger('update_dm_presence',dm);}}
function on_transient_message_notification(data){var last_message=_.last(messages);data.id=(last_message?last_message.id:0)+0.01;data.author_id=data.author_id||ODOOBOT_ID;add_message(data);}
function onActivityUpdateNodification(data){chat_manager.bus.trigger('activity_updated',data);}
var ChatManager=Class.extend(Mixins.EventDispatcherMixin,ServicesMixin,{make_message:make_message,make_channel:make_channel,init:function(parent){var self=this;Mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);this.bus=new Bus(this);this.bus.on('client_action_open',null,function(open){client_action_open=open;});bus.on('notification',null,on_notification);this.channel_seen=_.throttle(function(channel){return self._rpc({model:'mail.channel',method:'channel_seen',args:[[channel.id]],},{shadow:true});},3000);},start:function(){this.is_ready=session.is_bound.then(function(){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return session.rpc('client_action.php',{context:context});}).then(this._onMailClientAction.bind(this));add_channel({id:"channel_inbox",name:_lt("Inbox"),type:"static",},{display_needactions:true});add_channel({id:"channel_starred",name:_lt("Starred"),type:"static"});},_onMailClientAction:function(result){_.each(result.channel_slots,function(channels){_.each(channels,add_channel);});needaction_counter=result.needaction_inbox_counter;starred_counter=result.starred_counter;commands=_.map(result.commands,function(command){return _.extend({id:command.name},command);});mention_partner_suggestions=result.mention_partner_suggestions;discuss_menu_id=result.menu_id;_.each(result.shortcodes,function(s){if(s.shortcode_type==='text'){canned_responses.push(_.pick(s,['id','source','substitution']));}else{emojis.push(_.pick(s,['id','source','unicode_source','substitution','description']));emoji_substitutions[_.escape(s.source)]=s.substitution;if(s.unicode_source){emoji_substitutions[_.escape(s.unicode_source)]=s.substitution;emoji_unicodes[_.escape(s.source)]=s.unicode_source;}}});bus.start_polling();},_fetchFromChannel:function(channel,options){options=options||{};var domain=(channel.id==="channel_inbox")?[['needaction','=',true]]:(channel.id==="channel_starred")?[['starred','=',true]]:[['channel_ids','in',channel.id]];var cache=get_channel_cache(channel,options.domain);if(options.domain){domain=domain.concat(options.domain||[]);}
if(options.load_more){var min_message_id=cache.messages[0].id;domain=[['id','<',min_message_id]].concat(domain);}
return this._rpc({model:'mail.message',method:'message_fetch',args:[domain],kwargs:{limit:LIMIT,context:session.user_context},}).then(function(msgs){if(!cache.all_history_loaded){cache.all_history_loaded=msgs.length<LIMIT;}
cache.loaded=true;_.each(msgs,function(msg){add_message(msg,{channel_id:channel.id,silent:true,domain:options.domain});});var channel_cache=get_channel_cache(channel,options.domain||[]);return channel_cache.messages;});},_fetchDocumentMessages:function(ids,options){var loaded_msgs=_.filter(messages,function(message){return _.contains(ids,message.id);});var loaded_msg_ids=_.pluck(loaded_msgs,'id');options=options||{};if(options.force_fetch||_.difference(ids.slice(0,LIMIT),loaded_msg_ids).length){var ids_to_load=_.difference(ids,loaded_msg_ids).slice(0,LIMIT);return this._rpc({model:'mail.message',method:'message_format',args:[ids_to_load],context:session.user_context,}).then(function(msgs){var processed_msgs=[];_.each(msgs,function(msg){processed_msgs.push(add_message(msg,{silent:true}));});return _.sortBy(loaded_msgs.concat(processed_msgs),function(msg){return msg.id;});});}else{return $.when(loaded_msgs);}},post_message:function(data,options){var self=this;options=options||{};var body=utils.parse_and_transform(_.str.trim(data.content),utils.add_link);var msg={partner_ids:data.partner_ids,body:body,attachment_ids:data.attachment_ids,};_.each(_.keys(emoji_unicodes),function(key){var escaped_key=String(key).replace(/([.*+?=^!:${}()|[\]\/\\])/g,'\\$1');var regexp=new RegExp("(\\s|^)("+escaped_key+")(?=\\s|$)","g");msg.body=msg.body.replace(regexp,"$1"+emoji_unicodes[key]);});if('subject'in data){msg.subject=data.subject;}
if('channel_id'in options){return this._rpc({model:'mail.channel',method:data.command?'execute_command':'message_post',args:[options.channel_id],kwargs:_.extend(msg,{message_type:'comment',content_subtype:'html',subtype:'mail.mt_comment',command:data.command,}),});}
if('model'in options&&'res_id'in options){_.extend(msg,{content_subtype:data.content_subtype,context:data.context,message_type:data.message_type,subtype:data.subtype,subtype_id:data.subtype_id,});return this._rpc({model:options.model,method:'message_post',args:[options.res_id],kwargs:msg,}).then(function(msg_id){return self._rpc({model:'mail.message',method:'message_format',args:[msg_id],}).then(function(msgs){msgs[0].model=options.model;msgs[0].res_id=options.res_id;add_message(msgs[0]);});});}},get_message:function(id){return _.findWhere(messages,{id:id});},get_messages:function(options){var channel;if('channel_id'in options&&options.load_more){channel=this.get_channel(options.channel_id);return this._fetchFromChannel(channel,{domain:options.domain||{},load_more:true});}
if('channel_id'in options){channel=this.get_channel(options.channel_id);var channel_cache=get_channel_cache(channel,options.domain);if(channel_cache.loaded){return $.when(channel_cache.messages);}else{return this._fetchFromChannel(channel,{domain:options.domain});}}
if('ids'in options){return this._fetchDocumentMessages(options.ids,options).then(function(result){chat_manager.mark_as_read(options.ids);return result;});}
if('model'in options&&'res_id'in options){var domain=[['model','=',options.model],['res_id','=',options.res_id]];this._rpc({model:'mail.message',method:'message_fetch',args:[domain],kwargs:{limit:30},}).then(function(msgs){return _.map(msgs,add_message);});}},toggle_star_status:function(message_id){return this._rpc({model:'mail.message',method:'toggle_message_starred',args:[[message_id]],});},unstar_all:function(){return this._rpc({model:'mail.message',method:'unstar_all',args:[[]]});},mark_as_read:function(message_ids){var ids=_.filter(message_ids,function(id){var message=_.findWhere(messages,{id:id});return!message||message.is_needaction;});if(ids.length){return this._rpc({model:'mail.message',method:'set_message_done',args:[ids],});}else{return $.when();}},mark_all_as_read:function(channel,domain){if((channel.id==="channel_inbox"&&needaction_counter)||(channel&&channel.needaction_counter)){return this._rpc({model:'mail.message',method:'mark_all_as_read',kwargs:{channel_ids:channel.id!=="channel_inbox"?[channel.id]:[],domain:domain},});}
return $.when();},undo_mark_as_read:function(message_ids,channel){return this._rpc({model:'mail.message',method:'mark_as_unread',args:[message_ids,[channel.id]],});},mark_channel_as_seen:function(channel){if(channel.unread_counter>0&&channel.type!=='static'){update_channel_unread_counter(channel,0);this.channel_seen(channel);}},get_channels:function(){return _.clone(channels);},get_channel:function(id){return _.findWhere(channels,{id:id});},get_dm_from_partner_id:function(partner_id){return _.findWhere(channels,{direct_partner_id:partner_id});},all_history_loaded:function(channel,domain){return get_channel_cache(channel,domain).all_history_loaded;},get_mention_partner_suggestions:function(channel){if(!channel){return mention_partner_suggestions;}
if(!channel.members_deferred){channel.members_deferred=this._rpc({model:'mail.channel',method:'channel_fetch_listeners',args:[channel.uuid],},{shadow:true}).then(function(members){var suggestions=[];_.each(mention_partner_suggestions,function(partners){suggestions.push(_.filter(partners,function(partner){return!_.findWhere(members,{id:partner.id});}));});return[members];});}
return channel.members_deferred;},get_commands:function(channel){return _.filter(commands,function(command){return!command.channel_types||_.contains(command.channel_types,channel.server_type);});},get_canned_responses:function(){return canned_responses;},get_emojis:function(){return emojis;},get_needaction_counter:function(){return needaction_counter;},get_starred_counter:function(){return starred_counter;},get_chat_unread_counter:function(){return chat_unread_counter;},get_unread_conversation_counter:function(){return unread_conversation_counter;},get_last_seen_message:function(channel){if(channel.last_seen_message_id){var messages=channel.cache['[]'].messages;var msg=_.findWhere(messages,{id:channel.last_seen_message_id});if(msg){var i=_.sortedIndex(messages,msg,'id')+1;while(i<messages.length&&(messages[i].is_author||messages[i].is_system_notification)){msg=messages[i];i++;}
return msg;}}},get_discuss_menu_id:function(){return discuss_menu_id;},detach_channel:function(channel){return this._rpc({model:'mail.channel',method:'channel_minimize',args:[channel.uuid,true],},{shadow:true,});},remove_chatter_messages:function(model){messages=_.reject(messages,function(message){return message.channel_ids.length===0&&message.model===model;});},create_channel:function(name,type){var method=type==="dm"?"channel_get":"channel_create";var args=type==="dm"?[[name]]:[name,type];var context=_.extend({isMobile:config.device.isMobile},session.user_context);return this._rpc({model:'mail.channel',method:method,args:args,kwargs:{context:context},}).then(add_channel);},join_channel:function(channel_id,options){if(channel_id in channel_defs){return channel_defs[channel_id];}
var channel=this.get_channel(channel_id);if(channel){channel_defs[channel_id]=$.when(channel);}else{channel_defs[channel_id]=this._rpc({model:'mail.channel',method:'channel_join_and_get_info',args:[[channel_id]],}).then(function(result){return add_channel(result,options);});}
return channel_defs[channel_id];},open_and_detach_dm:function(partner_id){return this._rpc({model:'mail.channel',method:'channel_get_and_minimize',args:[[partner_id]],}).then(add_channel);},open_channel:function(channel){chat_manager.bus.trigger(client_action_open?'open_channel':'detach_channel',channel);},unsubscribe:function(channel){if(_.contains(['public','private'],channel.type)){return this._rpc({model:'mail.channel',method:'action_unfollow',args:[[channel.id]],});}else{return this._rpc({model:'mail.channel',method:'channel_pin',args:[channel.uuid,false],});}},close_chat_session:function(channel_id){var channel=this.get_channel(channel_id);this._rpc({model:'mail.channel',method:'channel_fold',kwargs:{uuid:channel.uuid,state:'closed'},},{shadow:true});},fold_channel:function(channel_id,folded){var args={uuid:this.get_channel(channel_id).uuid,};if(_.isBoolean(folded)){args.state=folded?'folded':'open';}
return this._rpc({model:'mail.channel',method:'channel_fold',kwargs:args,},{shadow:true});},redirect:function(res_model,res_id,dm_redirection_callback){var self=this;var redirect_to_document=function(res_model,res_id,view_id){web_client.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:res_model,views:[[view_id||false,'form']],res_id:res_id,});};if(res_model==="res.partner"){var domain=[["partner_id","=",res_id]];this._rpc({model:'res.users',method:'search',args:[domain],}).then(function(user_ids){if(user_ids.length&&user_ids[0]!==session.uid&&dm_redirection_callback){self.create_channel(res_id,'dm').then(dm_redirection_callback);}else{redirect_to_document(res_model,res_id);}});}else{this._rpc({model:res_model,method:'get_formview_id',args:[[res_id],session.user_context],}).then(function(view_id){redirect_to_document(res_model,res_id,view_id);});}},get_channels_preview:function(channels){var channels_preview=_.map(channels,function(channel){var info;if(channel.channel_ids&&_.contains(channel.channel_ids,"channel_inbox")){info=_.pick(channel,'id','body','avatar_src','res_id','model','module_icon','subject','date','record_name','status','displayed_author','email_from','unread_counter');info.last_message={body:info.body,date:info.date,displayed_author:info.displayed_author||info.email_from,};info.name=info.record_name||info.subject||info.displayed_author;info.image_src=info.module_icon||info.avatar_src;info.message_id=info.id;info.id='channel_inbox';return info;}
info=_.pick(channel,'id','is_chat','name','status','unread_counter');info.last_message=channel.last_message||_.last(channel.cache['[]'].messages);if(!info.is_chat){info.image_src='/web/image/mail.channel/'+channel.id+'/image_small';}else if(channel.direct_partner_id){info.image_src='/web/image/res.partner/'+channel.direct_partner_id+'/image_small';}else{info.image_src='/mail/static/src/img/smiley/avatar.jpg';}
return info;});var missing_channels=_.where(channels_preview,{last_message:undefined});if(!channels_preview_def){if(missing_channels.length){var missing_channel_ids=_.pluck(missing_channels,'id');channels_preview_def=this._rpc({model:'mail.channel',method:'channel_fetch_preview',args:[missing_channel_ids],},{shadow:true,});}else{channels_preview_def=$.when();}}
return channels_preview_def.then(function(channels){_.each(missing_channels,function(channel_preview){var channel=_.findWhere(channels,{id:channel_preview.id});if(channel){channel_preview.last_message=add_message(channel.last_message);}});channels_preview.sort(function(c1,c2){return Math.min(1,c2.unread_counter)-Math.min(1,c1.unread_counter)||c2.is_chat-c1.is_chat||!!c2.last_message-!!c1.last_message||(c2.last_message&&c2.last_message.date.diff(c1.last_message.date));});_.each(channels_preview,function(channel){if(channel.last_message){channel.last_message_preview=chat_manager.get_message_body_preview(channel.last_message.body);channel.last_message_date=channel.last_message.date.fromNow();}});return channels_preview;});},get_message_body_preview:function(message_body){return utils.parse_and_transform(message_body,utils.inline);},search_partner:function(search_val,limit){var def=$.Deferred();var values=[];var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search_val)),'i');_.each(mention_partner_suggestions,function(partners){if(values.length<limit){values=values.concat(_.filter(partners,function(partner){return session.partner_id!==partner.id&&search_regexp.test(partner.name);})).splice(0,limit);}});if(!values.length){def=this._rpc({model:'res.partner',method:'im_search',args:[search_val,limit||20],},{shadow:true,});}else{def=$.when(values);}
return def.then(function(values){var autocomplete_data=_.map(values,function(value){return{id:value.id,value:value.name,label:value.name};});return _.sortBy(autocomplete_data,'label');});},});var CallService=Class.extend(Mixins.EventDispatcherMixin,Mixins.ServiceProvider,{init:function(){Mixins.ServiceProvider.init.call(this);Mixins.EventDispatcherMixin.init.call(this);},});var chat_manager=new ChatManager(new CallService());chat_manager.start();return chat_manager;});;

/* /mail/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter',function(require){"use strict";var Activity=require('mail.Activity');var chat_mixin=require('mail.chat_mixin');var ChatterComposer=require('mail.ChatterComposer');var Followers=require('mail.Followers');var ThreadField=require('mail.ThreadField');var utils=require('mail.utils');var concurrency=require('web.concurrency');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var Chatter=Widget.extend(chat_mixin,{template:'mail.Chatter',custom_events:{reload_mail_fields:'_onReloadMailFields',},events:{'click .o_chatter_button_new_message':'_onOpenComposerMessage','click .o_chatter_button_log_note':'_onOpenComposerNote','click .o_chatter_button_schedule_activity':'_onScheduleActivity',},supportedFieldTypes:['one2many'],init:function(parent,record,mailFields,options){this._super.apply(this,arguments);this._setState(record);this.dp=new concurrency.DropPrevious();this.mentionPartnerSuggestions=this._getMentionPartnerSuggestions();this.mentionSuggestions=this.mentionPartnerSuggestions;this.fields={};if(mailFields.mail_activity){this.fields.activity=new Activity(this,mailFields.mail_activity,record,options);}
if(mailFields.mail_followers){this.fields.followers=new Followers(this,mailFields.mail_followers,record,options);}
if(mailFields.mail_thread){this.fields.thread=new ThreadField(this,mailFields.mail_thread,record,options);var nodeOptions=this.record.fieldsInfo.form[mailFields.mail_thread].options;this.hasLogButton=nodeOptions.display_log_button;this.postRefresh=nodeOptions.post_refresh||'never';}},start:function(){this.$topbar=this.$('.o_chatter_topbar');this.$topbar.append(QWeb.render('mail.Chatter.Buttons',{new_message_btn:!!this.fields.thread,log_note_btn:this.hasLogButton,schedule_activity_btn:!!this.fields.activity,isMobile:config.device.isMobile,}));var fieldDefs=_.invoke(this.fields,'appendTo',$('<div>'));var def=this.dp.add($.when.apply($,fieldDefs));this._render(def).then(this._updateMentionSuggestions.bind(this));return this._super.apply(this,arguments);},update:function(record,fieldNames){var self=this;if(this.record.res_id!==record.res_id){this._closeComposer(true);}
this._setState(record);this.$el.height(this.$el.height());if(this.fields.activity){this.fields.activity.$el.detach();}
if(this.fields.thread){this.fields.thread.$el.detach();}
var fieldsToReset;if(fieldNames){fieldsToReset=_.filter(this.fields,function(field){return _.contains(fieldNames,field.name);});}else{fieldsToReset=this.fields;}
var fieldDefs=_.invoke(fieldsToReset,'reset',record);var def=this.dp.add($.when.apply($,fieldDefs));this._render(def).then(function(){self.$el.height('auto');self._updateMentionSuggestions();});},_closeComposer:function(force){if(this.composer&&(this.composer.is_empty()||force)){this.$el.removeClass('o_chatter_composer_active');this.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');this.composer.do_hide();this.composer.clear_composer();}},_openComposer:function(options){var self=this;var old_composer=this.composer;this.composer=new ChatterComposer(this,this.record.model,options.suggested_partners||[],{commands_enabled:false,context:this.context,input_min_height:50,input_max_height:Number.MAX_VALUE,input_baseline:14,is_log:options&&options.is_log,record_name:this.record_name,default_body:old_composer&&old_composer.$input&&old_composer.$input.val(),default_mention_selections:old_composer&&old_composer.mention_get_listener_selections(),});this.composer.on('input_focused',this,function(){this.composer.mention_set_prefetched_partners(this.mentionSuggestions||[]);});this.composer.insertAfter(this.$('.o_chatter_topbar')).then(function(){if(old_composer){old_composer.destroy();}
if(!config.device.touch){self.composer.focus();}
self.composer.on('post_message',self,function(message){self.fields.thread.postMessage(message).then(function(){self._closeComposer(true);if(self.postRefresh==='always'||(self.postRefresh==='recipients'&&message.partner_ids.length)){self.trigger_up('reload');}});});self.composer.on('need_refresh',self,self.trigger_up.bind(self,'reload'));self.composer.on('close_composer',null,self._closeComposer.bind(self,true));self.$el.addClass('o_chatter_composer_active');self.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');self.$('.o_chatter_button_new_message').toggleClass('o_active',!self.composer.options.is_log);self.$('.o_chatter_button_log_note').toggleClass('o_active',self.composer.options.is_log);});},_render:function(def){var self=this;var $spinner=$(QWeb.render('Spinner'));concurrency.rejectAfter(concurrency.delay(500),def).then(function(){$spinner.appendTo(self.$el);});return def.then(function(){if(self.fields.activity){self.fields.activity.$el.appendTo(self.$el);}
if(self.fields.followers){self.fields.followers.$el.appendTo(self.$topbar);}
if(self.fields.thread){self.fields.thread.$el.appendTo(self.$el);}}).always($spinner.remove.bind($spinner));},_setState:function(record){if(!this.record||this.record.res_id!==record.res_id){this.context={default_res_id:record.res_id||false,default_model:record.model||false,};this.suggested_partners_def=undefined;}
this.record=record;this.record_name=record.data.display_name;},_updateMentionSuggestions:function(){if(!this.fields.followers){return;}
var self=this;this.mentionSuggestions=[];var follower_suggestions=[];var followers=this.fields.followers.getFollowers();_.each(followers,function(follower){if(follower.res_model==='res.partner'){follower_suggestions.push({id:follower.res_id,name:follower.name,email:follower.email,});}});if(follower_suggestions.length){this.mentionSuggestions.push(follower_suggestions);}
_.each(this.mentionPartnerSuggestions,function(partners){self.mentionSuggestions.push(_.filter(partners,function(partner){return!_.findWhere(follower_suggestions,{id:partner.id});}));});},_onOpenComposerMessage:function(){var self=this;if(!this.suggested_partners_def){this.suggested_partners_def=$.Deferred();var method='message_get_suggested_recipients';var args=[[this.context.default_res_id],this.context];this._rpc({model:this.record.model,method:method,args:args}).then(function(result){if(!self.suggested_partners_def){return;}
var suggested_partners=[];var thread_recipients=result[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=recipient[1]&&utils.parse_email(recipient[1]);suggested_partners.push({checked:true,partner_id:recipient[0],full_name:recipient[1],name:parsed_email[0],email_address:parsed_email[1],reason:recipient[2],});});self.suggested_partners_def.resolve(suggested_partners);});}
this.suggested_partners_def.then(function(suggested_partners){self._openComposer({is_log:false,suggested_partners:suggested_partners});});},_onOpenComposerNote:function(){this._openComposer({is_log:true});},_onReloadMailFields:function(event){var fieldNames=[];if(this.fields.activity&&event.data.activity){fieldNames.push(this.fields.activity.name);}
if(this.fields.followers&&event.data.followers){fieldNames.push(this.fields.followers.name);}
if(this.fields.thread&&event.data.thread){fieldNames.push(this.fields.thread.name);}
this.trigger_up('reload',{fieldNames:fieldNames,keepChanges:true,});},_onScheduleActivity:function(){this.fields.activity.scheduleActivity(false);},});return Chatter;});;

/* /mail/static/src/js/chatter_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatterComposer',function(require){"use strict";var composer=require('mail.composer');var utils=require('mail.utils');var core=require('web.core');var view_dialogs=require('web.view_dialogs');var _t=core._t;var ChatterComposer=composer.BasicComposer.extend({template:'mail.chatter.ChatComposer',init:function(parent,model,suggested_partners,options){this._super(parent,options);this.model=model;this.suggested_partners=suggested_partners;this.options=_.defaults(this.options,{display_mode:'textarea',record_name:false,is_log:false,});if(this.options.is_log){this.options.send_text=_t('Log');}
this.events=_.extend(this.events,{'click .o_composer_button_full_composer':'on_open_full_composer',});this.notInline=true;},should_send:function(){return false;},preprocess_message:function(){var self=this;var def=$.Deferred();this._super().then(function(message){message=_.extend(message,{subtype:'mail.mt_comment',message_type:'comment',content_subtype:'html',context:self.context,});if(self.options.is_log){message.subtype='mail.mt_note';}
if(!self.options.is_log){var checked_suggested_partners=self.get_checked_suggested_partners();self.check_suggested_partners(checked_suggested_partners).done(function(partner_ids){message.partner_ids=(message.partner_ids||[]).concat(partner_ids);message.context=_.defaults({},message.context,{mail_post_autofollow:true,});def.resolve(message);});}else{def.resolve(message);}});return def;},clear_composer_on_send:function(){},prevent_send:function(event){return!event.shiftKey;},get_checked_suggested_partners:function(){var self=this;var checked_partners=[];this.$('.o_composer_suggested_partners input:checked').each(function(){var full_name=$(this).data('fullname');checked_partners=checked_partners.concat(_.filter(self.suggested_partners,function(item){return full_name===item.full_name;}));});return checked_partners;},check_suggested_partners:function(checked_suggested_partners){var self=this;var check_done=$.Deferred();var recipients=_.filter(checked_suggested_partners,function(recipient){return recipient.checked;});var recipients_to_find=_.filter(recipients,function(recipient){return(!recipient.partner_id);});var names_to_find=_.pluck(recipients_to_find,'full_name');var recipients_to_check=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address);});var recipient_ids=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address;}),'partner_id');var names_to_remove=[];var recipient_ids_to_remove=[];var def;if(names_to_find.length>0){def=this._rpc({model:this.model,method:'message_partner_info_from_emails',args:[[this.context.default_res_id],names_to_find],});}
$.when(def).pipe(function(result){result=result||[];var emails_deferred=[];var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){var deferred=$.Deferred();emails_deferred.push(deferred);var partner_name=partner_info.full_name;var partner_id=partner_info.partner_id;var parsed_email=utils.parse_email(partner_name);var dialog=new view_dialogs.FormViewDialog(self,{res_model:'res.partner',res_id:partner_id,context:{force_email:true,ref:"compound_context",default_name:parsed_email[0],default_email:parsed_email[1],},title:_t("Please complete customer's informations"),disable_multiple_selection:true,}).open();dialog.on('closed',self,function(){deferred.resolve();});dialog.opened().then(function(){dialog.form_view.on('on_button_cancel',self,function(){names_to_remove.push(partner_name);if(partner_id){recipient_ids_to_remove.push(partner_id);}});});});$.when.apply($,emails_deferred).then(function(){var new_names_to_find=_.difference(names_to_find,names_to_remove);var def;if(new_names_to_find.length>0){def=self._rpc({model:self.model,method:'message_partner_info_from_emails',args:[[self.context.default_res_id],new_names_to_find,true],});}
$.when(def).pipe(function(result){result=result||[];var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){if(partner_info.partner_id&&_.indexOf(partner_info.partner_id,recipient_ids_to_remove)===-1){recipient_ids.push(partner_info.partner_id);}});}).pipe(function(){check_done.resolve(recipient_ids);});});});return check_done;},on_open_full_composer:function(){if(!this.do_check_attachment_upload()){return false;}
var self=this;var recipient_done=$.Deferred();if(this.options.is_log){recipient_done.resolve([]);}else{var checked_suggested_partners=this.get_checked_suggested_partners();recipient_done=this.check_suggested_partners(checked_suggested_partners);}
recipient_done.then(function(partner_ids){var context={default_parent_id:self.id,default_body:utils.get_text2html(self.$input.val()),default_attachment_ids:_.pluck(self.get('attachment_ids'),'id'),default_partner_ids:partner_ids,default_is_log:self.options.is_log,mail_post_autofollow:true,};if(self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,};self.do_action(action,{on_close:self.trigger.bind(self,'need_refresh'),}).then(self.trigger.bind(self,'close_composer'));});}});return ChatterComposer;});;

/* /mail/static/src/js/followers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Followers',function(require){"use strict";var AbstractField=require('web.AbstractField');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var field_registry=require('web.field_registry');var _t=core._t;var QWeb=core.qweb;var Followers=AbstractField.extend({template:'mail.Followers',events:{'click .o_followers_follow_button':'_onFollowButtonClicked','click .o_subtypes_list input':'_onSubtypeClicked','click .o_add_follower':'_onAddFollower','click .o_add_follower_channel':'_onAddChannel','click .o_edit_subtype':'_onEditSubtype','click .o_remove_follower':'_onRemoveFollower','click .o_mail_redirect':'_onRedirect',},supportedFieldTypes:['one2many'],init:function(parent,name,record,options){this._super.apply(this,arguments);this.image=this.attrs.image||'image_small';this.comment=this.attrs.help||false;this.followers=[];this.subtypes=[];this.data_subtype={};this.is_follower=undefined;var session=this.getSession();this.partnerID=session.partner_id;this.dp=new concurrency.DropPrevious();options=options||{};this.isEditable=options.isEditable;},_render:function(){var self=this;var fetch_def=this.dp.add(this._readFollowers());concurrency.rejectAfter(concurrency.delay(0),fetch_def).then(this._displayGeneric.bind(this));fetch_def.then(function(){self._displayButtons();self._displayFollowers(self.followers);if(self.subtypes){self._displaySubtypes(self.subtypes);}});},isSet:function(){return true;},_reset:function(record){this._super.apply(this,arguments);this.res_id=record.res_id;},getFollowers:function(){return this.followers;},_displayButtons:function(){if(this.is_follower){this.$('button.o_followers_follow_button').removeClass('o_followers_notfollow').addClass('o_followers_following');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.$('.o_followers_actions .dropdown-toggle').addClass('o_followers_following');}else{this.$('button.o_followers_follow_button').removeClass('o_followers_following').addClass('o_followers_notfollow');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);this.$('.o_followers_actions .dropdown-toggle').removeClass('o_followers_following');}},_displayGeneric:function(){this.$('.o_followers_actions').hide();this.$('.o_followers_title_box > button').prop('disabled',true);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr("title",this._formatFollowers(this.value.res_ids.length));},_displayFollowers:function(){var self=this;var $followers_list=this.$('.o_followers_list').empty();$(QWeb.render('mail.Followers.add_more',{widget:this})).appendTo($followers_list);var $follower_li;_.each(this.followers,function(record){$follower_li=$(QWeb.render('mail.Followers.partner',{'record':_.extend(record,{'avatar_url':'/web/image/'+record.res_model+'/'+record.res_id+'/image_small'}),'widget':self}));$follower_li.appendTo($followers_list);if(record.is_editable){$follower_li.on('mouseenter mouseleave',function(e){$(e.currentTarget).find('.o_edit_subtype').toggleClass('hide',e.type==='mouseleave');});}});this.$('.o_followers_actions').show();this.$('.o_followers_title_box > button').prop('disabled',!$followers_list.children().length);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr("title",this._formatFollowers(this.value.res_ids.length));},_displaySubtypes:function(data,dialog,display_warning){var old_parent_model;var $list;if(dialog){$list=$('<ul>').appendTo(this.dialog.$el);}else{$list=this.$('.o_subtypes_list ul');}
$list.empty();this.data_subtype=data;_.each(data,function(record){if(old_parent_model!==record.parent_model&&old_parent_model!==undefined){$list.append($('<li>').addClass('divider'));}
old_parent_model=record.parent_model;record.followed=record.followed||undefined;$list.append(QWeb.render('mail.Followers.subtype',{'record':record,'dialog':dialog,'display_warning':display_warning&&record.internal,}));});if(display_warning){$(QWeb.render('mail.Followers.subtypes.warning')).appendTo(this.dialog.$el);}},_inviteFollower:function(channel_only){var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],name:_t('Invite Follower'),target:'new',context:{'default_res_model':this.model,'default_res_id':this.res_id,'mail_invite_follower_channel_only':channel_only,},};this.do_action(action,{on_close:this._reload.bind(this),});},_formatFollowers:function(count){var str='';if(count<=0){str=_t('No follower');}else if(count===1){str=_t('One follower');}else{str=''+count+' '+_t('followers');}
return str;},_readFollowers:function(){var self=this;var missing_ids=_.difference(this.value.res_ids,_.pluck(this.followers,'id'));var def;if(missing_ids.length){def=this._rpc({route:'/mail/read_followers',params:{follower_ids:missing_ids,res_model:this.model}});}
return $.when(def).then(function(results){if(results){self.followers=_.uniq(results.followers.concat(self.followers),'id');self.subtypes=results.subtypes;}
self.followers=_.filter(self.followers,function(follower){return _.contains(self.value.res_ids,follower.id);});var user_follower=_.filter(self.followers,function(rec){return rec.is_uid;});self.is_follower=user_follower.length>=1;});},_reload:function(){this.trigger_up('reload',{fieldNames:[this.name]});},_follow:function(){var kwargs={partner_ids:[this.partnerID],context:{},};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));},_unfollow:function(ids){var self=this;var def=$.Deferred();var text=_t("Warning! \n If you remove a follower, he won't be notified of any email or discussion on this document.\n Do you really want to remove this follower ?");Dialog.confirm(this,text,{confirm_callback:function(){var args=[[self.res_id],ids.partner_ids,ids.channel_ids,{},];self._rpc({model:self.model,method:'message_unsubscribe',args:args}).then(self._reload.bind(self));def.resolve();},cancel_callback:def.reject.bind(def),});return def;},_updateSubscription:function(event,follower_id,is_channel){var ids={};var subtypes;if(follower_id!==undefined){subtypes=this.dialog.$('input[type="checkbox"]');if(is_channel){ids.channel_ids=[follower_id];}else{ids.partner_ids=[follower_id];}}else{subtypes=this.$('.o_followers_actions input[type="checkbox"]');ids.partner_ids=[this.partnerID];}
var checklist=[];_.each(subtypes,function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});if(!checklist.length){this._unfollow(ids).fail(function(){$(event.target).prop("checked",true);});}else{var kwargs=_.extend({},ids);kwargs.subtype_ids=checklist;kwargs.context={};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));}},_onAddFollower:function(event){event.preventDefault();this._inviteFollower(false);},_onAddChannel:function(event){event.preventDefault();this._inviteFollower(true);},_onEditSubtype:function(event){var self=this;var $currentTarget=$(event.currentTarget);var follower_id=$currentTarget.data('follower-id');this._rpc({route:'/mail/read_subscription_data',params:{res_model:this.model,follower_id:follower_id},}).then(function(data){var res_id=$currentTarget.data('oe-id');var is_channel=$currentTarget.data('oe-model')==='mail.channel';self.dialog=new Dialog(this,{size:'medium',title:_t('Edit Subscription of ')+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),classes:'btn-primary',click:function(){self._updateSubscription(event,res_id,is_channel);},close:true},{text:_t("Cancel"),close:true,},],});self.dialog.opened().then(function(){self._displaySubtypes(data,true,is_channel);});self.dialog.open();});},_onFollowButtonClicked:function(){if(!this.is_follower){this._follow();}else{this._unfollow({partner_ids:[this.partnerID]});}},_onRedirect:function(event){event.preventDefault();var $target=$(event.target);this.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:$target.data('oe-model'),views:[[false,'form']],res_id:$target.data('oe-id'),});},_onRemoveFollower:function(event){var res_model=$(event.target).parent().find('a').data('oe-model');var res_id=$(event.target).parent().find('a').data('oe-id');if(res_model==='res.partner'){return this._unfollow({partner_ids:[res_id]});}else{return this._unfollow({channel_ids:[res_id]});}},_onSubtypeClicked:function(event){event.stopPropagation();this._updateSubscription(event);var $list=this.$('.o_subtypes_list');if(!$list.hasClass('open')){$list.addClass('open');}
if(this.$('.o_subtypes_list ul')[0].children.length<1){$list.removeClass('open');}},});field_registry.add('mail_followers',Followers);return Followers;});;

/* /mail/static/src/js/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.form_renderer',function(require){"use strict";var BasicModel=require('web.BasicModel');var Chatter=require('mail.Chatter');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');FormRenderer.include({init:function(parent,state,params){this._super.apply(this,arguments);this.mailFields=params.mailFields;this.chatter=undefined;},confirmChange:function(state,id,fields){if(this.chatter){var updatedMailFields=_.intersection(fields,_.values(this.mailFields));if(updatedMailFields.length){this.chatter.update(state,updatedMailFields);}}
return this._super.apply(this,arguments);},_renderNode:function(node){if(node.tag==='div'&&node.attrs.class==='oe_chatter'){if(this.chatter){this.chatter.$el.detach();}
if(this.mode==='edit'&&!this.state.data.id){var $div=$('<div>');this._handleAttributes($div,node);return $div;}else{if(!this.chatter){this.chatter=new Chatter(this,this.state,this.mailFields,{isEditable:this.activeActions.edit,});this.chatter.appendTo($('<div>'));this._handleAttributes(this.chatter.$el,node);}else{this.chatter.update(this.state);}
return this.chatter.$el;}}else{return this._super.apply(this,arguments);}},});FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{new_message:'_onNewMessage',}),_onNewMessage:function(event){this.model.updateMessageIDs(event.data.id,event.data.msgIDs);},});BasicModel.include({updateMessageIDs:function(id,msgIDs){var element=this.localData[id];element.res_ids=msgIDs;element.count=msgIDs.length;},});});;

/* /mail/static/src/js/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.BasicView',function(require){"use strict";var BasicView=require('web.BasicView');var mailWidgets=['mail_followers','mail_thread','mail_activity','kanban_activity'];BasicView.include({init:function(viewInfo){this._super.apply(this,arguments);this.mailFields={};var fieldsInfo=viewInfo.fieldsInfo[this.viewType];for(var fieldName in fieldsInfo){var fieldInfo=fieldsInfo[fieldName];if(_.contains(mailWidgets,fieldInfo.widget)){this.mailFields[fieldInfo.widget]=fieldName;fieldInfo.__no_fetch=true;}}
this.rendererParams.activeActions=this.controllerParams.activeActions;this.rendererParams.mailFields=this.mailFields;},});});;

/* /mail/static/src/js/thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatThread',function(require){"use strict";var core=require('web.core');var time=require('web.time');var DocumentViewer=require('mail.DocumentViewer');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ORDER={ASC:1,DESC:-1,};var read_more=_t('read more');var read_less=_t('read less');function time_from_now(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
var Thread=Widget.extend({className:'o_mail_thread',events:{"click a":"on_click_redirect","click img":"on_click_redirect","click strong":"on_click_redirect","click .o_thread_show_more":"on_click_show_more","click .o_attachment_download":"_onAttachmentDownload","click .o_attachment_view":"_onAttachmentView","click .o_thread_message_needaction":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("mark_as_read",message_id);},"click .o_thread_message_star":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("toggle_star_status",message_id);},"click .o_thread_message_reply":function(event){this.selected_id=$(event.currentTarget).data('message-id');this.$('.o_thread_message').removeClass('o_thread_selected_message');this.$('.o_thread_message[data-message-id="'+this.selected_id+'"]').addClass('o_thread_selected_message');this.trigger('select_message',this.selected_id);event.stopPropagation();},"click .oe_mail_expand":function(event){event.preventDefault();var $message=$(event.currentTarget).parents('.o_thread_message');$message.addClass('o_message_expanded');this.expanded_msg_ids.push($message.data('message-id'));},"click .o_thread_message":function(event){$(event.currentTarget).toggleClass('o_thread_selected_message');},"click":function(){if(this.selected_id){this.unselect();this.trigger('unselect_message');}},},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{display_order:ORDER.ASC,display_needactions:true,display_stars:true,display_document_link:true,display_avatar:true,squash_close_messages:true,display_email_icon:true,display_reply_icon:false,});this.expanded_msg_ids=[];this.selected_id=null;},render:function(messages,options){var self=this;var msgs=_.map(messages,this._preprocess_message.bind(this));if(this.options.display_order===ORDER.DESC){msgs.reverse();}
options=_.extend({},this.options,options);var prev_msg;_.each(msgs,function(msg){if(!prev_msg||(Math.abs(msg.date.diff(prev_msg.date))>60000)||prev_msg.message_type!=='comment'||msg.message_type!=='comment'||(prev_msg.author_id[0]!==msg.author_id[0])||prev_msg.model!==msg.model||prev_msg.res_id!==msg.res_id){msg.display_author=true;}else{msg.display_author=!options.squash_close_messages;}
prev_msg=msg;});this.$el.html(QWeb.render('mail.ChatThread',{messages:msgs,options:options,ORDER:ORDER,date_format:time.getLangDatetimeFormat(),}));this.attachments=_.uniq(_.flatten(_.map(messages,'attachment_ids')));_.each(msgs,function(msg){var $msg=self.$('.o_thread_message[data-message-id="'+msg.id+'"]');$msg.find('.o_mail_timestamp').data('date',msg.date);self.insert_read_more($msg);});if(!this.update_timestamps_interval){this.update_timestamps_interval=setInterval(function(){self.update_timestamps();},1000*60);}},insert_read_more:function($element){var self=this;var groups=[];var read_more_nodes;var $children=$element.contents().filter(function(){return this.nodeType===1||this.nodeType===3&&this.nodeValue.trim();});_.each($children,function(child){var $child=$(child);if(child.nodeType===3&&$child.prevAll("[id*='stopSpelling']").length>0){var $child=$('<span>',{text:child.textContent,"data-o-mail-quote":"1",});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev("[data-o-mail-quote='1']").length>0)){if(!read_more_nodes){read_more_nodes=[];groups.push(read_more_nodes);}
$child.hide();read_more_nodes.push($child);}else{read_more_nodes=undefined;self.insert_read_more($child);}});_.each(groups,function(group){var $read_more=$('<a>',{class:"o_mail_read_more",href:"#",text:read_more,}).insertBefore(group[0]);var is_read_more=true;$read_more.click(function(e){e.preventDefault();is_read_more=!is_read_more;_.each(group,function($child){$child.hide();$child.toggle(!is_read_more);});$read_more.text(is_read_more?read_more:read_less);});});},update_timestamps:function(){var isAtBottom=this.is_at_bottom();this.$('.o_mail_timestamp').each(function(){var date=$(this).data('date');$(this).html(time_from_now(date));});if(isAtBottom&&!this.is_at_bottom()){this.scroll_to();}},on_click_redirect:function(event){if($(event.target).data('oe-field')!==undefined){return;}
var id=$(event.target).data('oe-id');if(id){event.preventDefault();var model=$(event.target).data('oe-model');var options=model&&(model!=='mail.channel')?{model:model,id:id}:{channel_id:id};this._redirect(options);}},_redirect:_.debounce(function(options){if('channel_id'in options){this.trigger('redirect_to_channel',options.channel_id);}else{this.trigger('redirect',options.model,options.id);}},500,true),on_click_show_more:function(){this.trigger('load_more_messages');},_preprocess_message:function(message){var msg=_.extend({},message);msg.date=moment.min(msg.date,moment());msg.hour=time_from_now(msg.date);var date=msg.date.format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){msg.day=_t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){msg.day=_t("Yesterday");}else{msg.day=msg.date.format('LL');}
if(_.contains(this.expanded_msg_ids,message.id)){msg.expanded=true;}
msg.display_subject=message.subject&&message.message_type!=='notification'&&!(message.model&&(message.model!=='mail.channel'));msg.is_selected=msg.id===this.selected_id;return msg;},remove_message_and_render:function(message_id,messages,options){var self=this;var done=$.Deferred();this.$('.o_thread_message[data-message-id="'+message_id+'"]').fadeOut({done:function(){self.render(messages,options);done.resolve();},duration:200,});return done;},scroll_to:function(options){options=options||{};if(options.id!==undefined){var $target=this.$('.o_thread_message[data-message-id="'+options.id+'"]');if(options.only_if_necessary){var delta=$target.parent().height()-$target.height();var offset=delta<0?0:delta-($target.offset().top-$target.offsetParent().offset().top);offset=-Math.min(offset,0);this.$el.scrollTo("+="+offset+"px",options);}else if($target.length){this.$el.scrollTo($target);}}else if(options.offset!==undefined){this.$el.scrollTop(options.offset);}else{this.$el.scrollTop(this.el.scrollHeight);}},get_scrolltop:function(){return this.$el.scrollTop();},is_at_bottom:function(){return this.el.scrollHeight-this.$el.scrollTop()-this.$el.outerHeight()<5;},unselect:function(){this.$('.o_thread_message').removeClass('o_thread_selected_message');this.selected_id=null;},destroy:function(){clearInterval(this.update_timestamps_interval);},_onAttachmentDownload:function(event){event.stopPropagation();},_onAttachmentView:function(event){event.stopPropagation();var activeAttachmentID=$(event.currentTarget).data('id');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,this.attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},});Thread.ORDER=ORDER;return Thread;});;

/* /mail/static/src/js/thread_field.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ThreadField',function(require){"use strict";var chat_mixin=require('mail.chat_mixin');var ChatThread=require('mail.ChatThread');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var concurrency=require('web.concurrency');var _t=core._t;var ThreadField=AbstractField.extend(chat_mixin,{init:function(){this._super.apply(this,arguments);this.msgIDs=this.value.res_ids;},willStart:function(){return this.alive(this._chatReady());},start:function(){var self=this;this.dp=new concurrency.DropPrevious();this.thread=new ChatThread(this,{display_order:ChatThread.ORDER.DESC,display_document_link:false,display_needactions:false,squash_close_messages:false,});this.thread.on('load_more_messages',this,this._onLoadMoreMessages);this.thread.on('redirect',this,this._onRedirect);this.thread.on('redirect_to_channel',this,this._onRedirectToChannel);this.thread.on('toggle_star_status',this,this._toggleStarStatus);var def1=this.thread.appendTo(this.$el);var def2=this._super.apply(this,arguments);return this.alive($.when(def1,def2)).then(function(){self.setElement(self.thread.$el);var bus=self._getBus();bus.on('new_message',self,self._onNewMessage);bus.on('update_message',self,self._onUpdateMessage);});},_render:function(){return this._fetchAndRenderThread(this.msgIDs);},isSet:function(){return true;},destroy:function(){this._removeChatterMessages(this.model);this._super.apply(this,arguments);},_reset:function(record){this._super.apply(this,arguments);this.msgIDs=this.value.res_ids;this.res_id=record.res_id;},postMessage:function(message){var self=this;var options={model:this.model,res_id:this.res_id};return this._postMessage(message,options).then(function(){if(message.partner_ids.length){self.trigger_up('reload_mail_fields',{followers:true});}}).fail(function(){self.do_notify(_t('Sending Error'),_t('Your message has not been sent.'));});},_fetchAndRenderThread:function(ids,options){var self=this;options=options||{};options.ids=ids;var fetch_def=this.dp.add(this._getMessages(options));return fetch_def.then(function(raw_messages){self.thread.render(raw_messages,{display_load_more:raw_messages.length<ids.length});});},_onLoadMoreMessages:function(){this._fetchAndRenderThread(this.msgIDs,{force_fetch:true});},_onNewMessage:function(message){if(message.model===this.model&&message.res_id===this.res_id){this.msgIDs.unshift(message.id);this.trigger_up('new_message',{id:this.value.id,msgIDs:this.msgIDs,});this._fetchAndRenderThread(this.msgIDs);}},_onRedirectToChannel:function(channelID){var self=this;this._joinChannel(channelID).then(function(){self.do_action('mail.mail_channel_action_client_chat',{active_id:channelID});});},_onRedirect:function(res_model,res_id){this.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:res_model,views:[[false,'form']],res_id:res_id,});},_onUpdateMessage:function(message){if(message.model===this.model&&message.res_id===this.res_id){this._fetchAndRenderThread(this.msgIDs);}},});field_registry.add('mail_thread',ThreadField);return ThreadField;});;

/* /mail/static/src/js/systray.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var chat_manager=require('mail.chat_manager');var QWeb=core.qweb;var MessagingMenu=Widget.extend({template:'mail.chat.MessagingMenu',events:{"click":"on_click","click .o_filter_button":"on_click_filter_button","click .o_new_message":"on_click_new_message","click .o_mail_channel_preview":"_onClickChannel",},init:function(){this._super.apply(this,arguments);this.isMobile=config.device.isMobile;},start:function(){this.$filter_buttons=this.$('.o_filter_button');this.$channels_preview=this.$('.o_mail_navbar_dropdown_channels');this.filter=false;chat_manager.bus.on("update_needaction",this,this.update_counter);chat_manager.bus.on("update_channel_unread_counter",this,this.update_counter);chat_manager.is_ready.then(this.update_counter.bind(this));return this._super();},is_open:function(){return this.$el.hasClass('open');},update_counter:function(){var counter=chat_manager.get_needaction_counter()+chat_manager.get_unread_conversation_counter();this.$('.o_notification_counter').text(counter);this.$el.toggleClass('o_no_notification',!counter);if(this.is_open()){this.update_channels_preview();}},update_channels_preview:function(){var self=this;this.$channels_preview.html(QWeb.render('Spinner'));chat_manager.is_ready.then(function(){var channels=_.filter(chat_manager.get_channels(),function(channel){if(self.filter==='chat'){return channel.is_chat;}else if(self.filter==='channels'){return!channel.is_chat&&channel.type!=='static';}else{return channel.type!=='static';}});chat_manager.get_messages({channel_id:'channel_inbox'}).then(function(result){var res=[];_.each(result,function(message){message.unread_counter=1;var duplicatedMessage=_.findWhere(res,{model:message.model,'res_id':message.res_id});if(message.model&&message.res_id&&duplicatedMessage){message.unread_counter=duplicatedMessage.unread_counter+1;res[_.findIndex(res,duplicatedMessage)]=message;}else{res.push(message);}});if(self.filter==='channel_inbox'||!self.filter){channels=_.union(channels,res);}
chat_manager.get_channels_preview(channels).then(self._render_channels_preview.bind(self));});});},_render_channels_preview:function(channels_preview){this.$channels_preview.html(QWeb.render('mail.chat.ChannelsPreview',{channels:channels_preview,}));},on_click:function(){if(!this.is_open()){this.update_channels_preview();}},on_click_filter_button:function(event){event.stopPropagation();this.$filter_buttons.removeClass('active');var $target=$(event.currentTarget);$target.addClass('active');this.filter=$target.data('filter');this.update_channels_preview();},on_click_new_message:function(){chat_manager.bus.trigger('open_chat');},_onClickChannel:function(event){var self=this;var channelID=$(event.currentTarget).data('channel_id');if(channelID==='channel_inbox'){var resID=$(event.currentTarget).data('res_id');var resModel=$(event.currentTarget).data('res_model');if(resModel&&resModel!=='mail.channel'&&resID){this.do_action({type:'ir.actions.act_window',res_model:resModel,views:[[false,'form']],res_id:resID});}else{var clientChatOptions={clear_breadcrumbs:true};if(resModel&&resModel==='mail.channel'&&resID){clientChatOptions.active_id=resID;}
this.do_action('mail.mail_channel_action_client_chat',clientChatOptions).then(function(){self.trigger_up('hide_app_switcher');core.bus.trigger('change_menu_section',chat_manager.get_discuss_menu_id());});}}else{var channel=chat_manager.get_channel(channelID);if(channel){chat_manager.open_channel(channel);}}},});var ActivityMenu=Widget.extend({template:'mail.chat.ActivityMenu',events:{"click":"_onActivityMenuClick","click .o_mail_channel_preview":"_onActivityFilterClick",},start:function(){this.$activities_preview=this.$('.o_mail_navbar_dropdown_channels');chat_manager.bus.on("activity_updated",this,this._updateCounter);chat_manager.is_ready.then(this._updateCounter.bind(this));this._updateActivityPreview();return this._super();},_getActivityData:function(){var self=this;return self._rpc({model:'res.users',method:'activity_user_count',kwargs:{context:session.user_context,},}).then(function(data){self.activities=data;self.activityCounter=_.reduce(data,function(total_count,p_data){return total_count+p_data.total_count;},0);self.$('.o_notification_counter').text(self.activityCounter);self.$el.toggleClass('o_no_notification',!self.activityCounter);});},_getActivityModelViewID:function(model){return this._rpc({model:model,method:'get_activity_view_id'});},_isOpen:function(){return this.$el.hasClass('open');},_updateActivityPreview:function(){var self=this;self._getActivityData().then(function(){self.$activities_preview.html(QWeb.render('mail.chat.ActivityMenuPreview',{activities:self.activities}));});},_updateCounter:function(data){if(data){if(data.activity_created){this.activityCounter++;}
if(data.activity_deleted&&this.activityCounter>0){this.activityCounter--;}
this.$('.o_notification_counter').text(this.activityCounter);this.$el.toggleClass('o_no_notification',!this.activityCounter);}},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:[[false,'kanban'],[false,'form']],search_view_id:[false],domain:[['activity_user_id','=',session.uid]],context:context,});},_onActivityMenuClick:function(){if(!this._isOpen()){this._updateActivityPreview();}},});SystrayMenu.Items.push(MessagingMenu);SystrayMenu.Items.push(ActivityMenu);return{ActivityMenu:ActivityMenu,};});;

/* /mail/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',[{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="public"]',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_mail_chat .o_composer_text_field',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>\'@\'</i> or link another channel with <i>\'#\'</i>. Start your message with <i>\'/\'</i> to get the list of possible commands.</p>"),position:"top",width:350,},{trigger:".o_mail_chat .o_mail_thread .o_thread_message_star",content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"right",},{trigger:'.o_mail_chat .o_mail_chat_channel_item[data-channel-id="channel_starred"]',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="dm"]',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var bus=require('bus.bus').bus;function send_notification(widget,title,content){if(window.Notification&&Notification.permission==="granted"){if(bus.is_master){_send_native_notification(title,content);}}else{widget.do_notify(title,content);if(bus.is_master){_beep(widget);}}}
function _send_native_notification(title,content){var notification=new Notification(title,{body:content,icon:"/mail/static/src/img/odoo_o.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}};}
var _beep=(function(){if(typeof(Audio)==="undefined"){return function(){};}
var audio;return function(widget){if(!audio){audio=new Audio();var ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";var session=widget.getSession();audio.src=session.url("/mail/static/src/audio/ting"+ext);}
audio.play();};})();function parse_and_transform(html_string,transform_function){var open_token="OPEN"+Date.now();var string=html_string.replace(/&lt;/g,open_token);var children=$('<div>').html(string).contents();return _parse_and_transform(children,transform_function).replace(new RegExp(open_token,"g"),"&lt;");}
function _parse_and_transform(nodes,transform_function){return _.map(nodes,function(node){return transform_function(node,function(){return _parse_and_transform(node.childNodes,transform_function);});}).join("");}
var url_regexp=/\b(?:https?:\/\/\d{1,3}(?:\.\d{1,3}){3}|(?:https?:\/\/|(?:www\.))[-a-z0-9@:%._\+~#=]{2,256}\.[a-z]{2,13})\b(?:[-a-z0-9@:%_\+.~#?&'$//=]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(url_regexp,function(url){var href=(!/^https?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function add_link(node,transform_children){if(node.nodeType===3){return linkify(node.data);}
if(node.tagName==="A")return node.outerHTML;node.innerHTML=transform_children();return node.outerHTML;}
function strip_html(node,transform_children){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transform_children();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.nodeType===8)return"";if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parse_email(text){if(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}}
function get_text2html(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
var accented_letters_mapping={'a':'[àáâãäå]','ae':'æ','c':'ç','e':'[èéêë]','i':'[ìíîï]','n':'ñ','o':'[òóôõö]','oe':'œ','u':'[ùúûűü]','y':'[ýÿ]',};function unaccent(str){_.each(accented_letters_mapping,function(value,key){str=str.replace(new RegExp(value,'g'),key);});return str;}
return{send_notification:send_notification,parse_and_transform:parse_and_transform,add_link:add_link,linkify:linkify,strip_html:strip_html,inline:inline,parse_email:parse_email,get_text2html:get_text2html,unaccent:unaccent,};});;

/* /mail/static/src/js/window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.window_manager',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ExtendedChatWindow=require('mail.ExtendedChatWindow');var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var web_client=require('web.web_client');var _t=core._t;var QWeb=core.qweb;var CHAT_WINDOW_WIDTH=325+5;var chat_sessions=[];var new_chat_session;var display_state={chat_windows_hidden:false,hidden_sessions:[],hidden_unread_counter:0,nb_slots:0,space_left:0,windows_dropdown_is_open:false,};function add_chat_session(chat_session){compute_available_slots(chat_sessions.length+1);chat_sessions.splice(display_state.nb_slots-1,0,chat_session);}
function open_chat(session,options){if(!session){open_chat_without_session();return;}
options=options||{};var chat_session=_.findWhere(chat_sessions,{id:session.id});if(!chat_session){var prefix=!session.is_chat?"#":"";var window_options={autofocus:!options.passively,input_less:session.mass_mailing,status:session.status,};chat_session={id:session.id,uuid:session.uuid,name:session.name,keep_unread:options.passively,window:new ExtendedChatWindow(web_client,session.id,prefix+session.name,session.is_folded,session.unread_counter,window_options),};chat_session.window.on("close_chat_session",null,function(){close_chat(chat_session);chat_manager.close_chat_session(chat_session.id);});chat_session.window.on("toggle_star_status",null,function(message_id){chat_manager.toggle_star_status(message_id);});chat_session.window.on("fold_channel",null,function(channel_id,folded){chat_manager.fold_channel(channel_id,folded);});chat_session.window.on("post_message",null,function(message,channel_id){chat_manager.post_message(message,{channel_id:channel_id}).then(function(){chat_session.window.thread.scroll_to();});});chat_session.window.on("redirect",null,function(res_model,res_id){chat_manager.redirect(res_model,res_id,open_chat);});chat_session.window.on("redirect_to_channel",null,function(channel_id){var session=_.findWhere(chat_sessions,{id:channel_id});if(!session){chat_manager.join_channel(channel_id).then(function(channel){chat_manager.detach_channel(channel);});}else{session.window.toggle_fold(false);}});var remove_new_chat=false;if(options.passively){chat_sessions.push(chat_session);}else if(new_chat_session&&new_chat_session.partner_id&&new_chat_session.partner_id===session.direct_partner_id){chat_sessions[_.indexOf(chat_sessions,new_chat_session)]=chat_session;remove_new_chat=true;}else{add_chat_session(chat_session);}
chat_session.window.appendTo($('body')).then(function(){reposition_windows({remove_new_chat:remove_new_chat});return chat_manager.get_messages({channel_id:chat_session.id});}).then(function(messages){chat_session.window.render(messages);chat_session.window.thread.scroll_to();setTimeout(function(){chat_session.window.thread.$el.on("scroll",null,_.debounce(function(){if(!chat_session.keep_unread&&chat_session.window.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(session);}},100));},0);if(options.passively){chat_session.window.$('.o_mail_thread, .o_chat_composer').one('click',function(){chat_manager.mark_channel_as_seen(session);});}else if(!display_state.chat_windows_hidden&&!session.is_folded){chat_manager.mark_channel_as_seen(session);}});}else if(!options.passively){if(chat_session.window.is_hidden){make_session_visible(chat_session);}else if(session.is_folded!==chat_session.window.folded){chat_session.window.toggle_fold(session.is_folded);}}}
function open_chat_without_session(){if(!new_chat_session){new_chat_session={id:'_open',window:new ExtendedChatWindow(web_client,undefined,_t('New message'),false,0,{thread_less:true}),};new_chat_session.window.on("close_chat_session",null,close_new_chat);new_chat_session.window.on('open_dm_session',null,function(partner_id){new_chat_session.partner_id=partner_id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(!dm){chat_manager.open_and_detach_dm(partner_id);}else{var dm_session=_.findWhere(chat_sessions,{id:dm.id});if(!dm_session){chat_manager.detach_channel(dm);}else{close_chat(dm_session);dm.is_folded=false;open_chat(dm);}}});add_chat_session(new_chat_session);new_chat_session.window.appendTo($('body')).then(reposition_windows);}else{if(new_chat_session.window.is_hidden){make_session_visible(new_chat_session);}else if(new_chat_session.window.folded){new_chat_session.window.toggle_fold(false);}}}
function close_chat(chat_session,options){if(options&&options.keep_open_if_unread&&chat_session.keep_unread){return;}
chat_sessions=_.without(chat_sessions,chat_session);chat_session.window.destroy();reposition_windows();}
function close_new_chat(){chat_sessions=_.without(chat_sessions,new_chat_session);reposition_windows({remove_new_chat:true});}
function destroy_new_chat(){new_chat_session.window.destroy();new_chat_session=undefined;}
function toggle_fold_chat(channel){var session=_.find(chat_sessions,{id:channel.id});if(session){session.window.toggle_fold(channel.is_folded);}}
function compute_available_slots(nb_windows){if(config.device.size_class===config.device.SIZES.XS){display_state.nb_slots=1;return;}
var width=window.innerWidth;var nb_slots=Math.floor(width/CHAT_WINDOW_WIDTH);var space_left=width-(Math.min(nb_slots,nb_windows)*CHAT_WINDOW_WIDTH);if(nb_slots<nb_windows&&space_left<50){nb_slots--;space_left+=CHAT_WINDOW_WIDTH;}
display_state.nb_slots=nb_slots;display_state.space_left=space_left;}
var reposition_windows=function(options){if(options&&options.remove_new_chat){destroy_new_chat();}
if(display_state.chat_windows_hidden){return;}
compute_available_slots(chat_sessions.length);var hidden_sessions=[];var hidden_unread_counter=0;var nb_slots=display_state.nb_slots;_.each(chat_sessions,function(session,index){if(index<nb_slots){session.window.$el.css({right:CHAT_WINDOW_WIDTH*index,bottom:0});session.window.do_show();}else{hidden_sessions.push(session);hidden_unread_counter+=session.window.unread_msgs;session.window.do_hide();}});display_state.hidden_sessions=hidden_sessions;display_state.hidden_unread_counter=hidden_unread_counter;if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.remove();}
if(hidden_sessions.length){display_state.$hidden_windows_dropdown=render_hidden_sessions_dropdown();var $hidden_windows_dropdown=display_state.$hidden_windows_dropdown;$hidden_windows_dropdown.css({right:CHAT_WINDOW_WIDTH*nb_slots,bottom:0}).appendTo($('body'));reposition_hidden_sessions_dropdown();display_state.windows_dropdown_is_open=false;$hidden_windows_dropdown.on('click','.o_chat_header',function(event){var session_id=$(event.currentTarget).data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){make_session_visible(session);}});$hidden_windows_dropdown.on('click','.o_chat_window_close',function(event){var session_id=$(event.currentTarget).closest('.o_chat_header').data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){session.window.on_click_close(event);display_state.windows_dropdown_is_open=true;}});}};function make_session_visible(session){utils.swap(chat_sessions,session,chat_sessions[display_state.nb_slots-1]);reposition_windows();session.window.toggle_fold(false);}
function render_hidden_sessions_dropdown(){var $dropdown=$(QWeb.render("mail.ChatWindowsDropdown",{sessions:display_state.hidden_sessions,open:display_state.windows_dropdown_is_open,unread_counter:display_state.hidden_unread_counter,widget:{isMobile:config.device.isMobile},}));return $dropdown;}
function reposition_hidden_sessions_dropdown(){var $dropdown_ul=display_state.$hidden_windows_dropdown.children('ul');if(display_state.space_left>$dropdown_ul.width()+10){$dropdown_ul.addClass('dropdown-menu-right');}}
function update_sessions(message,scrollBottom){_.each(chat_sessions,function(session){if(_.contains(message.channel_ids,session.id)){var message_visible=!display_state.chat_windows_hidden&&!session.window.folded&&!session.window.is_hidden&&session.window.thread.is_at_bottom();if(message_visible&&!session.keep_unread){chat_manager.mark_channel_as_seen(chat_manager.get_channel(session.id));}
chat_manager.get_messages({channel_id:session.id}).then(function(messages){session.window.render(messages);if(scrollBottom&&message_visible){session.window.thread.scroll_to();}});}});}
core.bus.on('web_client_ready',null,function(){chat_manager.bus.on('open_chat',null,open_chat);chat_manager.bus.on('close_chat',null,function(channel,options){var session=_.find(chat_sessions,{id:channel.id});if(session){close_chat(session,options);}});chat_manager.bus.on('channel_toggle_fold',null,toggle_fold_chat);chat_manager.bus.on('new_message',null,function(message){update_sessions(message,true);});chat_manager.bus.on('update_message',null,function(message){update_sessions(message,false);});chat_manager.bus.on('anyone_listening',null,function(channel,query){_.each(chat_sessions,function(session){if(channel.id===session.id&&session.window.thread.is_at_bottom()&&!session.window.is_hidden){query.is_displayed=true;}});});chat_manager.bus.on('unsubscribe_from_channel',null,function(channel_id){_.each(chat_sessions,function(session){if(channel_id===session.id){close_chat(session);}});});chat_manager.bus.on('update_channel_unread_counter',null,function(channel){display_state.hidden_unread_counter=0;_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_unread(channel.unread_counter);if(channel.unread_counter===0){session.keep_unread=false;}}
if(session.window.is_hidden){display_state.hidden_unread_counter+=session.window.unread_msgs;}});if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.html(render_hidden_sessions_dropdown().html());reposition_hidden_sessions_dropdown();}});chat_manager.bus.on('update_dm_presence',null,function(channel){_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_status(channel.status);}});});chat_manager.is_ready.then(function(){_.each(chat_manager.get_channels(),function(channel){if(channel.is_detached){open_chat(channel);}});});chat_manager.bus.on('detach_channel',null,function(channel){var chat_session=_.findWhere(chat_sessions,{id:channel.id});if(!chat_session||chat_session.window.folded){chat_manager.detach_channel(channel);}else if(chat_session.window.is_hidden){make_session_visible(chat_session);}else{chat_session.window.focus_input();}});chat_manager.bus.on('client_action_open',null,function(open){display_state.chat_windows_hidden=open;if(open){$('body').addClass('o_no_chat_window');}else{$('body').removeClass('o_no_chat_window');reposition_windows();}});core.bus.on('resize',null,_.debounce(reposition_windows,100));});});;

/* /mail/static/src/js/activity.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Activity',function(require){"use strict";var AbstractField=require('web.AbstractField');var BasicModel=require('web.BasicModel');var core=require('web.core');var field_registry=require('web.field_registry');var time=require('web.time');var utils=require('mail.utils');var QWeb=core.qweb;var _t=core._t;function _readActivities(self,ids){if(!ids.length){return $.when([]);}
return self._rpc({model:'mail.activity',method:'read',args:[ids],context:(self.record&&self.record.getContext())||self.getSession().user_context,}).then(function(activities){_.each(activities,function(activity){activity.create_date=moment(time.auto_str_to_date(activity.create_date));activity.date_deadline=moment(time.auto_str_to_date(activity.date_deadline));});activities=_.sortBy(activities,'date_deadline');return activities;});}
BasicModel.include({_fetchSpecialActivity:function(record,fieldName){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];return _readActivities(this,this.localData[localID].res_ids);},});var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var to_display='';var diff=activity.date_deadline.diff(today,'days',true);if(diff===0){to_display=_t('Today');}else{if(diff<0){if(diff===-1){to_display=_t('Yesterday');}else{to_display=_.str.sprintf(_t('%d days overdue'),Math.abs(diff));}}else{if(diff===1){to_display=_t('Tomorrow');}else{to_display=_.str.sprintf(_t('Due in %d days'),Math.abs(diff));}}}
activity.label_delay=to_display;});return activities;};var AbstractActivityField=AbstractField.extend({_markActivityDone:function(id,feedback){return this._rpc({model:'mail.activity',method:'action_feedback',args:[[id]],kwargs:{feedback:feedback},context:this.record.getContext(),});},_scheduleActivity:function(id,previous_activity_type_id,callback){var action={type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,default_previous_activity_type_id:previous_activity_type_id,},res_id:id||false,};return this.do_action(action,{on_close:callback});},});var Activity=AbstractActivityField.extend({className:'o_mail_activity',events:{'click .o_activity_edit':'_onEditActivity','click .o_activity_unlink':'_onUnlinkActivity','click .o_activity_done':'_onMarkActivityDone',},specialData:'_fetchSpecialActivity',init:function(){this._super.apply(this,arguments);this.activities=this.record.specialData[this.name];},_render:function(){_.each(this.activities,function(activity){if(activity.note){activity.note=utils.parse_and_transform(activity.note,utils.add_link);}});var activities=setDelayLabel(this.activities);if(activities.length){var nbActivities=_.countBy(activities,'state');this.$el.html(QWeb.render('mail.activity_items',{activities:activities,nbPlannedActivities:nbActivities.planned,nbTodayActivities:nbActivities.today,nbOverdueActivities:nbActivities.overdue,date_format:time.getLangDateFormat(),datetime_format:time.getLangDatetimeFormat(),}));}else{this.$el.empty();}},_reset:function(record){this._super.apply(this,arguments);this.activities=this.record.specialData[this.name];this.res_id=record.res_id;},scheduleActivity:function(previous_activity_type_id){var callback=this._reload.bind(this,{activity:true,thread:true});return this._scheduleActivity(false,previous_activity_type_id,callback);},_reload:function(fieldsToReload){this.trigger_up('reload_mail_fields',fieldsToReload);},_bindPopoverFocusout:function($popover_el){var self=this;var $popover=$popover_el.data("bs.popover").tip();var activity_id=$popover_el.data('activity-id');$popover.off('focusout');$popover.focusout(function(e){self.feedbackValue[activity_id]=$popover.find('#activity_feedback').val().trim();if(!$popover.is(e.relatedTarget)&&!$popover.find(e.relatedTarget).length){$popover_el.popover('hide');}});},_onEditActivity:function(event,options){event.preventDefault();var self=this;var activity_id=$(event.currentTarget).data('activity-id');var action=_.defaults(options||{},{type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,},res_id:activity_id,});return this.do_action(action,{on_close:function(){self._reload({activity:true,thread:true});},});},_onUnlinkActivity:function(event,options){event.preventDefault();var activity_id=$(event.currentTarget).data('activity-id');options=_.defaults(options||{},{model:'mail.activity',args:[[activity_id]],});return this._rpc({model:options.model,method:'unlink',args:options.args,}).then(this._reload.bind(this,{activity:true}));},_onMarkActivityDone:function(event){event.preventDefault();var self=this;this.feedbackValue=this.feedbackValue||{};var $popover_el=$(event.currentTarget);var activity_id=$popover_el.data('activity-id');var previous_activity_type_id=$popover_el.data('previous-activity-type-id');if(!$popover_el.data('bs.popover')){this.feedbackValue[activity_id]="";$popover_el.popover({title:_t('Feedback'),html:'true',trigger:'click',content:function(){var $popover=$(QWeb.render("mail.activity_feedback_form",{'previous_activity_type_id':previous_activity_type_id}));$popover.find('#activity_feedback').val(self.feedbackValue[activity_id]);$popover.on('click','.o_activity_popover_done_next',function(){var feedback=_.escape($popover.find('#activity_feedback').val());var previous_activity_type_id=$popover_el.data('previous-activity-type-id');self._markActivityDone(activity_id,feedback).then(self.scheduleActivity.bind(self,previous_activity_type_id));});$popover.on('click','.o_activity_popover_done',function(){var feedback=_.escape($popover.find('#activity_feedback').val());self._markActivityDone(activity_id,feedback).then(self._reload.bind(self,{activity:true,thread:true}));});$popover.on('click','.o_activity_popover_discard',function(){$popover_el.popover('hide');});return $popover;},}).on("show.bs.popover",function(e){var $popover=$(this).data("bs.popover").tip();$popover.addClass('o_mail_activity_feedback').attr('tabindex',0);$(".o_mail_activity_feedback.popover").not(e.target).popover("hide");}).on("shown.bs.popover",function(){var $popover=$(this).data("bs.popover").tip();$popover.find('#activity_feedback').focus();self._bindPopoverFocusout($(this));}).popover('show');}},});var KanbanActivity=AbstractActivityField.extend({template:'mail.KanbanActivity',events:{'click .o_activity_btn':'_onButtonClicked','click .o_schedule_activity':'_onScheduleActivity','click .o_mark_as_done':'_onMarkActivityDone',},init:function(parent,name,record){this._super.apply(this,arguments);var selection={};_.each(record.fields.activity_state.selection,function(value){selection[value[0]]=value[1];});this.selection=selection;this._setState(record);},_render:function(){var $span=this.$(".o_activity_btn > span");$span.removeClass(function(index,classNames){return classNames.split(/\s+/).filter(function(className){return _.str.startsWith(className,'o_activity_color_');}).join(' ');});$span.addClass('o_activity_color_'+(this.activity_state||'default'));if(this.$el.hasClass('open')){this._renderDropdown();}},_reset:function(record){this._super.apply(this,arguments);this._setState(record);},_reload:function(){this.trigger_up('reload',{db_id:this.record_id});},_renderDropdown:function(){var self=this;this.$('.o_activity').html(QWeb.render("mail.KanbanActivityLoading"));return _readActivities(this,this.value.res_ids).then(function(activities){self.$('.o_activity').html(QWeb.render("mail.KanbanActivityDropdown",{selection:self.selection,records:_.groupBy(setDelayLabel(activities),'state'),uid:self.getSession().uid,}));});},_setState:function(record){this.record_id=record.id;this.activity_state=this.recordData.activity_state;},_onButtonClicked:function(event){event.preventDefault();if(!this.$el.hasClass('open')){this._renderDropdown();}},_onMarkActivityDone:function(event){event.stopPropagation();var activity_id=$(event.currentTarget).data('activity-id');this._markActivityDone(activity_id).then(this._reload.bind(this));},_onScheduleActivity:function(event){var activity_id=$(event.currentTarget).data('activity-id')||false;return this._scheduleActivity(activity_id,false,this._reload.bind(this));},});field_registry.add('mail_activity',Activity).add('kanban_activity',KanbanActivity);return Activity;});;

/* /mail/static/src/js/chat_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_mixin',function(){"use strict";var ChatMixin={_chatReady:function(){var result;this.trigger_up('chat_manager_ready',{callback:function(def){result=def;}});return $.when(result);},_getBus:function(){var result;this.trigger_up('get_bus',{callback:function(bus){result=bus;}});return result;},_getCannedResponses:function(){var result;this.trigger_up('get_canned_responses',{callback:function(responses){result=responses;}});return result;},_getEmojis:function(){var result;this.trigger_up('get_emojis',{callback:function(emojis){result=emojis;}});return result;},_getMentionPartnerSuggestions:function(channel_id){var result;this.trigger_up('get_mention_partner_suggestions',{channel_id:channel_id,callback:function(res){result=res;},});return result;},_getMessages:function(options){var result;this.trigger_up('get_messages',{options:options,callback:function(messages){result=messages;}});return result?result:$.when();},_joinChannel:function(channel_id){var result;this.trigger_up('join_channel',{channel_id:channel_id,callback:function(def){result=def;},});return $.when(result);},_postMessage:function(message,options){var result;this.trigger_up('post_message',{message:message,options:options,callback:function(def){result=def;}});return $.when(result);},_removeChatterMessages:function(model){this.trigger_up('remove_chatter_messages',{model:model,});},_toggleStarStatus:function(message_id){this.trigger_up('toggle_star_status',{message_id:message_id,});},};return ChatMixin;});odoo.define('mail.chat_service',function(require){"use strict";var chat_manager=require('mail.chat_manager');var web_client=require('web.web_client');web_client.on('get_emojis',web_client,function(event){event.data.callback(chat_manager.get_emojis());});web_client.on('get_canned_responses',web_client,function(event){event.data.callback(chat_manager.get_canned_responses());});web_client.on('chat_manager_ready',web_client,function(event){event.data.callback(chat_manager.is_ready);});web_client.on('get_messages',web_client,function(event){event.data.callback(chat_manager.get_messages(event.data.options));});web_client.on('post_message',web_client,function(event){event.data.callback(chat_manager.post_message(event.data.message,event.data.options));});web_client.on('get_bus',web_client,function(event){event.data.callback(chat_manager.bus);});web_client.on('remove_chatter_messages',web_client,function(event){chat_manager.remove_chatter_messages(event.data.model);});web_client.on('toggle_star_status',web_client,function(event){chat_manager.toggle_star_status(event.data.message_id);});web_client.on('join_channel',web_client,function(event){event.data.callback(chat_manager.join_channel(event.data.channel_id));});web_client.on('get_mention_partner_suggestions',web_client,function(event){event.data.callback(chat_manager.get_mention_partner_suggestions(event.data.channel_id));});});;

/* /sms/static/src/js/sms_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.sms_widget',function(require){"use strict";var basicFields=require('web.basic_fields');var core=require('web.core');var fieldRegistry=require('web.field_registry');var framework=require('web.framework');var FieldText=basicFields.FieldText;var QWeb=core.qweb;var SmsWidget=FieldText.extend({init:function(){this._super.apply(this,arguments);this.nbrChar=0;this.nbrSMS=0;this.encoding="GSM7";this.tagName='div';},_compute:function(){var content=this._getValue();this.encoding=this._extractEncoding(content);this.nbrChar=content.length;this.nbrChar+=(content.match(/\n/g)||[]).length;this.nbrSMS=this._countSMS(this.nbrChar,this.encoding);this._renderSMS();},_countSMS:function(){if(this.nbrChar===0){return 0;}
if(this.encoding==='UNICODE'){if(this.nbrChar<=70){return 1;}
return Math.ceil(this.nbrChar/67);}
if(this.nbrChar<=160){return 1;}
return Math.ceil(this.nbrChar/153);},_renderEdit:function(){this.$el.empty();this._prepareInput($('<textarea/>')).appendTo(this.$el);this.$el.append($(QWeb.render("sms.sms_count",{})));this._compute();},_extractEncoding:function(content){if(String(content).match(RegExp("^[@£$¥èéùìòÇ\\nØø\\rÅåΔ_ΦΓΛΩΠΨΣΘΞÆæßÉ !\\\"#¤%&'()*+,-./0123456789:;<=>?¡ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÑÜ§¿abcdefghijklmnopqrstuvwxyzäöñüà]*$"))){return'GSM7';}
return'UNICODE';},_renderSMS:function(){this.$('.o_sms_count').text(this.nbrChar+' / '+this.nbrSMS+' SMS ('+this.encoding+') ');},_onChange:function(){this._super.apply(this,arguments);this._compute();},_onInput:function(){this._super.apply(this,arguments);this._compute();},});fieldRegistry.add('sms_widget',SmsWidget);return SmsWidget;});;

/* /account/static/src/js/reconciliation/reconciliation_action.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationClientAction',function(require){"use strict";var ReconciliationModel=require('account.ReconciliationModel');var ReconciliationRenderer=require('account.ReconciliationRenderer');var ControlPanelMixin=require('web.ControlPanelMixin');var Widget=require('web.Widget');var core=require('web.core');var StatementAction=Widget.extend(ControlPanelMixin,{title:core._t('Bank reconciliation'),template:'reconciliation',custom_events:{change_mode:'_onAction',change_filter:'_onAction',change_offset:'_onAction',change_partner:'_onAction',add_proposition:'_onAction',search_balance_amount:'_onAction',remove_proposition:'_onAction',update_proposition:'_onAction',create_proposition:'_onAction',quick_create_proposition:'_onAction',toggle_partial_reconcile:'_onAction',auto_reconciliation:'_onValidate',validate:'_onValidate',validate_all_balanced:'_onValidate',change_name:'_onChangeName',close_statement:'_onCloseStatement',load_more:'_onLoadMore',},config:{Model:ReconciliationModel.StatementModel,ActionRenderer:ReconciliationRenderer.StatementRenderer,LineRenderer:ReconciliationRenderer.LineRenderer,params:['statement_ids'],limitMoveLines:5,},init:function(parent,params){this._super.apply(this,arguments);this.action_manager=parent;this.params=params;this.model=new this.config.Model(this,{modelName:"account.bank.statement.line",limitMoveLines:params.params&&params.params.limitMoveLines||this.config.limitMoveLines,});this.widgets=[];if(!this.action_manager){this.set_cp_bus(new Widget());}
_.each(params.params,function(value,name){params.context[name]=name.indexOf('_ids')!==-1?_.map((value+'').split(),parseFloat):value;});params.params={};_.each(this.config.params,function(name){if(params.context[name]){params.params[name]=name.indexOf('_ids')!==-1&&_.isArray(params.context[name])?params.context[name].join():params.context[name];}});},willStart:function(){var self=this;var def=this.model.load(this.params.context).then(this._super.bind(this));return def.then(function(){self.title=self.model.bank_statement_id?self.model.bank_statement_id.display_name:self.title;self.renderer=new self.config.ActionRenderer(self,self.model,{'bank_statement_id':self.model.bank_statement_id,'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'defaultDisplayQty':self.model.defaultDisplayQty,'title':self.title,});});},start:function(){var self=this;this.set("title",this.title);var breadcrumbs=this.action_manager&&this.action_manager.get_breadcrumbs()||[{title:this.title,action:this}];this.update_control_panel({breadcrumbs:breadcrumbs,search_view_hidden:true},{clear:true});this.renderer.prependTo(self.$('.o_form_sheet'));this._renderLines();this._openFirstLine();},do_show:function(){this._super.apply(this,arguments);if(this.action_manager){var breadcrumbs=this.action_manager&&this.action_manager.get_breadcrumbs()||[{title:this.title,action:this}];while(breadcrumbs.length){if(breadcrumbs[breadcrumbs.length-1].action.widget===this){break;}
breadcrumbs.pop();}
this.update_control_panel({breadcrumbs:breadcrumbs,search_view_hidden:true},{clear:true});this.action_manager.do_push_state({action:this.params.tag,active_id:this.params.res_id,});}},_getWidget:function(handle){return _.find(this.widgets,function(widget){return widget.handle===handle;});},_loadMore:function(qty){var self=this;return this.model.loadMore(qty).then(function(){self._renderLines();});},_openFirstLine:function(){var self=this;var handle=_.compact(_.map(this.model.lines,function(line,handle){return line.reconciled?null:handle;}))[0];if(handle){var line=this.model.getLine(handle);this.model.changeMode(handle,'match').always(function(){self._getWidget(handle).update(line);});}
return handle;},_renderLines:function(){var self=this;var linesToDisplay=this.model.getStatementLines();_.each(linesToDisplay,function(line,handle){var widget=new self.config.LineRenderer(self,self.model,line);widget.handle=handle;self.widgets.push(widget);widget.appendTo(self.$('.o_reconciliation_lines'));});if(this.model.hasMoreLines()===false){this.renderer.hideLoadMoreButton();}},_onAction:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);var mode=line.mode;this.model[_.str.camelize(event.name)](handle,event.data.data).always(function(){self._getWidget(handle).update(line);if(mode==='inactive'&&line.mode!=='inactive'){_.each(self.model.lines,function(line,_handle){if(line.mode!=='inactive'&&_handle!==handle){self.model.changeMode(_handle,'inactive');var widget=self._getWidget(_handle);if(widget){widget.update(line);}}});}});},_onChangeName:function(event){var self=this;var title=event.data.data;this.model.changeName(title).then(function(){self.title=title;self.set("title",title);self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':title,});});},_onCloseStatement:function(event){var self=this;return this.model.closeStatement().then(function(result){self.do_action({name:'Bank Statements',res_model:'account.bank.statement',res_id:result,views:[[false,'form']],type:'ir.actions.act_window',view_type:'form',view_mode:'form',});});},_onLoadMore:function(event){return this._loadMore(this.model.defaultDisplayQty);},_onValidate:function(event){var self=this;var handle=event.target.handle;var method=event.name.indexOf('auto_reconciliation')===-1?'validate':'autoReconciliation';this.model[method](handle).then(function(result){self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':self.title,'time':Date.now()-self.time,'notifications':result.notifications,'context':self.model.getContext(),});_.each(result.handles,function(handle){self._getWidget(handle).destroy();var index=_.findIndex(self.widgets,function(widget){return widget.handle===handle;});self.widgets.splice(index,1);});if(self.widgets.length<self.model.defaultDisplayQty&&self.model.valuemax-self.model.valuenow>=self.model.defaultDisplayQty){var toLoad=self.model.defaultDisplayQty-self.widgets.length;self._loadMore(toLoad);}
self._openFirstLine();});},});var ManualAction=StatementAction.extend({title:core._t('Journal Items to Reconcile'),config:{Model:ReconciliationModel.ManualModel,ActionRenderer:ReconciliationRenderer.ManualRenderer,LineRenderer:ReconciliationRenderer.ManualLineRenderer,params:['company_ids','mode','partner_ids','account_ids'],limitMoveLines:10,},_onValidate:function(event){var self=this;var handle=event.target.handle;var method=event.name.indexOf('auto_reconciliation')===-1?'validate':'autoReconciliation';this.model[method](handle).then(function(result){_.each(result.reconciled,function(handle){self._getWidget(handle).destroy();});_.each(result.updated,function(handle){self._getWidget(handle).update(self.model.getLine(handle));});self.renderer.update({valuenow:_.compact(_.invoke(self.widgets,'isDestroyed')).length,valuemax:self.widgets.length,title:self.title,time:Date.now()-self.time,});if(!_.any(result.updated,function(handle){return self.model.getLine(handle).mode!=='inactive';})){self._openFirstLine();}});},});core.action_registry.add('bank_statement_reconciliation_view',StatementAction);core.action_registry.add('manual_reconciliation_view',ManualAction);return{StatementAction:StatementAction,ManualAction:ManualAction,};});;

/* /account/static/src/js/reconciliation/reconciliation_model.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var utils=require('web.utils');var session=require('web.session');var CrashManager=require('web.CrashManager');var core=require('web.core');var _t=core._t;var StatementModel=BasicModel.extend({avoidCreate:false,quickCreateFields:['account_id','amount','analytic_account_id','label','tax_id'],init:function(parent,options){this._super.apply(this,arguments);this.reconcileModels=[];this.lines={};this.valuenow=0;this.valuemax=0;this.alreadyDisplayed=[];this.defaultDisplayQty=10;this.limitMoveLines=options&&options.limitMoveLines||5;},addProposition:function(handle,mv_line_id){var line=this.getLine(handle);var prop=_.clone(_.find(line.mv_lines,{'id':mv_line_id}));this._addProposition(line,prop);var propLineIds=_.map(line.reconciliation_proposition,function(prop){return prop.id;});var leftOversProps=_.filter(line.mv_lines,function(mv_line){return propLineIds.indexOf(mv_line.id)===-1;});if(line.offset&&!leftOversProps.length){line.offset-=line.limitMoveLines;}
return $.when(this._computeLine(line),this._performMoveLine(handle));},autoReconciliation:function(){var self=this;var ids=_.pluck(_.filter(this.lines,{'reconciled':false}),'id');return this._rpc({model:'account.bank.statement.line',method:'reconciliation_widget_auto_reconcile',args:[ids,self.valuenow],}).then(function(result){var reconciled_ids=_.difference(ids,result.st_lines_ids);self.valuenow+=reconciled_ids.length;result.handles=[];_.each(self.lines,function(line,handle){if(reconciled_ids.indexOf(line.id)!==-1){line.reconciled=true;result.handles.push(handle);}});return result;});},changeFilter:function(handle,filter){var line=this.getLine(handle);line.filter=filter;line.offset=0;return this._performMoveLine(handle);},changeMode:function(handle,mode){var line=this.getLine(handle);if(line.mode==='create'){this._blurProposition(handle);line.createForm=null;}
if(mode==='create'&&this.avoidCreate){mode='match';}
line.mode=mode;if(mode==='match'){return this._performMoveLine(handle);}
if(line.mode==='create'){return this.createProposition(handle);}
return $.when();},changeName:function(name){return this._rpc({model:'account.bank.statement',method:'write',args:[this.bank_statement_id.id,{name:name}],});},changeOffset:function(handle,offset){this.getLine(handle).offset+=(offset>0?1:-1)*this.limitMoveLines;return this._performMoveLine(handle);},changePartner:function(handle,partner){var self=this;var line=this.getLine(handle);line.st_line.partner_id=partner&&partner.id;line.st_line.partner_name=partner&&partner.display_name||'';return $.when(partner&&this._changePartner(handle,partner.id)).then(function(){line.reconciliation_proposition=[];self._computeLine(line);return self.changeMode(handle,'match');}).then(function(){if(line.mode==='create'){return self.createProposition(handle);}});},closeStatement:function(){var self=this;return this._rpc({model:'account.bank.statement',method:'button_confirm_bank',args:[self.bank_statement_id.id],}).then(function(){return self.bank_statement_id.id;});},createProposition:function(handle){var line=this.getLine(handle);var prop=_.filter(line.reconciliation_proposition,'__focus');var last=prop[prop.length-1];if(last&&!this._isValid(last)){return $.Deferred().reject();}
prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(line);},getContext:function(){return this.context;},getStatementLines:function(){var self=this;var linesToDisplay=_.pick(this.lines,function(value,key,object){if(value.visible===true&&self.alreadyDisplayed.indexOf(key)===-1){self.alreadyDisplayed.push(key);return object;}});return linesToDisplay;},hasMoreLines:function(){var self=this;var notDisplayed=_.filter(this.lines,function(line){return!line.visible;});if(notDisplayed.length>0){return true;}
return false;},getLine:function(handle){return this.lines[handle];},load:function(context){var self=this;var statement_ids=context.statement_ids;if(!statement_ids){return $.when();}
this.context=context;var def_statement=this._rpc({model:'account.bank.statement',method:'reconciliation_widget_preprocess',args:[statement_ids],}).then(function(statement){self.statement=statement;self.bank_statement_id=statement_ids.length===1?{id:statement_ids[0],display_name:statement.statement_name}:false;self.valuenow=0;self.valuemax=statement.st_lines_ids.length;self.context.journal_id=statement.journal_id;_.each(statement.st_lines_ids,function(id){self.lines[_.uniqueId('rline')]={id:id,reconciled:false,mode:'inactive',mv_lines:[],offset:0,filter:"",reconciliation_proposition:[],reconcileModels:[],};});});var def_reconcileModel=this._rpc({model:'account.reconcile.model',method:'search_read',}).then(function(reconcileModels){self.reconcileModels=reconcileModels;});var def_account=this._rpc({model:'account.account',method:'search_read',fields:['code'],}).then(function(accounts){self.accounts=_.object(_.pluck(accounts,'id'),_.pluck(accounts,'code'));});return $.when(def_statement,def_reconcileModel,def_account).then(function(){_.each(self.lines,function(line){line.reconcileModels=self.reconcileModels;});var ids=_.pluck(self.lines,'id');ids=ids.splice(0,self.defaultDisplayQty);self.pagerIndex=ids.length;return self.loadData(ids,[]);});},loadMore:function(qty){if(qty===undefined){qty=this.defaultDisplayQty;}
var ids=_.pluck(this.lines,'id');ids=ids.splice(this.pagerIndex,qty);this.pagerIndex+=qty;return this.loadData(ids,this._getExcludedIds());},loadData:function(ids,excluded_ids){var self=this;return self._rpc({model:'account.bank.statement.line',method:'get_data_for_reconciliation_widget',args:[ids,excluded_ids],context:self.context,}).then(self._formatLine.bind(self));},quickCreateProposition:function(handle,reconcileModelId){var line=this.getLine(handle);var reconcileModel=_.find(this.reconcileModels,function(r){return r.id===reconcileModelId;});var fields=['account_id','amount','amount_type','analytic_account_id','journal_id','label','tax_id'];this._blurProposition(handle);var focus=this._formatQuickCreate(line,_.pick(reconcileModel,fields));focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(focus);if(reconcileModel.has_second_line){var second={};_.each(fields,function(key){second[key]=("second_"+key)in reconcileModel?reconcileModel["second_"+key]:reconcileModel[key];});focus=this._formatQuickCreate(line,second);focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(focus);this._computeReconcileModels(handle,reconcileModelId);}
line.createForm=_.pick(focus,this.quickCreateFields);return this._computeLine(line);},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});}
line.mode=(id||line.mode!=="create")&&isNaN(id)&&!this.avoidCreate?'create':'match';var def=this._computeLine(line);if(line.mode==='create'){return def.then(function(){return self.createProposition(handle);});}else if(line.mode==='match'){return $.when(def,self._performMoveLine(handle));}
return def;},searchBalanceAmount:function(handle){var line=this.getLine(handle);var amount=line.balance.amount;var amount_str=_.str.sprintf('%.2f',Math.abs(amount));amount_str=(amount>'0'?'-':'+')+amount_str;if(line.balance.currency_id&&line.balance.amount_currency){var amount_currency=line.balance.amount_currency;var amount_currency_str=_.str.sprintf('%.2f',Math.abs(amount_currency));amount_str+='|'+(amount_currency>'0'?'-':'+')+amount_currency_str;}
if(amount_str===line.filter){line.filter='';line.offset=0;return this.changeMode(handle,'create');}
line.filter=amount_str;line.offset=0;return this.changeMode(handle,'match');},togglePartialReconcile:function(handle){var line=this.getLine(handle);var selected;var targetLineAmount=line.st_line.amount;line.reconciliation_proposition.every(function(prop){if(!prop.invalid){if(((line.balance.amount<0||!line.partial_reconcile)&&prop.amount>0&&targetLineAmount>0&&targetLineAmount<prop.amount)||((line.balance.amount>0||!line.partial_reconcile)&&prop.amount<0&&targetLineAmount<0&&targetLineAmount>prop.amount)){selected=prop;return false;}
targetLineAmount-=prop.amount;}
return true;});if(selected==null)
return $.Deferred().reject();selected.partial_reconcile=!selected.partial_reconcile;if(!selected.partial_reconcile){return this._computeLine(line);}
var format_options={currency_id:line.st_line.currency_id};selected.write_off_amount=selected.amount+line.balance.amount;selected.write_off_amount_str=field_utils.format.monetary(Math.abs(selected.write_off_amount),{},format_options);selected.write_off_amount_str=selected.write_off_amount_str.replace('&nbsp;',' ');return this._computeLine(line).then(function(){if(selected.partial_reconcile){line.balance.amount=0;line.balance.type=1;line.mode='inactive';}});},updateProposition:function(handle,values){var line=this.getLine(handle);var prop=_.last(_.filter(line.reconciliation_proposition,'__focus'));if(!prop){prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);}
_.each(values,function(value,fieldName){prop[fieldName]=values[fieldName];});if('account_id'in values){prop.account_code=prop.account_id?this.accounts[prop.account_id.id]:'';}
if('amount'in values){prop.base_amount=values.amount;if(prop.reconcileModelId){this._computeReconcileModels(handle,prop.reconcileModelId);}}
if('account_id'in values||'amount'in values||'tax_id'in values){prop.__tax_to_recompute=true;}
line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(line);},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&line.balance&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var ids=[];var values=[];_.each(handles,function(handle){var line=self.getLine(handle);var props=_.filter(line.reconciliation_proposition,function(prop){return!prop.is_tax&&!prop.invalid;});if(props.length===0){props.push(self._formatQuickCreate(line,{account_id:[line.st_line.open_balance_account_id,self.accounts[line.st_line.open_balance_account_id]],}));line.reconciliation_proposition.push(props[0]);self._computeLine(line);}
ids.push(line.id);var values_dict={"partner_id":line.st_line.partner_id,"counterpart_aml_dicts":_.map(_.filter(props,function(prop){return!isNaN(prop.id)&&!prop.already_paid;}),self._formatToProcessReconciliation.bind(self,line)),"payment_aml_ids":_.pluck(_.filter(props,function(prop){return!isNaN(prop.id)&&prop.already_paid;}),'id'),"new_aml_dicts":_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line)),};var currency=session.get_currency(line.st_line.currency_id);var balance=line.balance.amount;if(!utils.float_is_zero(balance,currency.digits[1])){var unreconciled_amount_dict={'account_id':line.st_line.open_balance_account_id,'credit':balance>0?balance:0,'debit':balance<0?-balance:0,'name':line.st_line.name+' : '+_t("Open balance"),};values_dict['new_aml_dicts'].push(unreconciled_amount_dict);}
values.push(values_dict);line.reconciled=true;self.valuenow++;});return this._rpc({model:'account.bank.statement.line',method:'process_reconciliations',args:[ids,values],}).then(function(){return{handles:handles};});},_addProposition:function(line,prop){function checkAccountType(r){return!isNaN(r.id)&&r.account_type!==prop.account_type;}
if(_.any(line.reconciliation_proposition,checkAccountType)){new CrashManager().show_warning({data:{exception_type:_t("Incorrect Operation"),message:_t("You cannot mix items from receivable and payable accounts.")}});return $.when();}
line.reconciliation_proposition.push(prop);_.each(line.reconciliation_proposition,function(prop){prop.partial_reconcile=false;});},_blurProposition:function(handle){var line=this.getLine(handle);line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(l){l.__focus=false;return!l.invalid;});return this._computeLine(line);},_changePartner:function(handle,partner_id){var self=this;return this._rpc({model:'res.partner',method:'read',args:[partner_id,["property_account_receivable_id","property_account_payable_id"]],}).then(function(result){if(result.length>0){var line=self.getLine(handle);self.lines[handle].st_line.open_balance_account_id=line.balance.amount<0?result[0]['property_account_payable_id'][0]:result[0]['property_account_receivable_id'][0];}});},_computeLine:function(line){var self=this;var tax_defs=[];var reconciliation_proposition=[];var formatOptions={currency_id:line.st_line.currency_id,};_.each(line.reconciliation_proposition,function(prop){if(prop.is_tax){if(!_.find(line.reconciliation_proposition,{'id':prop.link}).__tax_to_recompute){reconciliation_proposition.push(prop);}
return;}
reconciliation_proposition.push(prop);if(prop.tax_id&&prop.__tax_to_recompute&&prop.base_amount){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return!p.is_tax||p.link!==prop.id;});var args=[[prop.tax_id.id],prop.base_amount,formatOptions.currency_id];tax_defs.push(self._rpc({model:'account.tax',method:'json_friendly_compute_all',args:args,context:$.extend(self.context||{},{'round':true}),}).then(function(result){_.each(result.taxes,function(tax){var tax_prop=self._formatQuickCreate(line,{'link':prop.id,'tax_id':tax.id,'amount':tax.amount,'label':tax.name,'account_id':tax.account_id?[tax.account_id,null]:prop.account_id,'analytic':tax.analytic,'is_tax':true,'__focus':false});prop.computed_with_tax=tax.price_include
prop.tax_amount=tax.amount
prop.tax_exigible=tax.tax_exigibility==='on_payment'?true:undefined
prop.amount=tax.base;prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.invalid=!self._isValid(prop);tax_prop.amount_str=field_utils.format.monetary(Math.abs(tax_prop.amount),{},formatOptions);tax_prop.invalid=prop.invalid;reconciliation_proposition.push(tax_prop);});}));}else{prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.display=self._isDisplayedProposition(prop);prop.invalid=!self._isValid(prop);}});return $.when.apply($,tax_defs).then(function(){_.each(reconciliation_proposition,function(prop){prop.__tax_to_recompute=false;});line.reconciliation_proposition=reconciliation_proposition;var amount_currency=0;var total=line.st_line.amount||0;var isOtherCurrencyId=_.uniq(_.pluck(_.reject(reconciliation_proposition,'invalid'),'currency_id'));isOtherCurrencyId=isOtherCurrencyId.length===1&&!total&&isOtherCurrencyId[0]!==formatOptions.currency_id?isOtherCurrencyId[0]:false;_.each(reconciliation_proposition,function(prop){if(!prop.invalid){total-=prop.amount;if(isOtherCurrencyId){amount_currency-=(prop.amount<0?-1:1)*Math.abs(prop.amount_currency);}}});var company_currency=session.get_currency(line.st_line.currency_id);var company_precision=company_currency&&company_currency.digits[1]||2;total=utils.round_precision(total*1000,company_precision)/1000||0;if(isOtherCurrencyId){var other_currency=session.get_currency(isOtherCurrencyId);var other_precision=other_currency&&other_currency.digits[1]||2;amount_currency=utils.round_precision(amount_currency,other_precision)}
line.balance={amount:total,amount_str:field_utils.format.monetary(Math.abs(total),{},formatOptions),currency_id:isOtherCurrencyId,amount_currency:isOtherCurrencyId?amount_currency:total,amount_currency_str:isOtherCurrencyId?field_utils.format.monetary(Math.abs(amount_currency),{},{currency_id:isOtherCurrencyId}):false,account_code:self.accounts[line.st_line.open_balance_account_id],};line.balance.type=line.balance.amount_currency?(line.st_line.partner_id?0:-1):1;});},_computeReconcileModels:function(handle,reconcileModelId){var line=this.getLine(handle);var props=_.filter(line.reconciliation_proposition,{'reconcileModelId':reconcileModelId,'__focus':true});if(props.length===2&&props[0].percent&&props[1].percent){if(props[0].percent+props[1].percent===100){props[0].base_amount=props[0].amount=line.st_line.amount-props[1].base_amount;props[0].__tax_to_recompute=true;}}},_formatNameGet:function(value){return value?(value.id?value:{'id':value[0],'display_name':value[1]}):false;},_formatLineProposition:function(line,props){var self=this;if(props.length){_.each(props,function(prop){prop.amount=prop.debit||-prop.credit;prop.label=prop.name;prop.account_id=self._formatNameGet(prop.account_id||line.account_id);prop.is_partially_reconciled=prop.amount_str!==prop.total_amount_str;});}},_formatLine:function(lines){var self=this;var defs=[];_.each(lines,function(data){var line=_.find(self.lines,function(l){return l.id===data.st_line.id;});line.visible=true;line.limitMoveLines=self.limitMoveLines;_.extend(line,data);self._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
defs.push(self._computeLine(line));});return $.when.apply($,defs);},_formatMoveLine:function(handle,mv_lines){var self=this;var line=this.getLine(handle);_.extend(line,{'mv_lines':mv_lines});this._formatLineProposition(line,mv_lines);if(line.mode!=='create'&&!mv_lines.length&&!line.filter.length){line.mode=this.avoidCreate||!line.balance.amount?'inactive':'create';if(line.mode==='create'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},_formatQuickCreate:function(line,values){values=values||{};var account=this._formatNameGet(values.account_id);var formatOptions={currency_id:line.st_line.currency_id,};var amount=values.amount!==undefined?values.amount:line.balance.amount;var prop={'id':_.uniqueId('createLine'),'label':values.label||line.st_line.name,'account_id':account,'account_code':account?this.accounts[account.id]:'','analytic_account_id':this._formatNameGet(values.analytic_account_id),'journal_id':this._formatNameGet(values.journal_id),'tax_id':this._formatNameGet(values.tax_id),'debit':0,'credit':0,'base_amount':values.amount_type!=="percentage"?(amount):line.balance.amount*values.amount/100,'percent':values.amount_type==="percentage"?values.amount:null,'link':values.link,'display':true,'invalid':true,'__tax_to_recompute':true,'is_tax':values.is_tax,'__focus':'__focus'in values?values.__focus:true,};if(prop.base_amount){var sign=prop.base_amount<0?-1:1;var amount=field_utils.format.monetary(Math.abs(prop.base_amount),{},formatOptions);prop.base_amount=sign*field_utils.parse.monetary(amount,{},formatOptions);}
prop.amount=prop.base_amount;return prop;},_getExcludedIds:function(){var excludedIds=[];_.each(this.lines,function(line){if(line.reconciliation_proposition){_.each(line.reconciliation_proposition,function(prop){if(parseInt(prop['id'])){excludedIds.push(prop['id']);}})}});return excludedIds;},_isDisplayedProposition:function(prop){return!isNaN(prop.id)||!!prop.account_id;},_isValid:function(prop){return!isNaN(prop.id)||prop.account_id&&prop.amount&&prop.label&&!!prop.label.length;},_performMoveLine:function(handle){var line=this.getLine(handle);var excluded_ids=_.compact(_.flatten(_.map(this.lines,function(line){return _.map(line.reconciliation_proposition,function(prop){return!prop.partial_reconcile&&_.isNumber(prop.id)?prop.id:null;});})));var filter=line.filter||"";var offset=line.offset;var limit=this.limitMoveLines+1;return this._rpc({model:'account.bank.statement.line',method:'get_move_lines_for_reconciliation_widget',args:[line.id,line.st_line.partner_id,excluded_ids,filter,offset,limit],context:this.context,}).then(this._formatMoveLine.bind(this,handle));},_formatToProcessReconciliation:function(line,prop){var amount=prop.computed_with_tax&&-prop.base_amount||-prop.amount;if(prop.partial_reconcile===true){amount=-prop.write_off_amount;}
var result={name:prop.label,debit:amount>0?amount:0,credit:amount<0?-amount:0,tax_exigible:prop.tax_exigible,computed_with_tax:prop.computed_with_tax,};if(!isNaN(prop.id)){result.counterpart_aml_id=prop.id;}else{result.account_id=prop.account_id.id;if(prop.journal_id){result.journal_id=prop.journal_id.id;}}
if(!isNaN(prop.id))result.counterpart_aml_id=prop.id;if(prop.analytic_account_id)result.analytic_account_id=prop.analytic_account_id.id;if(prop.tax_id)result.tax_ids=[[4,prop.tax_id.id,null]];return result;},});var ManualModel=StatementModel.extend({quickCreateFields:['account_id','journal_id','amount','analytic_account_id','label','tax_id'],load:function(context){var self=this;this.context=context;var domain_account_id=[];if(context&&context.company_ids){domain_account_id.push(['company_id','in',context.company_ids]);}
var def_account=this._rpc({model:'account.account',method:'search_read',domain:domain_account_id,fields:['code'],}).then(function(accounts){self.account_ids=_.pluck(accounts,'id');self.accounts=_.object(self.account_ids,_.pluck(accounts,'code'));});var def_reconcileModel=this._rpc({model:'account.reconcile.model',method:'search_read',}).then(function(reconcileModels){self.reconcileModels=reconcileModels;});return $.when(def_reconcileModel,def_account).then(function(){switch(context.mode){case'customers':case'suppliers':var mode=context.mode==='customers'?'receivable':'payable';var args=['partner',context.partner_ids||null,mode];return self._rpc({model:'account.move.line',method:'get_data_for_manual_reconciliation',args:args,context:context,}).then(function(result){var defs=_.map(result,self._formatLine.bind(self,context.mode));self.valuenow=0;self.valuemax=Object.keys(self.lines).length;return $.when.apply($,defs);});case'accounts':return self._rpc({model:'account.move.line',method:'get_data_for_manual_reconciliation',args:['account',context.account_ids||self.account_ids],context:context,}).then(function(result){var defs=_.map(result,self._formatLine.bind(self,'accounts'));self.valuenow=0;self.valuemax=Object.keys(self.lines).length;return $.when.apply($,defs);});default:var partner_ids=context.partner_ids;var account_ids=self.account_ids;if(partner_ids&&!account_ids)account_ids=[];if(!partner_ids&&account_ids)partner_ids=[];account_ids=null;partner_ids=null;return self._rpc({model:'account.move.line',method:'get_data_for_manual_reconciliation_widget',args:[partner_ids,account_ids],context:context,}).then(function(result){var defs=_.map(result.accounts,self._formatLine.bind(self,'accounts'));defs=defs.concat(_.map(result.customers,self._formatLine.bind(self,'customers')));defs=defs.concat(_.map(result.suppliers,self._formatLine.bind(self,'suppliers')));self.valuenow=0;self.valuemax=Object.keys(self.lines).length;return $.when.apply($,defs);});}});},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var def=$.when();var process_reconciliations=[];var reconciled=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
var props=line.reconciliation_proposition;if(!props.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;process_reconciliations.push({id:line.type==='accounts'?line.account_id:line.partner_id,type:line.type,mv_line_ids:[],new_mv_line_dicts:[],});}else{var mv_line_ids=_.pluck(_.filter(props,function(prop){return!isNaN(prop.id);}),'id');var new_mv_line_dicts=_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display&&!prop.is_tax;}),self._formatToProcessReconciliation.bind(self,line));process_reconciliations.push({id:null,type:null,mv_line_ids:mv_line_ids,new_mv_line_dicts:new_mv_line_dicts});}
line.reconciliation_proposition=[];});if(process_reconciliations.length){def=self._rpc({model:'account.move.line',method:'process_reconciliations',args:[process_reconciliations],});}
return def.then(function(){var defs=[];var account_ids=[];var partner_ids=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
line.filter="";line.offset=0;defs.push(self._performMoveLine(handle).then(function(){if(!line.mv_lines.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;if(line.type==='accounts'){account_ids.push(line.account_id.id);}else{partner_ids.push(line.partner_id.id);}}}));});return $.when.apply($,defs).then(function(){if(account_ids.length){self._rpc({model:'account.account',method:'mark_as_reconciled',args:[account_ids],});}
if(partner_ids.length){self._rpc({model:'res.partner',method:'mark_as_reconciled',args:[partner_ids],});}
return{reconciled:reconciled,updated:_.difference(handles,reconciled)};});});},_computeLine:function(line){return this._super(line).then(function(){var props=_.reject(line.reconciliation_proposition,'invalid');line.balance.type=-1;if(!line.balance.amount_currency&&props.length){line.balance.type=1;}else if(_.any(props,function(prop){return prop.amount>0;})&&_.any(props,function(prop){return prop.amount<0;})){line.balance.type=0;}});},_formatLine:function(type,data){var line=this.lines[_.uniqueId('rline')]=_.extend(data,{type:type,reconciled:false,mode:'inactive',offset:0,limitMoveLines:this.limitMoveLines,filter:"",reconcileModels:this.reconcileModels,account_id:this._formatNameGet([data.account_id,data.account_name]),st_line:data,visible:true});this._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
return this._computeLine(line);},_formatLineProposition:function(line,props){var self=this;this._super(line,props);if(props.length){_.each(props,function(prop){var tmp_value=prop.debit||prop.credit;prop.credit=prop.credit!==0?0:tmp_value;prop.debit=prop.debit!==0?0:tmp_value;prop.amount=-prop.amount;prop.journal_id=self._formatNameGet(prop.journal_id||line.journal_id);});}},_isDisplayedProposition:function(prop){return!!prop.journal_id&&this._super(prop);},_isValid:function(prop){return prop.journal_id&&this._super(prop);},_performMoveLine:function(handle){var line=this.getLine(handle);var excluded_ids=_.compact(_.flatten(_.map(this.lines,function(line){return _.map(line.reconciliation_proposition,function(prop){return!prop.partial_reconcile&&_.isNumber(prop.id)?prop.id:null;});})));var filter=line.filter||"";var offset=line.offset;var limit=this.limitMoveLines+1;var args=[line.account_id.id,line.partner_id,excluded_ids,filter,offset,limit];return this._rpc({model:'account.move.line',method:'get_move_lines_for_manual_reconciliation',args:args,context:this.context,}).then(this._formatMoveLine.bind(this,handle));},});return{StatementModel:StatementModel,ManualModel:ManualModel,};});;

/* /account/static/src/js/reconciliation/reconciliation_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationRenderer',function(require){"use strict";var Widget=require('web.Widget');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var basic_fields=require('web.basic_fields');var core=require('web.core');var time=require('web.time');var qweb=core.qweb;var _t=core._t;var StatementRenderer=Widget.extend(FieldManagerMixin,{template:'reconciliation.statement',events:{'click div:first button.o_automatic_reconciliation':'_onAutoReconciliation','click div:first h1.statement_name':'_onClickStatementName','click div:first h1.statement_name_edition button':'_onValidateName',"click *[rel='do_action']":"_onDoAction",'click button.js_load_more':'_onLoadMore',},init:function(parent,model,state){this._super(parent);this.model=model;this._initialState=state;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.time=Date.now();this.$progress=this.$('.progress');if(this._initialState.bank_statement_id){var def=this.model.makeRecord("account.bank.statement",[{type:'char',name:'name',attrs:{string:""},value:this._initialState.bank_statement_id.display_name}]).then(function(recordID){self.handleNameRecord=recordID;self.name=new basic_fields.FieldChar(self,'name',self.model.get(self.handleNameRecord),{mode:'edit'});self.name.appendTo(self.$('.statement_name_edition')).then(function(){self.name.$el.addClass('o_required_modifier');});self.$('.statement_name').text(self._initialState.bank_statement_id.display_name);});defs.push(def);}
this.$('h1.statement_name').text(this._initialState.title);delete this._initialState;this.enterHandler=function(e){if((e.which===13||e.which===10)&&(e.ctrlKey||e.metaKey)){this.trigger_up('validate_all_balanced');}}.bind(this);$('body').on('keyup',this.enterHandler);return $.when.apply($,defs);},destroy:function(){this._super();$('body').off('keyup',this.enterHandler);},hideLoadMoreButton:function(){this.$('.js_load_more').hide();},update:function(state){var self=this;this.$progress.find('.valuenow').text(state.valuenow);this.$progress.find('.valuemax').text(state.valuemax);this.$progress.find('.progress-bar').attr('aria-valuenow',state.valuenow).attr('aria-valuemax',state.valuemax).css('width',(state.valuenow/state.valuemax*100)+'%');if(state.valuenow===state.valuemax&&!this.$('.done_message').length){var dt=Date.now()-this.time;var $done=$(qweb.render("reconciliation.done",{'duration':moment(dt).utc().format(time.getLangTimeFormat()),'number':state.valuenow,'timePerTransaction':Math.round(dt/1000/state.valuemax),'context':state.context,}));$done.find('.button_close_statement').click(this._onCloseBankStatement.bind(this));$done.find('.button_back_to_statement').click(this._onGoToBankStatement.bind(this));this.$el.children().hide();this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:$done,click_close:false,});this.$el.css('min-height','450px');}
if(state.notifications){this._renderNotifications(state.notifications);}
this.$('h1.statement_name').text(state.title);},_renderNotifications:function(notifications){this.$(".notification_area").empty();for(var i=0;i<notifications.length;i++){var $notification=$(qweb.render("reconciliation.notification",{type:notifications[i].type,message:notifications[i].message,details:notifications[i].details,})).hide();$notification.appendTo(this.$(".notification_area")).slideDown(300);}},_onAutoReconciliation:function(){this.trigger_up('auto_reconciliation');},_onClickStatementName:function(){this.$('.statement_name, .statement_name_edition').toggle();},_onCloseBankStatement:function(e){this.trigger_up('close_statement');},_onDoAction:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_name;var model=e.currentTarget.dataset.model;var ids=e.currentTarget.dataset.ids.split(",").map(Number);this.do_action({name:name,res_model:model,domain:[['id','in',ids]],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});},_onGoToBankStatement:function(e){var journalId=$(e.target).attr('data_journal_id');if(journalId){journalId=parseInt(journalId);}
this.do_action({name:'Bank Statements',res_model:'account.bank.statement',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_journal_id:journalId},view_type:'list',view_mode:'form',});},_onLoadMore:function(e){this.trigger_up('load_more');},_onValidateName:function(){var name=this.model.get(this.handleNameRecord).data.name;this.trigger_up('change_name',{'data':name});this.$('.statement_name, .statement_name_edition').toggle();},});var LineRenderer=Widget.extend(FieldManagerMixin,{template:"reconciliation.line",events:{'click .accounting_view caption .o_buttons button':'_onValidate','click .accounting_view thead td':'_onTogglePanel','click .accounting_view tfoot td:not(.cell_left,.cell_right)':'_onShowPanel','click tfoot .cell_left, tfoot .cell_right':'_onSearchBalanceAmount','input input.filter':'_onFilterChange','click .match_controls .fa-chevron-left:not(.disabled)':'_onPrevious','click .match_controls .fa-chevron-right:not(.disabled)':'_onNext','click .match .mv_line td':'_onSelectMoveLine','click .accounting_view tbody .mv_line td':'_onSelectProposition','click .o_reconcile_models button':'_onQuickCreateProposition','click .create .add_line':'_onCreateProposition','click .accounting_view .line_info_button.fa-exclamation-triangle':'_onTogglePartialReconcile','click .reconcile_model_create':'_onCreateReconcileModel','click .reconcile_model_edit':'_onEditReconcileModel','keyup input':'_onInputKeyup','blur input':'_onInputKeyup',},custom_events:_.extend({},FieldManagerMixin.custom_events,{'field_changed':'_onFieldChanged',}),_avoidFieldUpdate:{},init:function(parent,model,state){this._super(parent);FieldManagerMixin.init.call(this);this.model=model;this._initialState=state;},start:function(){var self=this;var def1=this._makePartnerRecord(this._initialState.st_line.partner_id,this._initialState.st_line.partner_name).then(function(recordID){self.fields={partner_id:new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'edit',attrs:{placeholder:self._initialState.st_line.communication_partner_name||'',}})};self.fields.partner_id.appendTo(self.$('.accounting_view caption'));});$('<span class="line_info_button fa fa-info-circle"/>').appendTo(this.$('thead .cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.statement_line.details',{'state':this._initialState}));this.$el.popover({'selector':'.line_info_button','placement':'left','container':this.$el,'html':true,'trigger':'hover','animation':false,'toggle':'popover'});var def2=this._super.apply(this,arguments);return $.when(def1,def2);},update:function(state){var self=this;this.$('caption .o_buttons button.o_validate').toggleClass('hidden',!!state.balance.type);this.$('caption .o_buttons button.o_reconcile').toggleClass('hidden',state.balance.type<=0);this.$('caption .o_buttons .o_no_valid').toggleClass('hidden',state.balance.type>=0);this._makePartnerRecord(state.st_line.partner_id,state.st_line.partner_name).then(function(recordID){self.fields.partner_id.reset(self.model.get(recordID));self.$el.attr('data-partner',state.st_line.partner_id);});this.$('.create, .match').each(function(){var $panel=$(this);$panel.css('-webkit-transition','none');$panel.css('-moz-transition','none');$panel.css('-o-transition','none');$panel.css('transition','none');$panel.css('max-height',$panel.height());$panel.css('-webkit-transition','');$panel.css('-moz-transition','');$panel.css('-o-transition','');$panel.css('transition','');});this.$el.data('mode',state.mode).attr('data-mode',state.mode);this.$('.create, .match').each(function(){$(this).removeAttr('style');});var $props=this.$('.accounting_view tbody').empty();var props=[];var partialDebitProps=0;var partialCreditProps=0;_.each(state.reconciliation_proposition,function(prop){if(prop.display){props.push(prop);if(prop.amount>0&&prop.amount>state.st_line.amount){partialDebitProps++;}else if(prop.amount<0&&prop.amount<state.st_line.amount){partialCreditProps++;}}});var targetLineAmount=state.st_line.amount;_.each(props,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
if(line.already_paid===false&&((state.balance.amount_currency<0||line.partial_reconcile)&&line.amount>0&&state.st_line.amount>0&&targetLineAmount<line.amount&&partialDebitProps<=1)||((state.balance.amount_currency>0||line.partial_reconcile)&&line.amount<0&&state.st_line.amount<0&&targetLineAmount>line.amount&&partialCreditProps<=1)){var $cell=$line.find(line.amount>0?'.cell_right':'.cell_left');var text;if(line.partial_reconcile){text=_t("Undo the partial reconciliation.");$cell.text(line.write_off_amount_str);}else{text=_t("This move's amount is higher than the transaction's amount. Click to register a partial payment and keep the payment balance open.");}
$('<span class="do_partial_reconcile_'+(!line.partial_reconcile)+' line_info_button fa fa-exclamation-triangle"/>').prependTo($cell).attr("data-content",text);}
targetLineAmount-=line.amount;$props.append($line);});var $mv_lines=this.$('.match table tbody').empty();var stateMvLines=state.mv_lines||[];_.each(stateMvLines.slice(0,state.limitMoveLines),function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$mv_lines.append($line);});this.$('.match .fa-chevron-right').toggleClass('disabled',stateMvLines.length<=state.limitMoveLines);this.$('.match .fa-chevron-left').toggleClass('disabled',!state.offset);this.$('.match').css('max-height',!stateMvLines.length&&!state.filter.length?'0px':'');this.$('.popover').remove();this.$('table tfoot').html(qweb.render("reconciliation.line.balance",{'state':state}));if(_.str.strip(this.$('input.filter').val())!==state.filter){this.$('input.filter').val(state.filter);}
if(state.createForm){if(!this.fields.account_id){this._renderCreate(state);}
var data=this.model.get(this.handleCreateRecord).data;this.model.notifyChanges(this.handleCreateRecord,state.createForm).then(function(){var record=self.model.get(self.handleCreateRecord);_.each(self.fields,function(field,fieldName){if(self._avoidFieldUpdate[fieldName])return;if(fieldName==="partner_id")return;if((data[fieldName]||state.createForm[fieldName])&&!_.isEqual(state.createForm[fieldName],data[fieldName])){field.reset(record);}});});}
this.$('.create .add_line').toggle(!!state.balance.amount_currency);},_destroyPopover:function($el){var popover=$el.data('bs.popover');if(popover){popover.destroy();}},_makePartnerRecord:function(partnerID,partnerName){var field={relation:'res.partner',type:'many2one',name:'partner_id',};if(partnerID){field.value=[partnerID,partnerName];}
return this.model.makeRecord('account.bank.statement.line',[field],{partner_id:{domain:[["parent_id","=",false],"|",["customer","=",true],["supplier","=",true]],options:{no_open:true}}});},_renderCreate:function(state){var self=this;this.model.makeRecord('account.bank.statement.line',[{relation:'account.account',type:'many2one',name:'account_id',},{relation:'account.journal',type:'many2one',name:'journal_id',},{relation:'account.tax',type:'many2one',name:'tax_id',},{relation:'account.analytic.account',type:'many2one',name:'analytic_account_id',},{type:'char',name:'label',},{type:'float',name:'amount',}],{account_id:{string:_t("Account")},label:{string:_t("Label")},amount:{string:_t("Account")}}).then(function(recordID){self.handleCreateRecord=recordID;var record=self.model.get(self.handleCreateRecord);self.fields.account_id=new relational_fields.FieldMany2One(self,'account_id',record,{mode:'edit'});self.fields.journal_id=new relational_fields.FieldMany2One(self,'journal_id',record,{mode:'edit'});self.fields.tax_id=new relational_fields.FieldMany2One(self,'tax_id',record,{mode:'edit'});self.fields.analytic_account_id=new relational_fields.FieldMany2One(self,'analytic_account_id',record,{mode:'edit'});self.fields.label=new basic_fields.FieldChar(self,'label',record,{mode:'edit'});self.fields.amount=new basic_fields.FieldFloat(self,'amount',record,{mode:'edit'});var $create=$(qweb.render("reconciliation.line.create",{'state':state}));self.fields.account_id.appendTo($create.find('.create_account_id .o_td_field')).then(addRequiredStyle.bind(self,self.fields.account_id));self.fields.journal_id.appendTo($create.find('.create_journal_id .o_td_field'));self.fields.tax_id.appendTo($create.find('.create_tax_id .o_td_field'));self.fields.analytic_account_id.appendTo($create.find('.create_analytic_account_id .o_td_field'));self.fields.label.appendTo($create.find('.create_label .o_td_field')).then(addRequiredStyle.bind(self,self.fields.label));self.fields.amount.appendTo($create.find('.create_amount .o_td_field')).then(addRequiredStyle.bind(self,self.fields.amount));self.$('.create').append($create);function addRequiredStyle(widget){widget.$el.addClass('o_required_modifier');}});},_onCreateReconcileModel:function(event){event.preventDefault();this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'form']],target:'current'});},_onEditReconcileModel:function(event){event.preventDefault();this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'list'],[false,'form']],view_type:"list",view_mode:"list",target:'current'});},_onFieldChanged:function(event){event.stopPropagation();var fieldName=event.target.name;if(fieldName==='partner_id'){var partner_id=event.data.changes.partner_id;this.trigger_up('change_partner',{'data':partner_id});}else{if(event.data.changes.amount&&isNaN(event.data.changes.amount)){return;}
this.trigger_up('update_proposition',{'data':event.data.changes});}},_onTogglePanel:function(){var mode=this.$el.data('mode')==='inactive'?'match':'inactive';this.trigger_up('change_mode',{'data':mode});},_onSearchBalanceAmount:function(){this.trigger_up('search_balance_amount');},_onShowPanel:function(){var mode=(this.$el.data('mode')==='inactive'||this.$el.data('mode')==='match')?'create':'match';this.trigger_up('change_mode',{'data':mode});},_onFilterChange:function(event){this.trigger_up('change_filter',{'data':_.str.strip($(event.target).val())});},_onInputKeyup:function(event){var target_partner_id=$(event.target).parents('[name="partner_id"]');if(target_partner_id.length===1){return;}
if(event.keyCode===13){var created_lines=_.findWhere(this.model.lines,{mode:'create'});if(created_lines&&created_lines.balance.amount){this._onCreateProposition();}
return;}
var self=this;for(var fieldName in this.fields){var field=this.fields[fieldName];if(!field.$el.is(event.target)){continue;}
this._avoidFieldUpdate[field.name]=event.type!=='focusout';field.value=false;field._setValue($(event.target).val()).then(function(){self._avoidFieldUpdate[field.name]=false;});break;}},_onPrevious:function(){this.trigger_up('change_offset',{'data':-1});},_onNext:function(){this.trigger_up('change_offset',{'data':1});},_onSelectMoveLine:function(event){var $el=$(event.target)
this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('add_proposition',{'data':moveLineId});},_onSelectProposition:function(event){var $el=$(event.target)
this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('remove_proposition',{'data':moveLineId});},_onQuickCreateProposition:function(event){document.activeElement&&document.activeElement.blur();this.trigger_up('quick_create_proposition',{'data':$(event.target).data('reconcile-model-id')});},_onCreateProposition:function(){document.activeElement&&document.activeElement.blur();var invalid=[];_.each(this.fields,function(field){if(!field.isValid()){invalid.push(field.string);}});if(invalid.length){this.do_warn(_("Some fields are undefined"),invalid.join(', '));return;}
this.trigger_up('create_proposition');},_onValidate:function(){this.trigger_up('validate');},_onTogglePartialReconcile:function(e){e.stopPropagation();var popover=$(e.target).data('bs.popover');popover&&popover.destroy();this.trigger_up('toggle_partial_reconcile');}});var ManualRenderer=StatementRenderer.extend({template:"reconciliation.manual.statement",_onClickStatementName:function(){}});var ManualLineRenderer=LineRenderer.extend({template:"reconciliation.manual.line",removeProposition:function(handle,id){if(!id){return $.when();}
return this._super(handle,id);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){var defs=[];var def;if(self._initialState.partner_id){def=self._makePartnerRecord(self._initialState.partner_id,self._initialState.partner_name).then(function(recordID){self.fields.partner_id=new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'readonly'});});defs.push(def);}else{def=self.model.makeRecord('account.move.line',[{relation:'account.account',type:'many2one',name:'account_id',value:[self._initialState.account_id.id,self._initialState.account_id.display_name],}]).then(function(recordID){self.fields.title_account_id=new relational_fields.FieldMany2One(self,'account_id',self.model.get(recordID),{mode:'readonly'});});defs.push(def);}
return $.when.apply($,defs).then(function(){if(!self.fields.title_account_id){self.fields.partner_id.$el.prependTo(self.$('.accounting_view thead td:eq(1) span:first'));}else{self.fields.partner_id.destroy();self.fields.title_account_id.appendTo(self.$('.accounting_view thead td:eq(1) span:first'));}});});},update:function(state){this._super(state);var props=_.filter(state.reconciliation_proposition,{'display':true});if(!props.length){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':{},'state':state}));this.$('.accounting_view tbody').append($line);}},_renderCreate:function(state){this._super(state);this.$('.create .create_journal_id').show();this.$('.create .create_journal_id .o_input').addClass('o_required_modifier');},});return{StatementRenderer:StatementRenderer,ManualRenderer:ManualRenderer,LineRenderer:LineRenderer,ManualLineRenderer:ManualLineRenderer,};});;

/* /account/static/src/js/account_payment_field.js defined in bundle 'web.assets_backend' */
odoo.define('account.payment',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var field_utils=require('web.field_utils');var QWeb=core.qweb;var ShowPaymentLineWidget=AbstractField.extend({events:_.extend({'click .outstanding_credit_assign':'_onOutstandingCreditAssign',},AbstractField.prototype.events),supportedFieldTypes:['char'],isSet:function(){return true;},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
_.each(info.content,function(k,v){k.index=v;k.amount=field_utils.format.float(k.amount,{digits:k.digits});if(k.date){k.date=field_utils.format.date(field_utils.parse.date(k.date,{},{isUTC:true}));}});this.$el.html(QWeb.render('ShowPaymentInfo',{lines:info.content,outstanding:info.outstanding,title:info.title}));_.each(this.$('.js_payment_info'),function(k,v){var content=info.content[v];var options={content:function(){var $content=$(QWeb.render('PaymentPopOver',{name:content.name,journal_name:content.journal_name,date:content.date,amount:content.amount,currency:content.currency,position:content.position,payment_id:content.payment_id,move_id:content.move_id,ref:content.ref,account_payment_id:content.account_payment_id,invoice_id:content.invoice_id,}));$content.filter('.js_unreconcile_payment').on('click',self._onRemoveMoveReconcile.bind(self));$content.filter('.js_open_payment').on('click',self._onOpenPayment.bind(self));return $content;},html:true,placement:'left',title:'Payment Information',trigger:'focus',delay:{"show":0,"hide":100},};$(k).popover(options);});},_onOpenPayment:function(event){var invoiceId=parseInt($(event.target).attr('invoice-id'));var paymentId=parseInt($(event.target).attr('payment-id'));var moveId=parseInt($(event.target).attr('move-id'));var res_model;var id;if(invoiceId!==undefined&&!isNaN(invoiceId)){res_model="account.invoice";id=invoiceId;}else if(paymentId!==undefined&&!isNaN(paymentId)){res_model="account.payment";id=paymentId;}else if(moveId!==undefined&&!isNaN(moveId)){res_model="account.move";id=moveId;}
if(res_model&&id){this.do_action({type:'ir.actions.act_window',res_model:res_model,res_id:id,views:[[false,'form']],target:'current'});}},_onOutstandingCreditAssign:function(event){var self=this;var id=$(event.target).data('id')||false;this._rpc({model:'account.invoice',method:'assign_outstanding_credit',args:[JSON.parse(this.value).invoice_id,id],}).then(function(){self.trigger_up('reload');});},_onRemoveMoveReconcile:function(event){var self=this;var paymentId=parseInt($(event.target).attr('payment-id'));if(paymentId!==undefined&&!isNaN(paymentId)){this._rpc({model:'account.move.line',method:'remove_move_reconcile',args:[paymentId,{'invoice_id':this.res_id}]}).then(function(){self.trigger_up('reload');});}},});field_registry.add('payment',ShowPaymentLineWidget);});;

/* /account/static/src/js/account_dashboard_setup_bar.js defined in bundle 'web.assets_backend' */
odoo.define('account.dashboard_setup_bar',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var KanbanView=require('web.KanbanView');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanController=require('web.KanbanController');var session=require('web.session');var view_registry=require('web.view_registry');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var COMPANY_METHOD_TYPE="company_object";var AccountSetupBarRenderer=KanbanRenderer.extend({events:_.extend({},KanbanRenderer.prototype.events,{'click .account_setup_dashboard_action':'onActionClicked',}),_notifyTargetChange:function(target_name,value){this.trigger_up('dashboard_edit_target',{target_name:target_name,target_value:value,});},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var values=self.state.dashboardValues;var account_dashboard=QWeb.render('account.AccountDashboardSetupBar',{widget:self,values:values,});self.$el.prepend(account_dashboard);});},onActionClicked:function(e){e.preventDefault();var self=this;var $action=$(e.currentTarget);var name_attr=$action.attr('name');var type_attr=$action.attr('type');var action_context=$action.data('context');if(type_attr==COMPANY_METHOD_TYPE){self.trigger_up('company_button_action',{rpc_method:name_attr,context:action_context})}},});var AccountSetupBarModel=KanbanModel.extend({init:function(){this.dashboardValues={};this._super.apply(this,arguments);},get:function(localID){var result=this._super.apply(this,arguments);if(this.dashboardValues[localID]){result.dashboardValues=this.dashboardValues[localID];}
return result;},load:function(){return this._loadDashboard(this._super.apply(this,arguments));},reload:function(){return this._loadDashboard(this._super.apply(this,arguments));},_fetchDashboardData:function(){return $.when(this._rpc({model:'account.journal',method:'retrieve_account_dashboard_setup_bar',args:[],}));},_loadDashboard:function(super_def){var self=this;var dashboard_def=this._fetchDashboardData();return $.when(super_def,dashboard_def).then(function(id,dashboardValues){self.dashboardValues[id]=dashboardValues;return id;});},});var AccountSetupBarController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{dashboard_open_action:'_onDashboardOpenAction',company_button_action:'_triggerCompanyButtonAction',}),_onDashboardOpenAction:function(e){var action_name=e.data.action_name;var action_context=e.data.action_context;return this.do_action(action_name,{additional_context:action_context,});},_triggerCompanyButtonAction:function(odooEvent){var self=this
if(odooEvent.data.rpc_method!==undefined){self._rpc({model:'res.company',method:odooEvent.data.rpc_method,args:[],}).then(function(rslt_action){if(rslt_action!==undefined){self.do_action(rslt_action,{action_context:odooEvent.data.context,on_close:function(){self.trigger_up('reload');},});}
else{self.trigger_up('reload');}});}}});var AccountDashboardView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:AccountSetupBarModel,Renderer:AccountSetupBarRenderer,Controller:AccountSetupBarController,}),display_name:_lt('Dashboard'),icon:'fa-dashboard',searchview_hidden:false,});view_registry.add('account_setup_bar',AccountDashboardView);return{Model:AccountSetupBarModel,Renderer:AccountSetupBarRenderer,Controller:AccountSetupBarController,};});;

/* /stock/static/src/js/stock_traceability_report_backend.js defined in bundle 'web.assets_backend' */
odoo.define('stock.stock_report_generic',function(require){'use strict';var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var ReportWidget=require('stock.ReportWidget');var framework=require('web.framework');var crash_manager=require('web.crash_manager');var QWeb=core.qweb;var stock_report_generic=Widget.extend(ControlPanelMixin,{init:function(parent,action){this.actionManager=parent;this.given_context=session.user_context;this.controller_url=action.context.url;if(action.context.context){this.given_context=action.context.context;}
this.given_context.active_id=action.context.active_id||action.params.active_id;this.given_context.model=action.context.active_model||false;this.given_context.ttype=action.context.ttype||false;return this._super.apply(this,arguments);},willStart:function(){return this.get_html();},set_html:function(){var self=this;var def=$.when();if(!this.report_widget){this.report_widget=new ReportWidget(this,this.given_context);def=this.report_widget.appendTo(this.$el);}
def.then(function(){self.report_widget.$el.html(self.html);if(self.given_context['ttype']=='downstream'){self.report_widget.$el.find('.o_report_heading').html('<h1>Downstream Traceability</h1>');}});},start:function(){this.set_html();return this._super();},get_html:function(){var self=this;var defs=[];return this._rpc({model:'stock.traceability.report',method:'get_html',args:[self.given_context],}).then(function(result){self.html=result.html;self.renderButtons();defs.push(self.update_cp());return $.when.apply($,defs);});},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={breadcrumbs:this.actionManager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons},};return this.update_control_panel(status);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("stockReports.buttons",{}));this.$buttons.bind('click',function(){var $element=$(self.$el[0]).find('.o_stock_reports_table tbody tr');var dict=[];$element.each(function(index){var $el=$($element[index]);dict.push({'id':$el.data('id'),'model_id':$el.data('model_id'),'model_name':$el.data('model'),'unfoldable':$el.data('unfold'),'level':$el.find('td:first').data('level')||1});});framework.blockUI();var url_data=self.controller_url.replace('active_id',self.given_context['active_id']);session.get_file({url:url_data.replace('output_format','pdf'),data:{data:JSON.stringify(dict)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});});return this.$buttons;},do_show:function(){this._super();this.update_cp();},});core.action_registry.add("stock_report_generic",stock_report_generic);return stock_report_generic;});;

/* /stock/static/src/js/stock_traceability_report_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('stock.ReportWidget',function(require){'use strict';var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ReportWidget=Widget.extend({events:{'click span.o_stock_reports_foldable':'fold','click span.o_stock_reports_unfoldable':'unfold','click .o_stock_reports_web_action':'boundLink','click .o_stock_reports_stream':'updownStream',},init:function(parent){this._super.apply(this,arguments);},start:function(){QWeb.add_template("/stock/static/src/xml/stock_traceability_report_line.xml");return this._super.apply(this,arguments);},boundLink:function(e){return this.do_action({type:'ir.actions.act_window',res_model:$(e.target).data('res-model'),res_id:$(e.target).data('active-id'),views:[[false,'form']],target:'current'});},updownStream:function(e){var stream=$(e.target).parent().data('stream');var $el=$(e.target).parents('tr');var string="Upstream Traceability"
if(stream=='downstream'){string="Downstream Traceability"}
this.do_action({type:"ir.actions.client",tag:'stock_report_generic',name:_t(string),context:{active_id:$el.data('model_id'),active_model:$el.data('model'),ttype:stream||false,url:'/stock/output_format/stock/active_id'},});},removeLine:function(element){var self=this;var el,$el;var rec_id=element.data('id');var $stockEl=element.nextAll('tr[data-parent_id='+rec_id+']')
for(el in $stockEl){$el=$($stockEl[el]).find(".o_stock_reports_domain_line_0, .o_stock_reports_domain_line_1");if($el.length===0){break;}
else{var $nextEls=$($el[0]).parents("tr");self.removeLine($nextEls);$nextEls.remove();}
$el.remove();}
return true;},fold:function(e){this.removeLine($(e.target).parents('tr'));var active_id=$(e.target).parents('tr').find('td.o_stock_reports_foldable').data('id');$(e.target).parents('tr').find('td.o_stock_reports_foldable').attr('class','o_stock_reports_unfoldable '+active_id);$(e.target).parents('tr').find('span.o_stock_reports_foldable').replaceWith(QWeb.render("unfoldable",{lineId:active_id}));$(e.target).parents('tr').toggleClass('o_stock_reports_unfolded');},unfold:function(e){var $CurretElement;$CurretElement=$(e.target).parents('tr').find('td.o_stock_reports_unfoldable');var active_id=$CurretElement.data('id');var active_model_name=$CurretElement.data('model');var active_model_id=$CurretElement.data('model_id');var row_level=$CurretElement.data('level');var stream=$CurretElement.data('stream');var parent_quant=$CurretElement.data('parent_quant');var $cursor=$(e.target).parents('tr');this._rpc({model:'stock.traceability.report',method:'get_lines',args:[parseInt(active_id,10)],kwargs:{'model_id':active_model_id,'model_name':active_model_name,'stream':stream||'upstream','parent_quant':parseInt(parent_quant)||false,'level':parseInt(row_level)+30||1},}).then(function(lines){var line;for(line in lines){$cursor.after(QWeb.render("report_mrp_line",{l:lines[line]}));$cursor=$cursor.next();}});$CurretElement.attr('class','o_stock_reports_foldable '+active_id);$(e.target).parents('tr').find('span.o_stock_reports_unfoldable').replaceWith(QWeb.render("foldable",{lineId:active_id}));$(e.target).parents('tr').toggleClass('o_stock_reports_unfolded');},});return ReportWidget;});;

/* /point_of_sale/static/src/js/field_text_html.js defined in bundle 'web.assets_backend' */
odoo.define('point_of_sale.fieldtexthtml',function(require){'use strict';var FieldTextHtml=require('web_editor.backend').FieldTextHtml;FieldTextHtml.include({getDatarecord:function(){var datarecord=this._super();if(this.model==='pos.config'){datarecord=_.omit(datarecord,function(val,key){return _.isObject(val)||key==='customer_facing_display_html';});}
return datarecord;},});});;

/* /point_of_sale/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('point_of_sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('point_of_sale_tour',{url:"/web",rainbowMan:false,},[{trigger:'.o_app[data-menu-xmlid="point_of_sale.menu_point_root"], .oe_menu_toggler[data-menu-xmlid="point_of_sale.menu_point_root"]',content:_t("Ready to launch your <b>point of sale</b>? <i>Click here</i>."),position:'bottom',},{trigger:".o_pos_kanban button.oe_kanban_action_button",content:_t("<p>Click to start the point of sale interface. It <b>runs on tablets</b>, laptops, or industrial hardware.</p><p>Once the session launched, the system continues to run without an internet connection.</p>"),position:"bottom"}]);});;

/* /web_settings_dashboard/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('web_settings_dashboard',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var PlannerCommon=require('web.planner.common');var PlannerDialog=PlannerCommon.PlannerDialog;var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Dashboard=Widget.extend({template:'DashboardMain',init:function(){this.all_dashboards=['apps','invitations','planner','share','translations','company'];return this._super.apply(this,arguments);},start:function(){return this.load(this.all_dashboards);},load:function(dashboards){var self=this;var loading_done=new $.Deferred();this._rpc({route:'/web_settings_dashboard/data'}).then(function(data){var all_dashboards_defs=[];_.each(dashboards,function(dashboard){var dashboard_def=self['load_'+dashboard](data);if(dashboard_def){all_dashboards_defs.push(dashboard_def);}});$.when.apply($,all_dashboards_defs).then(function(){loading_done.resolve();});});return loading_done;},load_apps:function(data){return new DashboardApps(this,data.apps).replace(this.$('.o_web_settings_dashboard_apps'));},load_share:function(data){return new DashboardShare(this,data.share).replace(this.$('.o_web_settings_dashboard_share'));},load_invitations:function(data){return new DashboardInvitations(this,data.users_info).replace(this.$('.o_web_settings_dashboard_invitations'));},load_planner:function(data){return new DashboardPlanner(this,data.planner).replace(this.$('.o_web_settings_dashboard_planner'));},load_translations:function(data){return new DashboardTranslations(this,data.translations).replace(this.$('.o_web_settings_dashboard_translations'));},load_company:function(data){return new DashboardCompany(this,data.company).replace(this.$('.o_web_settings_dashboard_company'));}});var DashboardInvitations=Widget.extend({template:'DashboardInvitations',events:{'click .o_web_settings_dashboard_invitations':'send_invitations','click .o_web_settings_dashboard_access_rights':'on_access_rights_clicked','click .o_web_settings_dashboard_user':'on_user_clicked','click .o_web_settings_dashboard_more':'on_more',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},send_invitations:function(e){var self=this;var $target=$(e.currentTarget);var user_emails=_.filter($(e.delegateTarget).find('#user_emails').val().split(/[\n, ]/),function(email){return email!=="";});var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;var is_valid_emails=_.every(user_emails,function(email){return re.test(email);});if(is_valid_emails){$target.prop('disabled',true);$target.find('i.fa-cog').removeClass('hidden');this._rpc({model:'res.users',method:'web_dashboard_create_users',args:[user_emails],}).then(function(){self.reload();}).always(function(){$(e.delegateTarget).find('.o_web_settings_dashboard_invitations').prop('disabled',false);$(e.delegateTarget).find('i.fa-cog').addClass('hidden');});}
else{this.do_warn(_t("Please provide valid email addresses"),"");}},on_access_rights_clicked:function(e){var self=this;e.preventDefault();this.do_action('base.action_res_users',{on_reverse_breadcrumb:function(){return self.reload();}});},on_user_clicked:function(e){var self=this;e.preventDefault();var user_id=$(e.currentTarget).data('user-id');var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.users',views:[[this.data.user_form_view_id,'form']],res_id:user_id,};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},on_more:function(e){var self=this;e.preventDefault();var action={type:'ir.actions.act_window',view_type:'form',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],views:[[false,'list'],[false,'form']],};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['invitations']);},});var DashboardPlanner=Widget.extend({template:'DashboardPlanner',events:{'click .o_web_settings_dashboard_planner_progress_bar':'on_planner_clicked',},init:function(parent,data){this.data=data;this.parent=parent;this.planner_by_menu={};this._super.apply(this,arguments);},willStart:function(){var self=this;return this._rpc({model:'web.planner',method:'search_read',context:session.user_context,}).then(function(res){self.planners=res;_.each(self.planners,function(planner){self.planner_by_menu[planner.menu_id[0]]=planner;self.planner_by_menu[planner.menu_id[0]].data=$.parseJSON(planner.data)||{};});self.set_overall_progress();});},update_planner_progress:function(){this.set_overall_progress();this.$('.o_web_settings_dashboard_planners_list').replaceWith(QWeb.render("DashboardPlanner.PlannersList",{'planners':this.planners}));},set_overall_progress:function(){var self=this;this.sort_planners_list();var average=_.reduce(self.planners,function(memo,planner){return planner.progress+memo;},0)/(self.planners.length||1);self.overall_progress=Math.floor(average);self.$('.o_web_settings_dashboard_planner_overall_progress').text(self.overall_progress);},sort_planners_list:function(){this.planners=_.sortBy(this.planners,function(planner){return(planner.progress>=100)+planner.name;});},on_planner_clicked:function(e){var menu_id=$(e.currentTarget).attr('data-menu-id');this.planner=this.planner_by_menu[menu_id];this.dialog=new PlannerDialog(this,undefined,this.planner);this.dialog.on("planner_progress_changed",this,function(percent){this.planner.progress=percent;this.update_planner_progress();});this.dialog.open();},});var DashboardApps=Widget.extend({template:'DashboardApps',events:{'click .o_browse_apps':'on_new_apps','click .o_confirm_upgrade':'confirm_upgrade',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);if(odoo.db_info&&_.last(odoo.db_info.server_version_info)!=='e'){$(QWeb.render("DashboardEnterprise")).appendTo(this.$el);}},on_new_apps:function(){this.do_action('base.open_module_tree');},confirm_upgrade:function(){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+(this.data.enterprise_users||1));},});var DashboardShare=Widget.extend({template:'DashboardShare',events:{'click .tw_share':'share_twitter','click .fb_share':'share_facebook','click .li_share':'share_linkedin',},init:function(parent,data){this.data=data;this.parent=parent;this.share_url='https://www.odoo.com';this.share_text=encodeURIComponent("I am using #Odoo - Awesome open source business apps.");},share_twitter:function(){var popup_url=_.str.sprintf('https://twitter.com/intent/tweet?tw_p=tweetbutton&text=%s %s',this.share_text,this.share_url);this.sharer(popup_url);},share_facebook:function(){var popup_url=_.str.sprintf('https://www.facebook.com/sharer/sharer.php?u=%s',encodeURIComponent(this.share_url));this.sharer(popup_url);},share_linkedin:function(){var popup_url=_.str.sprintf('http://www.linkedin.com/shareArticle?mini=true&url=%s&title=I am using odoo&summary=%s&source=www.odoo.com',encodeURIComponent(this.share_url),this.share_text);this.sharer(popup_url);},sharer:function(popup_url){window.open(popup_url,'Share Dialog','width=600,height=400');}});var DashboardTranslations=Widget.extend({template:'DashboardTranslations',events:{'click .o_load_translations':'on_load_translations'},on_load_translations:function(){this.do_action('base.action_view_base_language_install');}});var DashboardCompany=Widget.extend({template:'DashboardCompany',events:{'click .o_setup_company':'on_setup_company'},init:function(parent,data){this.data=data;this.parent=parent;this._super.apply(this,arguments);},on_setup_company:function(){var self=this;var action={type:'ir.actions.act_window',res_model:'res.company',view_mode:'form',view_type:'form',views:[[false,'form']],res_id:this.data.company_id};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['company']);}});core.action_registry.add('web_settings_dashboard.main',Dashboard);return{Dashboard:Dashboard,DashboardApps:DashboardApps,DashboardInvitations:DashboardInvitations,DashboardPlanner:DashboardPlanner,DashboardShare:DashboardShare,DashboardTranslations:DashboardTranslations,DashboardCompany:DashboardCompany};});