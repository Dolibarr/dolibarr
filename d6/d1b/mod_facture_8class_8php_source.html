<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dolibarr: htdocs/core/modules/modFacture.class.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dolibarr
   &#160;<span id="projectnumber">x.y.z</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_eaa9681d2effa5cf690be6ac05e74743.html">htdocs</a></li><li class="navelem"><a class="el" href="../../dir_dbb7cc76f4d8f56337f997fc682508aa.html">core</a></li><li class="navelem"><a class="el" href="../../dir_104116dba3890974446a366abc0bf5a1.html">modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">modFacture.class.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d1b/mod_facture_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* Copyright (C) 2003-2004  Rodolphe Quiedeville  &lt;rodolphe@quiedeville.org&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2004-2018  Laurent Destailleur   &lt;eldy@users.sourceforge.net&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2004   Sebastien Di Cintio   &lt;sdicintio@ressource-toi.org&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 2004   Benoit Mortier      &lt;benoit.mortier@opensides.be&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Copyright (C) 2005-2012  Regis Houssin     &lt;regis.houssin@inodbox.com&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Copyright (C) 2021   Alexandre Spangaro    &lt;aspangaro@open-dsi.fr&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 2022       Frédéric France         &lt;frederic.france@netlogic.fr&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;include_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/modules/DolibarrModules.class.php&#39;</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="../../d2/d4f/classmod_facture.html">   37</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d2/d4f/classmod_facture.html">modFacture</a> <span class="keyword">extends</span> <a class="code" href="../../d0/d8f/class_dolibarr_modules.html">DolibarrModules</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="../../d2/d4f/classmod_facture.html#adac89d6d5e381738bbee5e587829282f">   45</a></span>&#160;  <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d2/d4f/classmod_facture.html#adac89d6d5e381738bbee5e587829282f">__construct</a>($db)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    global $conf, $user;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    $this-&gt;<a class="code" href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a> = $db;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    $this-&gt;numero = 30;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    $this-&gt;family = <span class="stringliteral">&quot;financial&quot;</span>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    $this-&gt;module_position = <span class="stringliteral">&#39;11&#39;</span>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Module label (no space allowed), used if translation string &#39;ModuleXXXName&#39; not found (where XXX is value of numeric property &#39;numero&#39; of module)</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    $this-&gt;<a class="code" href="../../d1/d2d/repair_8php.html#adc47ab40d9a5ded8ff8f4e1a3b92a208">name</a> = preg_replace(<span class="stringliteral">&#39;/^mod/i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, get_class($this));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    $this-&gt;<a class="code" href="../../d8/d0e/email__expire__services__to__customers_8php.html#a152b76e3a9723678d88531fde723582d">description</a> = <span class="stringliteral">&quot;Gestion des factures&quot;</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Possible values for version are: &#39;development&#39;, &#39;experimental&#39;, &#39;dolibarr&#39; or version</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    $this-&gt;version = <span class="stringliteral">&#39;dolibarr&#39;</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    $this-&gt;const_name = <span class="stringliteral">&#39;MAIN_MODULE_&#39;</span>.strtoupper($this-&gt;<a class="code" href="../../d1/d2d/repair_8php.html#adc47ab40d9a5ded8ff8f4e1a3b92a208">name</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    $this-&gt;picto = <span class="stringliteral">&#39;bill&#39;</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Data directories to create when module is enabled</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    $this-&gt;dirs = array(<span class="stringliteral">&quot;/facture/temp&quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// Dependencies</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    $this-&gt;depends = array(<span class="stringliteral">&#39;always&#39;</span>=&gt;<span class="stringliteral">&quot;modSociete&quot;</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    $this-&gt;requiredby = array(<span class="stringliteral">&quot;modComptabilite&quot;</span>, <span class="stringliteral">&quot;modAccounting&quot;</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    $this-&gt;conflictwith = array();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    $this-&gt;langfiles = array(<span class="stringliteral">&quot;bills&quot;</span>, <span class="stringliteral">&quot;companies&quot;</span>, <span class="stringliteral">&quot;compta&quot;</span>, <span class="stringliteral">&quot;products&quot;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    $this-&gt;warnings_activation = array(); <span class="comment">// Warning to show when we activate module. array(&#39;always&#39;=&#39;text&#39;) or array(&#39;FR&#39;=&#39;text&#39;)</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    $this-&gt;warnings_activation_ext = array(); <span class="comment">// Warning to show when we activate an external module. array(&#39;always&#39;=&#39;text&#39;) or array(&#39;FR&#39;=&#39;text&#39;)</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// Config pages</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    $this-&gt;config_page_url = array(<span class="stringliteral">&quot;facture.php&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// Constants</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    $this-&gt;<span class="keyword">const</span> = array();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    $r = 0;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][0] = <span class="stringliteral">&quot;FACTURE_ADDON&quot;</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][1] = <span class="stringliteral">&quot;chaine&quot;</span>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][2] = <span class="stringliteral">&quot;mod_facture_terre&quot;</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][3] = <span class="stringliteral">&#39;Name of numbering numerotation rules of invoice&#39;</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][4] = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    $r++;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][0] = <span class="stringliteral">&quot;FACTURE_ADDON_PDF&quot;</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][1] = <span class="stringliteral">&quot;chaine&quot;</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][2] = <span class="stringliteral">&quot;sponge&quot;</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][3] = <span class="stringliteral">&#39;Name of PDF model of invoice&#39;</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][4] = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    $r++;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][0] = <span class="stringliteral">&quot;FACTURE_ADDON_PDF_ODT_PATH&quot;</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][1] = <span class="stringliteral">&quot;chaine&quot;</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][2] = <span class="stringliteral">&quot;DOL_DATA_ROOT/doctemplates/invoices&quot;</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][3] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    $this-&gt;<span class="keyword">const</span>[$r][4] = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    $r++;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// Boxes</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">//$this-&gt;boxes = array(0=&gt;array(1=&gt;&#39;box_factures_imp.php&#39;),1=&gt;array(1=&gt;&#39;box_factures.php&#39;));</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    $this-&gt;boxes = array(</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        0=&gt;array(<span class="stringliteral">&#39;file&#39;</span>=&gt;<span class="stringliteral">&#39;box_factures_imp.php&#39;</span>, <span class="stringliteral">&#39;enabledbydefaulton&#39;</span>=&gt;<span class="stringliteral">&#39;Home&#39;</span>),</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        1=&gt;array(<span class="stringliteral">&#39;file&#39;</span>=&gt;<span class="stringliteral">&#39;box_factures.php&#39;</span>, <span class="stringliteral">&#39;enabledbydefaulton&#39;</span>=&gt;<span class="stringliteral">&#39;Home&#39;</span>),</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        2=&gt;array(<span class="stringliteral">&#39;file&#39;</span>=&gt;<span class="stringliteral">&#39;box_graph_invoices_permonth.php&#39;</span>, <span class="stringliteral">&#39;enabledbydefaulton&#39;</span>=&gt;<span class="stringliteral">&#39;Home&#39;</span>),</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        3=&gt;array(<span class="stringliteral">&#39;file&#39;</span>=&gt;<span class="stringliteral">&#39;box_customers_outstanding_bill_reached.php&#39;</span>, <span class="stringliteral">&#39;enabledbydefaulton&#39;</span>=&gt;<span class="stringliteral">&#39;Home&#39;</span>)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    );</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// Cronjobs</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    $arraydate = <a class="code" href="../../d9/d69/functions_8lib_8php.html#af6ea38239900c36d603debe46308159a">dol_getdate</a>(<a class="code" href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a>());</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    $datestart = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a>(23, 0, 0, $arraydate[<span class="stringliteral">&#39;mon&#39;</span>], $arraydate[<span class="stringliteral">&#39;mday&#39;</span>], $arraydate[<span class="stringliteral">&#39;year&#39;</span>]);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    $this-&gt;cronjobs = array(</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      0 =&gt; array(</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="stringliteral">&#39;label&#39;</span>=&gt;<span class="stringliteral">&#39;RecurringInvoicesJob&#39;</span>,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="stringliteral">&#39;jobtype&#39;</span>=&gt;<span class="stringliteral">&#39;method&#39;</span>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="stringliteral">&#39;class&#39;</span>=&gt;<span class="stringliteral">&#39;compta/facture/class/facture-rec.class.php&#39;</span>,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="stringliteral">&#39;objectname&#39;</span>=&gt;<span class="stringliteral">&#39;FactureRec&#39;</span>,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="stringliteral">&#39;method&#39;</span>=&gt;<span class="stringliteral">&#39;createRecurringInvoices&#39;</span>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="stringliteral">&#39;parameters&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="stringliteral">&#39;comment&#39;</span>=&gt;<span class="stringliteral">&#39;Generate recurring invoices&#39;</span>,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="stringliteral">&#39;frequency&#39;</span>=&gt;1,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="stringliteral">&#39;unitfrequency&#39;</span>=&gt;3600 * 24,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="stringliteral">&#39;priority&#39;</span>=&gt;51,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="stringliteral">&#39;status&#39;</span>=&gt;1,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="stringliteral">&#39;test&#39;</span>=&gt;<span class="stringliteral">&#39;$conf-&gt;facture-&gt;enabled&#39;</span>,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="stringliteral">&#39;datestart&#39;</span>=&gt;$datestart</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      ),</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      1 =&gt; array(</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="stringliteral">&#39;label&#39;</span>=&gt;<span class="stringliteral">&#39;SendEmailsRemindersOnInvoiceDueDate&#39;</span>,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="stringliteral">&#39;jobtype&#39;</span>=&gt;<span class="stringliteral">&#39;method&#39;</span>,</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="stringliteral">&#39;class&#39;</span>=&gt;<span class="stringliteral">&#39;compta/facture/class/facture.class.php&#39;</span>,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="stringliteral">&#39;objectname&#39;</span>=&gt;<span class="stringliteral">&#39;Facture&#39;</span>,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="stringliteral">&#39;method&#39;</span>=&gt;<span class="stringliteral">&#39;sendEmailsRemindersOnInvoiceDueDate&#39;</span>,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="stringliteral">&#39;parameters&#39;</span>=&gt;<span class="stringliteral">&quot;10,all,EmailTemplateCode&quot;</span>,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="stringliteral">&#39;comment&#39;</span>=&gt;<span class="stringliteral">&#39;Send an emails when the unpaid invoices reach a due date + n days = today. First param is the offset n of days, second parameter is &quot;all&quot; or a payment mode code, last parameter is the code of email template to use (an email template with EmailTemplateCode must exists. The version in the language of the thirdparty will be used in priority to update the PDF of the sent invoice).&#39;</span>,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="stringliteral">&#39;frequency&#39;</span>=&gt;1,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="stringliteral">&#39;unitfrequency&#39;</span>=&gt;3600 * 24,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="stringliteral">&#39;priority&#39;</span>=&gt;50,</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="stringliteral">&#39;status&#39;</span>=&gt;0,</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="stringliteral">&#39;test&#39;</span>=&gt;<span class="stringliteral">&#39;$conf-&gt;facture-&gt;enabled&#39;</span>,</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="stringliteral">&#39;datestart&#39;</span>=&gt;$datestart</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      ),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    );</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// Permissions</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    $this-&gt;rights = array();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    $this-&gt;rights_class = <span class="stringliteral">&#39;facture&#39;</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    $r = 0;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    $r++;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    $this-&gt;rights[$r][0] = 11;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Read invoices&#39;</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;lire&#39;</span>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    $r++;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    $this-&gt;rights[$r][0] = 12;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Create and update invoices&#39;</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;creer&#39;</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// There is a particular permission for unvalidate because this may be not forbidden by some laws</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    $r++;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    $this-&gt;rights[$r][0] = 13;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Devalidate invoices&#39;</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;invoice_advance&#39;</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    $this-&gt;rights[$r][5] = <span class="stringliteral">&#39;unvalidate&#39;</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    $r++;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    $this-&gt;rights[$r][0] = 14;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Validate invoices&#39;</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;invoice_advance&#39;</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    $this-&gt;rights[$r][5] = <span class="stringliteral">&#39;validate&#39;</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    $r++;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    $this-&gt;rights[$r][0] = 15;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Send invoices by email&#39;</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;invoice_advance&#39;</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    $this-&gt;rights[$r][5] = <span class="stringliteral">&#39;send&#39;</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    $r++;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    $this-&gt;rights[$r][0] = 16;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Issue payments on invoices&#39;</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;paiement&#39;</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    $r++;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    $this-&gt;rights[$r][0] = 19;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Delete invoices&#39;</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;supprimer&#39;</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    $r++;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    $this-&gt;rights[$r][0] = 1321;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Export customer invoices, attributes and payments&#39;</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;r&#39;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;facture&#39;</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    $this-&gt;rights[$r][5] = <span class="stringliteral">&#39;export&#39;</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    $r++;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    $this-&gt;rights[$r][0] = 1322;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    $this-&gt;rights[$r][1] = <span class="stringliteral">&#39;Re-open a fully paid invoice&#39;</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    $this-&gt;rights[$r][2] = <span class="charliteral">&#39;r&#39;</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    $this-&gt;rights[$r][3] = 0;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    $this-&gt;rights[$r][4] = <span class="stringliteral">&#39;invoice_advance&#39;</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    $this-&gt;rights[$r][5] = <span class="stringliteral">&#39;reopen&#39;</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Menus</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">//-------</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    $this-&gt;menu = 1; <span class="comment">// This module add menu entries. They are coded into menu manager.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// Imports</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">//--------</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    $r = 1;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    $r++;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    $this-&gt;import_code[$r] = $this-&gt;rights_class.<span class="charliteral">&#39;_&#39;</span>.$r;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    $this-&gt;import_label[$r] = <span class="stringliteral">&quot;Invoices&quot;</span>; <span class="comment">// Translation key</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    $this-&gt;import_icon[$r] = $this-&gt;picto;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    $this-&gt;import_entities_array[$r] = array(); <span class="comment">// We define here only fields that use another icon that the one defined into import_icon</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    $this-&gt;import_tables_array[$r] = array(<span class="charliteral">&#39;f&#39;</span> =&gt; MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture&#39;</span>, <span class="stringliteral">&#39;extra&#39;</span> =&gt; MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture_extrafields&#39;</span>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    $this-&gt;import_tables_creator_array[$r] = array(<span class="charliteral">&#39;f&#39;</span> =&gt; <span class="stringliteral">&#39;fk_user_author&#39;</span>); <span class="comment">// Fields to store import user id</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    $this-&gt;import_fields_array[$r] = array(</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="stringliteral">&#39;f.ref&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceRef*&#39;</span>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="stringliteral">&#39;f.ref_ext&#39;</span> =&gt; <span class="stringliteral">&#39;ExternalRef&#39;</span>,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="stringliteral">&#39;f.ref_client&#39;</span> =&gt; <span class="stringliteral">&#39;CustomerRef&#39;</span>,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="stringliteral">&#39;f.type&#39;</span> =&gt; <span class="stringliteral">&#39;Type*&#39;</span>,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="stringliteral">&#39;f.fk_soc&#39;</span> =&gt; <span class="stringliteral">&#39;Customer*&#39;</span>,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="stringliteral">&#39;f.datec&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceDateCreation&#39;</span>,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="stringliteral">&#39;f.datef&#39;</span> =&gt; <span class="stringliteral">&#39;DateInvoice&#39;</span>,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="stringliteral">&#39;f.date_valid&#39;</span> =&gt; <span class="stringliteral">&#39;Validation Date&#39;</span>,</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="stringliteral">&#39;f.paye&#39;</span> =&gt; <span class="stringliteral">&#39;InvoicePaid&#39;</span>,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="stringliteral">&#39;f.remise_percent&#39;</span> =&gt; <span class="stringliteral">&#39;RemisePercent&#39;</span>,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="stringliteral">&#39;f.remise_absolue&#39;</span> =&gt; <span class="stringliteral">&#39;RemiseAbsolue&#39;</span>,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="stringliteral">&#39;f.remise&#39;</span> =&gt; <span class="stringliteral">&#39;Remise&#39;</span>,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="stringliteral">&#39;f.total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;TotalVAT&#39;</span>,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="stringliteral">&#39;f.total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;TotalHT&#39;</span>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="stringliteral">&#39;f.total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;TotalTTC&#39;</span>,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="stringliteral">&#39;f.fk_statut&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceStatus&#39;</span>,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="stringliteral">&#39;f.fk_user_modif&#39;</span> =&gt; <span class="stringliteral">&#39;Modifier Id&#39;</span>,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="stringliteral">&#39;f.fk_user_valid&#39;</span> =&gt; <span class="stringliteral">&#39;Validator Id&#39;</span>,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="stringliteral">&#39;f.fk_user_closing&#39;</span> =&gt; <span class="stringliteral">&#39;Closer Id&#39;</span>,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="stringliteral">&#39;f.fk_facture_source&#39;</span> =&gt; <span class="stringliteral">&#39;Invoice Source Id&#39;</span>,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="stringliteral">&#39;f.fk_projet&#39;</span> =&gt; <span class="stringliteral">&#39;Project Id&#39;</span>,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="stringliteral">&#39;f.fk_account&#39;</span> =&gt; <span class="stringliteral">&#39;Bank Account&#39;</span>,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="stringliteral">&#39;f.fk_currency&#39;</span> =&gt; <span class="stringliteral">&#39;Currency*&#39;</span>,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="stringliteral">&#39;f.fk_cond_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;Payment Condition&#39;</span>,</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="stringliteral">&#39;f.fk_mode_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;Payment Mode&#39;</span>,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;DateMaxPayment&#39;</span>,</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="stringliteral">&#39;f.note_public&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceNote&#39;</span>,</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span> =&gt; <span class="stringliteral">&#39;NotePrivate&#39;</span>,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="stringliteral">&#39;f.model_pdf&#39;</span> =&gt; <span class="stringliteral">&#39;Model&#39;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    );</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;multicurrency&quot;</span>)) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_code&#39;</span>] = <span class="stringliteral">&#39;Currency&#39;</span>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_tx&#39;</span>] = <span class="stringliteral">&#39;CurrencyRate&#39;</span>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ht&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountHT&#39;</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_tva&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountVAT&#39;</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ttc&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountTTC&#39;</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// Add extra fields</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    $import_extrafield_sample = array();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    $sql = <span class="stringliteral">&quot;SELECT name, label, fieldrequired FROM &quot;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&quot;extrafields WHERE elementtype = &#39;facture&#39; AND entity IN (0, &quot;</span>.$conf-&gt;entity.<span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a> = $this-&gt;<a class="code" href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a>-&gt;query($sql);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">while</span> ($obj = $this-&gt;<a class="code" href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a>-&gt;fetch_object(<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>)) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        $fieldname = <span class="stringliteral">&#39;extra.&#39;</span>.$obj-&gt;name;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        $fieldlabel = ucfirst($obj-&gt;label);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        $this-&gt;import_fields_array[$r][$fieldname] = $fieldlabel.($obj-&gt;fieldrequired ? <span class="charliteral">&#39;*&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        $import_extrafield_sample[$fieldname] = $fieldlabel;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// End add extra fields</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    $this-&gt;import_fieldshidden_array[$r] = array(<span class="stringliteral">&#39;extra.fk_object&#39;</span> =&gt; <span class="stringliteral">&#39;lastrowid-&#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture&#39;</span>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    $this-&gt;import_regex_array[$r] = array(<span class="stringliteral">&#39;f.multicurrency_code&#39;</span> =&gt; <span class="stringliteral">&#39;code@&#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;multicurrency&#39;</span>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    $import_sample = array(</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="stringliteral">&#39;f.ref&#39;</span> =&gt; <span class="stringliteral">&#39;(PROV0001)&#39;</span>,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="stringliteral">&#39;f.ref_ext&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="stringliteral">&#39;f.ref_client&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="stringliteral">&#39;f.type&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="stringliteral">&#39;f.fk_soc&#39;</span> =&gt; <span class="stringliteral">&#39;80LIMIT&#39;</span>,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="stringliteral">&#39;f.datec&#39;</span> =&gt; <span class="stringliteral">&#39;2021-11-24&#39;</span>,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="stringliteral">&#39;f.datef&#39;</span> =&gt; <span class="stringliteral">&#39;2021-11-24&#39;</span>,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="stringliteral">&#39;f.date_valid&#39;</span> =&gt; <span class="stringliteral">&#39;2021-11-24&#39;</span>,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="stringliteral">&#39;f.paye&#39;</span> =&gt; <span class="charliteral">&#39;1&#39;</span>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="stringliteral">&#39;f.remise_percent&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="stringliteral">&#39;f.remise_absolue&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="stringliteral">&#39;f.remise&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="stringliteral">&#39;f.total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="stringliteral">&#39;f.total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;100&#39;</span>,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="stringliteral">&#39;f.total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;121&#39;</span>,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="stringliteral">&#39;f.fk_statut&#39;</span> =&gt; <span class="charliteral">&#39;1&#39;</span>,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="stringliteral">&#39;f.fk_user_modif&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="stringliteral">&#39;f.fk_user_valid&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="stringliteral">&#39;f.fk_user_closing&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="stringliteral">&#39;f.fk_facture_source&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="stringliteral">&#39;f.fk_projet&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="stringliteral">&#39;f.fk_account&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="stringliteral">&#39;f.fk_currency&#39;</span> =&gt; <span class="stringliteral">&#39;EUR&#39;</span>,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="stringliteral">&#39;f.fk_cond_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;30D&#39;</span>,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="stringliteral">&#39;f.fk_mode_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;VIR&#39;</span>,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span> =&gt; <span class="stringliteral">&#39;2021-12-24&#39;</span>,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="stringliteral">&#39;f.note_public&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="stringliteral">&#39;f.model_pdf&#39;</span> =&gt; <span class="stringliteral">&#39;crabe&#39;</span>,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="stringliteral">&#39;f.multicurrency_code&#39;</span> =&gt; <span class="stringliteral">&#39;EUR&#39;</span>,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="stringliteral">&#39;f.multicurrency_tx&#39;</span> =&gt; <span class="charliteral">&#39;1&#39;</span>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="stringliteral">&#39;f.multicurrency_total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;100&#39;</span>,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="stringliteral">&#39;f.multicurrency_total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="stringliteral">&#39;f.multicurrency_total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;121&#39;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    );</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    $this-&gt;import_examplevalues_array[$r] = array_merge($import_sample, $import_extrafield_sample);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    $this-&gt;import_updatekeys_array[$r] = array(<span class="stringliteral">&#39;f.ref&#39;</span> =&gt; <span class="stringliteral">&#39;Ref&#39;</span>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    $this-&gt;import_convertvalue_array[$r] = array(</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="stringliteral">&#39;f.fk_soc&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="stringliteral">&#39;rule&#39;</span> =&gt; <span class="stringliteral">&#39;fetchidfromref&#39;</span>,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="stringliteral">&#39;file&#39;</span> =&gt; <span class="stringliteral">&#39;/societe/class/societe.class.php&#39;</span>,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;Societe&#39;</span>,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fetch&#39;</span>,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="stringliteral">&#39;element&#39;</span> =&gt; <span class="stringliteral">&#39;ThirdParty&#39;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      ),</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="stringliteral">&#39;f.fk_projet&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="stringliteral">&#39;rule&#39;</span> =&gt; <span class="stringliteral">&#39;fetchidfromref&#39;</span>,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="stringliteral">&#39;file&#39;</span> =&gt; <span class="stringliteral">&#39;/projet/class/project.class.php&#39;</span>,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;Project&#39;</span>,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fetch&#39;</span>,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="stringliteral">&#39;element&#39;</span> =&gt; <span class="stringliteral">&#39;facture&#39;</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      ),</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="stringliteral">&#39;f.fk_cond_reglement&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="stringliteral">&#39;rule&#39;</span> =&gt; <span class="stringliteral">&#39;fetchidfromcodeorlabel&#39;</span>,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="stringliteral">&#39;file&#39;</span> =&gt; <span class="stringliteral">&#39;/compta/facture/class/paymentterm.class.php&#39;</span>,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;PaymentTerm&#39;</span>,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fetch&#39;</span>,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="stringliteral">&#39;element&#39;</span> =&gt; <span class="stringliteral">&#39;c_payment_term&#39;</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      )</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    );</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// Import Invoice Lines</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    $r++;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    $this-&gt;import_code[$r] = $this-&gt;rights_class.<span class="charliteral">&#39;_&#39;</span>.$r;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    $this-&gt;import_label[$r] = <span class="stringliteral">&quot;InvoiceLine&quot;</span>; <span class="comment">// Translation key</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    $this-&gt;import_icon[$r] = $this-&gt;picto;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    $this-&gt;import_entities_array[$r] = array(); <span class="comment">// We define here only fields that use another icon that the one defined into import_icon</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    $this-&gt;import_tables_array[$r] = array(<span class="stringliteral">&#39;fd&#39;</span> =&gt; MAIN_DB_PREFIX.<span class="stringliteral">&#39;facturedet&#39;</span>, <span class="stringliteral">&#39;extra&#39;</span> =&gt; MAIN_DB_PREFIX.<span class="stringliteral">&#39;facturedet_extrafields&#39;</span>);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    $this-&gt;import_fields_array[$r] = array(</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="stringliteral">&#39;fd.fk_facture&#39;</span> =&gt; <span class="stringliteral">&#39;InvoiceRef*&#39;</span>,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="stringliteral">&#39;fd.fk_parent_line&#39;</span> =&gt; <span class="stringliteral">&#39;FacParentLine&#39;</span>,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="stringliteral">&#39;fd.fk_product&#39;</span> =&gt; <span class="stringliteral">&#39;IdProduct&#39;</span>,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="stringliteral">&#39;fd.label&#39;</span> =&gt; <span class="stringliteral">&#39;Label&#39;</span>,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="stringliteral">&#39;fd.description&#39;</span> =&gt; <span class="stringliteral">&#39;LineDescription*&#39;</span>,</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="stringliteral">&#39;fd.vat_src_code&#39;</span> =&gt; <span class="stringliteral">&#39;Vat Source Code&#39;</span>,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="stringliteral">&#39;fd.tva_tx&#39;</span> =&gt; <span class="stringliteral">&#39;LineVATRate*&#39;</span>,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">// localtax1_tx</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="comment">// localtax1_type</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="comment">// localtax2_tx</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="comment">// localtax2_type</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="stringliteral">&#39;fd.qty&#39;</span> =&gt; <span class="stringliteral">&#39;LineQty&#39;</span>,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="stringliteral">&#39;fd.remise_percent&#39;</span> =&gt; <span class="stringliteral">&#39;Reduc. (%)&#39;</span>,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">// remise</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">// fk_remise_except</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">// subprice</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="comment">// price</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="stringliteral">&#39;fd.total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;LineTotalHT&#39;</span>,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="stringliteral">&#39;fd.total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;LineTotalVAT&#39;</span>,</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">// total_localtax1</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">// total_localtax2</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="stringliteral">&#39;fd.total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;LineTotalTTC&#39;</span>,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="stringliteral">&#39;fd.product_type&#39;</span> =&gt; <span class="stringliteral">&#39;TypeOfLineServiceOrProduct&#39;</span>,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="stringliteral">&#39;fd.date_start&#39;</span> =&gt; <span class="stringliteral">&#39;Start Date&#39;</span>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="stringliteral">&#39;fd.date_end&#39;</span> =&gt; <span class="stringliteral">&#39;End Date&#39;</span>,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="comment">// info_bits</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="comment">// buy_price_ht</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="comment">// fk_product_fournisseur_price</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="comment">// specia_code</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="comment">// rang</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="comment">// fk_contract_line</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="stringliteral">&#39;fd.fk_unit&#39;</span> =&gt; <span class="stringliteral">&#39;Unit&#39;</span>,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="comment">// fk_code_ventilation</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="comment">// situation_percent</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="comment">// fk_prev_id</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">// fk_user_author</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="comment">// fk_user_modif</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="comment">// ref_ext</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    );</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;multicurrency&quot;</span>)) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;fd.multicurrency_code&#39;</span>] = <span class="stringliteral">&#39;Currency&#39;</span>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;fd.multicurrency_subprice&#39;</span>] = <span class="stringliteral">&#39;CurrencyRate&#39;</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;fd.multicurrency_total_ht&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountHT&#39;</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;fd.multicurrency_total_tva&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountVAT&#39;</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      $this-&gt;import_fields_array[$r][<span class="stringliteral">&#39;fd.multicurrency_total_ttc&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountTTC&#39;</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// Add extra fields</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    $import_extrafield_sample = array();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    $sql = <span class="stringliteral">&quot;SELECT name, label, fieldrequired FROM &quot;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&quot;extrafields WHERE elementtype = &#39;facture_det&#39; AND entity IN (0, &quot;</span>.$conf-&gt;entity.<span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a> = $this-&gt;<a class="code" href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a>-&gt;query($sql);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">while</span> ($obj = $this-&gt;<a class="code" href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a>-&gt;fetch_object(<a class="code" href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a>)) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        $fieldname = <span class="stringliteral">&#39;extra.&#39;</span>.$obj-&gt;name;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        $fieldlabel = ucfirst($obj-&gt;label);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        $this-&gt;import_fields_array[$r][$fieldname] = $fieldlabel.($obj-&gt;fieldrequired ? <span class="charliteral">&#39;*&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        $import_extrafield_sample[$fieldname] = $fieldlabel;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// End add extra fields</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    $this-&gt;import_fieldshidden_array[$r] = array(<span class="stringliteral">&#39;extra.fk_object&#39;</span> =&gt; <span class="stringliteral">&#39;lastrowid-&#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facturedet&#39;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    $this-&gt;import_regex_array[$r] = array(</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="stringliteral">&#39;fd.fk_product&#39;</span> =&gt; <span class="stringliteral">&#39;rowid@&#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_code&#39;</span> =&gt; <span class="stringliteral">&#39;code@&#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;multicurrency&#39;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    );</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    $import_sample = array(</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="stringliteral">&#39;fd.fk_facture&#39;</span> =&gt; <span class="stringliteral">&#39;(PROV00001)&#39;</span>,</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="stringliteral">&#39;fd.fk_parent_line&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="stringliteral">&#39;fd.fk_product&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="stringliteral">&#39;fd.label&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="stringliteral">&#39;fd.description&#39;</span> =&gt; <span class="stringliteral">&#39;Test product&#39;</span>,</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="stringliteral">&#39;fd.vat_src_code&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="stringliteral">&#39;fd.tva_tx&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="comment">// localtax1_tx</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="comment">// localtax1_type</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">// localtax2_tx</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">// localtax2_type</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="stringliteral">&#39;fd.qty&#39;</span> =&gt; <span class="charliteral">&#39;1&#39;</span>,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="stringliteral">&#39;fd.remise_percent&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="comment">// remise</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="comment">// fk_remise_except</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="comment">// subprice</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// price</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="stringliteral">&#39;fd.total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;100&#39;</span>,</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="stringliteral">&#39;fd.total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="comment">// total_localtax1</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">// total_localtax2</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="stringliteral">&#39;fd.total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;121&#39;</span>,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="stringliteral">&#39;fd.product_type&#39;</span> =&gt; <span class="charliteral">&#39;0&#39;</span>,</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="stringliteral">&#39;fd.date_start&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="stringliteral">&#39;fd.date_end&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="comment">// info_bits</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// buy_price_ht</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">// fk_product_fournisseur_price</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="comment">// specia_code</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="comment">// rang</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="comment">// fk_contract_line</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="stringliteral">&#39;fd.fk_unit&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="comment">// fk_code_ventilation</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="comment">// situation_percent</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="comment">// fk_prev_id</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="comment">// fk_user_author</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="comment">// fk_user_modif</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="comment">// ref_ext</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_code&#39;</span> =&gt; <span class="stringliteral">&#39;EUR&#39;</span>,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_tx&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_total_ht&#39;</span> =&gt; <span class="stringliteral">&#39;100&#39;</span>,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_total_tva&#39;</span> =&gt; <span class="stringliteral">&#39;21&#39;</span>,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="stringliteral">&#39;fd.multicurrency_total_ttc&#39;</span> =&gt; <span class="stringliteral">&#39;121&#39;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    );</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    $this-&gt;import_examplevalues_array[$r] = array_merge($import_sample, $import_extrafield_sample);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    $this-&gt;import_updatekeys_array[$r] = array(</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="stringliteral">&#39;fd.rowid&#39;</span> =&gt; <span class="stringliteral">&#39;Row Id&#39;</span>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="stringliteral">&#39;fd.fk_facture&#39;</span> =&gt; <span class="stringliteral">&#39;Invoice Id&#39;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    );</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    $this-&gt;import_convertvalue_array[$r] = array(</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="stringliteral">&#39;fd.fk_facture&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="stringliteral">&#39;rule&#39;</span> =&gt; <span class="stringliteral">&#39;fetchidfromref&#39;</span>,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="stringliteral">&#39;file&#39;</span> =&gt; <span class="stringliteral">&#39;/compta/facture/class/facture.class.php&#39;</span>,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;Facture&#39;</span>,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fetch&#39;</span>,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="stringliteral">&#39;element&#39;</span> =&gt; <span class="stringliteral">&#39;facture&#39;</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      ),</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="stringliteral">&#39;fd.fk_projet&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="stringliteral">&#39;rule&#39;</span> =&gt; <span class="stringliteral">&#39;fetchidfromref&#39;</span>,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="stringliteral">&#39;file&#39;</span> =&gt; <span class="stringliteral">&#39;/projet/class/project.class.php&#39;</span>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="stringliteral">&#39;class&#39;</span> =&gt; <span class="stringliteral">&#39;Project&#39;</span>,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fetch&#39;</span>,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="stringliteral">&#39;element&#39;</span> =&gt; <span class="stringliteral">&#39;facture&#39;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      ),</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    );</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// Exports</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">//--------</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    $r = 1;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    $alias_product_perentity = empty($conf-&gt;global-&gt;MAIN_PRODUCT_PERENTITY_SHARED) ? <span class="stringliteral">&quot;p&quot;</span> : <span class="stringliteral">&quot;ppe&quot;</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    $this-&gt;export_code[$r] = $this-&gt;rights_class.<span class="charliteral">&#39;_&#39;</span>.$r;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    $this-&gt;export_label[$r] = <span class="stringliteral">&#39;CustomersInvoicesAndInvoiceLines&#39;</span>; <span class="comment">// Translation key (used only if key ExportDataset_xxx_z not found)</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    $this-&gt;export_icon[$r] = <span class="stringliteral">&#39;invoice&#39;</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    $this-&gt;export_permission[$r] = array(array(<span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;export&quot;</span>, <span class="stringliteral">&quot;other&quot;</span>));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    $this-&gt;export_fields_array[$r] = array(</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;IdCompany&quot;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;CompanyName&#39;</span>, <span class="stringliteral">&#39;ps.nom&#39;</span> =&gt; <span class="stringliteral">&#39;ParentCompany&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;CustomerCode&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;Address&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;Zip&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;Town&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;CountryCode&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;State&#39;</span>,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;Phone&#39;</span>,</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId1&#39;</span>, <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId2&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId3&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId4&#39;</span>,</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;CustomerAccountancyCode&#39;</span>,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;SupplierAccountancyCode&#39;</span>,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;VATIntra&#39;</span>,</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="stringliteral">&#39;t.libelle&#39;</span>=&gt;<span class="stringliteral">&quot;ThirdPartyType&quot;</span>, <span class="comment">// &#39;ce.code&#39;=&gt;&quot;Staff&quot;, &quot;cfj.libelle&quot;=&gt;&quot;JuridicalStatus&quot;,</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="stringliteral">&#39;f.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceId&quot;</span>, <span class="stringliteral">&#39;f.ref&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceRef&quot;</span>, <span class="stringliteral">&#39;f.ref_client&#39;</span>=&gt;<span class="stringliteral">&#39;RefCustomer&#39;</span>,</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="stringliteral">&#39;f.type&#39;</span>=&gt;<span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&#39;f.datec&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceDateCreation&quot;</span>, <span class="stringliteral">&#39;f.datef&#39;</span>=&gt;<span class="stringliteral">&quot;DateInvoice&quot;</span>, <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span>=&gt;<span class="stringliteral">&quot;DateDue&quot;</span>, <span class="stringliteral">&#39;f.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;TotalHT&quot;</span>,</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="stringliteral">&#39;f.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;TotalTTC&quot;</span>, <span class="stringliteral">&#39;f.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;TotalVAT&quot;</span>, <span class="stringliteral">&#39;f.localtax1&#39;</span>=&gt;<span class="stringliteral">&#39;LT1&#39;</span>, <span class="stringliteral">&#39;f.localtax2&#39;</span>=&gt;<span class="stringliteral">&#39;LT2&#39;</span>, <span class="stringliteral">&#39;f.paye&#39;</span>=&gt;<span class="stringliteral">&quot;InvoicePaidCompletely&quot;</span>, <span class="stringliteral">&#39;f.fk_statut&#39;</span>=&gt;<span class="stringliteral">&#39;InvoiceStatus&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>=&gt;<span class="stringliteral">&#39;EarlyClosingReason&#39;</span>, <span class="stringliteral">&#39;f.close_note&#39;</span>=&gt;<span class="stringliteral">&#39;EarlyClosingComment&#39;</span>,</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&#39;Rest&#39;</span>,</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span>=&gt;<span class="stringliteral">&quot;NotePrivate&quot;</span>, <span class="stringliteral">&#39;f.note_public&#39;</span>=&gt;<span class="stringliteral">&quot;NotePublic&quot;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    );</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// Add multicurrency fields</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;multicurrency&quot;</span>)) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_code&#39;</span>] = <span class="stringliteral">&#39;Currency&#39;</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_tx&#39;</span>] = <span class="stringliteral">&#39;CurrencyRate&#39;</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ht&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountHT&#39;</span>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_tva&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountVAT&#39;</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ttc&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountTTC&#39;</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// Add POS fields</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;cashdesk-&gt;enabled) || !empty($conf-&gt;takepos-&gt;enabled) || !empty($conf-&gt;global-&gt;INVOICE_SHOW_POS)) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.module_source&#39;</span>] = <span class="stringliteral">&#39;Module&#39;</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.pos_source&#39;</span>] = <span class="stringliteral">&#39;POSTerminal&#39;</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    $this-&gt;export_fields_array[$r] = $this-&gt;export_fields_array[$r] + array(</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;CreatedById&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;CreatedByLogin&#39;</span>,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;ValidatedById&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;ValidatedByLogin&#39;</span>,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;ProjectRef&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;ProjectLabel&#39;</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    );</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// Add multicompany field</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MULTICOMPANY_ENTITY_IN_EXPORT_IF_SHARED)) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      $nbofallowedentities = count(explode(<span class="charliteral">&#39;,&#39;</span>, <a class="code" href="../../d9/d69/functions_8lib_8php.html#af625cfc048eb1b8ce24a7455b2dfcf9b">getEntity</a>(<span class="stringliteral">&#39;invoice&#39;</span>)));</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&#39;multicompany&#39;</span>) &amp;&amp; $nbofallowedentities &gt; 1) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.entity&#39;</span>] = <span class="stringliteral">&#39;Entity&#39;</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    $this-&gt;export_fields_array[$r] = $this-&gt;export_fields_array[$r] + array(</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="stringliteral">&#39;fd.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;LineId&#39;</span>, <span class="stringliteral">&#39;fd.description&#39;</span>=&gt;<span class="stringliteral">&quot;LineDescription&quot;</span>,</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="stringliteral">&#39;fd.subprice&#39;</span>=&gt;<span class="stringliteral">&quot;LineUnitPrice&quot;</span>, <span class="stringliteral">&#39;fd.tva_tx&#39;</span>=&gt;<span class="stringliteral">&quot;LineVATRate&quot;</span>, <span class="stringliteral">&#39;fd.qty&#39;</span>=&gt;<span class="stringliteral">&quot;LineQty&quot;</span>, <span class="stringliteral">&#39;fd.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;LineTotalHT&quot;</span>, <span class="stringliteral">&#39;fd.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;LineTotalVAT&quot;</span>,</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="stringliteral">&#39;fd.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;LineTotalTTC&quot;</span>, <span class="stringliteral">&#39;fd.date_start&#39;</span>=&gt;<span class="stringliteral">&quot;DateStart&quot;</span>, <span class="stringliteral">&#39;fd.date_end&#39;</span>=&gt;<span class="stringliteral">&quot;DateEnd&quot;</span>, <span class="stringliteral">&#39;fd.special_code&#39;</span>=&gt;<span class="stringliteral">&#39;SpecialCode&#39;</span>,</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="stringliteral">&#39;fd.product_type&#39;</span>=&gt;<span class="stringliteral">&quot;TypeOfLineServiceOrProduct&quot;</span>, <span class="stringliteral">&#39;fd.fk_product&#39;</span>=&gt;<span class="stringliteral">&#39;ProductId&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;ProductRef&#39;</span>, <span class="stringliteral">&#39;p.label&#39;</span>=&gt;<span class="stringliteral">&#39;ProductLabel&#39;</span>,</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      $alias_product_perentity . <span class="stringliteral">&#39;.accountancy_code_sell&#39;</span>=&gt;<span class="stringliteral">&#39;ProductAccountancySellCode&#39;</span>,</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="stringliteral">&#39;aa.account_number&#39;</span> =&gt; <span class="stringliteral">&#39;AccountingAffectation&#39;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    );</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    $this-&gt;export_TypeFields_array[$r] = array(</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;ps.nom&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="stringliteral">&#39;t.libelle&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="comment">// &#39;ce.code&#39;=&gt;&quot;List:c_effectif:libelle:code&quot;, &quot;cfj.libelle&quot;=&gt;&quot;Text&quot;,</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="stringliteral">&#39;f.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.ref&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;f.ref_client&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.type&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.datec&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;f.datef&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;f.fk_mode_reglement&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>,</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="stringliteral">&#39;f.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.localtax1&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.localtax2&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.paye&#39;</span>=&gt;<span class="stringliteral">&quot;Boolean&quot;</span>, <span class="stringliteral">&#39;f.fk_statut&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.close_note&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&quot;NumericCompute&quot;</span>,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;f.note_public&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="stringliteral">&#39;f.module_source&#39;</span> =&gt; <span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="stringliteral">&#39;f.pos_source&#39;</span> =&gt; <span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="stringliteral">&#39;f.entity&#39;</span>=&gt;<span class="stringliteral">&#39;List:entity:label:rowid&#39;</span>,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;fd.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;fd.description&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;fd.subprice&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.tva_tx&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="stringliteral">&#39;fd.qty&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.date_start&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;fd.date_end&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="stringliteral">&#39;fd.special_code&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;fd.product_type&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;fd.fk_product&#39;</span>=&gt;<span class="stringliteral">&#39;List:product:label&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;p.label&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      $alias_product_perentity . <span class="stringliteral">&#39;.accountancy_code_sell&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="stringliteral">&#39;aa.account_number&#39;</span> =&gt; <span class="stringliteral">&#39;Text&#39;</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    );</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    $this-&gt;export_entities_array[$r] = array(</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;company&quot;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;ps.nom&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>,</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="stringliteral">&#39;t.libelle&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="comment">// &#39;ce.code&#39;=&gt;&#39;company&#39;, &#39;cfj.libelle&#39;=&gt;&#39;company&#39;</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;project&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;project&#39;</span>, <span class="stringliteral">&#39;fd.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;invoice_line&#39;</span>, <span class="stringliteral">&#39;fd.description&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>,</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="stringliteral">&#39;fd.subprice&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.tva_tx&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>,</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="stringliteral">&#39;fd.qty&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.date_start&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.date_end&#39;</span>=&gt;<span class="stringliteral">&quot;invoice_line&quot;</span>, <span class="stringliteral">&#39;fd.special_code&#39;</span>=&gt;<span class="stringliteral">&#39;invoice_line&#39;</span>,</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="stringliteral">&#39;fd.product_type&#39;</span>=&gt;<span class="stringliteral">&#39;invoice_line&#39;</span>, <span class="stringliteral">&#39;fd.fk_product&#39;</span>=&gt;<span class="stringliteral">&#39;product&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;product&#39;</span>, <span class="stringliteral">&#39;p.label&#39;</span>=&gt;<span class="stringliteral">&#39;product&#39;</span>, $alias_product_perentity . <span class="stringliteral">&#39;.accountancy_code_sell&#39;</span>=&gt;<span class="stringliteral">&#39;product&#39;</span>,</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="stringliteral">&#39;aa.account_number&#39;</span> =&gt; <span class="stringliteral">&quot;invoice_line&quot;</span>,</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    );</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    $this-&gt;export_special_array[$r] = array(<span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&#39;getRemainToPay&#39;</span>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    $this-&gt;export_dependencies_array[$r] = array(<span class="stringliteral">&#39;invoice_line&#39;</span>=&gt;<span class="stringliteral">&#39;fd.rowid&#39;</span>, <span class="stringliteral">&#39;product&#39;</span>=&gt;<span class="stringliteral">&#39;fd.rowid&#39;</span>, <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;array(<span class="stringliteral">&#39;f.rowid&#39;</span>, <span class="stringliteral">&#39;f.total_ttc&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>)); <span class="comment">// To add unique key if we ask a field of a child to avoid the DISTINCT to discard them</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    $keyforselect = <span class="stringliteral">&#39;facture&#39;</span>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    $keyforelement = <span class="stringliteral">&#39;invoice&#39;</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    $keyforaliasextra = <span class="stringliteral">&#39;extra&#39;</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/extrafieldsinexport.inc.php&#39;</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    $keyforselect = <span class="stringliteral">&#39;facturedet&#39;</span>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    $keyforelement = <span class="stringliteral">&#39;invoice_line&#39;</span>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    $keyforaliasextra = <span class="stringliteral">&#39;extra2&#39;</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/extrafieldsinexport.inc.php&#39;</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    $keyforselect = <span class="stringliteral">&#39;product&#39;</span>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    $keyforelement = <span class="stringliteral">&#39;product&#39;</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    $keyforaliasextra = <span class="stringliteral">&#39;extra3&#39;</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/extrafieldsinexport.inc.php&#39;</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    $keyforselect = <span class="stringliteral">&#39;societe&#39;</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    $keyforelement = <span class="stringliteral">&#39;company&#39;</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    $keyforaliasextra = <span class="stringliteral">&#39;extra4&#39;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/extrafieldsinexport.inc.php&#39;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    $this-&gt;export_sql_start[$r] = <span class="stringliteral">&#39;SELECT DISTINCT &#39;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    $this-&gt;export_sql_end[$r]  = <span class="stringliteral">&#39; FROM &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe as s&#39;</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe_extrafields as extra4 ON s.rowid = extra4.fk_object&#39;</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe as ps ON ps.rowid = s.parent&#39;</span>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_typent as t ON s.fk_typent = t.id&#39;</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;societe-&gt;client-&gt;voir)) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe_commerciaux as sc ON sc.fk_soc = s.rowid&#39;</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_country as c on s.fk_pays = c.rowid&#39;</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_departements as cd on s.fk_departement = cd.rowid,&#39;</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="charliteral">&#39; &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture as f&#39;</span>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;projet as pj ON f.fk_projet = pj.rowid&#39;</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;user as uc ON f.fk_user_author = uc.rowid&#39;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;user as uv ON f.fk_user_valid = uv.rowid&#39;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture_extrafields as extra ON f.rowid = extra.fk_object&#39;</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; , &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facturedet as fd&#39;</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facturedet_extrafields as extra2 on fd.rowid = extra2.fk_object&#39;</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;product as p on (fd.fk_product = p.rowid)&#39;</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_PRODUCT_PERENTITY_SHARED)) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&quot; LEFT JOIN &quot;</span> . MAIN_DB_PREFIX . <span class="stringliteral">&quot;product_perentity as ppe ON ppe.fk_product = p.rowid AND ppe.entity = &quot;</span> . ((int) $conf-&gt;entity);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;product_extrafields as extra3 on p.rowid = extra3.fk_object&#39;</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;accounting_account as aa on fd.fk_code_ventilation = aa.rowid&#39;</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; WHERE f.fk_soc = s.rowid AND f.rowid = fd.fk_facture&#39;</span>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; AND f.entity IN (&#39;</span>.getEntity(<span class="stringliteral">&#39;invoice&#39;</span>).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;societe-&gt;client-&gt;voir)) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; AND sc.fk_user = &#39;</span>.(empty($user) ? 0 : $user-&gt;id);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    $r++;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    $this-&gt;export_code[$r] = $this-&gt;rights_class.<span class="charliteral">&#39;_&#39;</span>.$r;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    $this-&gt;export_label[$r] = <span class="stringliteral">&#39;CustomersInvoicesAndPayments&#39;</span>; <span class="comment">// Translation key (used only if key ExportDataset_xxx_z not found)</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    $this-&gt;export_icon[$r] = <span class="stringliteral">&#39;invoice&#39;</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    $this-&gt;export_permission[$r] = array(array(<span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;facture&quot;</span>, <span class="stringliteral">&quot;export&quot;</span>));</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    $this-&gt;export_fields_array[$r] = array(</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;IdCompany&quot;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;CompanyName&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;CustomerCode&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;Address&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;Zip&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;Town&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;CountryCode&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;State&#39;</span>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;Phone&#39;</span>,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId1&#39;</span>, <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId2&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId3&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;ProfId4&#39;</span>, <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;CustomerAccountancyCode&#39;</span>,</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;SupplierAccountancyCode&#39;</span>, <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;VATIntra&#39;</span>,</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="stringliteral">&#39;f.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceId&quot;</span>, <span class="stringliteral">&#39;f.ref&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceRef&quot;</span>, <span class="stringliteral">&#39;f.ref_client&#39;</span>=&gt;<span class="stringliteral">&#39;RefCustomer&#39;</span>,</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="stringliteral">&#39;f.type&#39;</span>=&gt;<span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&#39;f.datec&#39;</span>=&gt;<span class="stringliteral">&quot;InvoiceDateCreation&quot;</span>, <span class="stringliteral">&#39;f.datef&#39;</span>=&gt;<span class="stringliteral">&quot;DateInvoice&quot;</span>, <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span>=&gt;<span class="stringliteral">&quot;DateDue&quot;</span>, <span class="stringliteral">&#39;f.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;TotalHT&quot;</span>,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="stringliteral">&#39;f.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;TotalTTC&quot;</span>, <span class="stringliteral">&#39;f.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;TotalVAT&quot;</span>, <span class="stringliteral">&#39;f.localtax1&#39;</span>=&gt;<span class="stringliteral">&#39;LT1&#39;</span>, <span class="stringliteral">&#39;f.localtax2&#39;</span>=&gt;<span class="stringliteral">&#39;LT2&#39;</span>, <span class="stringliteral">&#39;f.paye&#39;</span>=&gt;<span class="stringliteral">&quot;InvoicePaidCompletely&quot;</span>, <span class="stringliteral">&#39;f.fk_statut&#39;</span>=&gt;<span class="stringliteral">&#39;InvoiceStatus&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>=&gt;<span class="stringliteral">&#39;EarlyClosingReason&#39;</span>, <span class="stringliteral">&#39;f.close_note&#39;</span>=&gt;<span class="stringliteral">&#39;EarlyClosingComment&#39;</span>,</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&#39;Rest&#39;</span>,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span>=&gt;<span class="stringliteral">&quot;NotePrivate&quot;</span>, <span class="stringliteral">&#39;f.note_public&#39;</span>=&gt;<span class="stringliteral">&quot;NotePublic&quot;</span>, <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;CreatedById&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;CreatedByLogin&#39;</span>,</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;ValidatedById&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;ValidatedByLogin&#39;</span>, <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;ProjectRef&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;ProjectLabel&#39;</span>, <span class="stringliteral">&#39;p.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;PaymentId&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;PaymentRef&#39;</span>,</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="stringliteral">&#39;p.amount&#39;</span>=&gt;<span class="stringliteral">&#39;AmountPayment&#39;</span>, <span class="stringliteral">&#39;pf.amount&#39;</span>=&gt;<span class="stringliteral">&#39;AmountPaymentDistributedOnInvoice&#39;</span>, <span class="stringliteral">&#39;p.datep&#39;</span>=&gt;<span class="stringliteral">&#39;DatePayment&#39;</span>, <span class="stringliteral">&#39;p.num_paiement&#39;</span>=&gt;<span class="stringliteral">&#39;PaymentNumber&#39;</span>,</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="stringliteral">&#39;pt.code&#39;</span>=&gt;<span class="stringliteral">&#39;CodePaymentMode&#39;</span>, <span class="stringliteral">&#39;pt.libelle&#39;</span>=&gt;<span class="stringliteral">&#39;LabelPaymentMode&#39;</span>, <span class="stringliteral">&#39;p.note&#39;</span>=&gt;<span class="stringliteral">&#39;PaymentNote&#39;</span>, <span class="stringliteral">&#39;p.fk_bank&#39;</span>=&gt;<span class="stringliteral">&#39;IdTransaction&#39;</span>, <span class="stringliteral">&#39;ba.ref&#39;</span>=&gt;<span class="stringliteral">&#39;AccountRef&#39;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    );</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    $this-&gt;export_help_array[$r] = array(<span class="stringliteral">&#39;f.paye&#39;</span>=&gt;<span class="stringliteral">&#39;InvoicePaidCompletelyHelp&#39;</span>);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a>(<span class="stringliteral">&quot;multicurrency&quot;</span>)) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_code&#39;</span>] = <span class="stringliteral">&#39;Currency&#39;</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_tx&#39;</span>] = <span class="stringliteral">&#39;CurrencyRate&#39;</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ht&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountHT&#39;</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_tva&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountVAT&#39;</span>;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.multicurrency_total_ttc&#39;</span>] = <span class="stringliteral">&#39;MulticurrencyAmountTTC&#39;</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      $this-&gt;export_examplevalues_array[$r][<span class="stringliteral">&#39;f.multicurrency_code&#39;</span>] = <span class="stringliteral">&#39;EUR&#39;</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;cashdesk-&gt;enabled) || !empty($conf-&gt;takepos-&gt;enabled) || !empty($conf-&gt;global-&gt;INVOICE_SHOW_POS)) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.module_source&#39;</span>] = <span class="stringliteral">&#39;POSModule&#39;</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.pos_source&#39;</span>] = <span class="stringliteral">&#39;POSTerminal&#39;</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    $this-&gt;export_TypeFields_array[$r] = array(</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="stringliteral">&#39;f.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.ref&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;f.ref_client&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.type&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.datec&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;f.datef&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>, <span class="stringliteral">&#39;f.date_lim_reglement&#39;</span>=&gt;<span class="stringliteral">&quot;Date&quot;</span>,</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="stringliteral">&#39;f.total_ht&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.total_ttc&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.total_tva&#39;</span>=&gt;<span class="stringliteral">&quot;Numeric&quot;</span>, <span class="stringliteral">&#39;f.localtax1&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.localtax2&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;f.paye&#39;</span>=&gt;<span class="stringliteral">&quot;Boolean&quot;</span>, <span class="stringliteral">&#39;f.fk_statut&#39;</span>=&gt;<span class="stringliteral">&#39;Status&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.close_note&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&#39;NumericCompute&#39;</span>,</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="stringliteral">&#39;f.note_private&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;f.note_public&#39;</span>=&gt;<span class="stringliteral">&quot;Text&quot;</span>, <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>,</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;p.amount&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;pf.amount&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;p.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;p.title&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;p.datep&#39;</span>=&gt;<span class="stringliteral">&#39;Date&#39;</span>, <span class="stringliteral">&#39;p.num_paiement&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>,</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="stringliteral">&#39;p.fk_bank&#39;</span>=&gt;<span class="stringliteral">&#39;Numeric&#39;</span>, <span class="stringliteral">&#39;p.note&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;pt.code&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span>, <span class="stringliteral">&#39;pt.libelle&#39;</span>=&gt;<span class="stringliteral">&#39;text&#39;</span>, <span class="stringliteral">&#39;ba.ref&#39;</span>=&gt;<span class="stringliteral">&#39;Text&#39;</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    );</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (!empty($conf-&gt;cashdesk-&gt;enabled) || !empty($conf-&gt;takepos-&gt;enabled) || !empty($conf-&gt;global-&gt;INVOICE_SHOW_POS)) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.module_source&#39;</span>] = <span class="stringliteral">&#39;POSModule&#39;</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      $this-&gt;export_fields_array[$r][<span class="stringliteral">&#39;f.pos_source&#39;</span>] = <span class="stringliteral">&#39;POSTerminal&#39;</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    $this-&gt;export_entities_array[$r] = array(</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="stringliteral">&#39;s.rowid&#39;</span>=&gt;<span class="stringliteral">&quot;company&quot;</span>, <span class="stringliteral">&#39;s.nom&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_client&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.address&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.zip&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.town&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;c.code&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;cd.nom&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.phone&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>,</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="stringliteral">&#39;s.siren&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.siret&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.ape&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.idprof4&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_compta&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;s.code_compta_fournisseur&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>,</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="stringliteral">&#39;s.tva_intra&#39;</span>=&gt;<span class="stringliteral">&#39;company&#39;</span>, <span class="stringliteral">&#39;pj.ref&#39;</span>=&gt;<span class="stringliteral">&#39;project&#39;</span>, <span class="stringliteral">&#39;pj.title&#39;</span>=&gt;<span class="stringliteral">&#39;project&#39;</span>, <span class="stringliteral">&#39;p.rowid&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;p.ref&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;p.amount&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;pf.amount&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;p.datep&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>,</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="stringliteral">&#39;p.num_paiement&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;pt.code&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;pt.libelle&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;p.note&#39;</span>=&gt;<span class="stringliteral">&#39;payment&#39;</span>, <span class="stringliteral">&#39;f.fk_user_author&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;uc.login&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>,</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="stringliteral">&#39;f.fk_user_valid&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;uv.login&#39;</span>=&gt;<span class="stringliteral">&#39;user&#39;</span>, <span class="stringliteral">&#39;p.fk_bank&#39;</span>=&gt;<span class="stringliteral">&#39;account&#39;</span>, <span class="stringliteral">&#39;ba.ref&#39;</span>=&gt;<span class="stringliteral">&#39;account&#39;</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    );</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    $this-&gt;export_special_array[$r] = array(<span class="stringliteral">&#39;none.rest&#39;</span>=&gt;<span class="stringliteral">&#39;getRemainToPay&#39;</span>);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    $this-&gt;export_dependencies_array[$r] = array(<span class="stringliteral">&#39;payment&#39;</span>=&gt;<span class="stringliteral">&#39;p.rowid&#39;</span>, <span class="stringliteral">&#39;none.rest&#39;</span>=&gt;array(<span class="stringliteral">&#39;f.rowid&#39;</span>, <span class="stringliteral">&#39;f.total_ttc&#39;</span>, <span class="stringliteral">&#39;f.close_code&#39;</span>)); <span class="comment">// To add unique key if we ask a field of a child to avoid the DISTINCT to discard them, or just to have field we need</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    $keyforselect = <span class="stringliteral">&#39;facture&#39;</span>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    $keyforelement = <span class="stringliteral">&#39;invoice&#39;</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    $keyforaliasextra = <span class="stringliteral">&#39;extra&#39;</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    include DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/extrafieldsinexport.inc.php&#39;</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    $this-&gt;export_sql_start[$r] = <span class="stringliteral">&#39;SELECT DISTINCT &#39;</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    $this-&gt;export_sql_end[$r]  = <span class="stringliteral">&#39; FROM &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe as s&#39;</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;societe-&gt;client-&gt;voir)) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;societe_commerciaux as sc ON sc.fk_soc = s.rowid&#39;</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_country as c on s.fk_pays = c.rowid&#39;</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_departements as cd on s.fk_departement = cd.rowid,&#39;</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="charliteral">&#39; &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture as f&#39;</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;projet as pj ON f.fk_projet = pj.rowid&#39;</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;user as uc ON f.fk_user_author = uc.rowid&#39;</span>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;user as uv ON f.fk_user_valid = uv.rowid&#39;</span>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;facture_extrafields as extra ON f.rowid = extra.fk_object&#39;</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;paiement_facture as pf ON pf.fk_facture = f.rowid&#39;</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;paiement as p ON pf.fk_paiement = p.rowid&#39;</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;c_paiement as pt ON pt.id = p.fk_paiement&#39;</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;bank as b ON b.rowid = p.fk_bank&#39;</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&#39;bank_account as ba ON ba.rowid = b.fk_account&#39;</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; WHERE f.fk_soc = s.rowid&#39;</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; AND f.entity IN (&#39;</span>.getEntity(<span class="stringliteral">&#39;invoice&#39;</span>).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (empty($user-&gt;rights-&gt;societe-&gt;client-&gt;voir)) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      $this-&gt;export_sql_end[$r] .= <span class="stringliteral">&#39; AND sc.fk_user = &#39;</span>.(empty($user) ? 0 : $user-&gt;id);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    $r++;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno"><a class="line" href="../../d2/d4f/classmod_facture.html#ab345aa7ca69acd2eb7ef7c8f75031d77">  722</a></span>&#160;  <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d2/d4f/classmod_facture.html#ab345aa7ca69acd2eb7ef7c8f75031d77">init</a>($options = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    global $conf, $langs;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="comment">// Remove permissions and default values</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    $this-&gt;<span class="keyword">remove</span>($options);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">//ODT template</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    $src = DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/install/doctemplates/invoices/template_invoice.odt&#39;</span>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    $dirodt = DOL_DATA_ROOT.<span class="stringliteral">&#39;/doctemplates/invoices&#39;</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    $dest = $dirodt.<span class="stringliteral">&#39;/template_invoice.odt&#39;</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (file_exists($src) &amp;&amp; !file_exists($dest)) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      require_once DOL_DOCUMENT_ROOT.<span class="stringliteral">&#39;/core/lib/files.lib.php&#39;</span>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <a class="code" href="../../d9/d69/functions_8lib_8php.html#af6f6a291f41b6ef2a3e11a6be1e1256c">dol_mkdir</a>($dirodt);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      $result = <a class="code" href="../../de/d28/files_8lib_8php.html#a5d74a9a309df54772a062031c1e810ce">dol_copy</a>($src, $dest, 0, 0);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">if</span> ($result &lt; 0) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        $langs-&gt;load(<span class="stringliteral">&quot;errors&quot;</span>);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        $this-&gt;error = $langs-&gt;trans(<span class="stringliteral">&#39;ErrorFailToCopyFile&#39;</span>, $src, $dest);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    $sql = array(</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="stringliteral">&quot;DELETE FROM &quot;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&quot;document_model WHERE nom = &#39;&quot;</span>.$this-&gt;db-&gt;escape($this-&gt;const[1][2]).<span class="stringliteral">&quot;&#39; AND type = &#39;invoice&#39; AND entity = &quot;</span>.((<span class="keywordtype">int</span>) $conf-&gt;entity),</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="stringliteral">&quot;INSERT INTO &quot;</span>.MAIN_DB_PREFIX.<span class="stringliteral">&quot;document_model (nom, type, entity) VALUES(&#39;&quot;</span>.$this-&gt;db-&gt;escape($this-&gt;const[1][2]).<span class="stringliteral">&quot;&#39;,&#39;invoice&#39;,&quot;</span>.((<span class="keywordtype">int</span>) $conf-&gt;entity).<span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    );</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d0/d8f/class_dolibarr_modules.html#a1835ab64d762acd0fdeed01089372d5d">_init</a>($sql, $options);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div>
<div class="ttc" id="aclass_dolibarr_modules_html"><div class="ttname"><a href="../../d0/d8f/class_dolibarr_modules.html">DolibarrModules</a></div><div class="ttdoc">Class DolibarrModules.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da5/_dolibarr_modules_8class_8php_source.html#l00037">DolibarrModules.class.php:38</a></div></div>
<div class="ttc" id="aclass_dolibarr_modules_html_a1835ab64d762acd0fdeed01089372d5d"><div class="ttname"><a href="../../d0/d8f/class_dolibarr_modules.html#a1835ab64d762acd0fdeed01089372d5d">DolibarrModules\_init</a></div><div class="ttdeci">_init($array_sql, $options='')</div><div class="ttdoc">Enables a module.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da5/_dolibarr_modules_8class_8php_source.html#l00397">DolibarrModules.class.php:397</a></div></div>
<div class="ttc" id="aclassmod_facture_html"><div class="ttname"><a href="../../d2/d4f/classmod_facture.html">modFacture</a></div><div class="ttdoc">Class to describe module customer invoices.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1b/mod_facture_8class_8php_source.html#l00037">modFacture.class.php:38</a></div></div>
<div class="ttc" id="aclassmod_facture_html_ab345aa7ca69acd2eb7ef7c8f75031d77"><div class="ttname"><a href="../../d2/d4f/classmod_facture.html#ab345aa7ca69acd2eb7ef7c8f75031d77">modFacture\init</a></div><div class="ttdeci">init($options='')</div><div class="ttdoc">Function called when module is enabled.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1b/mod_facture_8class_8php_source.html#l00722">modFacture.class.php:722</a></div></div>
<div class="ttc" id="aclassmod_facture_html_adac89d6d5e381738bbee5e587829282f"><div class="ttname"><a href="../../d2/d4f/classmod_facture.html#adac89d6d5e381738bbee5e587829282f">modFacture\__construct</a></div><div class="ttdeci">__construct($db)</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1b/mod_facture_8class_8php_source.html#l00045">modFacture.class.php:45</a></div></div>
<div class="ttc" id="acompta_2index_8php_html_a8c1c24673aed10bb73024203be29cb7a"><div class="ttname"><a href="../../d9/d3c/compta_2index_8php.html#a8c1c24673aed10bb73024203be29cb7a">$resql</a></div><div class="ttdeci">if(isModEnabled('facture') &amp;&amp;!empty($user-&gt;rights-&gt;facture-&gt;lire)) if((isModEnabled('fournisseur') &amp;&amp;empty($conf-&gt;global-&gt;MAIN_USE_NEW_SUPPLIERMOD) &amp;&amp; $user-&gt;hasRight(&quot;fournisseur&quot;, &quot;facture&quot;, &quot;lire&quot;))||(isModEnabled('supplier_invoice') &amp;&amp; $user-&gt;hasRight(&quot;supplier_invoice&quot;, &quot;lire&quot;))) if(isModEnabled('don') &amp;&amp;!empty($user-&gt;rights-&gt;don-&gt;lire)) if(isModEnabled('tax') &amp;&amp;!empty($user-&gt;rights-&gt;tax-&gt;charges-&gt;lire)) if(isModEnabled('facture') &amp;&amp;isModEnabled('commande') &amp;&amp; $user-&gt;hasRight(&quot;commande&quot;, &quot;lire&quot;) &amp;&amp;empty($conf-&gt;global-&gt;WORKFLOW_DISABLE_CREATE_INVOICE_FROM_ORDER)) $resql</div><div class="ttdoc">Social contributions to pay.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d3c/compta_2index_8php_source.html#l00745">index.php:745</a></div></div>
<div class="ttc" id="aemail__expire__services__to__customers_8php_html_a152b76e3a9723678d88531fde723582d"><div class="ttname"><a href="../../d8/d0e/email__expire__services__to__customers_8php.html#a152b76e3a9723678d88531fde723582d">description</a></div><div class="ttdeci">print *****$script_file(&quot;.$version.&quot;) pid cd cd cd description as description</div><div class="ttdoc">Only used if Module[ID]Desc translation string is not found.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d0e/email__expire__services__to__customers_8php_source.html#l00083">email_expire_services_to_customers.php:83</a></div></div>
<div class="ttc" id="afiles_8lib_8php_html_a5d74a9a309df54772a062031c1e810ce"><div class="ttname"><a href="../../de/d28/files_8lib_8php.html#a5d74a9a309df54772a062031c1e810ce">dol_copy</a></div><div class="ttdeci">dol_copy($srcfile, $destfile, $newmask=0, $overwriteifexists=1)</div><div class="ttdoc">Copy a file to another file.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d28/files_8lib_8php_source.html#l00712">files.lib.php:712</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a09ae0028df30935f6a6f7d5ae05f42bd"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a09ae0028df30935f6a6f7d5ae05f42bd">dol_mktime</a></div><div class="ttdeci">dol_mktime($hour, $minute, $second, $month, $day, $year, $gm='auto', $check=1)</div><div class="ttdoc">Return a timestamp date built from detailed informations (by default a local PHP server timestamp) Re...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02828">functions.lib.php:2828</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a5e66578bb4ca51676bad5d37e19e7e1a"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a5e66578bb4ca51676bad5d37e19e7e1a">dol_now</a></div><div class="ttdeci">dol_now($mode='auto')</div><div class="ttdoc">Return date for now.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02916">functions.lib.php:2916</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_ae54e3727f7a757bd40513f88c0c7da47"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#ae54e3727f7a757bd40513f88c0c7da47">isModEnabled</a></div><div class="ttdeci">isModEnabled($module)</div><div class="ttdoc">Is Dolibarr module enabled.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00137">functions.lib.php:137</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_af625cfc048eb1b8ce24a7455b2dfcf9b"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#af625cfc048eb1b8ce24a7455b2dfcf9b">getEntity</a></div><div class="ttdeci">getEntity($element, $shared=1, $currentobject=null)</div><div class="ttdoc">Get list of entity id to use.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l00180">functions.lib.php:180</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_af6ea38239900c36d603debe46308159a"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#af6ea38239900c36d603debe46308159a">dol_getdate</a></div><div class="ttdeci">dol_getdate($timestamp, $fast=false, $forcetimezone='')</div><div class="ttdoc">Return an array with locale date info.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l02785">functions.lib.php:2785</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_af6f6a291f41b6ef2a3e11a6be1e1256c"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#af6f6a291f41b6ef2a3e11a6be1e1256c">dol_mkdir</a></div><div class="ttdeci">dol_mkdir($dir, $dataroot='', $newmask='')</div><div class="ttdoc">Creation of a directory (this can create recursive subdir)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l06750">functions.lib.php:6750</a></div></div>
<div class="ttc" id="arepair_8php_html_adc47ab40d9a5ded8ff8f4e1a3b92a208"><div class="ttname"><a href="../../d1/d2d/repair_8php.html#adc47ab40d9a5ded8ff8f4e1a3b92a208">name</a></div><div class="ttdeci">$conf db name</div><div class="ttdoc">Only used if Module[ID]Name translation string is not found.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d2d/repair_8php_source.html#l00122">repair.php:122</a></div></div>
<div class="ttc" id="asupport_2inc_8php_html_ac5c9be6a1c1e82d353381986a8e859b6"><div class="ttname"><a href="../../d3/d71/support_2inc_8php.html#ac5c9be6a1c1e82d353381986a8e859b6">db</a></div><div class="ttdeci">$conf db</div><div class="ttdoc">API class for accounts.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d71/support_2inc_8php_source.html#l00041">inc.php:41</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- 
File added into doxygen generated documentation
-->
<hr class="footer" />
<address class="footer"><small>Generated on Wed Jan 4 2023 15:02:24 for <a href="https://www.dolibarr.org" title="ERP and CRM open source software">dolibarr</a> by Doxygen 1.9.1 </small></address>
<br>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9049390-16"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-9049390-16');
</script>
</body>
</html>