<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dolibarr: htdocs/core/lib/ajax.lib.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dolibarr
   &#160;<span id="projectnumber">x.y.z</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_eaa9681d2effa5cf690be6ac05e74743.html">htdocs</a></li><li class="navelem"><a class="el" href="../../dir_dbb7cc76f4d8f56337f997fc682508aa.html">core</a></li><li class="navelem"><a class="el" href="../../dir_e03de4b84004d48b9a181b9b61e6f2c2.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ajax.lib.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d9a/ajax_8lib_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* Copyright (C) 2007-2010 Laurent Destailleur  &lt;eldy@users.sourceforge.net&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2007-2015 Regis Houssin        &lt;regis.houssin@inodbox.com&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2012      Christophe Battarel  &lt;christophe.battarel@altairis.fr&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * or see https://www.gnu.org/</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#a0a7c9bd5a445373c4bcb0c1e6aec4f52">   47</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a0a7c9bd5a445373c4bcb0c1e6aec4f52">ajax_autocompleter</a>($selected, $htmlname, $url, $urloption = <span class="stringliteral">&#39;&#39;</span>, $minLength = 2, $autoselect = 0, $ajaxoptions = array(), $moreparams = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;{</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  global $conf;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">if</span> (empty($minLength)) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    $minLength = 1;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  $dataforrenderITem = <span class="stringliteral">&#39;ui-autocomplete&#39;</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  $dataforitem = <span class="stringliteral">&#39;ui-autocomplete-item&#39;</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// Allow two constant to use other values for backward compatibility</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;JS_QUERY_AUTOCOMPLETE_RENDERITEM&#39;</span>)) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    $dataforrenderITem = constant(<span class="stringliteral">&#39;JS_QUERY_AUTOCOMPLETE_RENDERITEM&#39;</span>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;JS_QUERY_AUTOCOMPLETE_ITEM&#39;</span>)) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    $dataforitem = constant(<span class="stringliteral">&#39;JS_QUERY_AUTOCOMPLETE_ITEM&#39;</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  $htmlnamejquery = str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="stringliteral">&#39;\\\\.&#39;</span>, $htmlname);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// Input search_htmlname is original field</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// Input htmlname is a second input field used when using ajax autocomplete.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  $script = <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot; value=&quot;&#39;</span>.$selected.<span class="stringliteral">&#39;&quot; &#39;</span>.($moreparams ? $moreparams : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39; /&gt;&#39;</span>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  $script .= <span class="stringliteral">&#39;&lt;!-- Javascript code for autocomplete of field &#39;</span>.$htmlname.<span class="stringliteral">&#39; --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  $script .= <span class="stringliteral">&#39;&lt;script&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  $script .= <span class="stringliteral">&#39;$(document).ready(function() {</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral">          var autoselect = &#39;</span>.((int) $autoselect).<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">          var options = &#39;</span>.json_encode($ajaxoptions).<span class="stringliteral">&#39;; /* Option of actions to do after keyup, or after select */</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">          /* Remove selected id as soon as we type or delete a char (it means old selection is wrong). Use keyup/down instead of change to avoid loosing the product id. This is needed only for select of predefined product */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">          $(&quot;input#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).keydown(function(e) {</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">            if (e.keyCode != 9)   /* If not &quot;Tab&quot; key */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">            {</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">              if (e.keyCode == 13) { return false; } /* disable &quot;ENTER&quot; key useful for barcode readers */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">              console.log(&quot;Clear id previously selected for field &#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;);</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(&quot;&quot;);</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">          });</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="stringliteral">          // Check options for secondary actions when keyup</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="stringliteral">          $(&quot;input#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).keyup(function() {</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="stringliteral">                if ($(this).val().length == 0)</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="stringliteral">                {</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="stringliteral">                              $(&quot;#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(&quot;&quot;);</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="stringliteral">                              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(&quot;&quot;).trigger(&quot;change&quot;);</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral">                              if (options.option_disabled) {</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + options.option_disabled).removeAttr(&quot;disabled&quot;);</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">                  if (options.disabled) {</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral">                    $.each(options.disabled, function(key, value) {</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">                      $(&quot;#&quot; + value).removeAttr(&quot;disabled&quot;);</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral">                  if (options.update) {</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">                    $.each(options.update, function(key, value) {</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">                      $(&quot;#&quot; + key).val(&quot;&quot;).trigger(&quot;change&quot;);</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">                if (options.show) {</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">                    $.each(options.show, function(key, value) {</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">                      $(&quot;#&quot; + value).hide().trigger(&quot;hide&quot;);</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">                if (options.update_textarea) {</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">                    $.each(options.update_textarea, function(key, value) {</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral">                      if (typeof CKEDITOR == &quot;object&quot; &amp;&amp; typeof CKEDITOR.instances != &quot;undefined&quot; &amp;&amp; CKEDITOR.instances[key] != &quot;undefined&quot;) {</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">                        CKEDITOR.instances[key].setData(&quot;&quot;);</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral">                      } else {</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">                        $(&quot;#&quot; + key).html(&quot;&quot;);</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral">                    });</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">                    });</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">            $(&quot;input#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).autocomplete({</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">              source: function( request, response ) {</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">                $.get(&quot;&#39;</span>.$url.($urloption ? <span class="charliteral">&#39;?&#39;</span>.$urloption : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;, { &quot;&#39;</span>.str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $htmlname).<span class="stringliteral">&#39;&quot;: request.term }, function(data){</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral">                if (data != null)</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="stringliteral">                {</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="stringliteral">                  response($.map( data, function(item) {</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">                    if (autoselect == 1 &amp;&amp; data.length == 1) {</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">                      $(&quot;#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(item.value);</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">                      $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(item.key).trigger(&quot;change&quot;);</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">                    var label = &quot;&quot;;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="stringliteral">                    if (item.label != null) {</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="stringliteral">                      label = item.label.toString();</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="stringliteral">                    var update = {};</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="stringliteral">                    if (options.update) {</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="stringliteral">                      $.each(options.update, function(key, value) {</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral">                        update[key] = item[value];</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">                      });</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">                    var textarea = {};</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral">                    if (options.update_textarea) {</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">                      $.each(options.update_textarea, function(key, value) {</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">                        textarea[key] = item[value];</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral">                      });</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">                    console.log(&quot;Return value from GET to the rest of code&quot;);</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">                    return { label: label,</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">                         value: item.value,</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">                         id: item.key,</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">                         disabled: item.disabled,</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">                         update: update,</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">                         textarea: textarea,</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">                         pbq: item.pbq,</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">                         type: item.type,</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">                         qty: item.qty,</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">                         discount: item.discount,</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">                         pricebasetype: item.pricebasetype,</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">                         price_ht: item.price_ht,</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">                         price_ttc: item.price_ttc,</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="stringliteral">                         price_unit_ht: item.price_unit_ht,</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="stringliteral">                         price_unit_ht_locale: item.price_unit_ht_locale,</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="stringliteral">                         description : item.description,</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="stringliteral">                         ref_customer: item.ref_customer,</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral">                         tva_tx: item.tva_tx,</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral">                         default_vat_code: item.default_vat_code</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">                  }));</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">                  console.error(&quot;Error: Ajax url &#39;</span>.$url.($urloption ? <span class="charliteral">&#39;?&#39;</span>.$urloption : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39; has returned an empty page. Should be an empty json array.&quot;);</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">              }, &quot;json&quot;);</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="stringliteral">            },</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="stringliteral">            dataType: &quot;json&quot;,</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="stringliteral">              minLength: &#39;</span>.((<span class="keywordtype">int</span>) $minLength).<span class="stringliteral">&#39;,</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="stringliteral">              select: function( event, ui ) {   // Function ran once new value has been selected into javascript combo</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="stringliteral">                console.log(&quot;We will trigger change on input &#39;</span>.$htmlname.<span class="stringliteral">&#39; because of the select definition of autocomplete code for input#search_&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;);</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="stringliteral">                  console.log(&quot;Selected id = &quot;+ui.item.id+&quot; - If this value is null, it means you select a record with key that is null so selection is not effective&quot;);</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">              console.log(&quot;Propagate before some properties retrieved by ajax into data-xxx properties of #&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39; component&quot;);</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">              //console.log(ui.item);</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="stringliteral">              // For supplier price and customer when price by quantity is off</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-up&quot;, ui.item.price_ht);</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-up-locale&quot;, ui.item.price_unit_ht_locale);</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-base&quot;, ui.item.pricebasetype);</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-qty&quot;, ui.item.qty);</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-discount&quot;, ui.item.discount);</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-description&quot;, ui.item.description);</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-ref-customer&quot;, ui.item.ref_customer);</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-tvatx&quot;, ui.item.tva_tx);</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-default-vat-code&quot;, ui.item.default_vat_code);</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral">  &#39;</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <a class="code" href="../../d9/dc1/journals__list_8php.html#a90b302d5a7120cd0d34478405407d439">if</a> (!empty($conf-&gt;global-&gt;PRODUIT_CUSTOMER_PRICES_BY_QTY)) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    $script .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">              // For customer price when PRODUIT_CUSTOMER_PRICES_BY_QTY is on</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">              console.log(&quot;PRODUIT_CUSTOMER_PRICES_BY_QTY is on, propagate also prices by quantity into data-pbqxxx properties&quot;);</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-pbq&quot;, ui.item.pbq);</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-pbqup&quot;, ui.item.price_ht);</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-pbqbase&quot;, ui.item.pricebasetype);</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-pbqqty&quot;, ui.item.qty);</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).attr(&quot;data-pbqpercent&quot;, ui.item.discount);</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">    &#39;</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  $script .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral">              // A new value has been selected, we trigger the handlers on #htmlnamejquery</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">              console.log(&quot;Trigger changes on #&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;);</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="stringliteral">              $(&quot;#&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).val(ui.item.id).trigger(&quot;change&quot;);  // Select new value</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">              // Complementary actions</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral">                // Disable an element</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">                if (options.option_disabled) {</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral">                  console.log(&quot;Make action option_disabled on #&quot;+options.option_disabled+&quot; with disabled=&quot;+ui.item.disabled)</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral">                  if (ui.item.disabled) {</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">                  $(&quot;#&quot; + options.option_disabled).prop(&quot;disabled&quot;, true);</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">                    if (options.error) {</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">                      $.jnotify(options.error, &quot;error&quot;, true);    // Output with jnotify the error message</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">                    if (options.warning) {</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">                      $.jnotify(options.warning, &quot;warning&quot;, false);   // Output with jnotify the warning message</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + options.option_disabled).removeAttr(&quot;disabled&quot;);</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">                if (options.disabled) {</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">                  console.log(&quot;Make action disabled on each &quot;+options.option_disabled)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">                  $.each(options.disabled, function(key, value) {</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="stringliteral">                  $(&quot;#&quot; + value).prop(&quot;disabled&quot;, true);</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="stringliteral">                if (options.show) {</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="stringliteral">                  console.log(&quot;Make action show on each &quot;+options.show)</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="stringliteral">                  $.each(options.show, function(key, value) {</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + value).show().trigger(&quot;show&quot;);</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">                // Update an input</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">                if (ui.item.update) {</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">                  console.log(&quot;Make action update on each ui.item.update (if there is)&quot;)</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">                  // loop on each &quot;update&quot; fields</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">                  $.each(ui.item.update, function(key, value) {</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">                  console.log(&quot;Set value &quot;+value+&quot; into #&quot;+key);</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + key).val(value).trigger(&quot;change&quot;);</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral">                if (ui.item.textarea) {</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">                  console.log(&quot;Make action textarea on each ui.item.textarea (if there is)&quot;)</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">                  $.each(ui.item.textarea, function(key, value) {</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">                    if (typeof CKEDITOR == &quot;object&quot; &amp;&amp; typeof CKEDITOR.instances != &quot;undefined&quot; &amp;&amp; CKEDITOR.instances[key] != &quot;undefined&quot;) {</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">                      CKEDITOR.instances[key].setData(value);</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">                      CKEDITOR.instances[key].focus();</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">                    } else {</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">                      $(&quot;#&quot; + key).html(value);</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">                      $(&quot;#&quot; + key).focus();</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">                console.log(&quot;ajax_autocompleter new value selected, we trigger change also on original component so on field #search_&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;);</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">                $(&quot;#search_&#39;</span>.$htmlnamejquery.<span class="stringliteral">&#39;&quot;).trigger(&quot;change&quot;); // We have changed value of the combo select, we must be sure to trigger all js hook binded on this event. This is required to trigger other javascript change method binded on original field by other code.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">              ,delay: 500</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">          }).data(&quot;&#39;</span>.$dataforrenderITem.<span class="stringliteral">&#39;&quot;)._renderItem = function( ul, item ) {</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral">            return $(&quot;&lt;li&gt;&quot;)</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">            .data( &quot;&#39;</span>.$dataforitem.<span class="stringliteral">&#39;&quot;, item ) // jQuery UI &gt; 1.10.0</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="stringliteral">            .append( \&#39;&lt;a&gt;&lt;span class=&quot;tag&quot;&gt;\&#39; + item.label + &quot;&lt;/span&gt;&lt;/a&gt;&quot; )</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="stringliteral">            .appendTo(ul);</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="stringliteral">          };</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral">          });&#39;</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  $script .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">return</span> $script;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#a6c6162ff1b03b78df25450d5f2af526a">  297</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a6c6162ff1b03b78df25450d5f2af526a">ajax_multiautocompleter</a>($htmlname, $fields, $url, $option = <span class="stringliteral">&#39;&#39;</span>, $minLength = 2, $autoselect = 0)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  $script = <span class="stringliteral">&#39;&lt;!-- Autocomplete --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  $script .= <span class="stringliteral">&#39;&lt;script&gt;&#39;</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  $script .= <span class="stringliteral">&#39;jQuery(document).ready(function() {</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">          var fields = &#39;</span>.json_encode($fields).<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">          var nboffields = fields.length;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">          var autoselect = &#39;</span>.$autoselect.<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">          //alert(fields + &quot; &quot; + nboffields);</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="stringliteral">            jQuery(&quot;input#&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;).autocomplete({</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral">              dataType: &quot;json&quot;,</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">              minLength: &#39;</span>.$minLength.<span class="stringliteral">&#39;,</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral">              source: function( request, response ) {</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">                jQuery.getJSON( &quot;&#39;</span>.$url.($option ? <span class="charliteral">&#39;?&#39;</span>.$option : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;, { &#39;</span>.$htmlname.<span class="stringliteral">&#39;: request.term }, function(data){</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="stringliteral">                response( jQuery.map( data, function( item ) {</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral">                  if (autoselect == 1 &amp;&amp; data.length == 1) {</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">                    jQuery(&quot;#&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;).val(item.value);</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral">                    // TODO move this to specific request</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">                    if (item.states) {</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">                      jQuery(&quot;#state_id&quot;).html(item.states);</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">                    for (i=0;i&lt;nboffields;i++) {</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">                      if (item[fields[i]]) {   // If defined</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral">                                              //alert(item[fields[i]]);</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">                        jQuery(&quot;#&quot; + fields[i]).val(item[fields[i]]);</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">                      }</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral">                  return item</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">                }));</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">              },</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">              select: function( event, ui ) {</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">                  needtotrigger = &quot;&quot;;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral">                for (i=0;i&lt;nboffields;i++) {</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">                  //alert(fields[i] + &quot; = &quot; + ui.item[fields[i]]);</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral">                if (fields[i]==&quot;selectcountry_id&quot;)</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="stringliteral">                {</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="stringliteral">                    if (ui.item[fields[i]] &gt; 0)     // Do not erase country if unknown</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="stringliteral">                    {</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="stringliteral">                      oldvalue=jQuery(&quot;#&quot; + fields[i]).val();</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral">                        newvalue=ui.item[fields[i]];</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral">                      //alert(oldvalue+&quot; &quot;+newvalue);</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">                        jQuery(&quot;#&quot; + fields[i]).val(ui.item[fields[i]]);</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">                        if (oldvalue != newvalue) // To force select2 to refresh visible content</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral">                        {</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral">                        needtotrigger=&quot;#&quot; + fields[i];</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="stringliteral">                        // If we set new country and new state, we need to set a new list of state to allow change</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral">                                        if (ui.item.states &amp;&amp; ui.item[&quot;state_id&quot;] != jQuery(&quot;#state_id&quot;).value) {</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">                                            jQuery(&quot;#state_id&quot;).html(ui.item.states);</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">                                        }</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="stringliteral">                                else if (fields[i]==&quot;state_id&quot; || fields[i]==&quot;state_id&quot;)</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="stringliteral">                                {</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="stringliteral">                                    if (ui.item[fields[i]] &gt; 0)     // Do not erase state if unknown</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">                                    {</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral">                      oldvalue=jQuery(&quot;#&quot; + fields[i]).val();</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">                        newvalue=ui.item[fields[i]];</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral">                      //alert(oldvalue+&quot; &quot;+newvalue);</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">                                        jQuery(&quot;#&quot; + fields[i]).val(ui.item[fields[i]]);    // This may fails if not correct country</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">                        if (oldvalue != newvalue) // To force select2 to refresh visible content</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral">                        {</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">                        needtotrigger=&quot;#&quot; + fields[i];</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">                                    }</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">                                }</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">                else if (ui.item[fields[i]]) {   // If defined</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral">                    oldvalue=jQuery(&quot;#&quot; + fields[i]).val();</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="stringliteral">                      newvalue=ui.item[fields[i]];</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="stringliteral">                    //alert(oldvalue+&quot; &quot;+newvalue);</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="stringliteral">                      jQuery(&quot;#&quot; + fields[i]).val(ui.item[fields[i]]);</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">                      if (oldvalue != newvalue) // To force select2 to refresh visible content</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">                      {</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">                      needtotrigger=&quot;#&quot; + fields[i];</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">                if (needtotrigger != &quot;&quot;)  // To force select2 to refresh visible content</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">                {</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">                  // We introduce a delay so hand is back to js and all other js change can be done before the trigger that may execute a submit is done</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral">                  // This is required for example when changing zip with autocomplete that change the country</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">                  jQuery(needtotrigger).delay(500).queue(function() {</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral">                      jQuery(this).trigger(&quot;change&quot;);</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="stringliteral">                  });</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="stringliteral">          });</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral">          });&#39;</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  $script .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">return</span> $script;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#a502d0500db4087157edfa026606fbadd">  404</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a502d0500db4087157edfa026606fbadd">ajax_dialog</a>($title, $message, $w = 350, $h = 150)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  global $langs;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  $newtitle = <a class="code" href="../../d9/d69/functions_8lib_8php.html#a969562b15c3223c207f68a09730831d5">dol_textishtml</a>($title) ?<a class="code" href="../../d9/d69/functions_8lib_8php.html#a31088e17d267b7a42e549a10b7d8e90f">dol_string_nohtmltag</a>($title, 1) : $title;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  $msg = <span class="stringliteral">&#39;&lt;div id=&quot;dialog-info&quot; title=&quot;&#39;</span>.dol_escape_htmltag($newtitle).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  $msg .= $message;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  $msg .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  $msg .= <span class="stringliteral">&#39;&lt;script&gt;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="stringliteral">    jQuery(function() {</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="stringliteral">        jQuery(&quot;#dialog-info&quot;).dialog({</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="stringliteral">          resizable: false,</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="stringliteral">          height:&#39;</span>.$h.<span class="stringliteral">&#39;,</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="stringliteral">          width:&#39;</span>.$w.<span class="stringliteral">&#39;,</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="stringliteral">          modal: true,</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="stringliteral">          buttons: {</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="stringliteral">            Ok: function() {</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="stringliteral">          jQuery(this).dialog(\&#39;close\&#39;);</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="stringliteral">          }</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="stringliteral">      });</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="stringliteral">  });</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="stringliteral">  &lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  $msg .= <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">return</span> $msg;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#a2d669eb90f016c3f09a51362d709027f">  449</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a2d669eb90f016c3f09a51362d709027f">ajax_combobox</a>($htmlname, $events = array(), $minLengthToAutocomplete = 0, $forcefocus = 0, $widthTypeOfAutocomplete = <span class="stringliteral">&#39;resolve&#39;</span>, $idforemptyvalue = <span class="stringliteral">&#39;-1&#39;</span>, $morecss = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;{</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  global $conf;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// select2 can be disabled for smartphones</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;browser-&gt;layout) &amp;&amp; $conf-&gt;browser-&gt;layout == <span class="stringliteral">&#39;phone&#39;</span> &amp;&amp; !empty($conf-&gt;global-&gt;MAIN_DISALLOW_SELECT2_WITH_SMARTPHONE)) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_DISABLE_AJAX_COMBOX)) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;use_javascript_ajax)) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;MAIN_USE_JQUERY_MULTISELECT) &amp;&amp; !defined(<span class="stringliteral">&#39;REQUIRE_JQUERY_MULTISELECT&#39;</span>)) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (!empty($conf-&gt;global-&gt;MAIN_OPTIMIZEFORTEXTBROWSER)) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (empty($minLengthToAutocomplete)) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    $minLengthToAutocomplete = 0;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  $moreselect2theme = ($morecss ? <a class="code" href="../../d9/d69/functions_8lib_8php.html#a65bc772e2c2da824fffab2c113e7a15c">dol_escape_js</a>(<span class="charliteral">&#39; &#39;</span>.$morecss) : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  $moreselect2theme = preg_replace(<span class="stringliteral">&#39;/widthcentpercentminus[^\s]*/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $moreselect2theme);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  $tmpplugin = <span class="stringliteral">&#39;select2&#39;</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  $msg = <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;&lt;!-- JS CODE TO ENABLE &#39;</span>.$tmpplugin.<span class="stringliteral">&#39; for id = &#39;</span>.$htmlname.<span class="stringliteral">&#39; --&gt;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="stringliteral">    &lt;script&gt;</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="stringliteral">      $(document).ready(function () {</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="stringliteral">        $(\&#39;&#39;</span>.(preg_match(<span class="stringliteral">&#39;/^\./&#39;</span>, $htmlname) ? $htmlname : <span class="charliteral">&#39;#&#39;</span>.$htmlname).<span class="charliteral">&#39;\&#39;</span>).<span class="stringliteral">&#39;.$tmpplugin.&#39;</span>({</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          dir: \<span class="stringliteral">&#39;ltr\&#39;,</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="stringliteral">          width: \&#39;&#39;</span>.dol_escape_js($widthTypeOfAutocomplete).<span class="charliteral">&#39;\&#39;</span>,   <span class="comment">/* off or resolve */</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          minimumInputLength: <span class="stringliteral">&#39;.((int) $minLengthToAutocomplete).&#39;</span>,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          language: select2arrayoflanguage,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;          matcher: <span class="keyword">function</span> (params, data) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span> ($.trim(params.term) === <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;              <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            keywords = (params.term).split(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">for</span> (var i = 0; i &lt; keywords.length; i++) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;              <span class="keywordflow">if</span> (((data.text).toUpperCase()).indexOf((keywords[i]).toUpperCase()) == -1) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">null</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;              }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          },</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          theme: \<span class="stringliteral">&#39;default&#39;</span>.$moreselect2theme.<span class="charliteral">&#39;\&#39;</span>,    <span class="comment">/* to add css on generated html components */</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          containerCssClass: \<span class="stringliteral">&#39;:all:\&#39;,         /* Line to add class of origin SELECT propagated to the new &lt;span class=&quot;select2-selection...&gt; tag */</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="stringliteral">          selectionCssClass: \&#39;:all:\&#39;,         /* Line to add class of origin SELECT propagated to the new &lt;span class=&quot;select2-selection...&gt; tag */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="stringliteral">          templateResult: function (data, container) {  /* Format visible output into combo list */</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="stringliteral">            /* Code to add class of origin OPTION propagated to the new select2 &lt;li&gt; tag */</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="stringliteral">            if (data.element) { $(container).addClass($(data.element).attr(&quot;class&quot;)); }</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="stringliteral">            //console.log($(data.element).attr(&quot;data-html&quot;));</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="stringliteral">            if (data.id == &#39;</span>.((int) $idforemptyvalue).<span class="stringliteral">&#39; &amp;&amp; $(data.element).attr(&quot;data-html&quot;) == undefined) {</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="stringliteral">              return \&#39;&amp;nbsp;\&#39;;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="stringliteral">            if ($(data.element).attr(&quot;data-html&quot;) != undefined) return htmlEntityDecodeJs($(data.element).attr(&quot;data-html&quot;));   // If property html set, we decode html entities and use this</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="stringliteral">            return data.text;</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="stringliteral">          },</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="stringliteral">          templateSelection: function (selection) {   /* Format visible output of selected value */</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="stringliteral">            if (selection.id == &#39;</span>.((int) $idforemptyvalue).<span class="stringliteral">&#39;) return \&#39;&lt;span class=&quot;placeholder&quot;&gt;\&#39;+selection.text+\&#39;&lt;/span&gt;\&#39;;</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="stringliteral">            return selection.text;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="stringliteral">          },</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="stringliteral">          escapeMarkup: function(markup) {</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="stringliteral">            return markup;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="stringliteral">          },</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="stringliteral">          dropdownCssClass: \&#39;ui-dialog\&#39;</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="stringliteral">        })&#39;</span>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> ($forcefocus) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    $msg .= <span class="stringliteral">&#39;.select2(\&#39;focus\&#39;)&#39;</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  $msg .= <span class="charliteral">&#39;;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">if</span> (is_array($events) &amp;&amp; count($events)) {    <span class="comment">// If an array of js events to do were provided.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    $msg .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="stringliteral">      jQuery(&quot;#&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;).change(function () {</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">        var obj = &#39;</span>.json_encode($events).<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="stringliteral">          $.each(obj, function(key,values) {</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">            if (values.method.length) {</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="stringliteral">              runJsCodeForEvent&#39;</span>.$htmlname.<span class="stringliteral">&#39;(values);</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="stringliteral">        });</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="stringliteral">      });</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">      function runJsCodeForEvent&#39;</span>.$htmlname.<span class="stringliteral">&#39;(obj) {</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral">        var id = $(&quot;#&#39;</span>.$htmlname.<span class="stringliteral">&#39;&quot;).val();</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral">        var method = obj.method;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral">        var url = obj.url;</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral">        var htmlname = obj.htmlname;</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">        var showempty = obj.showempty;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral">        console.log(&quot;Run runJsCodeForEvent-&#39;</span>.$htmlname.<span class="stringliteral">&#39; from ajax_combobox id=&quot;+id+&quot; method=&quot;+method+&quot; showempty=&quot;+showempty+&quot; url=&quot;+url+&quot; htmlname=&quot;+htmlname);</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="stringliteral">        $.getJSON(url,</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="stringliteral">            {</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="stringliteral">              action: method,</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="stringliteral">              id: id,</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="stringliteral">              htmlname: htmlname,</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="stringliteral">              showempty: showempty</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="stringliteral">            },</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="stringliteral">            function(response) {</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="stringliteral">              $.each(obj.params, function(key,action) {</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="stringliteral">                if (key.length) {</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="stringliteral">                  var num = response.num;</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="stringliteral">                  if (num &gt; 0) {</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + key).removeAttr(action);</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="stringliteral">                  } else {</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="stringliteral">                    $(&quot;#&quot; + key).attr(action, action);</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="stringliteral">                  }</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="stringliteral">              });</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="stringliteral">              $(&quot;select#&quot; + htmlname).html(response.value);</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="stringliteral">              if (response.num) {</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="stringliteral">                var selecthtml_str = response.value;</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="stringliteral">                var selecthtml_dom=$.parseHTML(selecthtml_str);</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="stringliteral">                if (typeof(selecthtml_dom[0][0]) !== \&#39;undefined\&#39;) {</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="stringliteral">                                    $(&quot;#inputautocomplete&quot;+htmlname).val(selecthtml_dom[0][0].innerHTML);</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">              } else {</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral">                $(&quot;#inputautocomplete&quot;+htmlname).val(&quot;&quot;);</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">              }</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral">              $(&quot;select#&quot; + htmlname).change(); /* Trigger event change */</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral">        );</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">      }&#39;</span>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  $msg .= <span class="stringliteral">&#39;});&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  $msg .= <span class="stringliteral">&quot;&lt;/script&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">return</span> $msg;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#a990bd5380ad240c0383f0f5a82b35acc">  601</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d7/d9a/ajax_8lib_8php.html#a990bd5380ad240c0383f0f5a82b35acc">ajax_constantonoff</a>($code, $input = array(), $entity = <span class="keyword">null</span>, $revertonoff = 0, $strict = 0, $forcereload = 0, $marginleftonlyshort = 2, $forcenoajax = 0, $setzeroinsteadofdel = 0, $suffix = <span class="stringliteral">&#39;&#39;</span>, $mode = <span class="stringliteral">&#39;&#39;</span>, $morecss = <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;{</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  global $conf, $langs, $user;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  $entity = ((isset($entity) &amp;&amp; is_numeric($entity) &amp;&amp; $entity &gt;= 0) ? $entity : $conf-&gt;entity);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">if</span> (!isset($input)) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    $input = array();</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordflow">if</span> (empty($conf-&gt;use_javascript_ajax) || $forcenoajax) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (empty($conf-&gt;global-&gt;$code)) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      print <span class="stringliteral">&#39;&lt;a &#39;</span>.($morecss ? <span class="stringliteral">&#39;class=&quot;&#39;</span>.$morecss.<span class="stringliteral">&#39;&quot; &#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>].<span class="stringliteral">&#39;?action=set_&#39;</span>.$code.<span class="stringliteral">&#39;&amp;token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>().<span class="stringliteral">&#39;&amp;entity=&#39;</span>.$entity.($mode ? <span class="stringliteral">&#39;&amp;mode=&#39;</span>.$mode : <span class="stringliteral">&#39;&#39;</span>).($forcereload ? <span class="stringliteral">&#39;&amp;dol_resetcache=1&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&quot;Disabled&quot;</span>), <span class="stringliteral">&#39;off&#39;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      print <span class="stringliteral">&#39;&lt;a &#39;</span>.($morecss ? <span class="stringliteral">&#39;class=&quot;&#39;</span>.$morecss.<span class="stringliteral">&#39;&quot; &#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39; href=&quot;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>].<span class="stringliteral">&#39;?action=del_&#39;</span>.$code.<span class="stringliteral">&#39;&amp;token=&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a>().<span class="stringliteral">&#39;&amp;entity=&#39;</span>.$entity.($mode ? <span class="stringliteral">&#39;&amp;mode=&#39;</span>.$mode : <span class="stringliteral">&#39;&#39;</span>).($forcereload ? <span class="stringliteral">&#39;&amp;dol_resetcache=1&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a>($langs-&gt;trans(<span class="stringliteral">&quot;Enabled&quot;</span>), <span class="stringliteral">&#39;on&#39;</span>).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    $out = <span class="stringliteral">&quot;\n&lt;!-- Ajax code to switch constant &quot;</span>.$code.<span class="stringliteral">&quot; --&gt;&quot;</span>.<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">    &lt;script&gt;</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">      $(document).ready(function() {</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">        var input = &#39;</span>.json_encode($input).<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">        var url = \&#39;&#39;</span>.DOL_URL_ROOT.<span class="stringliteral">&#39;/core/ajax/constantonoff.php\&#39;;</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">        var code = \&#39;&#39;</span>.<a class="code" href="../../d9/d69/functions_8lib_8php.html#a65bc772e2c2da824fffab2c113e7a15c">dol_escape_js</a>($code).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        var entity = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js($entity).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        var strict = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js($strict).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        var userid = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js($user-&gt;id).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        var yesButton = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js($langs-&gt;transnoentities(<span class="stringliteral">&quot;Yes&quot;</span>)).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        var noButton = \<span class="stringliteral">&#39;&#39;</span>.dol_escape_js($langs-&gt;transnoentities(<span class="stringliteral">&quot;No&quot;</span>)).<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        var token = \<span class="stringliteral">&#39;&#39;</span>.currentToken().<span class="charliteral">&#39;\&#39;</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">// Set constant</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        $(<span class="stringliteral">&quot;#set_&quot;</span> + <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          <span class="keywordflow">if</span> (input.alert &amp;&amp; input.alert.set) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">if</span> (input.alert.set.yesButton) yesButton = input.alert.set.yesButton;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">if</span> (input.alert.set.noButton)  noButton = input.alert.set.noButton;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            confirmConstantAction(<span class="stringliteral">&quot;set&quot;</span>, url, <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>, input, input.alert.set, entity, yesButton, noButton, strict, userid, token);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            setConstant(url, <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>, input, entity, 0, <span class="stringliteral">&#39;.((int) $forcereload).&#39;</span>, userid, token);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        });</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="comment">// Del constant</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        $(<span class="stringliteral">&quot;#del_&quot;</span> + <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="keywordflow">if</span> (input.alert &amp;&amp; input.alert.del) {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="keywordflow">if</span> (input.alert.del.yesButton) yesButton = input.alert.del.yesButton;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordflow">if</span> (input.alert.del.noButton)  noButton = input.alert.del.noButton;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            confirmConstantAction(<span class="stringliteral">&quot;del&quot;</span>, url, <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>, input, input.alert.del, entity, yesButton, noButton, strict, userid, token);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          } <span class="keywordflow">else</span> {<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="stringliteral">    if (empty($setzeroinsteadofdel)) {</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">      $out .=&#39;</span>  delConstant(url, <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>, input, entity, 0, <span class="stringliteral">&#39;.((int) $forcereload).&#39;</span>, userid, token);<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral">    } else {</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">      $out .=&#39;</span>  setConstant(url, <a class="code" href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a>, input, entity, 0, <span class="stringliteral">&#39;.((int) $forcereload).&#39;</span>, userid, token, 0);<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">    $out .= &#39;</span> }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        });</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      });</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    &lt;/script&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral">    $out .= &#39;</span>&lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;confirm_&#39;.$code.&#39;&quot;</span> title=<span class="stringliteral">&quot;&quot;</span> style=<span class="stringliteral">&quot;display: none;&quot;</span>&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">    $out .= &#39;</span>&lt;span <span class="keywordtype">id</span>=<span class="stringliteral">&quot;set_&#39;.$code.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;valignmiddle linkobject &#39;.(!empty($conf-&gt;global-&gt;$code) ? &#39;hideobject&#39; : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.($revertonoff ?img_picto($langs-&gt;trans(&quot;Enabled&quot;), &#39;</span>switch_on<span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, false, 0, 0, &#39;</span><span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, $marginleftonlyshort) : img_picto($langs-&gt;trans(&quot;Disabled&quot;), &#39;</span>switch_off<span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, false, 0, 0, &#39;</span><span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, $marginleftonlyshort)).&#39;</span>&lt;/span&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral">    $out .= &#39;</span>&lt;span <span class="keywordtype">id</span>=<span class="stringliteral">&quot;del_&#39;.$code.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;valignmiddle linkobject &#39;.(!empty($conf-&gt;global-&gt;$code) ? &#39;&#39; : &#39;hideobject&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.($revertonoff ?img_picto($langs-&gt;trans(&quot;Disabled&quot;), &#39;</span>switch_off<span class="stringliteral">&#39;.$suffix, &#39;</span><span class="stringliteral">&#39;, false, 0, 0, &#39;</span><span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, $marginleftonlyshort) : img_picto($langs-&gt;trans(&quot;Enabled&quot;), &#39;</span>switch_on<span class="stringliteral">&#39;.$suffix, &#39;</span><span class="stringliteral">&#39;, false, 0, 0, &#39;</span><span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, $marginleftonlyshort)).&#39;</span>&lt;/span&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral">    $out .= &quot;\n&quot;;</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">  }</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral">  return $out;</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00681"></a><span class="lineno"><a class="line" href="../../d7/d9a/ajax_8lib_8php.html#aafd05e1fb55a651b35430881806c56b9">  681</a></span>&#160;<span class="stringliteral">function ajax_object_onoff($object, $code, $field, $text_on, $text_off, $input = array(), $morecss = &#39;</span><span class="stringliteral">&#39;, $htmlname = &#39;</span><span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">{</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="stringliteral">  global $langs;</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="stringliteral">  if (empty($htmlname)) {</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">    $htmlname = $code;</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral">  }</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral">  $out = &#39;</span>&lt;script&gt;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        $(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            var input = <span class="stringliteral">&#39;.json_encode($input).&#39;</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="comment">// Set constant</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            $(<span class="stringliteral">&quot;#set_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        console.log(<span class="stringliteral">&quot;Click managed by ajax_object_onoff&quot;</span>);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                $.get( <span class="stringliteral">&quot;&#39;.DOL_URL_ROOT.&#39;/core/ajax/objectonoff.php&quot;</span>, {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    action: \<span class="stringliteral">&#39;set\&#39;,</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="stringliteral">                    field: \&#39;&#39;</span>.dol_escape_js($field).<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                    value: \<span class="stringliteral">&#39;1\&#39;,</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="stringliteral">                    element: \&#39;&#39;</span>.dol_escape_js($object-&gt;element).<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                    id: \<span class="stringliteral">&#39;&#39;</span>.$object-&gt;id.<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          token: \<span class="stringliteral">&#39;&#39;</span>.currentToken().<span class="charliteral">&#39;\&#39;</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                },</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="keyword">function</span>() {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                    $(<span class="stringliteral">&quot;#set_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).hide();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                    $(<span class="stringliteral">&quot;#del_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).show();</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                    <span class="comment">// Enable another element</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                    <span class="keywordflow">if</span> (input.disabled &amp;&amp; input.disabled.length &gt; 0) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        $.each(input.disabled, <span class="keyword">function</span>(key,value) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                            $(<span class="stringliteral">&quot;#&quot;</span> + value).removeAttr(<span class="stringliteral">&quot;disabled&quot;</span>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                            <span class="keywordflow">if</span> ($(<span class="stringliteral">&quot;#&quot;</span> + value).hasClass(<span class="stringliteral">&quot;butActionRefused&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                                $(<span class="stringliteral">&quot;#&quot;</span> + value).removeClass(<span class="stringliteral">&quot;butActionRefused&quot;</span>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                                $(<span class="stringliteral">&quot;#&quot;</span> + value).addClass(<span class="stringliteral">&quot;butAction&quot;</span>);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                            }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                        });</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                    <span class="comment">// Show another element</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (input.showhide &amp;&amp; input.showhide.length &gt; 0) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                        $.each(input.showhide, <span class="keyword">function</span>(key,value) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                            $(<span class="stringliteral">&quot;#&quot;</span> + value).show();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                        });</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                });</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            });</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <span class="comment">// Del constant</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            $(<span class="stringliteral">&quot;#del_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).click(<span class="keyword">function</span>() {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        console.log(<span class="stringliteral">&quot;Click managed by ajax_object_onoff&quot;</span>);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                $.get( <span class="stringliteral">&quot;&#39;.DOL_URL_ROOT.&#39;/core/ajax/objectonoff.php&quot;</span>, {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                    action: \<span class="stringliteral">&#39;set\&#39;,</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="stringliteral">                    field: \&#39;&#39;</span>.dol_escape_js($field).<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                    value: \<span class="stringliteral">&#39;0\&#39;,</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="stringliteral">                    element: \&#39;&#39;</span>.dol_escape_js($object-&gt;element).<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    id: \<span class="stringliteral">&#39;&#39;</span>.$object-&gt;id.<span class="charliteral">&#39;\&#39;</span>,</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          token: \<span class="stringliteral">&#39;&#39;</span>.currentToken().<span class="charliteral">&#39;\&#39;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                },</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="keyword">function</span>() {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    $(<span class="stringliteral">&quot;#del_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).hide();</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    $(<span class="stringliteral">&quot;#set_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span>).show();</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    <span class="comment">// Disable another element</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    <span class="keywordflow">if</span> (input.disabled &amp;&amp; input.disabled.length &gt; 0) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        $.each(input.disabled, <span class="keyword">function</span>(key,value) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                            $(<span class="stringliteral">&quot;#&quot;</span> + value).prop(<span class="stringliteral">&quot;disabled&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                            <span class="keywordflow">if</span> ($(<span class="stringliteral">&quot;#&quot;</span> + value).hasClass(<span class="stringliteral">&quot;butAction&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                $(<span class="stringliteral">&quot;#&quot;</span> + value).removeClass(<span class="stringliteral">&quot;butAction&quot;</span>);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                $(<span class="stringliteral">&quot;#&quot;</span> + value).addClass(<span class="stringliteral">&quot;butActionRefused&quot;</span>);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                            }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                        });</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    <span class="comment">// Hide another element</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (input.showhide &amp;&amp; input.showhide.length &gt; 0) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        $.each(input.showhide, <span class="keyword">function</span>(key,value) {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                            $(<span class="stringliteral">&quot;#&quot;</span> + value).hide();</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        });</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                });</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            });</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        });</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    &lt;/script&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">  $out .= &#39;</span>&lt;span <span class="keywordtype">id</span>=<span class="stringliteral">&quot;set_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;linkobject &#39;.($object-&gt;$code == 1 ? &#39;hideobject&#39; : &#39;&#39;).($morecss ? &#39; &#39;.$morecss : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.img_picto($langs-&gt;trans($text_off), &#39;</span>switch_off<span class="stringliteral">&#39;).&#39;</span>&lt;/span&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">  $out .= &#39;</span>&lt;span <span class="keywordtype">id</span>=<span class="stringliteral">&quot;del_&#39;.$htmlname.&#39;_&#39;.$object-&gt;id.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;linkobject &#39;.($object-&gt;$code == 1 ? &#39;&#39; : &#39;hideobject&#39;).($morecss ? &#39; &#39;.$morecss : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.img_picto($langs-&gt;trans($text_on), &#39;</span>switch_on<span class="stringliteral">&#39;).&#39;</span>&lt;/span&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral">  return $out;</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral">}</span></div>
<div class="ttc" id="aajax_8lib_8php_html_a0a7c9bd5a445373c4bcb0c1e6aec4f52"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a0a7c9bd5a445373c4bcb0c1e6aec4f52">ajax_autocompleter</a></div><div class="ttdeci">ajax_autocompleter($selected, $htmlname, $url, $urloption='', $minLength=2, $autoselect=0, $ajaxoptions=array(), $moreparams='')</div><div class="ttdoc">Generic function that return javascript to add to a page to transform a common input field into an au...</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00047">ajax.lib.php:47</a></div></div>
<div class="ttc" id="aajax_8lib_8php_html_a2d669eb90f016c3f09a51362d709027f"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a2d669eb90f016c3f09a51362d709027f">ajax_combobox</a></div><div class="ttdeci">ajax_combobox($htmlname, $events=array(), $minLengthToAutocomplete=0, $forcefocus=0, $widthTypeOfAutocomplete='resolve', $idforemptyvalue='-1', $morecss='')</div><div class="ttdoc">Convert a html select field into an ajax combobox.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00449">ajax.lib.php:449</a></div></div>
<div class="ttc" id="aajax_8lib_8php_html_a502d0500db4087157edfa026606fbadd"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a502d0500db4087157edfa026606fbadd">ajax_dialog</a></div><div class="ttdeci">ajax_dialog($title, $message, $w=350, $h=150)</div><div class="ttdoc">Show an ajax dialog.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00404">ajax.lib.php:404</a></div></div>
<div class="ttc" id="aajax_8lib_8php_html_a6c6162ff1b03b78df25450d5f2af526a"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a6c6162ff1b03b78df25450d5f2af526a">ajax_multiautocompleter</a></div><div class="ttdeci">ajax_multiautocompleter($htmlname, $fields, $url, $option='', $minLength=2, $autoselect=0)</div><div class="ttdoc">Generic function that return javascript to add to a page to transform a common input field into an au...</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00297">ajax.lib.php:297</a></div></div>
<div class="ttc" id="aajax_8lib_8php_html_a990bd5380ad240c0383f0f5a82b35acc"><div class="ttname"><a href="../../d7/d9a/ajax_8lib_8php.html#a990bd5380ad240c0383f0f5a82b35acc">ajax_constantonoff</a></div><div class="ttdeci">ajax_constantonoff($code, $input=array(), $entity=null, $revertonoff=0, $strict=0, $forcereload=0, $marginleftonlyshort=2, $forcenoajax=0, $setzeroinsteadofdel=0, $suffix='', $mode='', $morecss='')</div><div class="ttdoc">On/off button for constant.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9a/ajax_8lib_8php_source.html#l00601">ajax.lib.php:601</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a31088e17d267b7a42e549a10b7d8e90f"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a31088e17d267b7a42e549a10b7d8e90f">dol_string_nohtmltag</a></div><div class="ttdeci">dol_string_nohtmltag($stringtoclean, $removelinefeed=1, $pagecodeto='UTF-8', $strip_tags=0, $removedoublespaces=1)</div><div class="ttdoc">Clean a string from all HTML tags and entities.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l06841">functions.lib.php:6841</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a64fc44ee4f3329fe0ff256b57bffc128"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a64fc44ee4f3329fe0ff256b57bffc128">img_picto</a></div><div class="ttdeci">img_picto($titlealt, $picto, $moreatt='', $pictoisfullpath=false, $srconly=0, $notitle=0, $alt='', $morecss='', $marginleftonlyshort=2)</div><div class="ttdoc">Show picto whatever it's its name (generic function)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l03989">functions.lib.php:3989</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a65bc772e2c2da824fffab2c113e7a15c"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a65bc772e2c2da824fffab2c113e7a15c">dol_escape_js</a></div><div class="ttdeci">dol_escape_js($stringtoescape, $mode=0, $noescapebackslashn=0)</div><div class="ttdoc">Returns text escaped for inclusion into javascript code.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l01431">functions.lib.php:1431</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a6d79bb77d4de9606546ddfccacf358f9"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a6d79bb77d4de9606546ddfccacf358f9">newToken</a></div><div class="ttdeci">newToken()</div><div class="ttdoc">Return the value of token currently saved into session with name 'newtoken'.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l11185">functions.lib.php:11185</a></div></div>
<div class="ttc" id="afunctions_8lib_8php_html_a969562b15c3223c207f68a09730831d5"><div class="ttname"><a href="../../d9/d69/functions_8lib_8php.html#a969562b15c3223c207f68a09730831d5">dol_textishtml</a></div><div class="ttdeci">dol_textishtml($msg, $option=0)</div><div class="ttdoc">Return if a text is a html content.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d69/functions_8lib_8php_source.html#l07432">functions.lib.php:7432</a></div></div>
<div class="ttc" id="ajournals__list_8php_html_a90b302d5a7120cd0d34478405407d439"><div class="ttname"><a href="../../d9/dc1/journals__list_8php.html#a90b302d5a7120cd0d34478405407d439">if</a></div><div class="ttdeci">if(!defined( 'CSRFCHECK_WITH_TOKEN'))</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc1/journals__list_8php_source.html#l00025">journals_list.php:25</a></div></div>
<div class="ttc" id="async__members__ldap2dolibarr_8php_html_aa4a73b56fb3e90f378bbdb5406f289ef"><div class="ttname"><a href="../../d6/d75/sync__members__ldap2dolibarr_8php.html#aa4a73b56fb3e90f378bbdb5406f289ef">code</a></div><div class="ttdeci">print *****$script_file(&quot;.$version.&quot;) pid code</div><div class="ttdoc">! Closing after partial payment: discount_vat, badcustomer or badsupplier, bankcharge,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d75/sync__members__ldap2dolibarr_8php_source.html#l00162">sync_members_ldap2dolibarr.php:60</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- 
File added into doxygen generated documentation
-->
<hr class="footer" />
<address class="footer"><small>Generated on Mon Jan 2 2023 15:01:54 for <a href="https://www.dolibarr.org" title="ERP and CRM open source software">dolibarr</a> by Doxygen 1.9.1 </small></address>
<br>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9049390-16"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-9049390-16');
</script>
</body>
</html>